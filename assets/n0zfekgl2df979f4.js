import{j as G,r as C,c as _t}from"./izh0i1dfnf8ev7x1.js";import{S as B,l as N,D as S,E as M,m as z,A as Qe,n as X,F as Vt,V as pe,P as Ce,o as Ye,R as $,p as Xe,G as et,W as xe,q as Pt,r as Wt,s as Ut,a as Be,t as jt,v as Kt,w as zt,x as $t,y as qt,z as j,B as Te,H as Jt,I as Zt,J as Qt,K as Yt,L as Xt,M as en,N as tn}from"./knizt02844mv3db5.js";import{d as tt,a as nt,a0 as fe,cu as nn,E as rn}from"./hggowi1ggrzb09yc.js";import{mg as on,ds as rt,mh as sn,az as ln,aA as an,gt as cn,gu as fn}from"./fc2hzad6rtrm7s5f.js";import{w as dn,x as un,y as hn,z as mn,A as gn,B as pn,C as Cn,E as xn,F as An,G as wn,J as kn,K as En,M as bn,O as Sn,Q as Mn,R as vn,S as Ln,U as Dn,V as yn,W as ie}from"./bi1mg4kyc0f39zhq.js";import{a as Bn,Z as Tn}from"./l4ce2zdnnawhaijx.js";import{c as Nn}from"./bgj24r5xl19a9i4c.js";const de=B.define(),ot=N.define({create:()=>null,update:(e,t)=>{const n=t.effects.find(i=>i.is(de));return n?n.value:e}}),On=e=>S.line({class:"!bg-[Highlight]"}).range(e),Rn=e=>S.line({class:"streaming-line-overlay before:content-['*'] before:bg-white/50 dark:before:bg-gray-750/50"}).range(e),Gn=N.define({create:()=>S.none,update:(e,t)=>{e=e.map(t.changes);const n=t.state.field(ot);if(n==null)return S.none;const i=t.state.doc,o=n+1;if(o>i.lines)return S.none;const r=i.line(o),s=On(r.from),l=Array.from({length:i.lines-o},(c,f)=>Rn(i.line(o+1+f).from));return S.set([s,...l])},provide:e=>M.decorations.from(e)}),Fn=e=>[ot.init(()=>e),Gn],it=B.define(),st=B.define(),lt=B.define(),at=B.define(),ue=(e,t)=>e.doc.line(t).from,Z=(e,t,n,i)=>{const o=ue(t,n),r=S.line({attributes:{class:tt("transition-colors bg-transparent",i===1&&"bg-yellow-100 dark:bg-yellow-500 dark:bg-opacity-50")}}).range(ue(t,n));return e.update({add:i===3?[]:[r],filter:s=>s!==o})},In=N.define({create(){return S.none},update(e,t){for(let n of t.effects){const{value:i}=n;if(n.is(it))return Z(e,t.state,i,0);if(n.is(st))return Z(e,t.state,i,1);if(n.is(lt))return Z(e,t.state,i,2);if(n.is(at))return Z(e,t.state,i,3)}return e.map(t.changes)},provide:e=>M.decorations.from(e)}),Hn=[In];function _n(e,t,n=500){e.dispatch({effects:it.of(t)});const i=ue(e.state,t);e.dispatch({selection:{anchor:i,head:i},scrollIntoView:!0}),requestAnimationFrame(()=>{e.dispatch({effects:st.of(t)})}),setTimeout(()=>{e.dispatch({effects:lt.of(t)}),setTimeout(()=>{e.dispatch({effects:at.of(t)})},150)},n),e.focus()}function Vn(e){return e.toString().length}function Pn(e,t,n){return i=>{if(!i.docChanged)return i;const o=Vn(i.state.doc);if(o<=e)return i;n&&t&&on(n,t);const r=i.state.doc.sliceString(0,e),s=i.startState.update({changes:{from:0,to:i.startState.doc.length,insert:r}});return rt.logEvent(nt.canvasCodemirrorMaxLength,{maxLength:e,newLength:o}),[s]}}function Wn(e,t,n){return[z.transactionFilter.of(Pn(n,e,t))]}const ct=Qe.define();function Un(){return M.updateListener.of(e=>{if(!e.docChanged||e.state.readOnly)return;const t=e.state.doc;t.length>0&&t.sliceString(t.length-1)!==`
`&&e.view.dispatch({changes:{from:t.length,to:t.length,insert:`
`},annotations:ct.of(!0)})})}class E{constructor(t,n,i,o){this.fromA=t,this.toA=n,this.fromB=i,this.toB=o}offset(t,n=t){return new E(this.fromA+t,this.toA+t,this.fromB+n,this.toB+n)}}function I(e,t,n,i,o,r){if(e==i)return[];let s=Ae(e,t,n,i,o,r),l=we(e,t+s,n,i,o+s,r);t+=s,n-=l,o+=s,r-=l;let c=n-t,f=r-o;if(!c||!f)return[new E(t,n,o,r)];if(c>f){let d=e.slice(t,n).indexOf(i.slice(o,r));if(d>-1)return[new E(t,t+d,o,o),new E(t+d+f,n,r,r)]}else if(f>c){let d=i.slice(o,r).indexOf(e.slice(t,n));if(d>-1)return[new E(t,t,o,o+d),new E(n,n,o+d+c,r)]}if(c==1||f==1)return[new E(t,n,o,r)];let a=ut(e,t,n,i,o,r);if(a){let[d,u,h]=a;return I(e,t,d,i,o,u).concat(I(e,d+h,n,i,u+h,r))}return jn(e,t,n,i,o,r)}let K=1e9;function jn(e,t,n,i,o,r){let s=n-t,l=r-o;if(K<1e9&&Math.min(s,l)>K*16)return Math.min(s,l)>K*64?[new E(t,n,o,r)]:Ne(e,t,n,i,o,r);let c=Math.ceil((s+l)/2);se.reset(c),le.reset(c);let f=(h,g)=>e.charCodeAt(t+h)==i.charCodeAt(o+g),a=(h,g)=>e.charCodeAt(n-h-1)==i.charCodeAt(r-g-1),d=(s-l)%2!=0?le:null,u=d?null:se;for(let h=0;h<c;h++){if(h>K)return Ne(e,t,n,i,o,r);let g=se.advance(h,s,l,c,d,!1,f)||le.advance(h,s,l,c,u,!0,a);if(g)return Kn(e,t,n,t+g[0],i,o,r,o+g[1])}return[new E(t,n,o,r)]}class ft{vec=[];len;start;end;reset(t){this.len=t<<1;for(let n=0;n<this.len;n++)this.vec[n]=-1;this.vec[t+1]=0,this.start=this.end=0}advance(t,n,i,o,r,s,l){for(let c=-t+this.start;c<=t-this.end;c+=2){let f=o+c,a=c==-t||c!=t&&this.vec[f-1]<this.vec[f+1]?this.vec[f+1]:this.vec[f-1]+1,d=a-c;for(;a<n&&d<i&&l(a,d);)a++,d++;if(this.vec[f]=a,a>n)this.end+=2;else if(d>i)this.start+=2;else if(r){let u=o+(n-i)-c;if(u>=0&&u<this.len&&r.vec[u]!=-1)if(s){let h=r.vec[u];if(h>=n-a)return[h,o+h-u]}else{let h=n-r.vec[u];if(a>=h)return[a,d]}}}return null}}const se=new ft,le=new ft;function Kn(e,t,n,i,o,r,s,l){let c=!1;return!P(e,i)&&++i==n&&(c=!0),!P(o,l)&&++l==s&&(c=!0),c?[new E(t,n,r,s)]:I(e,t,i,o,r,l).concat(I(e,i,n,o,l,s))}function dt(e,t){let n=1,i=Math.min(e,t);for(;n<i;)n=n<<1;return n}function Ae(e,t,n,i,o,r){if(t==n||t==r||e.charCodeAt(t)!=i.charCodeAt(o))return 0;let s=dt(n-t,r-o);for(let l=t,c=o;;){let f=l+s,a=c+s;if(f>n||a>r||e.slice(l,f)!=i.slice(c,a)){if(s==1)return l-t-(P(e,l)?0:1);s=s>>1}else{if(f==n||a==r)return f-t;l=f,c=a}}}function we(e,t,n,i,o,r){if(t==n||o==r||e.charCodeAt(n-1)!=i.charCodeAt(r-1))return 0;let s=dt(n-t,r-o);for(let l=n,c=r;;){let f=l-s,a=c-s;if(f<t||a<o||e.slice(f,l)!=i.slice(a,c)){if(s==1)return n-l-(P(e,l)?0:1);s=s>>1}else{if(f==t||a==o)return n-f;l=f,c=a}}}function he(e,t,n,i,o,r,s,l){let c=i.slice(o,r),f=null;for(;;){if(f||s<l)return f;for(let a=t+s;;){P(e,a)||a++;let d=a+s;if(P(e,d)||(d+=d==a+1?1:-1),d>=n)break;let u=e.slice(a,d),h=-1;for(;(h=c.indexOf(u,h+1))!=-1;){let g=Ae(e,d,n,i,o+h+u.length,r),p=we(e,t,a,i,o,o+h),m=u.length+g+p;(!f||f[2]<m)&&(f=[a-p,o+h-p,m])}a=d}if(l<0)return f;s=s>>1}}function ut(e,t,n,i,o,r){let s=n-t,l=r-o;if(s<l){let c=ut(i,o,r,e,t,n);return c&&[c[1],c[0],c[2]]}return s<4||l*2<s?null:he(e,t,n,i,o,r,Math.floor(s/4),-1)}function Ne(e,t,n,i,o,r){let s=n-t,l=r-o,c;if(s<l){let u=he(i,o,r,e,t,n,Math.floor(s/6),50);c=u&&[u[1],u[0],u[2]]}else c=he(e,t,n,i,o,r,Math.floor(l/6),50);if(!c)return[new E(t,n,o,r)];let[f,a,d]=c;return I(e,t,f,i,o,a).concat(I(e,f+d,n,i,a+d,r))}function ht(e,t){for(let n=1;n<e.length;n++){let i=e[n-1],o=e[n];i.toA>o.fromA-t&&i.toB>o.fromB-t&&(e[n-1]=new E(i.fromA,o.toA,i.fromB,o.toB),e.splice(n--,1))}}function zn(e,t,n){for(;;){ht(n,1);let i=!1;for(let o=0;o<n.length;o++){let r=n[o],s,l;(s=Ae(e,r.fromA,r.toA,t,r.fromB,r.toB))&&(r=n[o]=new E(r.fromA+s,r.toA,r.fromB+s,r.toB)),(l=we(e,r.fromA,r.toA,t,r.fromB,r.toB))&&(r=n[o]=new E(r.fromA,r.toA-l,r.fromB,r.toB-l));let c=r.toA-r.fromA,f=r.toB-r.fromB;if(c&&f)continue;let a=r.fromA-(o?n[o-1].toA:0),d=(o<n.length-1?n[o+1].fromA:e.length)-r.toA;if(!a||!d)continue;let u=c?e.slice(r.fromA,r.toA):t.slice(r.fromB,r.toB);a<=u.length&&e.slice(r.fromA-a,r.fromA)==u.slice(u.length-a)?(n[o]=new E(r.fromA-a,r.toA-a,r.fromB-a,r.toB-a),i=!0):d<=u.length&&e.slice(r.toA,r.toA+d)==u.slice(0,d)&&(n[o]=new E(r.fromA+d,r.toA+d,r.fromB+d,r.toB+d),i=!0)}if(!i)break}return n}function $n(e,t,n){for(let i=0,o=0;o<e.length;o++){let r=e[o],s=r.toA-r.fromA,l=r.toB-r.fromB;if(s&&l||s>3||l>3){let c=o==e.length-1?t.length:e[o+1].fromA,f=r.fromA-i,a=c-r.toA,d=Re(t,r.fromA,Math.min(f,5)),u=Oe(t,r.toA,Math.min(a,5)),h=r.fromA-d,g=u-r.toA;if(!s||!l){let p=Math.max(s,l),[m,A,b]=s?[t,r.fromA,r.toA]:[n,r.fromB,r.toB];h&&g&&(p>h&&t.slice(d,r.fromA)==m.slice(b-h,b)?(r=e[o]=new E(d,d+s,r.fromB-h,r.toB-h),d=r.fromA,u=Oe(t,r.toA,Math.min(c-r.toA,5))):p>g&&t.slice(r.toA,u)==m.slice(A,A+g)&&(r=e[o]=new E(u-s,u,r.fromB+g,r.toB+g),u=r.toA,d=Re(t,r.fromA,Math.min(r.fromA-i,5))),h=r.fromA-d,g=u-r.toA)}if(h||g)r=e[o]=new E(r.fromA-h,r.toA+g,r.fromB-h,r.toB+g);else if(s){if(!l){let p=Fe(t,r.fromA,r.toA),m,A=p<0?-1:Ge(t,r.toA,r.fromA);p>-1&&(m=p-r.fromA)<=a&&t.slice(r.fromA,p)==t.slice(r.toA,r.toA+m)?r=e[o]=r.offset(m):A>-1&&(m=r.toA-A)>=f&&n.slice(r.fromA-m,r.fromA)==n.slice(A,r.toA)&&(r=e[o]=r.offset(-m))}}else{let p=Fe(n,r.fromB,r.toB),m,A=p<0?-1:Ge(n,r.toB,r.fromB);p>-1&&(m=p-r.fromB)<=a&&n.slice(r.fromB,p)==n.slice(r.toB,r.toB+m)?r=e[o]=r.offset(m):A>-1&&(m=r.toB-A)>=f&&n.slice(r.fromB-m,r.fromB)==n.slice(A,r.toB)&&(r=e[o]=r.offset(-m))}i=r.toA}}return ht(e,3),e}let F;try{F=new RegExp("[\\p{Alphabetic}\\p{Number}]","u")}catch{}function mt(e){return e>48&&e<58||e>64&&e<91||e>96&&e<123}function gt(e,t){if(t==e.length)return 0;let n=e.charCodeAt(t);return n<192?mt(n)?1:0:F?!Ct(n)||t==e.length-1?F.test(String.fromCharCode(n))?1:0:F.test(e.slice(t,t+2))?2:0:0}function pt(e,t){if(!t)return 0;let n=e.charCodeAt(t-1);return n<192?mt(n)?1:0:F?!xt(n)||t==1?F.test(String.fromCharCode(n))?1:0:F.test(e.slice(t-2,t))?2:0:0}function Oe(e,t,n){if(t==e.length||!pt(e,t))return t;for(let i=t,o=t+n;;){let r=gt(e,i);if(!r)return i;if(i+=r,i>o)return t}}function Re(e,t,n){if(!t||!gt(e,t))return t;for(let i=t,o=t-n;;){let r=pt(e,i);if(!r)return i;if(i-=r,i<o)return t}}function Ge(e,t,n){for(;t!=n;t--)if(e.charCodeAt(t-1)==10)return t;return-1}function Fe(e,t,n){for(;t!=n;t++)if(e.charCodeAt(t)==10)return t;return-1}const Ct=e=>e>=55296&&e<=56319,xt=e=>e>=56320&&e<=57343;function P(e,t){return!t||t==e.length||!Ct(e.charCodeAt(t-1))||!xt(e.charCodeAt(t))}function qn(e,t,n){return K=(n?.scanLimit??1e9)>>1,zn(e,t,I(e,0,e.length,t,0,t.length))}function At(e,t,n){return $n(qn(e,t,n),e,t)}function Jn(e){const{start:t,end:n}=e.positionBefore,{start:i,end:o}=e.positionAfter;return new E(t,n,i,o)}class q{constructor(t,n,i,o,r){this.changes=t,this.fromA=n,this.toA=i,this.fromB=o,this.toB=r}offset(t,n){return t||n?new q(this.changes,this.fromA+t,this.toA+t,this.fromB+n,this.toB+n):this}get endA(){return Math.max(this.fromA,this.toA)}get endB(){return Math.max(this.fromB,this.toB)}static buildFromTextdocDiff(t){const i=t.edits.map(Jn);return i.sort((r,s)=>r.fromA-s.fromA),me(i,X.of(t.contentBefore.split(`
`)),X.of(t.contentAfter.split(`
`)),0,0)}static build(t,n,i){const o=At(t.toString(),n.toString(),i);return me(o,t,n,0,0)}static updateA(t,n,i,o,r){return Pe(Ve(t,o,!0,i.length),t,n,i,r)}static updateB(t,n,i,o,r){return Pe(Ve(t,o,!1,n.length),t,n,i,r)}}function Ie(e,t,n,i){let o=n.lineAt(e),r=i.lineAt(t);return o.to==e&&r.to==t&&e<n.length&&t<i.length?[e+1,t+1]:[o.from,r.from]}function He(e,t,n,i){let o=n.lineAt(e),r=i.lineAt(t);return o.from==e&&r.from==t?[e,t]:[o.to+1,r.to+1]}function me(e,t,n,i,o){let r=[];for(let s=0;s<e.length;s++){let l=e[s],[c,f]=Ie(l.fromA+i,l.fromB+o,t,n),[a,d]=He(l.toA+i,l.toB+o,t,n),u=[l.offset(-c+i,-f+o)];for(;s<e.length-1;){let h=e[s+1],[g,p]=Ie(h.fromA+i,h.fromB+o,t,n);if(g>a+1&&p>d+1)break;u.push(h.offset(-c+i,-f+o)),[a,d]=He(h.toA+i,h.toB+o,t,n),s++}r.push(new q(u,c,Math.max(c,a),f,Math.max(f,d)))}return r}const Q=1e3;function _e(e,t,n,i){let o=0,r=e.length;for(;;){if(o==r){let a=0,d=0;o&&({toA:a,toB:d}=e[o-1]);let u=t-(n?a:d);return[a+u,d+u]}let s=o+r>>1,l=e[s],[c,f]=n?[l.fromA,l.toA]:[l.fromB,l.toB];if(c>t)r=s;else if(f<=t)o=s+1;else return i?[l.fromA,l.fromB]:[l.toA,l.toB]}}function Ve(e,t,n,i){let o=[];return t.iterChangedRanges((r,s,l,c)=>{let f=0,a=n?t.length:i,d=0,u=n?i:t.length;r>Q&&([f,d]=_e(e,r-Q,n,!0)),s<t.length-Q&&([a,u]=_e(e,s+Q,n,!1));let h=c-l-(s-r),g,[p,m]=n?[h,0]:[0,h];o.length&&(g=o[o.length-1]).toA>=f?o[o.length-1]={fromA:g.fromA,fromB:g.fromB,toA:a,toB:u,diffA:g.diffA+p,diffB:g.diffB+m}:o.push({fromA:f,toA:a,fromB:d,toB:u,diffA:p,diffB:m})}),o}function Pe(e,t,n,i,o){if(!e.length)return t;let r=[];for(let s=0,l=0,c=0,f=0;;s++){let a=s==e.length?null:e[s],d=a?a.fromA+l:n.length,u=a?a.fromB+c:i.length;for(;f<t.length;){let m=t[f];if(m.toA+l>d||m.toB+c>u)break;r.push(m.offset(l,c)),f++}if(!a)break;let h=a.toA+l+a.diffA,g=a.toB+c+a.diffB,p=At(n.sliceString(d,h),i.sliceString(u,g),o);for(let m of me(p,n,i,d,u))r.push(m);for(l+=a.diffA,c+=a.diffB;f<t.length;){let m=t[f];if(m.fromA+l>h&&m.fromB+c>g)break;f++}}return r}const H=Vt.define({combine:e=>e[0]}),wt=B.define(),y=N.define({create(){return null},update(e,t){for(let n of t.effects)n.is(wt)&&(e=n.value);return e}}),Zn="bg-red-100 dark:bg-red-600/30",Qn="bg-green-100 dark:bg-green-600/30",ke=pe.fromClass(class{deco;gutter;constructor(e){({deco:this.deco,gutter:this.gutter}=je(e))}update(e){(e.docChanged||e.viewportChanged||Yn(e.startState,e.state)||Xn(e.startState,e.state))&&({deco:this.deco,gutter:this.gutter}=je(e.view))}},{decorations:e=>e.deco});Ce.low(Ye({class:"cm-changeGutter",markers:e=>e.plugin(ke)?.gutter||Xe.empty}));function Yn(e,t){return e.field(y,!1)!=t.field(y,!1)}function Xn(e,t){return e.facet(H)!=t.facet(H)}const We=S.line({class:`cm-changedLine ${Qn}`}),er=S.mark({class:"cm-changedText"}),tr=S.mark({tagName:"ins",class:"cm-insertedLine"}),nr=S.mark({tagName:"del",class:"cm-deletedLine"}),Ue=new class extends et{elementClass="cm-changedLineGutter"};function rr(e,t,n,i,o,r){let s=n?e.fromA:e.fromB,l=n?e.toA:e.toB,c=0;if(s!=l){o.add(s,s,We),o.add(s,l,n?nr:tr),r&&r.add(s,s,Ue);for(let f=t.iterRange(s,l-1),a=s;!f.next().done;){if(f.lineBreak){a++,o.add(a,a,We),r&&r.add(a,a,Ue);continue}let d=a+f.value.length;if(i)for(;c<e.changes.length;){let u=e.changes[c],h=s+(n?u.fromA:u.fromB),g=s+(n?u.toA:u.toB),p=Math.max(a,h),m=Math.min(d,g);if(p<m&&o.add(p,m,er),g<d)c++;else break}a=d}}}function je(e){let t=e.state.field(y),{side:n,highlightChanges:i,markGutter:o}=e.state.facet(H),r=n=="a",s=new $,l=o?new $:null,{from:c,to:f}=e.viewport;for(let a of t){if((r?a.fromA:a.fromB)>=f)break;(r?a.toA:a.toB)>c&&rr(a,e.state.doc,r,i,s,l)}return{deco:s.finish(),gutter:l&&l.finish()}}const or=B.define({map:(e,t)=>e.map(t)});N.define({create:()=>S.none,update:(e,t)=>{for(let n of t.effects)if(n.is(or))return n.value;return e.map(t.changes)},provide:e=>M.decorations.from(e)});const ge=B.define({map:(e,t)=>t.mapPos(e)});class ir extends xe{constructor(t){super(),this.lines=t}eq(t){return this.lines==t.lines}toDOM(t){let n=document.createElement("div");return n.className="cm-collapsedLines",n.textContent="⦚ "+t.state.phrase("$ unchanged lines",this.lines)+" ⦚",n.addEventListener("click",i=>{let o=t.posAtDOM(i.target);t.dispatch({effects:ge.of(o)});let{side:r,sibling:s}=t.state.facet(H);s&&s().dispatch({effects:ge.of(sr(o,t.state.field(y),r=="a"))})}),n}ignoreEvent(t){return t instanceof MouseEvent}get estimatedHeight(){return 27}}function sr(e,t,n){let i=0,o=0;for(let r=0;;r++){let s=r<t.length?t[r]:null;if(!s||(n?s.fromA:s.fromB)>=e)return o+(e-i);[i,o]=n?[s.toA,s.toB]:[s.toB,s.toA]}}const lr=N.define({create(){return S.none},update(e,t){e=e.map(t.changes);for(let n of t.effects)n.is(ge)&&(e=e.update({filter:i=>i!=n.value}));return e},provide:e=>M.decorations.from(e)});function ar({margin:e=3,minSize:t=4}){return lr.init(n=>cr(n,e,t))}function cr(e,t,n){let i=new $,o=e.facet(H).side=="a",r=e.field(y),s=1;for(let l=0;;l++){let c=l<r.length?r[l]:null,f=l?s+t:1,a=c?e.doc.lineAt(o?c.fromA:c.fromB).number-1-t:e.doc.lines,d=a-f+1;if(d>=n&&i.add(e.doc.line(f).from,e.doc.line(a).to,S.replace({widget:new ir(d),block:!0})),!c)break;s=e.doc.lineAt(Math.min(e.doc.length,o?c.toA:c.toB)).number}return i.finish()}M.styleModule.of(new Pt({".cm-mergeView":{overflowY:"auto"},".cm-mergeViewEditors":{display:"flex",alignItems:"stretch"},".cm-mergeViewEditor":{flexGrow:1,flexBasis:0,overflow:"hidden"},".cm-merge-revert":{width:"1.6em",flexGrow:0,flexShrink:0,position:"relative"},".cm-merge-revert button":{position:"absolute",display:"block",width:"100%",boxSizing:"border-box",textAlign:"center",background:"none",border:"none",font:"inherit",cursor:"pointer"}}));const fr=M.baseTheme({".cm-mergeView & .cm-scroller, .cm-mergeView &":{height:"auto !important",overflowY:"visible !important"},"&light.cm-merge-a .cm-changedText, &light .cm-deletedChunk .cm-deletedText":{background:"linear-gradient(#ee443366, #ee443366) bottom/100% 2px no-repeat"},"&dark.cm-merge-a .cm-changedText, &dark .cm-deletedChunk .cm-deletedText":{background:"linear-gradient(#ffaa9966, #ffaa9966) bottom/100% 2px no-repeat"},"&light.cm-merge-b .cm-changedText":{background:"linear-gradient(#22bb2266, #22bb2266) bottom/100% 2px no-repeat"},"&dark.cm-merge-b .cm-changedText":{background:"linear-gradient(#88ff8866, #88ff8866) bottom/100% 2px no-repeat"},".cm-insertedLine, .cm-deletedLine":{textDecoration:"none"},".cm-deletedChunk":{paddingLeft:"6px","& .cm-chunkButtons":{position:"absolute",insetInlineEnd:"5px"},"& button":{border:"none",cursor:"pointer",color:"white",margin:"0 2px",borderRadius:"3px","&[name=accept]":{background:"#2a2"},"&[name=reject]":{background:"#d43"}}},".cm-collapsedLines":{padding:"5px 5px 5px 10px",cursor:"pointer"},"&light .cm-collapsedLines":{color:"#444",background:"linear-gradient(to bottom, transparent 0, #f3f3f3 30%, #f3f3f3 70%, transparent 100%)"},"&dark .cm-collapsedLines":{color:"#ddd",background:"linear-gradient(to bottom, transparent 0, #222 30%, #222 70%, transparent 100%)"},".cm-changeGutter":{width:"3px",paddingLeft:"1px"},"&light.cm-merge-a .cm-changedLineGutter, &light .cm-deletedLineGutter":{background:"#e43"},"&dark.cm-merge-a .cm-changedLineGutter, &dark .cm-deletedLineGutter":{background:"#fa9"},"&light.cm-merge-b .cm-changedLineGutter":{background:"#2b2"},"&dark.cm-merge-b .cm-changedLineGutter":{background:"#8f8"}}),ae="unknown",dr=new class extends et{elementClass="cm-deletedLineGutter"},ur=Ce.low(Ye({class:"cm-changeGutter",markers:e=>e.plugin(ke)?.gutter||Xe.empty,widgetMarker:(e,t)=>t instanceof Et?dr:null}));function hr(e){let t=X.of(e.textdocDiff.contentBefore.split(`
`));return[Ce.low(ke),Cr(e.language),fr,M.editorAttributes.of({class:"cm-merge-b"}),H.of({highlightChanges:e.highlightChanges!==!1,markGutter:e.gutter!==!1,syntaxHighlightDeletions:e.syntaxHighlightDeletions!==!1,mergeControls:e.mergeControls!==!1,side:"b"}),ee.init(()=>t),e.gutter!==!1?ur:[],e.collapseUnchanged?ar(e.collapseUnchanged):[],y.init(()=>q.buildFromTextdocDiff(e.textdocDiff))]}const kt=B.define(),ee=N.define({create:()=>X.empty,update(e,t){for(let n of t.effects)n.is(kt)&&(e=n.value.doc);return e}}),U=new WeakMap;class Et extends xe{constructor(t){super(),this.buildDOM=t}dom=null;eq(t){return this.dom==t.dom}toDOM(t){return this.dom||(this.dom=this.buildDOM(t))}}function mr(e,t,n){if(U.has(t.changes)){const r=fe(U.get(t.changes)).get(n?.name??ae);if(r)return r}let i=r=>{let{highlightChanges:s,syntaxHighlightDeletions:l,mergeControls:c}=e.facet(H),f=r.state.field(ee).sliceString(t.fromA,t.endA),a=document.createElement("div");if(a.className=`cm-deletedChunk ${Zn}`,c){let m=a.appendChild(document.createElement("div"));m.className="cm-chunkButtons";let A=m.appendChild(document.createElement("button"));A.name="accept",A.textContent=e.phrase("Accept"),A.onmousedown=v=>{v.preventDefault(),gr(r,r.posAtDOM(a))};let b=m.appendChild(document.createElement("button"));b.name="reject",b.textContent=e.phrase("Reject"),b.onmousedown=v=>{v.preventDefault(),pr(r,r.posAtDOM(a))}}let d=a.appendChild(document.createElement("del")),u=t.changes,h=0,g=!1;function p(m,A,b){for(let v=m;v<A;){let L=A,x=b+(g?" cm-deletedText":""),T=!1;if(s&&h<u.length){let O=Math.max(0,g?u[h].toA:u[h].fromA);O<=L&&(L=O,g&&h++,T=!0)}if(L>v){let O=document.createTextNode(f.slice(v,L));if(x){let _=d.appendChild(document.createElement("span"));_.className=x,_.appendChild(O)}else d.appendChild(O)}v=L,T&&(g=!g)}}if(l&&n){let m=n.parser.parse(f),A=0;dn(m,{style:b=>un(e,b)},(b,v,L)=>{b>A&&p(A,b,""),p(b,v,L),A=v}),p(A,f.length,"")}else p(0,f.length,"");return a},o=S.widget({block:!0,side:-1,widget:new Et(i)});return U.has(t.changes)?fe(U.get(t.changes)).set(n?.name??ae,o):U.set(t.changes,new Map([[n?.name??ae,o]])),o}function gr(e,t){let{state:n}=e,i=t??n.selection.main.head,o=e.state.field(y).find(c=>c.fromB<=i&&c.endB>=i);if(!o)return!1;let r=e.state.sliceDoc(o.fromB,Math.max(o.fromB,o.toB-1)),s=e.state.field(ee);o.fromB!=o.toB&&o.toA<=s.length&&(r+=e.state.lineBreak);let l=Wt.of({from:o.fromA,to:Math.min(s.length,o.toA),insert:r},s.length);return e.dispatch({effects:kt.of({doc:l.apply(s),changes:l}),userEvent:"accept"}),!0}function pr(e,t){let{state:n}=e,i=t??n.selection.main.head,o=n.field(y).find(l=>l.fromB<=i&&l.endB>=i);if(!o)return!1;let s=n.field(ee).sliceString(o.fromA,Math.max(o.fromA,o.toA-1));return o.fromA!=o.toA&&o.toB<=n.doc.length&&(s+=n.lineBreak),e.dispatch({changes:{from:o.fromB,to:Math.min(n.doc.length,o.toB),insert:s},userEvent:"revert"}),!0}function Ke(e,t){let n=new $;for(let i of e.field(y))n.add(i.fromB,i.fromB,mr(e,i,t));return n.finish()}const Cr=e=>N.define({create:t=>Ke(t,e),update(t,n){return n.state.field(y,!1)!=n.startState.field(y,!1)?Ke(n.state,e):t},provide:t=>M.decorations.from(t)}),bt=B.define(),Y=N.define({create:()=>{},update(e,t){for(let n of t.effects)if(n.is(bt))return n.value;return e}});class xr extends xe{toDOM(){const t=document.createElement("span");return t.className=hn.modelCursor,t}}const Ar=pe.fromClass(class{decorations;constructor(e){this.decorations=this.buildDecorations(e)}update(e){(e.docChanged||e.viewportChanged||e.state.field(Y)!==e.startState.field(Y))&&(this.decorations=this.buildDecorations(e.view))}buildDecorations(e){const t=new $,n=e.state.field(Y);if(!n)return S.none;const{doc:i}=e.state,{modelCursorPosition:o,modelSelectionPositionRange:r}=n;if(o!=null)o>=0&&o<=i.length&&t.add(o,o,S.widget({widget:new xr,side:1}));else if(r!=null){const{start:s,end:l}=r;s>=0&&l<=i.length&&s<l&&t.add(s,l,S.mark({class:`${Bn} !bg-[Highlight]`}))}return t.finish()}},{decorations:e=>e.decorations}),wr=e=>[Y.init(()=>e),Ar],te=B.define(),Ee=N.define({create(){return null},update(e,t){for(const n of t.effects)if(n.is(te))return n.value;return e}});function St(e,t){const{selectionStart:n,selectionEnd:i}=t,[o,r]=n.from>i.from?[i.from,n.to]:[n.from,i.to];e.dispatch({selection:Be.create([Be.range(o,r)]),effects:te.of(t)})}function kr(e,t){St(e,{selectionStart:t,selectionEnd:t}),e.focus();const i=()=>{e.dispatch({effects:te.of(null)}),window.removeEventListener("mouseup",i)};return window.addEventListener("mouseup",i),!0}function Er(e,t){const n=e.state.field(Ee);if(n){const i={...n,selectionEnd:t};St(e,i)}return!0}const br=pe.fromClass(class{constructor(e){this.view=e,this.updateCursor()}update(e){e.transactions.some(t=>t.effects.some(n=>n.is(te)))&&this.updateCursor()}updateCursor(){this.view.state.field(Ee)?this.view.dom.classList.add("cm-line-number-dragging"):this.view.dom.classList.remove("cm-line-number-dragging")}}),Sr=M.theme({".cm-gutters":{cursor:"default"},"&.cm-line-number-dragging .cm-gutters":{cursor:"text"}});function Mr(){return[Ee,br,Sr,Ut({domEventHandlers:{mousedown:kr,mousemove:Er}})]}const ze=Qe.define();function Mt(e,t){return e==null?[]:hr({highlightChanges:!1,gutter:!1,syntaxHighlightDeletions:!0,mergeControls:!1,language:t,textdocDiff:e})}function ce(e,t,n){const i=e.reconfigure(Mt(t,n??null));if(t==null)return[i];const o=q.buildFromTextdocDiff(t);return[i,wt.of(o)]}const vr=({currentlyStreamingLineIndex:e,value:t,textdocDiff:n,placeholderContent:i,languageCompartment:o,languageCompartmentInit:r,editableCompartment:s,readOnlyCompartment:l,editableInit:c,handleChange:f,handleBlur:a,handleSave:d,extensionsProp:u,editorTheme:h,comments:g,maxLength:p=sn,intl:m,toaster:A,modelCursor:b,unifiedMergeViewCompartment:v})=>{const L=[jt(i),Wn(m,A,p),mn(),o.of(r??[]),s.of([M.editable.of(c)]),l.of([z.readOnly.of(!c)]),Kt(),z.allowMultipleSelections.of(!0),gn(),pn(vn,{fallback:!0}),Cn(),Mr(),zt(),xn({markerDOM:x=>{const T=document.createElement("span"),O=Nn.createRoot(T),_=x?G.jsx(ln,{className:"icon-sm text-token-text-tertiary"}):G.jsx(an,{className:"icon-sm text-token-text-tertiary"});return O.render(_),T}}),wr(b),v.of(Mt(n,r?.language??null)),...u??[],...Hn,$t.of([...An,...wn,...kn,...En,...bn,Sn]),Mn(),h,qt(g),Un(),Fn(e??null),M.updateListener.of(f),M.domEventHandlers({blur:a,keydown(x){(x.key==="s"||x.key==="S")&&x.metaKey&&d?.()},paste(x){const T=x.clipboardData?.getData("text/plain");T!=null&&rt.logEvent(nt.canvasCodemirrorPaste,{textLength:T.length})}})];return z.create({doc:t,extensions:L})};function Lr({state:e,parent:t,onUpdateState:n}){const i=(o,r)=>{r.update(o);const s=r.state;n(s)};return new M({state:e,parent:t,dispatchTransactions:i})}const Dr="_codemirror_cto5h_1",yr="_preview_cto5h_12",$e={codemirror:Dr,preview:yr},Br=Ln({settings:{background:"var(--main-surface-primary)"}}),Tr=Dn({theme:"light"}),qe=M.theme({".cm-tooltip-autocomplete":{backgroundColor:"var(--main-surface-primary)",color:"var(--text-primary)",border:"1px solid var(--border-light)",borderRadius:"6px",padding:"4px",boxShadow:"0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1)"},".cm-tooltip-autocomplete > ul > li":{borderRadius:"5px",color:"var(--text-primary)"},".cm-tooltip-autocomplete > ul > li[aria-selected]":{backgroundColor:"var(--main-surface-secondary)",color:"var(--text-primary)"},".cm-tooltip-autocomplete > ul > li:hover":{backgroundColor:"var(--selection)",color:"#ffffff"},".cm-completionMatchedText":{textDecoration:"none",fontWeight:"700"}}),Je=M.theme({".cm-scroller":{fontFamily:"ui-monospace, SFMono-Regular, SF Mono, Menlo, Consolas, Liberation Mono, monospace !important"}}),Ze=e=>e?[Je,Br,qe]:[Je,Tr,qe],Nr=e=>{const[t]=C.useState(()=>new j),n=nn();C.useEffect(()=>{e.current?.dispatch({effects:t.reconfigure(Ze(n))})},[n,t,e]);const[i]=C.useState(()=>t.of(Ze(n)));return i},vt=({id:e,children:t,comments:n,commentingOn:i,currentlyStreamingLineIndex:o,hoveredCommentId:r,focusedCommentId:s,placeholder:l="",readonlyReason:c,language:f,value:a,textdocDiff:d,extensions:u,onBlur:h,onSave:g,onChange:p,editorRef:m,width:A,modelCursor:b,isPreview:v})=>{const L=C.useRef(null),x=C.useRef(null),T=_t(),O=rn(),[_,be]=C.useState(null),ne=C.useRef(null),[{width:yt},Bt]=cn(),[W]=C.useState(()=>new j),[re]=C.useState(()=>new j),[oe]=C.useState(()=>new j),[R]=C.useState(()=>new j),Se=C.useRef(p);Se.current=p;const Tt=C.useCallback(({docChanged:w,state:k,transactions:V})=>{for(const D of V)if(D.annotation(ze)===!0||D.annotation(ct)===!0)return;if(k.doc.sliceString(k.doc.length-1)===`
`&&w){const D=k.doc.toString();ne.current=D,Se.current?.(k)}},[]),Me=C.useRef(h);Me.current=h;const Nt=C.useCallback(()=>Me.current?.(),[]),ve=C.useRef(g);ve.current=g;const Ot=C.useCallback(()=>ve.current?.(),[]),Rt=async w=>w?await yn(w):null,Le=C.useCallback(async w=>{const k=await Rt(w);k&&x.current?.dispatch({effects:[W.reconfigure(k),...ce(R,d,k?.language)]})},[W,R]),Gt=Nr(x),Ft=C.useCallback(w=>{if(w===ne.current){ne.current=null;return}const{current:k}=x;if(!k)return;const V=k.state.doc,D=f!=null?ie(f):null,Ht=k.state.update({changes:{from:0,to:V.length,insert:w},effects:[Te.of(n??[]),de.of(o??null),...D!=null?[W.reconfigure(D)]:[],...ce(R,d,D?.language)],annotations:ze.of(!0)});k.update([Ht])},[n,o,f,W,d,R]);C.useImperativeHandle(m,()=>({UNSAFE_setValue:Ft,codeViewRef:x,highlightLine:(w,k)=>_n(fe(x.current),w,k)})),C.useEffect(()=>{Le(f)},[f,Le]),C.useEffect(()=>{const w=f==null?null:ie(f);x.current?.dispatch({effects:ce(R,d,w?.language)})},[R,d]);const J=c?.isReadonly===!0;C.useEffect(()=>{x.current?.dispatch({effects:[re.reconfigure(M.editable.of(!J)),oe.reconfigure(z.readOnly.of(J))]})},[J,re,oe]),C.useEffect(()=>{(i==null||Jt(i))&&x.current?.dispatch({effects:Zt.of(i??null)})},[i]),C.useEffect(()=>{x.current?.dispatch({effects:Te.of(n??[])})},[n]),C.useEffect(()=>{x.current?.dispatch({effects:Qt.of(r)})},[r]),C.useEffect(()=>{x.current?.dispatch({effects:Yt.of(s)})},[s]),C.useEffect(()=>{x.current?.dispatch({effects:bt.of(b)})},[b]),C.useEffect(()=>{x.current?.dispatch({effects:de.of(o??null)})},[o]),C.useEffect(()=>{const w=L.current;if(w==null)return;const k=f==null?null:ie(f),V=vr({currentlyStreamingLineIndex:o,value:a,placeholderContent:l,editableCompartment:re,readOnlyCompartment:oe,editableInit:!J,languageCompartment:W,languageCompartmentInit:k??null,handleChange:Tt,handleBlur:Nt,handleSave:Ot,extensionsProp:u,editorTheme:Gt,intl:T,toaster:O,comments:n??[],modelCursor:b,textdocDiff:d,unifiedMergeViewCompartment:R});be(V);const D=Lr({state:V,parent:w,onUpdateState:be});return x.current=D,()=>{D.destroy()}},[e,u,l]);const It=C.useCallback(()=>x.current,[x]),De=[],ye=[];return C.Children.forEach(t,w=>{if(!C.isValidElement(w))return;const{type:k}=w;if(k===Dt)De.push(w);else if(k===Lt)ye.push(w);else throw new Error("Invalid Codemirror child: "+JSON.stringify(k))}),G.jsx(Xt.Provider,{value:It,children:G.jsx(en.Provider,{value:_,children:G.jsxs(tn.Provider,{value:yt,children:[G.jsxs("div",{className:"relative z-0 flex h-full max-w-full",children:[G.jsx("div",{id:e,className:tt($e.codemirror,v&&$e.preview,Tn.composer,"flex h-full w-full flex-col items-stretch"),ref:fn(L,Bt),style:{width:A}}),ye]}),De]})})})},Lt=({children:e})=>e,Dt=({children:e})=>e;vt.EditorChildren=Lt;vt.ContextChildren=Dt;export{vt as C};
//# sourceMappingURL=n0zfekgl2df979f4.js.map
