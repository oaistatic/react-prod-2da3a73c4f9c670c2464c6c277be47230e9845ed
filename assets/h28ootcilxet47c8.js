const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/e1s5r4gk07bkoir1.js","assets/izh0i1dfnf8ev7x1.js","assets/fc2hzad6rtrm7s5f.js","assets/hggowi1ggrzb09yc.js","assets/root-ko7rpr3h.css","assets/conversation-small-lgvqkxxm.css","assets/k5v629wnetgom1nk.js","assets/f3mk3eu1wcl6fjlu.js","assets/ei7ej0cmjdt2qsbq.js"])))=>i.map(i=>d[i]);
import{r as h,a as ke,v as we,j as s,M as m,c as De,R as Ne}from"./izh0i1dfnf8ev7x1.js";import{ew as Ae,gX as Le,a1 as le,ey as Fe,bE as Oe,fk as He,h2 as Ge,h3 as pe,h4 as Be,h5 as Ie,a2 as Qe,gP as Ve,g5 as ce,h6 as Ue,cz as $,dA as qe,h7 as We,h8 as Ye,h9 as ze,ha as Ke,hb as Ze,hc as $e,hd as Je,he as Y,hf as z,hg as Xe,hh as es,hi as ss,hj as ye,hk as ts,bZ as as,hl as ns,hm as os,hn as rs,ho as is,hp as ls,hq as K,hr as cs,hs as ds}from"./fc2hzad6rtrm7s5f.js";import{fU as us,fu as ms,s as J,r as O,gh as gs,aL as fs,d2 as xs,aR as hs,ep as de,n as ue,M as ps,bv as Me,bw as ve,a2 as ys,aI as H,d as G,aJ as I,V as je,aj as Ce,au as Ms,bY as vs,S as me,cq as ge,T as js,a as Z,go as Cs,E as Ts,bH as Rs,bi as Es,h as _s,gp as bs,gq as Ps,D as Ss,gr as ks,gs as ws,gt as Ds,al as Ns,gu as As,o as Ls}from"./hggowi1ggrzb09yc.js";import{u as Fs,g as Os}from"./8nxoaz0vb9p890un.js";function Hs({clientThreadId:e,conversationMode:t}){const r=h.useContext(us),i=ke(),a=ms(),o=Fs(),u=Ae.useIsEnabled(e),{data:c}=Le();return({nodeId:n,eventSource:f,requestedModelId:y,systemMessage:M,systemMessageMetadata:l,extraStreamParams:g})=>{const v=J.getTree(O(e)),p=v.getParentPromptNode(n),d=v.getConversationTurns(n,!1),w=d?.[d?.length-1].variantIds?.length===1&&g?.forceUseSearch===void 0,D=gs(i,a),R=O(e),N=le(D?.models,R?.modelId);let _=[];if(y){const b=le(D?.models,y),j=Os({modelConfig:b,systemHints:c??[]}).map(E=>E.systemHint);_=Array.from(o).filter(E=>j.includes(E))}u&&(g={...g??{},enableMessageFollowups:!0});const{systemHints:S,extraStreamParams:k}=Fe(_,g);fs(e,b=>{xs.setCurrentLeafId(b,p.id)}),r({completionType:hs.Variant,requestedModelId:y,eventSource:f,completionMetadata:{variantPurpose:w?"comparison_implicit":"none",conversationMode:t??O(e)?.mode,systemHints:S??p.message.metadata?.system_hints,searchSource:g?.forceUseSearch===!0?de.CONVERSATION_REGENERATE_WITH_SEARCH:g?.forceUseSearch===!1?de.CONVERSATION_REGENERATE_WITHOUT_SEARCH:void 0},appendMessages:M?[{id:we(),author:{role:N?.tags.includes("o1")?ue.Developer:ue.System},content:{content_type:ps.Text,parts:[M]},metadata:{exclude_after_next_user_message:!0,...l}}]:void 0,extraStreamParams:k})}}const Gs=Me(()=>ve(()=>import("./e1s5r4gk07bkoir1.js").then(e=>e.F),__vite__mapDeps([0,1,2,3,4,5]))),Bs=({errorState:e,nodeId:t,clientThreadId:r,isFeedbackEnabled:i,isUserTurn:a})=>{const{value:o}=ys("3779321121"),u=J.isLastActorMessage(O(r),t),c=e.canRetry&&u&&(o||e.errCode===H.ModelCapExceeded);if(a){const n=e?.flagSeverity;return s.jsxs("div",{className:"flex w-full flex-col items-end justify-between gap-2",children:[s.jsxs("div",{className:G("flex max-w-[var(--user-chat-width,70%)] flex-row-reverse items-start gap-1 text-start text-sm",n==="danger"&&"text-token-text-error",n==="warning"&&"text-orange-600",(n==="info"||!n)&&"text-token-text-secondary"),children:[s.jsx(Oe,{className:G("icon-md mt-[0.0625em] shrink-0")}),s.jsx(fe,{errorState:e,clientThreadId:r,isFeedbackEnabled:i})]}),c&&s.jsx(he,{clientThreadId:r,nodeId:t,errorState:e})]})}return s.jsx(He,{type:e?.flagSeverity,className:"mb-2 w-fit self-start",primaryAction:c&&s.jsx(he,{clientThreadId:r,nodeId:t,errorState:e}),children:s.jsx("div",{className:"flex flex-row items-center justify-between gap-4",children:s.jsx(fe,{errorState:e,clientThreadId:r,isFeedbackEnabled:i})})})},fe=({errorState:e,clientThreadId:t,isFeedbackEnabled:r})=>{const{errCode:i,errMessage:a}=e;switch(i){case I.ContentPolicy:return s.jsx(Us,{isFeedbackEnabled:r});case I.ModelIncompatibility:return s.jsx(m,{id:"cyOWhN",defaultMessage:"Your request was flagged as potentially violating our usage policy. Please try again with a different prompt."});case I.ContentOrTos:return s.jsx(Qs,{isFeedbackEnabled:r});case I.ContentRegurgitation:return s.jsx(Vs,{});case H.ModelCapExceeded:return s.jsx(Is,{clientThreadId:t});case H.HistoryDisabledConversationNotFound:return s.jsx(m,{id:"TextMessageDisplay.historyDisabledConversationMissing",defaultMessage:"Sorry, conversations created when Chat History is off expire after 6 hours of inactivity. Please start a new conversation to continue using ChatGPT."});case H.MissingLastCompletion:return s.jsx(m,{id:"TextMessageDisplay.somethingWentWrong",defaultMessage:"Something went wrong."});default:return a?s.jsx(Gs,{rehypePlugins:[[Ge,{target:"_new",rel:"noopener noreferrer"}]],className:"markdown break-words [&>:last-child]:mb-0",children:a}):null}};function Is({clientThreadId:e}){const t=pe(o=>o.isoDate),r=Be(t),i=je(e,o=>o?.mode),a=i&&i.kind!==Ce.PrimaryAssistant;return t?s.jsx(m,{id:"TextMessageDisplay.gptUsageCapExceededExpired",defaultMessage:"You previously reached your usage cap for GPT-4, but you can now try sending your message again"}):s.jsx("span",{children:a!=null?s.jsx(m,{id:"TextMessageDisplay.gptUsageCapExceededCustomFeature",defaultMessage:"You've reached the current usage cap for GPT-4, please try again {formattedTime}. <link>Learn more</link>",values:{link:xe,formattedTime:r}}):s.jsx(m,{id:"TextMessageDisplay.gptUsageCapExceeded",defaultMessage:"You've reached the current usage cap for GPT-4. You can continue with the default model now, or try again {formattedTime}. <link>Learn more</link>",values:{link:xe,formattedTime:r}})})}const xe=e=>s.jsx("a",{href:"https://share.hsforms.com/16d0ZZVM3QZirXnCD_q7u1Q4sk30",target:"_blank",rel:"noreferrer",className:"underline hover:no-underline",children:e});function Qs({isFeedbackEnabled:e}){return s.jsxs("div",{children:[s.jsx("div",{className:e?"font-semibold":"",children:s.jsx(m,{id:"TextMessageDisplay.contentOrTosViolationNoFeedback",defaultMessage:"This content may violate our <termsLink>Terms of Use</termsLink> or <contentPolicyLink>usage policies</contentPolicyLink>.",values:{contentPolicyLink:Te,termsLink:qs}})}),s.jsx("div",{children:e&&s.jsx(m,{id:"TextMessageDisplay.contentPolicyFeedback",defaultMessage:"Did we get it wrong? Please tell us by giving this response a thumbs down."})})]})}function Vs(){return s.jsxs("div",{children:[s.jsx("div",{className:"font-semibold",children:s.jsx(m,{id:"kAMQnd",defaultMessage:"ChatGPT isn't designed to provide this type of content."})}),s.jsx("div",{children:s.jsx(m,{id:"fQ0JYv",defaultMessage:"Read the <modelSpecLink>Model Spec</modelSpecLink> for more on how ChatGPT handles creators' content.",values:{modelSpecLink:Ws}})})]})}function Us({isFeedbackEnabled:e}){return s.jsxs("div",{children:[s.jsx("div",{className:e?"font-semibold":"",children:s.jsx(m,{id:"TextMessageDisplay.contentPolicyViolationNoFeedback",defaultMessage:"This content may violate our <contentPolicyLink>usage policies</contentPolicyLink>.",values:{contentPolicyLink:Te}})}),s.jsx("div",{children:e&&s.jsx(m,{id:"TextMessageDisplay.contentPolicyFeedback",defaultMessage:"Did we get it wrong? Please tell us by giving this response a thumbs down."})})]})}const Te=e=>s.jsx(X,{href:"https://openai.com/policies/usage-policies",children:e}),qs=e=>s.jsx(X,{href:"https://openai.com/policies/terms-of-use",children:e}),Ws=e=>s.jsx(X,{href:"https://cdn.openai.com/spec/model-spec-2024-05-08.html",children:e}),X=({href:e,children:t})=>s.jsx("a",{target:"_blank",rel:"noreferrer",href:e,className:"underline hover:no-underline",children:t}),he=({clientThreadId:e,nodeId:t,errorState:r})=>{const i=Hs({clientThreadId:e}),a=r?.errCode===H.ModelCapExceeded,o=pe(p=>p.isoDate),u=a&&!!o,c=je(e,p=>p?.mode),n=c&&c.kind!==Ce.PrimaryAssistant,f=u&&!n,y=u&&n,M=Ie(),{data:l}=Ms(),g=Qe(l)?.id,v=()=>{a?me.logEvent("chatgpt_regenerate_due_to_rate_limit_button_clicked",void 0,{...ge({clientThreadId:e}),useDefaultModel:f?"true":"false"}):me.logEvent("chatgpt_regenerate_due_to_error_button_clicked",void 0,{...ge({clientThreadId:e}),inlineButton:"true"}),f?(M({modelId:g,location:"Model switcher menu item"}),i({nodeId:t,requestedModelId:g})):i({nodeId:t})};return s.jsx(vs,{as:"button",color:"secondary",disabled:y,onClick:v,icon:Ve,"data-testid":"regenerate-thread-error-button",children:f?s.jsx(m,{id:"MessageError.buttonUseDefaultModel",defaultMessage:"Use default model"}):s.jsx(m,{id:"MessageError.buttonRetryResponse",defaultMessage:"Retry"})})},Ys=Me(()=>ve(()=>import("./k5v629wnetgom1nk.js"),__vite__mapDeps([6,1,3,4,2,5,7,8])).then(e=>e.TextMessageImageGroup));function Re({attachments:e,citations:t,contentReferences:r,className:i,clientThreadId:a,displayParts:o,isCompletionInProgress:u,id:c,isActivelyStreaming:n,isUserTurn:f,turnIndex:y,isFeedbackEnabled:M,messages:l,parts:g,prevGroupedMessageType:v,prevGroupedMessages:p,showEditButton:d,showCopyButton:B,onEnterEdit:w,size:D="medium",errorState:R}){const N=l.length>1,_=g.some(j=>j!==""),S=!_&&l[0].message.metadata?.content_references?.length===0,k=l[0].message.metadata?.targeted_reply_label??l[0].message.metadata?.targeted_reply,b=l[0].message.metadata?.targeted_reply_image;return h.useEffect(()=>{const j=l[0].message;if(j.author.metadata?.real_author===`tool:${js.SEARCHGPT}`&&_){const E=j.metadata?.search_source;ce.logEvent(Z.searchToolRequestTimeToFirstTextToken,a,j.id,{search_source:E},()=>{E===Cs.InstantQuery&&Ue.logEvent(Z.searchToolPageLoadTimeToFirstTextToken,{message_id:j.id,search_source:E})})}},[a,_,l]),h.useEffect(()=>{if(!S)switch(v){case $.Browsing:ce.logEvent(Z.browsingTimeToFirstTextToken,a,l[0].message.id);break}},[S,l,a,v]),s.jsxs("div",{"data-message-author-role":l[0].message.author.role,"data-message-id":l[0].message.id,dir:"auto",className:G(i,"text-message relative flex w-full flex-col items-end gap-2 whitespace-normal break-words text-start [.text-message+&]:mt-5"),"data-message-model-slug":l[0].message.metadata?.model_slug,children:[k&&s.jsxs("div",{className:"mb-1 ml-6 mt-1 flex items-center gap-1.5 text-sm font-normal text-token-text-tertiary sm:ml-7 lg:ml-8",children:[b?s.jsx("img",{className:"h-6 rounded border border-token-border-light object-contain",src:b,alt:k}):s.jsx(qe,{className:"icon-md shrink-0"}),s.jsx("p",{className:"mr-2 line-clamp-3",children:k})]}),f&&s.jsx(We,{messages:l}),!1,s.jsx(Ye,{messages:l}),s.jsx(zs,{parts:g,attachments:e,isUserTurn:f,isCompletionInProgress:u,turnIndex:y,displayParts:o,isActivelyStreaming:n,shouldHideContent:!!R?.shouldHideContent&&!M,showEditButton:d,showCopyButton:B,onEnterEdit:w,clientThreadId:a,id:c,isEmpty:S,prevGroupedMessageType:v,prevGroupedMessages:p,flagSeverity:R?.flagSeverity,messages:l,citations:t,contentReferences:r,size:D}),R&&s.jsx(Bs,{errorState:R,nodeId:c,isFeedbackEnabled:M,clientThreadId:a,isUserTurn:f}),s.jsx(ze,{message:N?void 0:l[0]}),!f&&!n&&p&&v===$.SearchResult&&s.jsx(Ke,{messages:p})]})}function zs({clientThreadId:e,id:t,displayParts:r,turnIndex:i,isActivelyStreaming:a,shouldHideContent:o,showEditButton:u=!1,showCopyButton:c=!1,onEnterEdit:n,isEmpty:f,prevGroupedMessageType:y,prevGroupedMessages:M,messages:l,citations:g,contentReferences:v,size:p,isUserTurn:d,parts:B,attachments:w}){const D=De(),R=Ts(),N=h.useRef(!1),_=Ze(r),S=l[0].message.metadata?.serialization_metadata,k=l[0].message.metadata?.image_results?.length??0,b=h.useMemo(()=>({clientThreadId:e,messageId:t,turnIndex:i}),[e,t,i]),{toggleThreadSidebar:j}=Rs(),E=h.useCallback((x,T)=>{j({type:"searchSources",scrollToHeader:T,clientThreadId:e,turnIndex:i,messageId:t})},[e,i,t,j]),V=h.useCallback(x=>{$e(e,i,R,x)},[e,i,R]),ee=s.jsx(Xe,{parts:B,attachments:w,isUserTurn:d,clientThreadId:e},"files-and-tables"),U=!!(w?.length||r.some(x=>x.type==="images")),Ee=Je();function se(x,T,C){const L=y===$.CodeInterpreter?M?.map(P=>P.message):void 0,{text:ae,contentReferences:ne}=es(T,g,v);let oe=ne;Ee&&(oe=ne.filter(P=>P.type!=="attribution"));let{processedText:F,displayedContentReferences:re}=bs(ae,oe,a?void 0:L,!1,a);F.includes(Ps)&&!N.current&&(N.current=!0,Ss.addError(new Error("Failed replaceTextWithDirectives"),{text:F,displayedContentReferences:re}));const q=l[0].message,ie=q.metadata?.message_locale,_e=l.find(P=>P.message.id===t),be=ss(_e?.message),Pe=ye()?ts()?"streaming-animation block-entry-animation":"streaming-animation":"result-streaming",Se=!F&&ks("630821311")?"result-thinking":Pe;let W=s.jsx(as,{clientThreadId:e,componentOverrides:be?ns:null,messageId:t,size:p,isActivelyStreaming:a,className:G(a&&Se),isDeepResearchResultMessage:q.metadata?.is_async_task_result_message,children:F===""?"&#8203;":F});if(ie!=null){const P=ws(ie);P!=null&&(W=s.jsx(Ds,{locale:P,children:W}))}return s.jsx(os.Provider,{value:{analyticsMetadata:b,message:q,contentReferences:re,onShowSearchResults:E,numImageResults:k,isActivelyStreaming:a,useSafeUrls:!0,clientThreadId:e},children:W},x)}const A=r.map((x,T)=>{if(x.type==="transcription"){const C=o?null:x.text;let L=null;if(d&&o)L=s.jsx("span",{className:"italic opacity-30",children:s.jsx(m,{...Q.contentRemoved})});else if(d&&C!=null)L=C.trim().length===0?s.jsx("span",{className:"italic opacity-30",children:s.jsx(Y,{text:D.formatMessage(Q.transcriptUnavailable),customSymbolOffsets:void 0})}):s.jsx("span",{className:"italic opacity-65",children:s.jsx(Y,{text:`“${C.trim()}”`,customSymbolOffsets:void 0})});else if(!d&&C!=null)return se(T,C);return s.jsx(z,{containsImagesOrAttachments:U,isUserTurn:d,showEditButton:u,showCopyButton:c,onEnterEdit:n,handleCopyToClipboard:V,children:L},T)}else if(x.type==="text"){const C=o?null:x.text;return!f&&!o&&!d?se(T,_):f&&a&&!d?s.jsx("div",{className:"result-streaming",children:s.jsx("span",{children:s.jsx("pre",{})})},T):s.jsx(z,{containsImagesOrAttachments:U,isUserTurn:d,showEditButton:u,showCopyButton:c,onEnterEdit:n,handleCopyToClipboard:V,children:d&&o?s.jsx("span",{className:"italic opacity-30",children:s.jsx(m,{...Q.contentRemoved})}):C?s.jsx(Y,{text:C,customSymbolOffsets:S?.custom_symbol_offsets}):null},T)}else if(x.type==="images"){const C=l[0].message.metadata?.attachments??[];return s.jsx(Ys,{assets:x.imageAssets,attachments:C},T)}else return null}),te=r.findIndex(x=>x.type==="text");if(te!==-1?A.splice(te,0,ee):A.push(ee),o&&d)A.length=0,A.push(s.jsx(z,{containsImagesOrAttachments:U,isUserTurn:d,showEditButton:!1,showCopyButton:!1,onEnterEdit:Es,handleCopyToClipboard:V,children:s.jsx("span",{className:"italic opacity-30",children:s.jsx(m,{...Q.contentRemoved})})}));else if(o&&!d)return null;return s.jsx("div",{className:G("flex w-full flex-col gap-1 empty:hidden",d&&"items-end rtl:items-start",!d&&"first:pt-[3px]"),children:A})}const Q=_s({contentRemoved:{id:"textMessage.contentRemoved",defaultMessage:"Content removed"},transcriptUnavailable:{id:"textMessage.transcriptUnavailable",defaultMessage:"Transcript Unavailable"}});function Ks(e){const{isActivelyStreaming:t,...r}=e,i=Ns(),a=i?.includes("debug")??!1,o=e.messages[e.messages.length-1].message.id,[u,c]=h.useState(rs(e.parts)),n=h.useRef(void 0);return n.current===void 0&&(n.current=i?.includes(As)??!1?new is(e.parts,c,t,void 0,{debug:a}):new ls(e.parts,c,t)),h.useEffect(()=>{n.current!=null&&(n.current.onMessagePartsUpdated(e.parts,t),n.current.isBuffering()&&K.addDelayedRenderingMessage(o))},[e.parts,o,t]),h.useEffect(()=>{n.current!=null&&!n.current.isBuffering()&&K.removeDelayedRenderingMessage(o)},[u,o]),h.useEffect(()=>()=>K.removeDelayedRenderingMessage(o),[o]),h.useEffect(()=>()=>{n.current!=null&&(n.current.destroy(),n.current=void 0)},[]),s.jsx(Re,{...r,displayParts:u,isActivelyStreaming:t||n.current?.isBuffering()})}function Zs({message:e,isCompletionInProgress:t,hasActiveRequest:r,clientThreadId:i,className:a,isUserTurn:o,turnIndex:u,isFeedbackEnabled:c,prevGroupedMessageType:n,prevGroupedMessages:f,showEditButton:y,showCopyButton:M,onEnterEdit:l}){const g=h.useMemo(()=>"parts"in e.message.content?e.message.content.parts:[Ls(e.message)],[e]);return s.jsx($s,{parts:g,messages:[e],hasActiveRequest:r,isCompletionInProgress:t,className:a,citations:e.message.metadata?.citations,contentReferences:e.message.metadata?.content_references,attachments:e.message.metadata?.attachments,isUserTurn:o,turnIndex:u,id:e.nodeId,isFeedbackEnabled:c,clientThreadId:i,showEditButton:y,showCopyButton:M,onEnterEdit:l,prevGroupedMessageType:n,prevGroupedMessages:f})}const tt=Ne.memo(Zs);function $s(e){const r=e.messages.length>1,i=J.isLastActorMessage(O(e.clientThreadId),e.messages[0].nodeId),a=r?void 0:cs(e.messages[0],i,!1,e.isCompletionInProgress||e.hasActiveRequest),o=a?.flagSeverity!=="danger"&&e.isCompletionInProgress,u=!e.parts.some(n=>n!==""),[c]=h.useState(()=>!e.isUserTurn&&(e.isCompletionInProgress||u)&&!ye());return c?s.jsx(Ks,{...e,isActivelyStreaming:o,errorState:a}):s.jsx(Re,{...e,displayParts:ds({isUserTurn:e.isUserTurn,parts:e.parts}),isActivelyStreaming:o,errorState:a})}export{$s as T,tt as a,Hs as u};
//# sourceMappingURL=h28ootcilxet47c8.js.map
