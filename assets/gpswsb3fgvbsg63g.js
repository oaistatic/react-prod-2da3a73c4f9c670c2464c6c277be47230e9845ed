import{j as e,c as R,r as o}from"./izh0i1dfnf8ev7x1.js";import{I as F,H as C,U as O,J as B,K as g}from"./fc2hzad6rtrm7s5f.js";import{s as E,r as D,fv as N,H as P,E as _,D as k,U as q,Q as x,bj as M,bh as H,h as U}from"./hggowi1ggrzb09yc.js";const r=U({submitRejectModeration:{id:"feedbackModal.moderationReject",defaultMessage:"Block Content"},submitAcceptModeration:{id:"feedbackModal.moderationAccept",defaultMessage:"Allow Content"},thumbsDownPlaceholder:{id:"feedbackModal.thumbsDownPlaceholder",defaultMessage:"What was the issue with the response? How could it be improved?"},copyrightContent:{id:"feedbackModal.copyrightContent",defaultMessage:"This content violates copyright law"},reportOtherContent:{id:"feedbackModal.reportOtherContent",defaultMessage:"I don't like this for some other reason (please describe)"},provideAdditionalFeedback:{id:"feedbackModal.provideAdditionalFeedback",defaultMessage:"Provide additional feedback"}});function z({onClose:n,clientThreadId:d}){const s=R(),p=E.getTree(D(d)),v=o.useContext(N)?.serverSharedThreadId,j=P(d),m=v??j,i=_(),c=o.useRef([]),f=o.useRef(""),b=o.useRef(null),l=o.useCallback(()=>{const a=b.current?.elements;c.current=[...a||[]].filter(t=>t.checked).map(t=>t.id).map(t=>t.replace("feedback-","")),f.current=a?.["feedback-other"].value||""},[]),u=o.useCallback((a,t)=>{if(m==null){i.danger("Moderation NOT logged successfully! serverThreadId is null"),k.addError("Moderation: serverThreadId is null");return}const h=p.getMessageId(q.getThreadCurrentLeafId(d));x.submitSharedConversationReportFeedback({message_id:h,shared_conversation_id:m,text:a,tags:t}).then(()=>{i.success("Moderation logged successfully")}).catch(A=>{i.danger("Moderation NOT logged successfully! Please try again"),k.addError(new Error("Moderation: failed to log",{cause:A}))}),n()},[p,d,n,m,i]),S=o.useCallback(()=>{l(),c.current.push("moderation-reject"),u(f.current,c.current)},[u,l]),T=o.useCallback(()=>{l(),c.current.push("moderation-accept"),u(f.current,c.current)},[u,l]),w=e.jsxs(e.Fragment,{children:[e.jsx(M.Button,{title:s.formatMessage(r.submitRejectModeration),color:"danger",onClick:S}),e.jsx(M.Button,{title:s.formatMessage(r.submitAcceptModeration),color:"primary",onClick:T})]}),[y,I]=o.useState([]);return o.useEffect(()=>{x.fetchShareModerationCategories().then(a=>{const t=a.moderation_categories;I(Object.keys(t).map(h=>[h,t[h]]))})},[]),e.jsxs(H,{isOpen:!0,onClose:n,showCloseButton:!0,size:"custom",className:"md:max-w-[672px] lg:max-w-[896px] xl:max-w-6xl",type:"success",title:s.formatMessage(r.provideAdditionalFeedback),children:[e.jsxs("form",{ref:b,children:[e.jsx(B,{id:"feedback-other",placeholder:s.formatMessage(r.thumbsDownPlaceholder),rows:3,className:"mb-1 mt-4 w-full resize-none rounded-md bg-token-main-surface-primary"}),e.jsxs("div",{className:"mb-4",children:[y.map(([a,t])=>e.jsx(g,{id:"feedback-"+a,label:t},a)),e.jsx(g,{id:"feedback-copyright",label:s.formatMessage(r.copyrightContent)}),e.jsx(g,{id:"feedback-content-other",label:s.formatMessage(r.reportOtherContent)})]})]}),e.jsx(M.Actions,{primaryButton:w})]})}function K({clientThreadId:n}){return F(C.SharedConversationModeration)?e.jsx(z,{onClose:()=>O.closeModal(C.SharedConversationModeration),clientThreadId:n}):null}export{K as C};
//# sourceMappingURL=gpswsb3fgvbsg63g.js.map
