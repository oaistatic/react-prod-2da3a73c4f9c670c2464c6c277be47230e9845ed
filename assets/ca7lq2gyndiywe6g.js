const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/j278765k98rmh2gy.js","assets/izh0i1dfnf8ev7x1.js","assets/f3mk3eu1wcl6fjlu.js","assets/hggowi1ggrzb09yc.js","assets/root-ko7rpr3h.css","assets/ei7ej0cmjdt2qsbq.js","assets/fc2hzad6rtrm7s5f.js","assets/conversation-small-lgvqkxxm.css","assets/h28ootcilxet47c8.js","assets/8nxoaz0vb9p890un.js","assets/lb1py1igp6jzrtce.js","assets/c9avu4yfkjav9bdb.js","assets/in3ze5ugryldzaj2.js","assets/ab6tyx2xygyb56l3.js","assets/tgoenu6tnz27czb5.js","assets/oqh4oznl5hswaxjl.js","assets/hvso4q5e920ht7cj.js","assets/kl3ozx7rebkh41p7.js","assets/gbq6199og40qsa1v.js","assets/dzs9jsp7hkzpbuhr.js","assets/ktras8z3bowlgaf3.js","assets/c0dr65ykcqmn5jn4.js","assets/cmhwt2695mlcqdi5.js","assets/kvnclk26g068u8j0.js","assets/mr6nc5us07sbkp4s.js","assets/jore4rsmi6xthsxp.js","assets/fwdp80vy7ntbfuu7.js","assets/kz50erytj15xw0j3.js","assets/n1qo72mbjnnjk2je.js","assets/m9e86ummh8a7fx0f.js","assets/bluopupp3hty4d7q.js","assets/k717zu3z0jn9v64p.js","assets/eto0fc8nib9bl0nl.js","assets/ek903rju0zels0pm.js","assets/mesuhiy66f679pn3.js","assets/e1s5r4gk07bkoir1.js","assets/l2i0py62vkyv61za.js","assets/eobmiu9ep1nh2j45.js","assets/dxpde14qu5zfq5m7.js","assets/pcacsxfe3uxv1gro.js","assets/iemgi2z64e5uqrv4.js","assets/gueirrzkglxzsmw1.js","assets/nlrayamhrsyhya9q.js","assets/h1u1n503o4rqjlms.js","assets/FormattedText-dqwoo8t7.css","assets/bqaw7aag2c6iw58l.js","assets/cot-message-g9y1y05k.css","assets/n5np20of7gh13xq7.js","assets/elgrylk95u65jz3s.js","assets/olku5xlevbjddjj8.js","assets/d70iue5kyho1p6i8.js","assets/kr0ic0arauqluu3x.js"])))=>i.map(i=>d[i]);
import{cp as Ae,V as J,s as K,di as Ie,fu as Ne,X as we,T as ge,r as fe,a as G,H as De,aL as xe,cc as Re,d as I,bU as pe,F as Le,bH as Q,eY as Oe,n as he,U as Fe,bY as $,eo as Pe,aj as Y,P as Ve,cq as Ue,br as ye,gS as Z,ex as He,ey as Be,bT as ze,eh as We,eu as Je,eg as qe,a2 as _e,D as Ke,go as Ye,bv as b,bw as N,el as Qe,eG as Xe}from"./hggowi1ggrzb09yc.js";import{j as s,M as k,a as Ee,c as X,r as p,ax as W,av as L}from"./izh0i1dfnf8ev7x1.js";import{k5 as $e,ii as Ge,k6 as Ze,ds as Me,k7 as es,k8 as ss,i8 as ts,i9 as as,i3 as ns,k9 as os,dl as is,ka as rs,kb as cs,kc as ls,kd as ds,ke as ms,kf as us,iC as gs,ib as E,i6 as Te,ia as z,kg as te,kh as q,i1 as ae,ki as fs,kj as xs,kk as ps,kl as hs,km as ys,dp as _s,dq as Es,bZ as Ms,kn as Ts,ko as vs,kp as B,ex as Ss,kq as ee,kr as Cs,ks as js,kt as bs,ku as ks,kv as As,kw as ne,kx as Is,ky as Ns,kz as ws,hq as oe,kA as ve,is as Ds,kB as Rs,kC as Ls,kD as Os,kE as Fs,aA as Ps,az as Vs,aa as Us,bO as Hs,g5 as Bs,h6 as zs,kF as Ws,kG as Js,cz as l,iz as qs,iS as Ks,kH as Ys,kI as Qs,kJ as Xs,eo as $s,kK as Gs,hj as Zs,iy as et,hk as st,kL as tt,kM as at,kN as nt,fk as ot}from"./fc2hzad6rtrm7s5f.js";import{u as it,a as rt}from"./h28ootcilxet47c8.js";import{a as ct,u as lt}from"./8nxoaz0vb9p890un.js";import{u as dt}from"./lb1py1igp6jzrtce.js";import{N as mt}from"./c9avu4yfkjav9bdb.js";import{f as ut}from"./in3ze5ugryldzaj2.js";const gt=e=>{for(const a of e.concat().reverse()){if("messages"in a)return a.messages[a.messages.length-1].nodeId;if("message"in a)return a.message.nodeId}},ft=(e,a)=>{const[t,o]=J(e,f=>[K.getRequestId(f),K.getLastMessageSystemHints(f).includes(Ie.CANVAS)]),r=it({clientThreadId:e}),i=$e(e),c=Ee(),m=Ne(),n=we(t),g=gt(a),d=a.some(f=>"messages"in f&&f.messages.some(h=>h.message.metadata?.canvas?.canvas_opt_in));return{isVisible:!o&&!i&&!d&&!!g,onClick:async f=>{if(!g)return;f.stopPropagation(),Ge();const h=[ge.CANMORE];n&&await Ze({clientThreadId:e,currentRequestId:t,queryClient:c,isHistoryAndTrainingDisabled:m}),requestAnimationFrame(()=>r({nodeId:g,systemMessage:"The user has requested the canvas tool be disabled for this conversation. You should not call the tool again.",systemMessageMetadata:{disable_tool_ids:h}}));const M=K.getTree(fe(e)),v=M.getConversationTurns(g,!1).length,S=M.getParentPromptNode(g).message.id;Me.logEventWithStatsig(G.canvasOptOutClicked,"chatgpt_canvas_opt_out_clicked",{num_turns:String(v),conversation_id:De(e),message_id:S}),xe(e,C=>{C.disabledToolIds=h})}}},xt=({clientThreadId:e,groupedMessages:a})=>{const{isVisible:t,onClick:o}=ft(e,a);return t?s.jsx("button",{onClick:o,className:"mb-2 w-full text-token-text-secondary hover:text-token-text-primary",children:s.jsxs("div",{className:"flex items-center rounded-xl",children:[s.jsx(k,{id:"aa5Dyk",defaultMessage:"Answer in chat instead"}),s.jsx(Ae,{className:"icon-md text-token-text-secondary"})]})}):null},pt=(e,a)=>e?.textdocId?e.textdocId:e?.function===z.CreateTextdoc?xs(e.messageId):a??void 0,ht=({messages:e,isRequestActive:a,isFinalTurn:t,allGroupedMessages:o,clientThreadId:r})=>{const i=X(),c=es(e),m=ss(e),n=p.useMemo(()=>{if(ts(c?.message))return as(a,c.message,m?.message??null)},[a,c,m]),g=ns(),d=pt(n,g),x=os(d),f=is(),h=rs(d),M=cs(),v=ls(),S=ds(),C=ms(),j=us({textdocId:d,assistantMessage:c}),D=gs(()=>{const y=fe(r)?.modelId;Me.logError("Textdoc missing from conversation",null,{clientThreadId:r,modelId:y,textdocId:d,latestTextdocId:g,toolCallTextdocId:n?.textdocId,toolCallStatus:n?.status,toolCallFunction:n?.function})});p.useEffect(()=>{!a&&n?.status===E.COMPLETE&&!C&&!x&&D()},[n,x,a,C,D]);const T=Te("canvas");if(!n)return null;const R=n.status===E.REDACTED||!C&&!x&&n.status!==E.STREAMING&&n.status!==E.WAITING;let P,V;if(n.status!==E.REDACTED&&n.status!==E.FAILED&&!R&&d){const y=n.function===z.UpdateTextdoc&&n.status===E.COMPLETE;P=()=>{T(),y&&n.versionInt?ps(d,n.versionInt,M):ae(d)},V=()=>{y&&n.versionInt&&S(d,n.versionInt)}}const U=yt(n,x);if(n.function===z.CreateTextdoc){if(n.status===E.STREAMING||n.status===E.WAITING||n.status===E.COMPLETE){const w=C===!0&&(n.status===E.STREAMING||n.status===E.WAITING);return s.jsxs(s.Fragment,{children:[s.jsx(te,{textdocId:d,name:U,tag:n.type,icon:q(n.type,!1),iconSelected:q(n.type,!0),isCanvasOpen:f,isInlinePreview:j,isFetching:w,isFocused:h,isStreaming:n.status===E.STREAMING,onClick:P}),t&&s.jsx(xt,{clientThreadId:r,groupedMessages:o})]})}let y;switch(n.status){case E.FAILED:y=i.formatMessage({id:"SNarKX",defaultMessage:"Failed to generate"});break;case E.CANCELED:y=i.formatMessage({id:"1A6W36",defaultMessage:"Stopped generating"});break;case E.REDACTED:y=s.jsx(Re,{align:"start",label:i.formatMessage({id:"F6q1k7",defaultMessage:"Removed from shared conversation"}),children:i.formatMessage({id:"BqyYDu",defaultMessage:"Created document"})});break}return s.jsx(ie,{children:y})}const u=R||n.status===E.REDACTED,_=v&&!u?U:null,A=s.jsx(ie,{onClick:P,onMouseOver:V,isStreaming:n.status===E.STREAMING,children:n.function===z.CommentTextdoc?Et(i,n,_):_t(i,n,_)});return j&&!f&&!R&&d?s.jsxs("div",{className:"flex flex-col gap-2",children:[s.jsx(te,{textdocId:d,name:U,tag:x?.type,icon:q(x?.type,!1),iconSelected:q(x?.type,!0),isCanvasOpen:f,isFetching:!1,isFocused:h,isInlinePreview:!0,isStreaming:n.status===E.STREAMING,onClick:d!=null?()=>{T(),ae(d)}:void 0}),A]}):A};function yt(e,a){return a?.title?a.title:e.function===z.CreateTextdoc&&e.title?fs(e.title):null}const ie=({isStreaming:e=!1,onClick:a,onMouseOver:t,children:o})=>s.jsx("button",{disabled:!a,className:I(e&&"loading-shimmer","flex min-h-5 w-fit select-none pt-[3px] text-start text-token-text-secondary",a&&"hover:text-token-text-primary"),onClick:a,onMouseOver:t,children:o}),Se=9;function _t(e,a,t){if(a.status===E.STREAMING)return t?e.formatMessage({id:"W2xN1Z",defaultMessage:"Editing {documentTitle}"},{documentTitle:t}):e.formatMessage({id:"8taq8v",defaultMessage:"Editing"});if(a.status===E.FAILED)return t?e.formatMessage({id:"UjJKYZ",defaultMessage:"Failed to edit {documentTitle}"},{documentTitle:t}):e.formatMessage({id:"kWUVkg",defaultMessage:"Failed to edit"});if(a.status===E.CANCELED)return t?e.formatMessage({id:"TmSrCd",defaultMessage:"Stopped editing {documentTitle}"},{documentTitle:t}):e.formatMessage({id:"bYV7xA",defaultMessage:"Stopped editing"});const o=a.updates?.length;return a.status===E.REDACTED||!o||o>Se?t?e.formatMessage({id:"n+G/ct",defaultMessage:"Edited {documentTitle}"},{documentTitle:t}):e.formatMessage({id:"aegqpL",defaultMessage:"Edited"}):t?e.formatMessage({id:"osYMSb",defaultMessage:"{numEdits, plural, one {Edited {documentTitle}} other {Made {numEdits} edits to {documentTitle}}}"},{numEdits:o,documentTitle:t}):e.formatMessage({id:"xJD3WR",defaultMessage:"{numEdits, plural, one {Edited} other {Made {numEdits} edits}}"},{numEdits:o})}function Et(e,a,t){if(a.status===E.STREAMING)return t?e.formatMessage({id:"8xQH/P",defaultMessage:"Commenting on {documentTitle}"},{documentTitle:t}):e.formatMessage({id:"5yqLeN",defaultMessage:"Commenting"});if(a.status===E.FAILED)return t?e.formatMessage({id:"Rl821S",defaultMessage:"Failed to comment on {documentTitle}"},{documentTitle:t}):e.formatMessage({id:"W007jt",defaultMessage:"Failed to comment"});if(a.status===E.CANCELED)return t?e.formatMessage({id:"bozPdq",defaultMessage:"Stopped commenting on {documentTitle}"},{documentTitle:t}):e.formatMessage({id:"hyBGa7",defaultMessage:"Stopped commenting"});const o=a.comments?.length;return a.status===E.REDACTED||!o||o>Se?t?e.formatMessage({id:"LXEzK7",defaultMessage:"Commented on {documentTitle}"},{documentTitle:t}):e.formatMessage({id:"KeMYhy",defaultMessage:"Commented"}):t?e.formatMessage({id:"Ql5lPq",defaultMessage:"{numComments, plural, one {Commented on {documentTitle}} other {Added {numComments} comments on {documentTitle}}}"},{numComments:o,documentTitle:t}):e.formatMessage({id:"FHtyJQ",defaultMessage:"{numComments, plural, one {Commented} other {Added {numComments} comments}}"},{numComments:o})}const Mt={div:e=>{const{node:a,children:t,...o}=e;return s.jsx("div",{...o,className:"text-red-500",children:t})},p:e=>{const{node:a,children:t,...o}=e;return s.jsx("p",{...o,className:"text-start leading-6 text-token-text-primary",children:t})},a:e=>{const{node:a,children:t,...o}=e;return s.jsx("a",{...o,className:"font-sm leading-6 !text-token-text-primary",children:t})}},Tt=1e3*60*2,vt=30;function Ce({onClick:e,statusMessage:a,showSources:t,includeMargin:o,sources:r,progressBar:i}){const c=pe();return s.jsx("button",{onClick:()=>c&&e(),className:I("mt-4 flex w-4/5 max-w-[416px] items-start justify-start gap-[18px] rounded-2xl border border-black/10 bg-token-main-surface-primary px-5 py-4 shadow dark:border-white/10",c?"cursor-pointer hover:bg-token-main-surface-secondary":"cursor-auto"),children:s.jsxs("div",{className:"flex w-full flex-col gap-3",children:[s.jsxs("div",{className:I("flex flex-col items-start justify-start self-stretch md:h-7 md:flex-row md:items-center md:justify-between",t?"h-12":"h-6"),children:[s.jsx("div",{className:I("font-sm w-full flex-1 truncate text-start leading-7 text-token-text-primary md:w-0",o&&"mr-[30px]"),children:a}),t&&r]}),s.jsx("div",{className:"flex w-full items-center justify-start gap-4 self-stretch pb-2",children:i})]})})}function se({toggleSidebar:e,openSidebar:a,startTime:t}){const o=X(),[r,i]=p.useState(!1),c=hs();return p.useEffect(()=>{if(!t)return;const m=Date.now()-t,n=Tt-m;if(n>0){const g=setTimeout(()=>{i(!0),a()},n);return()=>clearTimeout(g)}else i(!0),a()},[t,a]),s.jsx(Ce,{onClick:e,statusMessage:r?o.formatMessage({id:"T2SbxC",defaultMessage:"Waiting…"}):s.jsx("div",{className:"text-pretty text-sm font-medium text-token-text-primary",children:c.startingMessage}),progressBar:s.jsx(ys,{className:"h-2 w-full"}),showSources:!1})}function St(e,a,t){const o=e.formatMessage({id:"Bs+OcV",defaultMessage:"Thinking…"});if(a.length<2)return t?.initial??o;const r=a[a.length-2];if(r.type==="summary")return r.title;if(r.type==="search")return r.query;if(r?.type==="websiteOpen")return s.jsx(Ms,{componentOverrides:Mt,children:r.active_row_text})}function Ct({task:e,clientThreadId:a,caterpillarRows:t,messageWithTaskMetadata:o,totalSources:r,handleToggleCaterpillarSidebar:i}){const c=X(),m=pe(),n=St(c,t,o.metadata?.async_task_status_messages),g=(e?.expectedDurationMinutes??vt)*60*1e3,d=_s(t[1]?.created_at?t[1].created_at*1e3:Date.now(),g),x=t[1]&&t[1].created_at?d:0;p.useEffect(()=>{xe(a,M=>{M.async_status=Le.STREAMING})},[a]);const{openThreadSidebar:f}=Q();p.useEffect(()=>{t.length===2&&m&&f({type:"caterpillar",caterpillarId:e.taskId,initialTab:"activity",clientThreadId:a})},[t.length,f,e.taskId,a,m]);const h=p.useCallback(()=>{f({type:"caterpillar",caterpillarId:e.taskId,initialTab:"activity",clientThreadId:a})},[f,e.taskId,a]);return t.length<=1?s.jsx(se,{toggleSidebar:()=>i("activity"),openSidebar:h,startTime:new Date(e.createdAt).getTime()}):s.jsx(Ce,{onClick:()=>i("activity"),statusMessage:n,showSources:!0,includeMargin:r>0,sources:r===0?s.jsx("div",{className:"text-pretty text-sm text-token-text-tertiary",children:s.jsx(k,{id:"zfwUjs",defaultMessage:"Looking for sources…"})}):s.jsxs("button",{onClick:M=>{M.stopPropagation(),i("sources")},className:I("flex shrink-0 gap-1 text-[13px] leading-[18px] text-[#0285ff]",m?"cursor-pointer hover:text-[#0285ff]/80":"cursor-auto"),children:[s.jsx("div",{className:"relative",children:s.jsx(W,{initial:!1,children:s.jsx(L.span,{initial:{opacity:0,rotateX:-90,translateY:20},animate:{opacity:1,rotateX:0,translateY:0},exit:{opacity:0,rotateX:90,translateY:-20},transition:{duration:.35},className:"absolute left-0 md:right-0",children:r},r)})}),s.jsx("div",{className:I("md:pr-0",r>0&&"pl-2",r>9&&"pl-[14px]",r>99&&"pl-[22px]"),children:r>1?s.jsx(k,{id:"zN+MuO",defaultMessage:" sources"}):s.jsx(k,{id:"dMowmJ",defaultMessage:" source"})})]}),progressBar:s.jsx("div",{className:"flex h-2 shrink grow basis-0 items-start justify-start gap-2.5 overflow-hidden rounded-[10px] bg-token-main-surface-tertiary",children:s.jsx(Es,{percentage:x,barClassName:"bg-token-text-primary",backgroundClassName:"bg-token-main-surface-tertiary"})})})}function re({task:e,clientThreadId:a,messageWithTaskMetadata:t,totalSources:o,handleToggleCaterpillarSidebar:r}){const i=Ts(e),c=!1,m=J(a,g=>vs(g,e?.taskId)),{clearSystemHintModeTrigger:n}=ct();return p.useEffect(()=>{e?.status===B.COMPLETED&&!m&&!c&&(i(),n(Ss.Research))},[e?.status,c,m,i,n]),s.jsx(ee,{message:s.jsxs(s.Fragment,{children:[t.metadata?.async_task_status_messages?.completed_with_time??t.metadata?.async_task_status_messages?.completed_no_time??s.jsx(k,{id:"4d0xZc",defaultMessage:"Completed"}),o===0?s.jsx(k,{id:"VggF2B",defaultMessage:" · 0 sources"}):o===1?s.jsx(k,{id:"zkkdKV",defaultMessage:" · 1 source"}):s.jsx(k,{id:"qcKt3q",defaultMessage:" · {sourcesCount} sources",values:{sourcesCount:o}})]}),handleToggleCaterpillarSidebar:()=>r("activity")})}function jt({messages:e,clientThreadId:a}){const t=e.find(g=>g.message.metadata?.b1de6e2_s&&g.message.metadata?.async_task_id)?.message,o=t?.metadata?.async_task_id,r=e.find(g=>g.message.recipient===ge.START_RESEARCH_TASK),i=J(a,g=>Cs(g,r?.message.id)),c=Oe({clientThreadId:a}),[m,n]=p.useState(c);return p.useEffect(()=>{const g=setTimeout(()=>{n(i&&c)},3e3);return()=>clearTimeout(g)},[c,i]),!t||!o?m?s.jsx(se,{toggleSidebar:()=>{},openSidebar:()=>{},startTime:new Date().getTime()}):null:s.jsx(bt,{clientThreadId:a,payloadTaskId:o,messageWithTaskMetadata:t})}function bt({payloadTaskId:e,messageWithTaskMetadata:a,clientThreadId:t}){js(e,a,t);const o=bs(x=>e?x.tasks[e]:null),r=X(),i=o?.status,c=p.useMemo(()=>o?.rows?o.rows:[],[o?.rows]),{toggleThreadSidebar:m}=Q(),{totalSources:n}=p.useMemo(()=>{if(!c)return{uniqueSources:[],totalSources:0};const x=ks(c),f=x.reduce((h,M)=>h+M.count,0);return{uniqueSources:x,totalSources:f}},[c]),g=Te("caterpillar"),d=p.useCallback(x=>{e&&m({type:"caterpillar",caterpillarId:e,initialTab:x,clientThreadId:t},g)},[m,e,g,t]);return As(e),a.metadata?.async_task_status_messages?.completed_with_time?s.jsx(re,{task:o,clientThreadId:t,messageWithTaskMetadata:a,totalSources:n,handleToggleCaterpillarSidebar:d}):!o||!i||i===B.UNDETERMINED?s.jsx(se,{toggleSidebar:()=>{},openSidebar:()=>{},startTime:new Date().getTime()}):o.status===B.COMPLETED?s.jsx(re,{task:o,clientThreadId:t,messageWithTaskMetadata:a,totalSources:n,handleToggleCaterpillarSidebar:d}):o.status===B.FAILED?s.jsx(ee,{message:a.metadata?.async_task_status_messages?.error??r.formatMessage({id:"at6zk8",defaultMessage:"Failed to think"}),handleToggleCaterpillarSidebar:()=>d("activity")}):o.status===B.CANCELLED?s.jsx(ee,{message:a.metadata?.async_task_status_messages?.cancelled??r.formatMessage({id:"u1rIr5",defaultMessage:"Task Cancelled"}),handleToggleCaterpillarSidebar:()=>d("activity")}):s.jsx(Ct,{task:o,clientThreadId:t,caterpillarRows:c,messageWithTaskMetadata:a,totalSources:n,handleToggleCaterpillarSidebar:d})}function kt(e,a,t){const o=a.elements.length;if(o===0)return;const r=Object.entries(e).reduce((i,[c,m])=>Array.isArray(m)?m.length>0?i+1:i:m!==""?i+1:i,0);Ve.logEventWithStatsig("dynamic-form-submission","chatgpt_dyanmic_form_submission",{...Ue({clientThreadId:t}),totalItems:o.toString(),completedItems:r.toString(),ratio:(r/o).toString()})}function At(e,a){let t="";return a.elements.forEach(o=>{const r=o.scope.split("/").pop(),i=r&&e[r],c=i?Array.isArray(i)?i.join(", "):i:"Any",m=o.label??r;t+=`${m}: ${c}
`}),t}function It({messages:e,clientThreadId:a,isLastMessage:t}){const o=e.find(T=>T.message.author.role===he.Assistant),r=e.find(T=>T.message.metadata?.json_form),i=r?.message.metadata?.json_form,[c,m]=p.useState({}),[n,g]=p.useState(),[d,x]=p.useState(),f=lt(),h=dt({clientThreadId:a});p.useEffect(()=>{i&&(g(i.json_form_ui),x(i.json_form_data))},[i]);const M=p.useCallback(()=>{if(m({}),n){const T={...n,elements:n.elements.filter(R=>R.scope!=="#/properties/AdditionalInfo")};g(T)}d&&(delete d.properties.AdditionalInfo,x(d))},[m,g,x,n,d]),v=p.useCallback(()=>{if(n){const T={...n,elements:[...n.elements,{type:"Control",scope:"#/properties/AdditionalInfo",label:"Additional Info",placeholder:"Any other details..."}]};g(T)}if(d){const T={...d.properties,AdditionalInfo:{type:"string"}};x({...d,properties:T})}},[g,x,n,d]),S=n?.elements.some(T=>T.scope.endsWith("#/properties/AdditionalInfo")),C=Fe.getThreadCurrentLeafId(a),j=r?.nodeId!==C;if(!r||!d||!n)return o?.message.status==="in_progress"&&t?s.jsxs("div",{className:"flex flex-col gap-2",children:[s.jsx(ne,{className:"h-[26px] w-full"}),s.jsx(ne,{className:"h-[26px] w-3/4"}),s.jsx(Is,{})]}):null;if(j)return null;const D=async()=>{const T=At(c,n);kt(c,n,a),h({promptMessage:Pe(T),completionMetadata:{systemHints:[...f],conversationMode:{kind:Y.PrimaryAssistant}}})};return s.jsxs(Ns,{children:[s.jsx(Nt,{formData:c,dataSchema:d,uiSchema:n,setData:m,readOnly:j}),s.jsxs("div",{className:"flex w-full justify-between",children:[S?s.jsx("div",{}):s.jsx($,{disabled:j,onClick:v,color:"secondary",className:"text-token-text-secondary",children:s.jsx(k,{id:"Sen69P",defaultMessage:"Add a detail"})}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx($,{disabled:j,onClick:M,color:"secondary",className:"text-token-text-secondary",children:s.jsx(k,{id:"Uqo7UD",defaultMessage:"Reset"})}),s.jsx($,{disabled:j,onClick:D,children:s.jsx(k,{id:"FVou++",defaultMessage:"Start"})})]})]})]})}function Nt({dataSchema:e,uiSchema:a,setData:t,readOnly:o,formData:r}){return s.jsx("div",{children:s.jsx(ws,{formData:r,readOnly:o,schema:e,uiSchema:a,onChange:i=>t(i)})})}const wt=2e3,je=.4,Dt=.45,Rt=.2,Lt=.1,Ot=.25;var O=(e=>(e[e.Running=0]="Running",e[e.Finished=1]="Finished",e[e.Error=2]="Error",e[e.Stopped=3]="Stopped",e[e.Paused=4]="Paused",e))(O||{});function ya({conversationMessages:e,icon:a,status:t,text:o,estimatedToolDurationMs:r,animationLoopDurationMs:i=wt,shouldPersistAfterFinished:c=!1}){const[m,n]=p.useState(t===0?0:t===1&&!c?7:1),[g,d]=p.useState(0);p.useEffect(()=>{t===2?n(8):t===3?n(9):t===4?n(10):t===1?n(m===2?3:7):t===0&&m===10&&(n(2),d(f=>f+1))},[t]);const x=Vt(m);return p.useEffect(()=>{const f=e[0].message.id;if(x)return oe.addDelayedRenderingMessage(f),()=>{oe.removeDelayedRenderingMessage(f)}},[x]),ve(()=>{F(m)&&d(f=>f+1)},i),m===7&&!c?null:s.jsxs("div",{className:"my-2.5 flex items-center gap-2.5",children:[s.jsx(Ft,{icon:a,status:t,uiState:m,estimatedToolDurationMs:r,animationLoopCounter:g,shouldPersistAfterFinished:c,onFillProgressBarAnimationComplete:()=>n(4),onFinishAnimationComplete:()=>{n(5),setTimeout(()=>{n(c?7:6)},Lt*1e3)},onHideAnimationComplete:()=>n(7)}),s.jsx(Pt,{text:o,uiState:m,animationLoopCounter:g,onEnterAnimationComplete:()=>n(2)})]})}const ce=50;function Ft({icon:e,status:a,uiState:t,estimatedToolDurationMs:o,animationLoopCounter:r,shouldPersistAfterFinished:i,onFillProgressBarAnimationComplete:c,onFinishAnimationComplete:m,onHideAnimationComplete:n}){const[g,d]=p.useState(0);ve(()=>{F(t)?d(j=>j+ce):t===10&&d(0)},ce);let x,f,h;F(t)||t===10?(x="running",f=s.jsx(e,{animationLoopCounter:r}),h="bg-transparent"):t===4||t===5||t===7&&i?(x="finished",f=s.jsx(Rs,{}),h="bg-brand-purple"):a===2?(x="error",f=s.jsx(Ls,{}),h="bg-orange-500"):a===3&&(x="stopped",f=s.jsx(Os,{}),h="bg-gray-300");let M={opacity:0,scale:0,rotate:-180,x:0},v={type:"spring",bounce:.3,duration:Dt},S={opacity:0,scale:.6,rotate:0,x:0};t===0?(M={opacity:0,scale:.5,rotate:-180,x:-8},v={type:"spring",bounce:.3,duration:je}):t===1?M=!1:t===5&&(S={opacity:0,scale:0,rotate:0,x:0},v={type:"spring",bounce:.3,duration:Ot});const C=Fs(g,o);return s.jsx("div",{className:"relative h-5 w-5 shrink-0",children:s.jsx(W,{onExitComplete:()=>{t===6&&n()},children:x!=null&&s.jsxs(L.div,{className:I("absolute left-0 top-0 flex h-full w-full items-center justify-center rounded-full text-white",h),initial:M,animate:{opacity:1,scale:1,rotate:0,x:0},exit:S,transition:v,onAnimationComplete:()=>{t===4&&m()},children:[f,(F(t)||t===10)&&s.jsx(Ds,{percentage:t===3?100:C,thickness:1.5/23,className:"absolute left-1/2 top-1/2 h-[23px] w-[23px] -translate-x-1/2 -translate-y-1/2 text-brand-purple",backgroundStrokeClassName:"stroke-brand-purple/25 dark:stroke-brand-purple/50",transitionDuration:t===3?`${(100-C)/100*Rt}s`:void 0,transitionTimingFunction:t===3?"cubic-bezier(0.55, 0, 1, 1)":void 0,onTransitionEnd:()=>{t===3&&c()}})]},x)})})}function Pt({text:e,uiState:a,animationLoopCounter:t,onEnterAnimationComplete:o}){const[r,i]=p.useState(e);p.useEffect(()=>{a===2&&i(e)},[t]),p.useEffect(()=>{F(a)||i(e)},[a,e]);let c={opacity:0,x:0,y:15},m={type:"spring",bounce:.3,opacity:{duration:.15},y:{duration:.3}};a===0?(c={opacity:0,x:-8,y:0},m={type:"spring",bounce:.3,duration:je,delay:.15}):a===1&&(c=!1);const n=r??void 0;return s.jsx("div",{className:I("relative h-5 w-full leading-5",a===8||a===9?"text-token-text-tertiary":"text-token-text-secondary"),children:s.jsx(W,{children:n!=null&&s.jsx(L.div,{className:"absolute left-0 top-0 line-clamp-1 overflow-visible",initial:c,animate:{opacity:1,x:0,y:0},exit:{opacity:0,x:0,y:-15},transition:m,onAnimationComplete:()=>{a===0&&o()},children:n},n.toString())})})}function F(e){return e===0||e===2||e===3}function Vt(e){return F(e)||e===4||e===5||e===6||e===10}const le=ye.div`group left-0 top-0 mr-1.5 overflow-hidden mt-1 text-start`,Ut=({highlightedCommand:e,status:a,children:t,showWorkUserSetting:o=!1,hideOnlyIfNotInteractedWith:r=!1,defaultExpanded:i=!1,onOpenAnalytics:c,onClick:m,...n},g)=>{const d=t!=null||m!=null,[x]=p.useState(o),[f,h]=p.useState(o||i),[M,v]=p.useState(!1),S=a===O.Finished||a===O.Error,C=r?x?!1:!M:!1,j=a===O.Running&&"loading-shimmer";return S&&C?null:d?s.jsxs(s.Fragment,{children:[s.jsx(de,{ref:g,$canShowWork:!0,...n,children:s.jsx(W,{children:s.jsx(le,{children:s.jsx(L.button,{onClick:D=>{f||c?.(),h(T=>!T),v(!0),m?.(D)},initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},className:I(j),children:s.jsxs("div",{className:"flex items-center justify-start gap-1",children:[s.jsx("span",{className:"text-start",children:e}),!m&&(f?s.jsx(Ps,{className:"icon-md"}):s.jsx(Vs,{className:"icon-md"}))]})},e?.toString())})})}),s.jsx(W,{children:f&&t&&s.jsx(L.div,{initial:"collapsed",animate:"reveal",exit:"collapsed",variants:{collapsed:{translateY:-20,opacity:0,height:0},reveal:{translateY:0,opacity:1,height:"auto"}},transition:{duration:.3,ease:"easeInOut"},className:"overflow-hidden",children:t})})]}):s.jsx(de,{ref:g,$canShowWork:!1,...n,children:s.jsx(le,{className:I(j),children:e})})},de=ye.span`block first:mt-0 relative
${({$canShowWork:e})=>e?"text-token-text-secondary hover:text-token-text-primary my-1.5":"text-token-text-secondary"}`,Ht=p.forwardRef(Ut),Bt=3,zt=.1,me=[0,.26,.4];function Wt({nextMessage:e,isLastMessage:a,isRequestActive:t,isLastTurnInConversation:o,clientThreadId:r,turnIndex:i}){let c=a||!e||e&&!Z(e.message);const m=p.useRef(!1),n=Ee(),g=J(r,K.getGizmoId);p.useEffect(()=>{e&&Z(e.message)&&!m.current&&(m.current=!0,Us(n,g))},[e,n,g]);const d=He(e?.message),x=Be(e?.message);e?.message.id&&ut(e?.message.id);const f=[];if(x?.[0]?.type==="navigation"&&e&&f.push(s.jsx(Jt,{clientThreadId:r,turnIndex:i,nextMessage:e,isRequestActive:t,isLastTurnInConversation:o,navigationCitation:x[0]},"fast-nav")),c){const h=ze(d.slice(0,Bt).map(v=>v.entries[0].url)),M=t?s.jsxs("div",{className:"flex items-center gap-1",children:[h.map((v,S)=>s.jsx(L.div,{className:I("-ml-1.5 first:ml-0 last:mr-1.5","relative"),initial:{width:S===0?0:6,opacity:0},animate:{width:20,opacity:1},transition:{duration:zt,delay:me[Math.min(S,me.length-1)]},children:s.jsx("div",{className:I("flex h-[22px] w-[22px] items-center overflow-hidden rounded-full","border-2 border-token-main-surface-primary bg-token-main-surface-primary"),children:s.jsx(Hs,{url:v,size:32,minSize:16,className:"icon-md rounded-full"})})},v)),s.jsx(k,{id:"jjx8Qg",defaultMessage:"Searching the web"})]}):s.jsx(k,{id:"fssXGM",defaultMessage:"Error while searching"});f.push(s.jsx(Ht,{highlightedCommand:M,status:t?O.Running:O.Error},"search-gpt-query"))}return f.length?s.jsx(s.Fragment,{children:f}):null}const Jt=({clientThreadId:e,turnIndex:a,nextMessage:t,isRequestActive:o,isLastTurnInConversation:r,navigationCitation:i})=>{const{scrollToHeader:c}=We("searchSources")??{},m=Je(),n=qe()&&m?.type==="searchSources",{openThreadSidebar:g}=Q(),{value:d}=_e("756982148");return p.useEffect(()=>{Ke.addFirstTiming("render.fastNavigation")},[]),p.useEffect(()=>{n&&g({type:"searchSources",scrollToHeader:c,clientThreadId:e,turnIndex:a,messageId:t?.message.id??""})},[]),p.useEffect(()=>{const x=t.message,f=x.metadata?.search_source,h=i.domains.map(M=>M.url);Bs.logEvent(G.searchToolRequestTimeToFastNav,e,x.id,{search_source:f,urls:h},()=>{f===Ye.InstantQuery&&zs.logEvent(G.searchToolPageLoadTimeToFastNav,{message_id:x.id,urls:h,search_source:f})})},[e,t,i]),o&&r&&d?s.jsx(L.div,{initial:{opacity:o?0:1,height:o?0:"auto"},animate:{opacity:1,height:"auto"},children:s.jsx(ue,{clientThreadId:e,turnIndex:a,nextMessage:t,navigationCitation:i})}):s.jsx(ue,{clientThreadId:e,turnIndex:a,nextMessage:t,navigationCitation:i})},ue=({clientThreadId:e,turnIndex:a,nextMessage:t,navigationCitation:o})=>{const{toggleThreadSidebar:r}=Q(),{value:i}=_e("756982148"),c=p.useMemo(()=>({clientThreadId:e,turnIndex:a,messageId:t?.message.id}),[e,a,t?.message.id]),m=p.useCallback((g,d)=>{r({type:"searchSources",scrollToHeader:d,clientThreadId:e,turnIndex:a,messageId:t?.message.id??""})},[r,e,a,t?.message.id]),n=Ws(c);return i?s.jsx(mt,{navigation:o,onShowSearchResults:m,trackContentReferenceEvent:n}):s.jsx(Js,{tldr:{type:"tldr",display_title:o.domains[0].title,url:o.domains[0].url,matched_text:"",start_idx:0,end_idx:0,page_title:"",breadcrumbs:[o.domains[0].domain],refs:[]},trackContentReferenceEvent:n})},qt=b(()=>N(()=>import("./j278765k98rmh2gy.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13]))),Kt=b(()=>N(()=>import("./tgoenu6tnz27czb5.js"),__vite__mapDeps([14,1,3,4,15]))),Yt=b(()=>N(()=>import("./hvso4q5e920ht7cj.js"),__vite__mapDeps([16,1,3,4,8,6,7,9]))),Qt=b(()=>N(()=>import("./kl3ozx7rebkh41p7.js"),__vite__mapDeps([17,1,3,4,6,7,9])).then(e=>e.TextMessageEditor)),Xt=b(()=>N(()=>import("./gbq6199og40qsa1v.js"),__vite__mapDeps([18,1,3,4,19,6,7,20,2,5,21,10,9,8,11,12,13]))),$t=b(async()=>()=>null),Gt=b(async()=>()=>null),Zt=b(()=>N(()=>import("./cmhwt2695mlcqdi5.js"),__vite__mapDeps([22,1,3,4,6,7,8,9,10,11,12,13]))),ea=b(()=>N(()=>import("./kvnclk26g068u8j0.js"),__vite__mapDeps([23,1,3,4,6,7,8,9,10,11,12,13])).then(e=>e.BrowsingMessage)),sa=b(()=>N(()=>import("./mr6nc5us07sbkp4s.js"),__vite__mapDeps([24,1,3,4,6,7])).then(e=>e.SearchResultMessage)),ta=b(()=>N(()=>import("./jore4rsmi6xthsxp.js"),__vite__mapDeps([25,1,3,4,6,7,8,9,10,11,12,13])).then(e=>e.JITPluginMessage)),aa=b(()=>N(()=>import("./fwdp80vy7ntbfuu7.js"),__vite__mapDeps([26,3,1,4,6,7,8,9,10,11,12,13])).then(e=>e.DataAnalysisMessage)),na=b(()=>N(()=>import("./kz50erytj15xw0j3.js"),__vite__mapDeps([27,1,3,4,6,7,28,29,30,8,9,10,11,12,13]))),oa=b(()=>N(()=>import("./k717zu3z0jn9v64p.js"),__vite__mapDeps([31,1,3,4,6,7,32,33,10,9,34,35,36,37,38,19,39,40,41,11,42,43,44,28,45,46])).then(e=>e.CoTMessage)),ia=b(()=>N(()=>import("./n5np20of7gh13xq7.js"),__vite__mapDeps([47,1,6,3,4,7,48,49,50,51])).then(e=>e.JawboneMessage));function _a(e){switch(e.type){case l.Text:case l.Debug:return[e.message];case l.MultiText:case l.Browsing:case l.CodeInterpreter:case l.JITPlugin:case l.RetrievalBrowsing:case l.ParallelBrowsing:case l.Dalle:case l.t2uay3k:case l.GizmoEditor:case l.SearchResult:case l.a8km123:case l.f959b8c:case l.b1de6e2_c:case l.b1de6e2_s:case l.b1de6e2_d:case l.is_loading_message:case l.Canmore:case l.SonicCanvas:case l.de1d73e:case l.SearchGPTQuery:case l.l1p9k3u:case l.oiw209h:case l.c12k321:return e.messages;default:throw new Error("Bad")}}function Ea({groupedMessagesToRender:e,allMessages:a,allGroupedMessages:t,clientThreadId:o,isEditing:r,isUserTurn:i,isCompletionRequestInProgress:c,isFeedbackEnabled:m,isFinalTurn:n,turnIndex:g,hasActiveRequest:d,handleEnterEdit:x,handleExitEdit:f,onRequestCompletion:h,shouldGrowContainer:M=!0,showEditButton:v=!1,showCopyButton:S=!1}){const C=qs(),{showDebugConversationTurns:j}=Ks(),[D]=J(o,u=>[u?.mode]),T=Qe(o),R=Ys(),P=t.some(u=>Qs.includes(u.type)),V=e.map((u,_)=>{const A=_===t.length-1;switch(u.type){case l.Text:case l.MultiText:{const y=e[_-1],w=y?.type,H=y&&"messages"in y?y.messages:void 0;if(u.type===l.Text){const be=u?.message&&!Z(u.message.message),ke=r?s.jsx(Qt,{message:u.message,clientThreadId:o,onRequestCompletion:h,onExitEdit:f,disabled:d}):P&&be?null:s.jsx(rt,{className:"min-h-8",message:u.message,isFeedbackEnabled:m,isCompletionInProgress:A&&c,hasActiveRequest:d,turnIndex:g,clientThreadId:o,showEditButton:v,showCopyButton:S,onEnterEdit:x,isUserTurn:i,prevGroupedMessageType:w,prevGroupedMessages:H});return s.jsxs(p.Fragment,{children:[ke,s.jsx(Gs,{isUserTurn:i,message:u.message.message})]},"group-"+u.message.nodeId)}else return u.type===l.MultiText?s.jsx(Yt,{clientThreadId:o,messages:u.messages,isCompletionInProgress:A&&c,isFeedbackEnabled:m,hasActiveRequest:d,prevGroupedMessageType:w,prevGroupedMessages:H},"multitext-"+(u.messages[0]?.nodeId??_)):u.type}case l.Browsing:case l.RetrievalBrowsing:{const y=D!=null&&[Y.GizmoInteraction,Y.GizmoMagicCreate,Y.GizmoTest].includes(D.kind),w=T?$s(T):!1;return s.jsx(ea,{messages:u.messages,isRequestActive:d,isLastMessageInTurn:A,isUsingGizmo:y,isUsingSnorlax:w,isRetrieval:u.type===l.RetrievalBrowsing},"browsing-"+(u.messages[0]?.nodeId??_))}case l.SearchGPTQuery:{const y=t.slice(_+1).find(({type:H})=>H===l.Text||H===l.SonicCanvas),w=y?.type===l.Text?y.message:y?.type===l.SonicCanvas?y.messages[0]:void 0;return s.jsx(Wt,{clientThreadId:o,turnIndex:g,isRequestActive:d,isLastMessage:A,isLastTurnInConversation:n,nextMessage:w},"searchquery-"+(u.messages[0]?.nodeId??_))}case l.a8km123:if(C?.isEnabled&&u.messages.find(({message:y})=>y.metadata?.model_slug?.includes("o3-mini"))){const y=a.findLastIndex(({message:w})=>w.author.role===he.Assistant&&w.recipient==="all");return s.jsx(oa,{isStreaming:(A||y<_)&&c,messages:u.messages},"sum-"+(u.messages[0]?.nodeId??_))}return s.jsx(na,{messages:u.messages,isStreaming:A&&c,isLastMessage:A,clientThreadId:o,currentGroupedMessageIndex:_,turnIndex:g},"sum-"+(u.messages[0]?.nodeId??_));case l.f959b8c:return null;case l.is_loading_message:return A&&c?s.jsx(Xs,{},"loading-message-"+_):null;case l.c12k321:return null;case l.l1p9k3u:return null;case l.b1de6e2_c:return s.jsx(It,{messages:u.messages,clientThreadId:o,isLastMessage:A},"b1de6e2-"+(u.messages[0]?.nodeId??_));case l.b1de6e2_s:return s.jsx(jt,{messages:u.messages,clientThreadId:o},"b1de6e2_s-"+(u.messages[0]?.nodeId??_));case l.b1de6e2_d:return null;case l.de1d73e:if(R){const y=_+1<t.length?t[_+1]:void 0;return s.jsx(ia,{clientThreadId:o,currentGroupedMessage:u,nextMessage:y&&y.type===l.Text?y.message:void 0,isLastMessage:A,isRequestActive:d},"jawbone-"+(u.messages[0]?.nodeId??_))}else return null;case l.ParallelBrowsing:return s.jsx(Zt,{messages:u.messages},"parallel-"+(u.messages[0]?.nodeId??_));case l.CodeInterpreter:return s.jsx(aa,{messages:u.messages,isRequestActive:d,clientThreadId:o},"ada-"+(u.messages[0]?.nodeId??_));case l.JITPlugin:return s.jsx(ta,{messages:u.messages,clientThreadId:o,isLastTurnInConversation:n,onRequestCompletion:h},"jit-"+(u.messages[0]?.nodeId??_));case l.t2uay3k:return s.jsx(Gt,{messages:u.messages,clientThreadId:o},"t2uay3k-"+(u.messages[0]?.nodeId??_));case l.Dalle:return s.jsx(Xt,{messages:u.messages,clientThreadId:o},"dalle-"+(u.messages[0]?.nodeId??_));case l.GizmoEditor:return s.jsx(qt,{messages:u.messages},"gizmo-editor-"+(u.messages[0]?.nodeId??_));case l.oiw209h:return s.jsx($t,{messages:u.messages,clientThreadId:o},"oiw209h-"+(u.messages[0]?.nodeId??_));case l.Canmore:return s.jsx(ht,{messages:u.messages,allGroupedMessages:e,isFinalTurn:n,isRequestActive:d,clientThreadId:o},"canmore-"+(u.messages[0]?.nodeId??_));case l.SonicCanvas:return u.messages[0],!1;case l.Debug:return j?s.jsx(Kt,{message:u.message},"debug-"+u.message.nodeId):null;case l.SearchResult:return s.jsx(sa,{messages:u.messages},"search-result-"+(u.messages[0]?.nodeId??_))}}),U=nt();return s.jsx(ca,{shouldGrowContainer:M,children:Zs()?s.jsxs(et,{isDisabled:i||!n||!c,children:[st()&&!i&&n&&s.jsx(tt,{isWordByWordEnabled:at(),isStreaming:c,debug:U}),V]}):V})}function ra(){return s.jsx(ot,{type:"danger",children:s.jsx(k,{id:"5eGo3w",defaultMessage:"Unable to display this message due to an error."})})}function ca({children:e,shouldGrowContainer:a}){return s.jsx("div",{className:I({"flex max-w-full flex-col":!0,"flex-grow":a}),children:s.jsx(Xe,{name:"GroupedMessages",fallback:ra,children:e})})}export{Ea as C,O as T,Ht as a,ya as b,_a as g};
//# sourceMappingURL=ca7lq2gyndiywe6g.js.map
