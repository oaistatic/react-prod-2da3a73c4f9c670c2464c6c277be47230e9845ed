import{r as a}from"./izh0i1dfnf8ev7x1.js";import{R as u,gG as o,D as l,e as S,j as x,bT as R}from"./hggowi1ggrzb09yc.js";import{d as _}from"./fc2hzad6rtrm7s5f.js";const W=e=>a.createElement("svg",{width:24,height:24,viewBox:"0 0 34 34",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e},a.createElement("g",{id:"icon / robot-sad"},a.createElement("path",{id:"Rectangle 49961",d:"M4.9585 9.91667C4.9585 8.35186 6.22702 7.08333 7.79183 7.08333H26.2085C27.7733 7.08333 29.0418 8.35186 29.0418 9.91667V21.25C29.0418 24.3796 26.5048 26.9167 23.3752 26.9167H10.6252C7.49555 26.9167 4.9585 24.3796 4.9585 21.25V9.91667Z",stroke:"currentColor",strokeWidth:2.83333}),a.createElement("circle",{id:"Ellipse 32520",cx:12.0415,cy:14.1667,r:2.125,fill:"currentColor"}),a.createElement("circle",{id:"Ellipse 32521",cx:21.9585,cy:14.1667,r:2.125,fill:"currentColor"}),a.createElement("path",{id:"Vector 2380",d:"M17 7.08333V4.25",stroke:"currentColor",strokeWidth:2.83333,strokeLinecap:"round",strokeLinejoin:"round"}),a.createElement("path",{id:"Vector 2381",d:"M4.95817 14.1667V14.1667C4.17577 14.1667 3.5415 14.8009 3.5415 15.5833V17C3.5415 17.7824 4.17577 18.4167 4.95817 18.4167V18.4167",stroke:"currentColor",strokeWidth:2.83333,strokeLinecap:"round",strokeLinejoin:"round"}),a.createElement("path",{id:"Vector 2382",d:"M29.0418 14.1667V14.1667C29.8242 14.1667 30.4585 14.8009 30.4585 15.5833V17C30.4585 17.7824 29.8242 18.4167 29.0418 18.4167V18.4167",stroke:"currentColor",strokeWidth:2.83333,strokeLinecap:"round",strokeLinejoin:"round"}),a.createElement("path",{id:"Vector 2386",d:"M19.8335 21.158C17.8696 20.3362 16.1307 20.3362 14.1668 21.158",stroke:"currentColor",strokeWidth:2.83333,strokeLinecap:"round",strokeLinejoin:"round"})));var m=(e=>(e.SCALLION="scallion",e.SCALLION_RC="scallion-rc",e.SCALLION_RC0="scallion-rc0",e.SCALLION_RC1="scallion-rc1",e.SCALLION_RC2="scallion-rc2",e.CHIVE="chive",e.CHIVE_RC="chive-rc",e.CHIVE_RC0="chive-rc0",e.CHIVE_RC1="chive-rc1",e))(m||{});const F=async({queryKey:e})=>{const[r,n]=e;if(n.length<2)return[];const t=new URLSearchParams({query_fragment:n});return u.get(`${o}/suggestions?${t.toString()}`).then(s=>s.suggestions).catch(()=>[])};async function D({threadId:e,sessionId:r,query:n,agentSettingsOverrides:t,metadata:s,extraTurnData:y}){const C=g(t),d=e?`${o}/threads/${e}/turns?blocking=false`:`${o}/turns?nonce=${r}`;t.emulated_location&&(s={...s,...t.emulated_location});const h=new PerformanceObserver(w=>{const f=w.getEntriesByName(d,"resource");if(f.length){const i=f[0];if(i.connectEnd){const L=i.connectEnd-i.fetchStart;l.addAction("sonic.web.home.new_turn_connection_time",{durationMs:L})}h.disconnect()}});return h.observe({type:"resource"}),u.post(d,{...C,turn:{user_query:n,now:t.emulated_date?new Date(t.emulated_date).toISOString():void 0,...y},user_metadata:s})}async function q(){return u.delete(`${o}/threads`)}function g(e){return{settings_overrides:{search_results:{search_engines:e.use_labrador?{bing:{}}:{bing:{ranking_model:null,rrf_alpha:1,rrf_input_threshold:0},labrador:null}},model_response:{enable_multimodal:e.show_image_to_model,completion_model:e.completion_model&&e.completion_model!=="production"?{model:e.completion_model,clip_model:"@mmapi",direct_connection_urls:[]}:{}}},base_config:e.base_config??m.SCALLION,eval_preset:e.eval_preset}}async function H({threadId:e,threadUserId:r,routePrefix:n}){let t=o;n&&(t=t+n);const s=new URL(`${t}/threads/${e}/with_turns`);return r&&s.searchParams.append("thread_user_id",r),await u.get(s.toString())}async function O(e){const r=new FormData;return r.append("feedback",JSON.stringify({thread_id:e.threadId,turn_index:e.turnIndex,rating:e.rating,search_query:e.searchQuery,text:e.text,model_instructions:e.modelInstructions,tags:e.tags,user_email:e.userEmail})),e.screenshot&&r.append("file",new File([e.screenshot],"screenshot.jpeg",{type:"image/jpeg"})),u.post(`${o}/feedback/turns`,r)}async function P(e,r){return u.post(`${o}/threads/${e}/turns/${r}/images_try_hard`)}async function z(e){const r=new FormData;return e.screenshot&&r.append("file",new File([e.screenshot],"screenshot.jpeg",{type:"image/jpeg"})),r.append("feedback",JSON.stringify({thread_id:e.threadId,url:e.url,title:e.title,snippet:e.snippet,rating:e.rating,search_query:e.searchQuery,text:e.text,tags:e.tags,user_email:e.userEmail,turn_index:e.turnIndex})),u.post(`${o}/feedback/links`,r)}function U(e){const r=g(e.agentSettingsOverrides);u.post(`${o}/prefetch`,{...r,turn:{user_query:e.query},user_metadata:e.metadata})}function A(){return u.get(`${o}/healthcheck`)}function J(){return u.post(`${o}/waitlist`)}function E(e,r){if(Object.is(e,r))return!0;if(typeof e!="object"||e===null||typeof r!="object"||r===null)return!1;if(e instanceof Map&&r instanceof Map){if(e.size!==r.size)return!1;for(const[t,s]of e)if(!Object.is(s,r.get(t)))return!1;return!0}if(e instanceof Set&&r instanceof Set){if(e.size!==r.size)return!1;for(const t of e)if(!r.has(t))return!1;return!0}const n=Object.keys(e);if(n.length!==Object.keys(r).length)return!1;for(const t of n)if(!Object.prototype.hasOwnProperty.call(r,t)||!Object.is(e[t],r[t]))return!1;return!0}class Q extends Error{constructor(r){super(r),this.name="WebsocketConnectError"}}class T extends Error{constructor(r){super(r),this.name="TurnError"}}class G extends Error{constructor(r){super(r),this.name="TurnDeltaMessageError"}}function V(e){return e?e.model_response?.text!=null&&e.model_response.text.length>0:!1}function p(e){return e.execution_status==="fatal_system_error"}function $(e){return e.execution_status==="in_progress"||e.execution_status===null}function Z(e){return c(r=>r.thread?.turns.map(n=>e.reduce((t,s)=>(t[s]=n[s],t),{}))??[],(r,n)=>{if(r.length!==n.length)return!1;for(let t=0;t<r.length;t++)if(!E(r[t],n[t]))return!1;return!0})}function K(){return c(e=>R(e.thread?.turns.flatMap(r=>r.model_response?.citations)),E)}const k={thread:null,error:void 0},c=S(x(()=>({...k}))),I=_(()=>{l.addError(new T("got updateTurn with no current thread"))},1e3),v=_(e=>{l.addError(new T("turn not found"),{turnIndex:e})},1e3),X={threadId:e=>e.thread?.id??null,turns:e=>e.thread?.turns??[],turnCitations:e=>r=>r.thread?.turns[e].model_response?.citations??[],hasResponse:e=>V(e.thread?.turns[0]),firstTurn:e=>e.thread!=null?e.thread.turns[0]:void 0,lastTurn:e=>e.thread!=null?e.thread.turns[e.thread.turns.length-1]:void 0,numTurns:e=>e.thread?.turns.length??0,isLastTurnStreaming:e=>{const r=e.thread!=null?e.thread.turns[e.thread.turns.length-1]:void 0;return r!=null&&$(r)},hasModelResponseText:e=>e.thread?.turns[0]?.model_response?.text!=null,hasFirstTurnError:e=>{const r=e.thread?.turns[0];return!!r&&p(r)},hasTurnError:e=>e.thread?.turns.some(p)??!1,threadError:e=>e.error,__deprecated_sportsWidget:e=>e.thread?.turns[0]?.sports_widget??null},Y={appendTurn(e,r,n){c.setState(t=>{t.thread?.id!==e&&(n?.(e),t.thread={id:e,turns:[]}),t.thread.turns.push(r)})},updateTurn(e,r){c.setState(n=>{const t=n.thread;if(!t){I();return}const s=t.turns[e];if(!s){v(e);return}r(s)})},clearThread(){c.setState(()=>({...k}))},setError(e){c.setState(r=>{r.error=e})},setThread(e,r){c.setState(n=>{n.thread={id:e,turns:r}})}};export{m as B,W as S,Y as T,Q as W,c as a,X as b,K as c,p as d,q as e,J as f,H as g,A as h,D as i,T as j,G as k,F as l,O as m,z as n,$ as o,P as p,U as r,Z as u};
//# sourceMappingURL=l2i0py62vkyv61za.js.map
