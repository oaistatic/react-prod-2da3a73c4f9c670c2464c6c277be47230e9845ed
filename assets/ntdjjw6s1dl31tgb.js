const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/odz0wn7xlaiouzpz.js","assets/hggowi1ggrzb09yc.js","assets/izh0i1dfnf8ev7x1.js","assets/root-ko7rpr3h.css","assets/fc2hzad6rtrm7s5f.js","assets/conversation-small-lgvqkxxm.css","assets/i7y8w3cb10gcd64n.js","assets/iuor4bcxoiridr5j.js","assets/j492ff3c1rtrw6ax.js","assets/ddzilicy6qtleo90.js","assets/8nxoaz0vb9p890un.js","assets/ozluxx1s2jsn9j26.js","assets/c9ymhpumxb2611xi.js","assets/gq56vmyv6ftpm8ay.js","assets/ki2fnq5gqslif1ka.js","assets/hy4byupilmyf57n0.js","assets/j7xrr4x8o3ssozmz.js","assets/jr1b41w4nuv00isi.js","assets/nn6gjrst5lwozesx.js","assets/lb1py1igp6jzrtce.js","assets/c0dr65ykcqmn5jn4.js","assets/in3ze5ugryldzaj2.js","assets/ab6tyx2xygyb56l3.js","assets/h28ootcilxet47c8.js","assets/bluopupp3hty4d7q.js","assets/ca7lq2gyndiywe6g.js","assets/c9avu4yfkjav9bdb.js","assets/ebe0yuqj113ljvzn.js","assets/od46hv00xnfht62v.js","assets/ldmmkc4tdjcw782k.js","assets/7wy7hh8qb4pjpp4m.js","assets/dzs9jsp7hkzpbuhr.js","assets/kkwehadcshvfaf0g.js","assets/msabkok53wtel8yn.js","assets/myyiiqb6up4h3fac.js","assets/ojcgwgwujkn9jneg.js","assets/kh1pguo5uwldp8r4.js","assets/paq1bye12yp7s2hg.js","assets/hjbk0a4n40hheieo.js","assets/modzmagtrlhmunl0.js","assets/njf3cz24xrjtlnt8.js","assets/l47lzuwnujr3zu1x.js","assets/o6pswmk2unatjay4.js","assets/occ17b3goczs014q.js","assets/g6h6w1mnkfslacmc.js","assets/enugaxrnjmwna50j.js","assets/nlrayamhrsyhya9q.js","assets/kr0ic0arauqluu3x.js","assets/kk7z3x85399sx5vr.js","assets/ktras8z3bowlgaf3.js","assets/lonirizi613v4ikr.js","assets/fpc3fdcd67mn2gbu.js","assets/m89x2zftpo6hrypr.js","assets/niehzmi6s4ycdcrr.js","assets/ozu9ysjrlcwoblzo.js","assets/7nzpgz11uruugbbu.js","assets/iejjcjl0eek5zfni.js","assets/cjw59qpvd6058plc.js","assets/ei7ej0cmjdt2qsbq.js","assets/lx9hhkuca66lgvof.js","assets/gy64pge8qevmvg7e.js","assets/gr2fdg6s9o78t8hz.js","assets/elgrylk95u65jz3s.js","assets/d70iue5kyho1p6i8.js","assets/l95tqa88v5i9hn0n.js","assets/kaeuu7lrrhyntd9q.js","assets/fzrn137102spawew.js","assets/e9lafxuzyeh4418f.js","assets/d7bvxndom3b3tpj8.js","assets/dxpde14qu5zfq5m7.js","assets/k6wx8lqy041mdibl.js","assets/f3zuoxagz3pyagk9.js"])))=>i.map(i=>d[i]);
import{S as we,V as ie,s as Z,ae as ls,dj as xo,h5 as uc,h6 as mc,hN as hc,eK as pc,hO as gc,cc as Ut,dt as Nr,eF as Pa,bY as ft,P as F,h as He,hP as Cn,a as B,bu as wn,dw as _s,br as Oe,E as As,J as At,O as Zt,aj as Le,e3 as ct,an as fc,cp as xc,bW as X,cj as Po,bv as Ue,bw as Ve,el as dt,au as Nt,hQ as Ia,d1 as Io,en as Er,u as zt,v as ut,hR as Rr,d as N,hS as vc,c5 as un,K as Fo,cs as Fa,dA as Sc,hT as Pr,hU as vo,hV as bc,ar as Fe,bt as Mn,X as Ot,hW as Ir,aM as Ba,e as yc,j as jc,a4 as es,a3 as co,bk as So,a2 as Re,bI as Bo,dz as gn,ax as as,r as tt,n as st,ap as Cc,T as Do,eC as Lo,cN as wc,cL as Mc,bX as kc,dv as Fr,ep as Br,cF as Tc,cl as kn,ch as Da,cd as kt,gb as _c,a8 as Ac,ad as Nc,al as Dr,hX as Ec,hY as Rc,hZ as Pc,gc as Ho,cB as La,gi as Ic,gj as Fc,bF as Bc,H as Tt,gC as Dc,h_ as Lc,gr as Hc,o as Oc,h$ as Uc,i0 as zc,d0 as Gc,D as bo,eY as Wc,fu as qc,aR as Vc,aL as js,d2 as Lr,eo as $c,fQ as Yc,fP as Oo,L as Uo,i1 as zo,gy as Go,aI as Kc,cq as lt,F as Hr,aJ as Ha,bU as Qc,Q as rs,eA as Or,i2 as Jc,a0 as Xt,bl as Ur,d3 as Xc,bo as Zc,i3 as ed,cu as td,ei as yo,fC as sd,q as ws,aK as nd,ej as fn,bi as Zs,U as zr,as as Gr,W as od,b$ as ad,eV as rd,eR as id,M as ld,bH as cd,b_ as dd,Z as ud,d$ as md,gv as hd,i4 as pd,fU as gd}from"./hggowi1ggrzb09yc.js";import{c as oe,r as i,j as e,ax as nt,av as ee,d as Tn,M as E,L as xn,R as Wo,h as Wr,b7 as fd,a as qr,w as xd,v as vd,b8 as Sd,b3 as bd,b0 as Oa}from"./izh0i1dfnf8ev7x1.js";import{u as yd}from"./lb1py1igp6jzrtce.js";import{fW as _t,pe as jd,pf as Cd,pg as wd,ph as Md,pi as kd,pj as Td,pk as _d,pl as Ad,U as Ms,r as Xe,f4 as _n,bl as Nd,pm as xt,i as Vr,lJ as $r,bw as Yr,pn as Kr,po as An,j8 as Ua,a3 as Ns,pp as vn,cf as ts,lo as Sn,pq as qo,pr as Vo,dv as Nn,cb as Qr,cc as Jr,iF as Xr,j7 as Zr,iD as ei,iE as ti,ja as Ed,ps as Rd,c9 as $o,cd as mn,ce as Pd,cB as Yo,hF as hn,V as Es,pt as Ko,m as Gt,jm as Id,bL as jo,ah as Fd,o as za,a7 as Bd,an as Dd,fa as Ld,ao as Hd,az as Qo,ca as En,iX as Jo,hJ as cs,g_ as Od,pu as Mt,bE as si,pv as Co,pw as uo,px as Ud,py as en,pz as zd,gM as Gd,en as Ze,mp as Wd,mc as Ga,gL as qd,eo as Vd,pA as $d,jI as tn,pB as Yd,v as Xo,d7 as Kd,u as Qd,pC as Jd,fq as Xd,X as Rs,D as Zd,pD as eu,gw as tu,pE as su,pF as nu,cv as ou,eO as Zo,hR as au,dG as ru,fg as iu,pG as lu,pH as cu,pI as ni,pJ as du,pK as uu,q as ot,bZ as oi,pL as ea,ex as J,pM as Rn,pN as ss,j5 as mu,eE as ns,pO as ai,pP as ri,ev as ze,pQ as Ee,gP as ii,l8 as li,lb as ci,dB as hu,B as ta,fB as pu,l7 as gu,pR as di,g4 as fu,pS as xu,pT as is,kH as ui,pU as V,pV as mi,pW as hi,pX as vu,pY as Su,pZ as bu,p_ as yu,p$ as ju,q0 as Cu,q1 as wu,q2 as Mu,q3 as ku,q4 as Tu,q5 as _u,q6 as Au,q7 as Nu,q8 as Eu,q9 as Ru,qa as Pu,qb as Iu,qc as Fu,qd as Bu,qe as Du,qf as Lu,qg as Hu,qh as Ou,qi as Uu,qj as zu,qk as Gu,ql as Wu,qm as qu,qn as pi,a1 as Cs,qo as gi,lW as fi,qp as bn,cu as Vu,qq as xi,qr as ys,qs as $u,qt as Yu,lv as ks,qu as vi,qv as Ku,qw as Qu,qx as Wa,qy as Ju,qz as Xu,iG as Zu,qA as em,qB as tm,qC as sm,O as Si,fs as nm,gO as bi,qD as sn,qE as om,oo as am,gY as yi,qF as rm,qG as im,qH as lm,qI as cm,ab as ji,qJ as dm,c7 as Pn,dw as Ci,ew as sa,qK as um,qL as wi,qM as mm,qN as hm,qO as pm,a2 as Mi,h1 as qa,hv as ki,iS as na,g7 as gm,qP as fm,i0 as xm,qQ as vm,qR as Sm,qS as bm,qT as ym,h5 as jm,dl as Cm,qU as wm,qV as Mm,qW as km,qX as Tm,gQ as _m,mN as Am,qY as Nm,qZ as Em,gS as Rm,gT as Pm,gu as Im,q_ as Fm,p5 as Bm,mQ as Dm,q$ as Lm,r0 as Hm,fI as Om,r1 as Um,dy as zm,dz as Gm,r2 as Wm,r3 as qm,ey as Vm,k6 as $m,fJ as Ym,g2 as Km,eC as Ti,r4 as Qm,r5 as Jm,r6 as _i,jh as oa,eF as yn,h3 as Xm,hT as Zm,r7 as wo,d as Ai,r8 as Va,r9 as Ni,ra as eh,nR as th,eA as sh,rb as nh,lj as Ei,eB as oh,rc as ah,rd as rh,fm as ih,jv as Mo,eX as lh,re as ch,rf as dh,rg as uh,rh as nn,lh as Ri,no as mh,ri as Pi,rj as $a,rk as hh,i5 as jn,rl as ph,rm as gh,rn as on,ro as fh,cC as xh,cD as vh,ez as pn,dA as Sh,bD as Ii,cU as Fi,ga as bh,gn as Bi,gp as Di,d4 as yh,rp as jh,rq as aa,it as Ch,rr as wh,hc as Mh,g1 as kh,rs as Th,rt as Li,ru as _h,rv as Ah,rw as Nh,dg as Eh,i4 as Rh,cA as Ph,rx as Ih,ry as Fh,fQ as mo,gm as Bh,go as Dh,gB as Lh,rz as Hh,rA as Oh,rB as Uh,rC as zh,rD as Gh,rE as Wh,rF as qh,rG as Vh,dk as $h,rH as Yh,rI as Kh,lf as Qh,lg as Jh,le as Xh,rJ as Zh,hW as ep,rK as tp,hw as sp,hy as np,H as op,gk as ap,j_ as rp,j$ as ip,nJ as lp,hL as cp,hx as dp,nd as up,ht as mp,cW as hp,cV as pp,rL as gp,hz as Ya,cG as fp,cH as xp,jC as vp,mL as Sp,hC as bp,rM as yp,aa as jp}from"./fc2hzad6rtrm7s5f.js";import{a as Hi,m as Ts,c as Oi,d as Cp,u as wp}from"./c0dr65ykcqmn5jn4.js";import{e as Ui,b as ra,a as In,f as Mp,u as Ps,t as ko,c as zi,h as Gi,i as Fn,j as kp,k as Ka,l as Tp,s as _p,m as Ap,P as Np}from"./8nxoaz0vb9p890un.js";import{S as Ep,u as Bn,G as Rp,L as Pp,a as Ip}from"./jr1b41w4nuv00isi.js";import{u as Fp,j as Bp,g as Dp,S as Lp,k as Hp,l as Op,m as Up,n as ia,s as zp,o as Gp,p as an,q as Wp,r as qp,t as Dn,C as Wi}from"./in3ze5ugryldzaj2.js";import{u as qi}from"./h28ootcilxet47c8.js";import{G as la,a as Vp}from"./j7xrr4x8o3ssozmz.js";import"./ab6tyx2xygyb56l3.js";import{B as $p}from"./bluopupp3hty4d7q.js";import{C as To,g as Yp}from"./ca7lq2gyndiywe6g.js";function Kp({usage:t}){const s={work:{icon:Md,color:"#35AE47"},school:{icon:kd,color:"#E937D1"},personalTasks:{icon:Td,color:"#EA8444"},funAndEntertainment:{icon:_d,color:"#6C71FF"},justCurious:{icon:Ad,color:"#FFCC00"}},o=s[t].icon,n=s[t].color;return e.jsx(o,{className:"icon-md",style:{color:n}})}function Qp({clientThreadId:t}){const s=oe(),o=Hi({clientThreadId:t});return i.useEffect(()=>{we.logEvent("chatgpt_convo_onboarding_usage_chips_shown")},[]),e.jsx(nt,{mode:"wait",children:e.jsx(ee.div,{className:"mx-[-2.125rem] mt-2 flex flex-wrap gap-2 px-[2.125rem]",initial:{opacity:0},animate:{opacity:1,transition:{delay:.2,ease:"easeInOut"}},exit:{opacity:0,transition:{ease:"easeInOut"}},children:["school","work","personalTasks","funAndEntertainment","justCurious"].map(n=>e.jsxs("button",{className:"inline-flex h-[42px] items-center justify-start gap-2 rounded-[25px] border border-token-border-light bg-token-main-surface-primary px-4 py-3 hover:bg-token-main-surface-secondary",onClick:()=>{o({stepPrompt:s.formatMessage(Ts[`${n}Prompt`]),messageMetadata:{onboarding:{main_usages:[{usage:n}]},is_starter_prompt:!0,suggestion_type:_t.Starter}}),we.logEvent("chatgpt_convo_onboarding_usage_chip_clicked",null,{usage:n})},children:[e.jsx("div",{"data-svg-wrapper":!0,className:"relative",children:e.jsx(Kp,{usage:n})}),e.jsx("div",{className:"font-['SF Pro'] text-[13px] font-normal leading-[18px] text-token-text-primary opacity-90",children:s.formatMessage(Ts[n])})]},n))})})}function Jp({clientThreadId:t,examples:s}){const o=Hi({clientThreadId:t}),n=[jd,Cd,wd],a=oe();return i.useEffect(()=>{we.logEvent("chatgpt_convo_onboarding_examples_shown")},[]),e.jsx(nt,{mode:"wait",children:e.jsxs("div",{children:[e.jsx(ee.p,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3,ease:"easeInOut"},className:"text-base text-token-text-primary",children:a.formatMessage(Ts.tryAnExample)}),e.jsx("ul",{className:"mx-[-2.125rem] flex list-none flex-nowrap gap-6 overflow-auto px-[2.125rem] py-4",children:s.map((r,l)=>e.jsx(ee.li,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:(l+1)*.2,duration:.3},children:e.jsxs("button",{className:"inline-flex h-60 w-[222px] flex-col items-center justify-start overflow-hidden rounded-2xl bg-token-main-surface-primary outline outline-token-border-xlight transition-all duration-300 hover:shadow-lg hover:shadow-token-border-light",onClick:()=>{o({stepPrompt:r.example,messageMetadata:{onboarding:{triggered_tools:[r.feature]},is_starter_prompt:!0,suggestion_type:_t.Starter}}),we.logEvent("chatgpt_convo_onboarding_example_clicked",null,{tool:r.feature})},children:[e.jsx("img",{src:n[l%n.length].src,className:"h-[160px] w-full object-cover",alt:a.formatMessage({id:"chatgpt.new-onboarding.example-prompt",defaultMessage:"Example prompt"})}),e.jsx("div",{className:"inline-flex h-20 w-full gap-1 p-4",children:e.jsx("div",{className:"line-clamp-2 shrink grow basis-0 text-start text-base leading-normal text-token-text-primary",title:r.title,children:r.title})})]})},r.feature))})]})})}function Xp({clientThreadId:t,children:s}){const{isEligible:o,markAsViewed:n}=Oi(t),a=oe();return i.useEffect(()=>{o&&Ms.showAnnouncementTooltipExclusively(Xe.hasSeenFilePickerNuxTooltip,!0)},[o]),o?e.jsx(_n,{announcementKey:Xe.hasSeenFilePickerNuxTooltip,show:!0,side:"top",align:"start",theme:"bright",dismissOnOutsideClick:!0,badge:"none",title:a.formatMessage(Ts.tryUploadingAFile),description:a.formatMessage(Ts.uploadFileExample),onDismiss:n,sideOffset:0,children:s}):s}const Vi=({clientThreadId:t,rateLimitPopup:s,children:o,disabled:n,highlightTooltip:a=!1,disabledReason:r,currentModelName:l})=>{const d=oe(),c=ie(t,Z.getIsNewConversation),p=ls(),h=f=>{s!=null&&f&&F.logPopoverHover({type:"rate_limit",location:"file_upload",plan_type:p?.planType??"unknown"})},u=Nd(xo.signUpButtonText),{isEligible:m}=Oi(t),g=!!s;return e.jsx(e.Fragment,{children:g?e.jsx("div",{className:"h-8",children:e.jsxs(uc,{delayDuration:150,onOpenChange:h,children:[e.jsx(mc,{asChild:!0,children:o}),e.jsx(hc,{children:e.jsx(pc,{$as:gc,side:"left",sideOffset:0,align:"start",alignOffset:-12,className:"max-w-[320px]",children:e.jsx(Zp,{isNewConversation:c,rateLimitPopup:s,signUpButtonText:u})})})]})}):!n&&m?e.jsx(Xp,{clientThreadId:t,children:o}):e.jsx(Ut,{sideOffset:0,label:n?r===xt.ModelNotSupported?d.formatMessage({id:"pEB4vw",defaultMessage:"Attachments disabled for {modelName}"},{modelName:`${l}`}):r===xt.ThinkModeInUse?d.formatMessage({id:"NRk4QL",defaultMessage:"Attachments disabled for Reason mode"}):r===xt.SearchModeInUse?d.formatMessage({id:"YlO80p",defaultMessage:"Attachments disabled for Search mode"}):d.formatMessage({id:"9Wgi7B",defaultMessage:"Attach files is unavailable"}):d.formatMessage({id:"wkpQmi",defaultMessage:"Upload files and more"}),className:"flex",open:a?!0:void 0,side:"bottom",children:o})})},Zp=({isNewConversation:t=!1,rateLimitPopup:s,signUpButtonText:o})=>{const n=ls(),a=Tn(),r=Vr(),l=$r(),d=Nr();if(s==null)return null;const{call_to_action:c,description:p}=s,h=p||e.jsx(E,{...Qa.defaultDescription}),u=c?.includes(Pa.GET_PLUS),m=c?.includes(Pa.AUTHENTICATE),g=m&&d;return e.jsxs("div",{className:"p-2 text-sm text-token-text-primary",children:[e.jsx("div",{className:"mb-3",children:h}),u?e.jsx(ft,{size:"small",color:"secondary",onClick:()=>{Yr(a,"Rate limited file upload popover"),F.logRateLimitGetPlusButtonClicked({type:"file_upload",location:"popover",plan_type:n?.planType??"unknown",is_hard_block:!1,is_new_conversation:t,hard_block_reason:""})},children:e.jsx(E,{...Qa.getPlus})}):null,m?e.jsx(ft,{size:"small",color:"primary",onClick:()=>{r({authType:l?"login":"signup",callback:f=>{l?F.logLogInButtonClicked({location:"File picker rate limit tooltip",provider:f}):F.logSignUpButtonClicked({location:"File picker rate limit tooltip",provider:f})}})},children:l?e.jsx(E,{...xo.logInButtonText}):e.jsx(E,{...o})}):null,g?e.jsx(ft,{size:"small",color:"secondary",className:"ml-2",onClick:()=>{r({authType:l?"signup":"login",callback:f=>{l?F.logSignUpButtonClicked({location:"File picker rate limit tooltip",provider:f}):F.logLogInButtonClicked({location:"File picker rate limit tooltip",provider:f})}})},children:l?e.jsx(E,{...o}):e.jsx(E,{...xo.logInButtonText})}):null]})},Qa=He({defaultDescription:{id:"U5qAWP",defaultMessage:"You've reached your daily upload limit. Get ChatGPT Plus to unlock more."},getPlus:{id:"TeyLcp",defaultMessage:"Get Plus"}});function eg({clientThreadId:t,getInputProps:s,openFileDialog:o,uploadType:n,icon:a,isDisabled:r=!1,isSmall:l=!1,showLabel:d=!1,showUpsell:c=!1,hideBorder:p=!1,highlightTooltip:h=!1,disabledReason:u,currentModelName:m}){const g=oe(),f=Cn();r=(r||!!f)&&!c;const v=e.jsxs(Kr,{disabled:r,$showLabel:d,$hideBorder:p,$isSmall:l,onClick:M=>{if(M.preventDefault(),c){F.logNoAuthAttachButtonClicked({location:"No auth upsell"});return}F.logEvent(B.openFileViewer,{intent:n.toString()}),o()},"aria-label":r?u===xt.ModelNotSupported?g.formatMessage({id:"pEB4vw",defaultMessage:"Attachments disabled for {modelName}"},{modelName:`${m}`}):u===xt.ThinkModeInUse?g.formatMessage({id:"NRk4QL",defaultMessage:"Attachments disabled for Reason mode"}):u===xt.SearchModeInUse?g.formatMessage({id:"YlO80p",defaultMessage:"Attachments disabled for Search mode"}):g.formatMessage({id:"PromptFilePicker.attachFilesUnavailable",defaultMessage:"Attach files is unavailable"}):g.formatMessage({id:"PromptFilePicker.attachFiles",defaultMessage:"Upload files and more"}),children:[a,d&&e.jsx("span",{className:"whitespace-nowrap pr-1 [display:--force-hide-label]",children:g.formatMessage({id:"PromptFilePicker.attachFilesLabel",defaultMessage:"Attach"})})]}),j=e.jsx("input",{disabled:r,...s({className:"hidden"})}),S=e.jsxs("div",{className:"flex",children:[v,j]});return c?e.jsx(wn,{children:e.jsx(Ut,{sideOffset:0,label:e.jsx(E,{id:"wkpQmi",defaultMessage:"Upload files and more"}),side:"bottom",open:h||void 0,children:e.jsx(_s,{triggerButton:S,sideOffset:0,alignOffset:0,children:e.jsx(An,{location:"attach",statsig_login_event:"chatgpt_composer_upsell_login_button_clicked",statsig_signup_event:"chatgpt_composer_upsell_signup_button_clicked"})})})}):e.jsx(Vi,{disabled:r,clientThreadId:t,rateLimitPopup:f,highlightTooltip:h,children:S})}function tg({code:t,message:s}){switch(t){case Ua.FileTooLarge:return Ja.errorFileTooLarge;case Ua.TooManyFiles:return F.logEvent(B.uploadedMaxFilesError),Ja.errorTooManyFiles;default:return s}}const Ja=He({attachImages:{id:"PromptFilePicker.attachImages",defaultMessage:"Attach images"},attachFiles:{id:"PromptFilePicker.attachFiles",defaultMessage:"Upload files and more"},errorFileTooLarge:{id:"PromptFilePicker.errorFileTooLarge",defaultMessage:"Your file is too large. The maximum file size is {size}MB."},errorTooManyFiles:{id:"PromptFilePicker.errorTooManyFiles",defaultMessage:"You may only upload {maxNum} files at a time."},defaultFileUploadRateLimited:{id:"U5qAWP",defaultMessage:"You've reached your daily upload limit. Get ChatGPT Plus to unlock more."},getPlusButton:{id:"TeyLcp",defaultMessage:"Get Plus"}}),Xa=He({dragInstructions:{id:"FileDropZone.dragInstructions",defaultMessage:"Add anything"},dragAllAccepted:{id:"FileDropZone.dragAllAccepted",defaultMessage:"Drop any file here to add it to the conversation"}});function sg(t){if(!t.accept||Object.keys(t.accept).length===0)return[];const s=[];return Object.values(t.accept).forEach(o=>s.push(...o)),s.sort()}function ng(t){const{className:s,children:o,clientThreadId:n,currentModelConfig:a,noKeyboard:r}=t,l=oe(),d=As(),c=Ns(n),p=vn(a,c),h=p!==ts.None,u=Sn(k=>k.files),m=(p===ts.Multimodal?qo:Vo)-u.length,g=m<=0,{getGizmoId:f}=Nn(),{handleFileAccepted:v}=Yi(l,vn(a,c),Jr(a,c),"drag",f,Qr(a,c)?.attachments),j=Cn(),S=Xr(Zr(a,c)),{getRootProps:M,isDragActive:C}=ei({maxFiles:m,disabled:!h||g||j!=null,noClick:!0,noKeyboard:r,onDropAccepted:v,onDropRejected:k=>$i(k,l,d,p),multiple:!0,maxSize:ti,...S}),T=sg(S);return e.jsxs("div",{...M({className:s}),children:[o,C&&e.jsxs(og,{children:[e.jsx(Ed,{}),e.jsx("h3",{children:e.jsx(E,{...Xa.dragInstructions})}),e.jsx("h4",{className:"w-2/3 text-center",children:T.length>0?T.join(", "):e.jsx(E,{...Xa.dragAllAccepted})})]})]})}function $i(t,s,o,n){const{errors:a}=t[0];a.forEach(r=>{const l=tg(r);typeof l=="string"?o.danger(l,{hasCloseButton:!0}):o.danger(s.formatMessage(l,{size:Rd,maxNum:n===ts.Multimodal?qo:Vo}),{hasCloseButton:!0})})}function Yi(t,s,o,n,a,r){const l=As(),d=$o();return{handleFileAccepted:i.useCallback(async(p,h)=>{F.logEvent(B.uploadFile,{client:"web",eventSource:n,intent:s.toString()});const u=a!=null?await a():void 0;p.length>0&&p.forEach(m=>{mn.uploadFile(d,Pd(m),m,s,o,t,l,{gizmoId:u},r)})},[n,s,a,d,o,t,l,r])}}const og=Oe.div`absolute inset-0 opacity-80 flex gap-2 flex-col justify-center items-center bg-token-main-surface-primary text-token-text-primary`;function Ki(t){const{currentModelId:s}=Fp(),o=Ns(t),[n,a]=ie(t,u=>[Z.hasUserMessage(u),Z.getGizmoId(u)]),r=At(),l=Yo(s),d=Zt(t)&&!n&&(hn(o)||o?.kind===Le.GizmoTest),c=Es(a);return{showEmptyState:d,canUseNewHomepage:d&&c||d&&!a&&!l&&!r}}const Za=Oe.button`max-w-28 xs:max-w-40 sm:max-w-60 md:max-w-none group flex cursor-pointer items-center gap-1 rounded-lg py-1.5 ${({$shimmer:t})=>t?"loading-shimmer":""} ${({$isScreenArch:t})=>t?"text-md px-1":"px-1 text-lg"} hover:bg-token-main-surface-secondary radix-state-open:bg-token-main-surface-secondary font-semibold text-token-text-secondary overflow-hidden whitespace-nowrap`;function ag({conversation:t,gizmoResource:s,elementRef:o}){const a=ie(t.id,r=>r?.title??null)??t.title;return e.jsx(xn,{to:Dd(t.id,s),children:e.jsx(X.Item,{onSelect:()=>{F.logEvent(B.projectsBreadcrumbPickerPickConversation)},icon:Ld,children:e.jsx("div",{ref:o,children:a})},t.id)})}function rg({gizmoId:t,clientThreadId:s,inMobileHeader:o,modelLabel:n,modelPickerContent:a}){const r=oe(),d=!Ko(t),{data:c}=Gt(t),{items:p,hasNextPage:h,fetchNextPage:u,isLoading:m,isFetchingNextPage:g}=Id(t),f=i.useRef(null),v=i.useCallback(A=>{m||A==null||(f.current?.disconnect(),f.current=new IntersectionObserver(O=>{O[0].isIntersecting&&h&&u()}),f.current.observe(A))},[m,h,u]);i.useEffect(()=>()=>{f.current?.disconnect()},[]);const[j,S,M]=ie(s,A=>[A?.isLoading,A?.title??null,Z.getThreadTitleSource(A)]),C=ct(),{showEmptyState:T}=Ki(s),k=r.formatMessage(jo.newChatTitle),{resolvedTitle:z,isTypingEffect:P}=Fd(s,S,!0);if(!c||T)return null;const w=z==null&&(Zt(s)||M===fc.NewChat),y=j?e.jsx(e.Fragment,{}):e.jsxs(Za,{$isScreenArch:C,$shimmer:w,children:[e.jsxs("div",{className:"truncate",children:[P?e.jsx(Hd,{text:z??""}):z??k,d&&e.jsx("span",{className:"relative bottom-[1px] mx-1 inline-block rounded-md bg-token-main-surface-secondary px-1 text-xs leading-4 text-token-text-secondary",children:n})]}),e.jsx(Qo,{className:"icon-md text-token-text-tertiary"})]}),I=c.gizmo.display.name;return e.jsxs("div",{className:"flex items-center gap-0 overflow-hidden whitespace-nowrap px-2 py-1.5",children:[e.jsx(Za,{$isScreenArch:C,children:e.jsx(xn,{className:"truncate",to:za(c),children:I})}),e.jsxs(e.Fragment,{children:[e.jsx(xc,{className:"icon-md text-token-text-tertiary"}),e.jsxs(_s,{contentAlign:o?"center":"start",size:"small",onOpenChange:A=>{A&&F.logEvent(B.projectsBreadcrumbPickerOpen)},triggerButton:y,contentClassName:"max-h-[50dvh] overflow-y-scroll",children:[d&&e.jsxs(X.Sub,{onOpenChange:A=>{A&&F.logEvent(B.projectsBreadcrumbPickerModelPickerOpen)},children:[e.jsx(X.SubMenuTrigger,{children:e.jsxs("div",{className:"flex w-full items-center justify-between gap-1",children:[e.jsx(E,{id:"ilkdMh",defaultMessage:"Model"}),e.jsx("span",{className:"text-xs font-medium text-token-text-secondary",children:n})]})}),e.jsx(X.Portal,{children:e.jsx(X.SubContent,{onClick:()=>{F.logEvent(B.projectsBreadcrumbPickerModelPickerSelect)},children:a})})]}),e.jsx(xn,{to:za(c),children:e.jsx(X.Item,{onSelect:()=>{F.logEvent(B.projectsBreadcrumbPickerPickNewChat)},icon:Bd,children:e.jsx(E,{...jo.newChatProjectDropdownItem,values:{name:`"${c.gizmo.display.name}"`}})},"new-chat")}),p.filter(A=>A.id!==s).map((A,O)=>{const _=h&&O===p.length-4?v:void 0;return e.jsx(ag,{elementRef:_,conversation:A,gizmoResource:c},A.id)}),g&&e.jsx("div",{className:"m-4 mb-5 flex justify-center",children:e.jsx(Po,{})})]})]})]})}const ig=Ue(()=>Ve(()=>import("./odz0wn7xlaiouzpz.js"),__vite__mapDeps([0,1,2,3,4,5,6])).then(t=>t.ThreadHeaderGizmoDropdown)),lg=Ue(()=>Ve(()=>import("./iuor4bcxoiridr5j.js"),__vite__mapDeps([7,2,4,1,3,5,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26])).then(t=>t.ConversationHeaderMenuItems));function cg({clientThreadId:t}){const s=oe(),o=At(),n=ie(t,Z.getIsNewConversation),a=Tn(),[,r]=Wr(),l=()=>{!n&&!o?a({pathname:"/",search:new URLSearchParams({[tn]:"true"}).toString()}):r(d=>(d.get(tn)==="true"?d.delete(tn):d.set(tn,"true"),d),{replace:n,state:Yd()})};return e.jsx(X.Item,{size:"large",className:"!pr-3",onClick:l,icon:zd,children:e.jsxs("div",{className:"flex grow items-center justify-between gap-2",children:[e.jsx("div",{className:"flex flex-1 items-center gap-3",children:e.jsx(E,{...ma.temporaryChat})}),e.jsx(Gd,{enabled:o,label:s.formatMessage({defaultMessage:"Temporary",id:"temporaryChatToggleLabel"}),testId:"temporary-chat-toggle"})]})})}function dg(t){return t.title?t.title:t.shortLabel}function ca(t,s){let o=t;if(t===Ia.AUTO){const r=s?.categories.filter(({defaultModel:l})=>l!==Ia.AUTO);r?.length===1&&(o=r[0].defaultModel)}const n=s?.categories.find(({defaultModel:r})=>r===o);if(n){const{categoryId:r}=n,l=dg(n);return{selectedCategory:r,modelLabel:l,omitPrefix:!!n.title}}const a=s?.groups.find(({modelIds:r})=>r.includes(o));if(a){const{group:r,shortLabel:l}=a;return{selectedCategory:r,modelLabel:l}}return{selectedCategory:null,modelLabel:null}}function ug({modelLabel:t}){return e.jsx("span",{className:"overflow-x-clip text-ellipsis text-token-text-secondary",children:t})}function mg({clientThreadId:t,inMobileHeader:s}){const{isLoading:o,data:n}=Nt(),a=vc(),l=En(t).id,d=Jo();Ze.markStart("ThreadModelSelector");const{modelLabel:c,omitPrefix:p}=ca(l,n),h=da(t,d),u=oe(),{isUnauthenticated:m}=ut(),g=!m&&!a;c&&Ze.markRendered("ThreadModelSelector");const f=ct(),v=e.jsxs("div",{className:N(f?"overflow-x-hidden text-ellipsis":"text-token-text-secondary"),children:[p?null:`${Wd} `,g?e.jsx("span",{className:"text-token-text-secondary",children:c}):m&&c?e.jsx(ug,{modelLabel:c}):null]});return h.length?o?null:e.jsx(_s,{sideOffset:8,size:"large",triggerButton:e.jsxs(Ga,{$isScreenArch:f,style:{viewTransitionName:"var(--vt-thread-model-switcher)"},"aria-label":c?u.formatMessage({id:"JrtGPQ",defaultMessage:"Model selector, current model is {modelLabel}"},{modelLabel:c}):"",children:[v,f?e.jsx(qd,{className:"icon-md text-token-text-tertiary"}):e.jsx(Qo,{className:"icon-md text-token-text-tertiary"})]}),onOpenChange:j=>{F.logEvent(B.toggleModelSwitcher,{isOpen:j}),we.logEvent("toggle_model_switcher",null,{isOpen:String(j)})},contentAlign:s?"center":"start",testId:"model-switcher-dropdown",children:e.jsx(ua,{sections:h})}):e.jsx(Ga,{className:"cursor-default",children:v})}function hg({category:t,modelSwitcherDenialsBySlug:s,currentGizmoId:o,currentModelId:n,testId:a}){const{defaultModel:r,label:l,description:d,isBeta:c,isAlpha:p,modelBadge:h}=t,u=Vd(o??"");return e.jsx(Co,{value:r,currentModelId:n,modelSwitcherDenialsBySlug:s,renderName:m=>e.jsx(_o,{name:l,description:d,isDisabled:m,isBeta:c,isAlpha:p,modelBadge:h}),isSelected:(!o||u)&&n===r,testId:a},r)}function da(t,s,o=!1){const n=En(t),a=n.id,r=dt(t),{data:l}=Nt(),{data:d}=Io(),c=cs(r),p=d&&Er(d),h=zt(t),u=Od({clientThreadId:t}),m=oe(),g=!h,{isUnauthenticated:f}=ut(),v=Vr(),j=s.find(({categoryId:D})=>D===Mt.ALPHA),S=s.find(({categoryId:D})=>D===Mt.DATA_CAMPAIGNS),M=s.find(({categoryId:D})=>D===Mt.EXPERIMENTS),C=s.find(({categoryId:D})=>D===Mt.MAINLINE),T=!!j?.options.length,k=!!S?.options.length,z=!!M?.options.length,P=!!C?.options.length,w=Tn(),y=i.useCallback(()=>{F.logEvent(B.accountPayOpenPaymentFromModelPicker,{content:"gizmo-button"}),Yr(w,"Thread header dropdown")},[w]),I=()=>{we.logEvent("chatgpt_model_switcher_plus_upgrade_button_clicked"),F.logEvent(B.modelSwitcherPlusUpgradeButtonClicked),f?v({shouldOpenPaymentModalOnAuth:!0,callback:D=>{F.logSignUpButtonClicked({location:"Model switcher GPT-4 upsell",provider:D})}}):y()},A=[],[O,_]=i.useState(!1),x=e.jsxs(e.Fragment,{children:[o&&e.jsx(Rr,{setIsScrolledToEdge:_}),e.jsxs("div",{className:N("mb-1 flex items-center justify-between px-5 pt-2",{"sticky top-0 z-10 bg-token-main-surface-primary py-2":o},{"[box-shadow:--sharp-edge-top-shadow]":o&&O},{"[box-shadow:--sharp-edge-top-shadow-placeholder]":o&&!O}),children:[e.jsx("span",{className:"text-sm text-token-text-tertiary",children:e.jsx(E,{id:"ilkdMh",defaultMessage:"Model"})}),e.jsx("a",{href:"https://help.openai.com/en/articles/7864572-what-is-the-chatgpt-model-selector",target:"_blank",rel:"noreferrer",children:e.jsx(si,{className:"icon-md h-5 w-5 pl-0.5 text-token-text-tertiary"})})]},"header")]});if(f){const D={id:"modelSection",content:[]};D.content.push(e.jsx(An,{location:"model-switcher",statsig_login_event:"chatgpt_modelswitcher_login_button_clicked",statsig_signup_event:"chatgpt_modelswitcher_signup_button_clicked"},"noAuthUpsell")),A.push(D)}else if(!p&&!r){const D={id:"modelSection",content:[]};D.content.push(e.jsx(Co,{value:"",currentModelId:a,onClick:I,modelSwitcherDenialsBySlug:u,isUpgradeUpsell:!0,renderName:R=>e.jsx(_o,{icon:$d,isDisabled:R,name:m.formatMessage({id:"mzDzkX",defaultMessage:"ChatGPT Plus"}),description:m.formatMessage({id:"bqTHri",defaultMessage:"Our smartest model & more"})}),isSelected:!1,showNewChatHint:!1},"plusUpgrade")),D.content.push(e.jsx(Co,{value:uo.AUTO,currentModelId:a,modelSwitcherDenialsBySlug:u,renderName:R=>e.jsx(_o,{icon:Ud,name:m.formatMessage({id:"U9E7Rx",defaultMessage:"ChatGPT"}),description:m.formatMessage({id:"n96qML",defaultMessage:"Great for everyday tasks"}),isDisabled:R}),isSelected:!r&&a===uo.AUTO,showNewChatHint:!0},uo.AUTO)),A.push(D)}else{const D={id:"modelSection",content:[]};l?.categories.length&&D.content.push(x);const R=new Map;l?.categories.forEach(q=>{const G=e.jsx(hg,{category:q,currentGizmoId:r,currentModelId:a,modelSwitcherDenialsBySlug:u,testId:`model-switcher-${q.defaultModel}`},q.categoryId);q.subcategory?(R.has(q.subcategory)||R.set(q.subcategory,[]),R.get(q.subcategory)?.push(G)):D.content.push(G)}),R.forEach((q,G)=>{const W=l?.categories.find(de=>de.subcategory===G&&de.defaultModel===n.id);D.content.push(e.jsxs(X.Sub,{children:[e.jsx(X.SubMenuTrigger,{"data-testid":G==="More models"?"more-models-submenu":void 0,children:e.jsxs("div",{className:"flex grow justify-between gap-2 overflow-hidden",children:[G,!!W&&e.jsx("div",{className:"truncate text-token-text-tertiary",children:W.label})]})}),e.jsx(X.Portal,{children:e.jsx(X.SubContent,{className:"min-w-72",children:q})})]},G))}),A.push(D)}const K={id:"otherOptionsSection",content:[]},{selectedCategory:$}=ca(a,l);return g&&(T&&K.content.push(e.jsx(en,{isSelected:$===Mt.ALPHA,currentModel:n,option:j,modelSwitcherDenialsBySlug:u,displayInFull_INTERNAL_USE_ONLY:!0},j.value)),k&&K.content.push(e.jsx(en,{isSelected:$===Mt.DATA_CAMPAIGNS,currentModel:n,option:S,modelSwitcherDenialsBySlug:u,displayInFull_INTERNAL_USE_ONLY:!0},S.value)),z&&K.content.push(e.jsx(en,{currentModel:n,isSelected:$===Mt.EXPERIMENTS,option:M,modelSwitcherDenialsBySlug:u,displayInFull_INTERNAL_USE_ONLY:!0},M.value)),P&&K.content.push(e.jsx(en,{isSelected:$===Mt.MAINLINE,currentModel:n,option:C,modelSwitcherDenialsBySlug:u,displayInFull_INTERNAL_USE_ONLY:!0},C.value))),K.content.length&&A.push(K),!f&&!r&&!c&&A.push({id:"temporaryChatSection",content:[e.jsx(cg,{clientThreadId:t},"tempChat")]}),A}function pg(){const t=oe();return e.jsx("div",{className:"border-token-text-quartenary items-center rounded-full border px-1 py-0.5 text-[8px] font-semibold uppercase leading-3 text-token-text-secondary dark:border-token-border-heavy dark:text-token-text-tertiary",children:t.formatMessage(ma.beta)})}function gg(){const t=oe();return e.jsx("div",{className:"border-token-text-quartenary items-center rounded-full border px-1 py-0.5 text-[8px] font-semibold uppercase leading-3 text-token-text-secondary dark:border-token-border-heavy dark:text-token-text-tertiary",children:t.formatMessage(ma.alpha)})}function fg({badge:t}){return e.jsx("div",{className:"border-token-text-quartenary items-center rounded-full border px-1 py-0.5 text-[8px] font-semibold uppercase leading-3 text-token-text-secondary dark:border-token-border-heavy dark:text-token-text-tertiary",children:t})}function _o({isDisabled:t,name:s,icon:o,description:n,extra:a,isBeta:r=!1,isAlpha:l=!1,modelBadge:d=null}){let c=s;return r&&(c=e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:s}),e.jsx(pg,{})]})),l&&(c=e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:s}),e.jsx(gg,{})]})),d&&(c=e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:s}),e.jsx(fg,{badge:d})]})),e.jsxs("div",{className:"flex items-center gap-3",children:[o&&e.jsx("span",{className:"flex h-7 w-7 flex-shrink-0 items-center justify-center rounded-full bg-token-main-surface-secondary",children:e.jsx(o,{className:"h-4 w-4 text-token-text-primary"})}),e.jsxs("div",{children:[c,e.jsxs("div",{className:N(!t&&"text-token-text-secondary","text-xs"),children:[n,a]})]})]})}function ua({sections:t}){return e.jsx(e.Fragment,{children:t.map((s,o)=>e.jsxs(Wo.Fragment,{children:[o!==0?e.jsx(X.Separator,{}):null,s.content]},s.id))})}function xg({clientThreadId:t,inMobileHeader:s=!1}){const o=dt(t),n=Es(o),a=Ko(o),{showEmptyState:r}=Ki(t),{data:l}=Gt(o),{data:d}=Nt(),p=En(t).id,{modelLabel:h}=ca(p,d),u=Jo(),m=da(t,u,a),g=e.jsx(mg,{clientThreadId:t,inMobileHeader:s});return o==null?a?e.jsx(lg,{clientThreadId:t}):g:n?r&&l&&!a?g:e.jsx(rg,{modelLabel:h??"",modelPickerContent:e.jsx(ua,{sections:m}),gizmoId:o,clientThreadId:t,inMobileHeader:s}):e.jsx(ig,{clientThreadId:t,gizmoId:o,inMobileHeader:s})}const ma=He({alpha:{id:"o5FsPB",defaultMessage:"Alpha"},beta:{id:"XZwFET",defaultMessage:"Beta"},gpt35ShortExplainer:{defaultMessage:"Great for everyday tasks",id:"ModelSwitcher.gpt35ShortExplainer"},modelTunerSmartSelectionTitle:{id:"czjW8I",defaultMessage:"Dynamic"},modelTunerSmartSelectionExplainer:{id:"gp/YH1",defaultMessage:"Optimized for speed and intelligence"},gpt4ShortExplainer:{defaultMessage:"With DALL·E, browsing and analysis",id:"ModelSwitcher.gpt4ShortExplainer"},gpt4ShortExplainerWithoutBrowse:{defaultMessage:"With DALL·E and analysis",id:"ModelSwitcher.gpt4ShortExplainerWithoutBrowse"},gpt4UpsellExplainer:{id:"ModelSwitcher.gpt4Upsell",defaultMessage:"Our smartest and most capable model. Includes DALL·E, browsing and more."},userUpgrade:{id:"ModelSwithcer.upgradeButton",defaultMessage:"Upgrade to Plus"},userUpgradeSignup:{id:"ModelSwitcher.signupUpgradeButton",defaultMessage:"Sign up for ChatGPT Plus"},temporaryChat:{id:"ModelSwitcher.temporaryChat",defaultMessage:"Temporary chat"},shareChat:{id:"ModelSwitcher.shareChat",defaultMessage:"Share chat"}}),vg=Ue(()=>Ve(()=>import("./ebe0yuqj113ljvzn.js"),__vite__mapDeps([27,2,1,3,28,29,4,5,30,31,32,33,34,21,10,19,22,35,16,36,37,9,38,39,40,41,17,6,42,15,18,43])).then(t=>t.GizmoUsingAsOwnerNotice)),Sg=({clientThreadId:t})=>{const s=Xo(m=>m.activeStageSidebar),o=zt(t),n=Kd(un.WorkspaceShareLinks),{isUnauthenticated:a}=ut(),r=At(),l=dt(t),d=Es(l),c=Qd(),p=n&&o&&!a&&!r&&!d&&!c,h=ct(),u=!s&&!(!a&&h);return e.jsx("div",{className:N(!h&&"gap-2",h&&"@lg/screen-composer:gap-1","flex items-center pr-1 leading-[0]"),children:e.jsx(Bp,{showShareButton:p,showProfileDropdown:u,clientThreadId:t})})};function bg({clientThreadId:t,gizmoId:s}){const o=Jd(),{data:n}=Gt(s),a=ls();return e.jsxs(e.Fragment,{children:[e.jsxs(Xd,{className:"max-md:hidden",children:[e.jsxs("div",{className:"absolute start-1/2 ltr:-translate-x-1/2 rtl:translate-x-1/2",children:[n!=null&&a?.isWorkspaceAccount()&&n.gizmo.tags?.includes(Rs.WorkspaceDisabled)&&e.jsx(vg,{gizmo:n}),e.jsx(Zd,{gizmoId:s,clientThreadId:t})]}),e.jsxs("div",{className:"flex items-center gap-0 overflow-hidden",children:[e.jsx(Dp,{clientThreadId:t}),e.jsx(xg,{clientThreadId:t})]}),e.jsx(Sg,{clientThreadId:t})]}),o&&e.jsx(eu,{})]})}function Qi({clientThreadId:t}){const s=dt(t),o=Fo(),n=ct();return o||n?null:e.jsx(bg,{gizmoId:s,clientThreadId:t})}const er=Oe.div`m-8 flex flex-col items-center`;function tr(t){return e.jsx(ee.div,{initial:{opacity:0,translateY:20},animate:{opacity:1,translateY:0,transition:{duration:.5,ease:"easeIn"}},...t})}function yg({clientThreadId:t}){const o=ie(t,a=>a?.promptGptRating)?.gizmoId,{data:n}=Gt(o);return o==null||n==null||!tu(n)?null:e.jsx(jg,{gizmoId:o})}function jg({gizmoId:t}){const[s,o]=i.useState(!1),[n,a]=i.useState(!1),r=su(t),l=async c=>{o(!0),setTimeout(()=>{a(!0)},5e3),F.logEvent(B.submitInlineRating,{gizmo_id:t,rating:c}),await r.mutateAsync({rating:c})},d=async()=>{a(!0),F.logEvent(B.dismissInlineRating,{gizmo_id:t}),await r.mutateAsync({})};return i.useEffect(()=>{n||F.logEvent(B.showInlineRating,{gizmo_id:t})},[n,t]),n?null:s?e.jsx(er,{children:e.jsxs(tr,{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"rounded-lg border border-token-border-heavy p-4",children:e.jsxs("div",{className:"flex justify-between gap-2",children:[e.jsx(E,{id:"gizmo.inlineReview.reviewLeft",defaultMessage:"Feedback sent"}),e.jsx(Fa,{onClick:()=>{a(!0)}})]})}),e.jsx("div",{className:"text-xs text-token-text-tertiary",children:e.jsx(E,{id:"gizmo.inlineReview.reviewLeftSubtext",defaultMessage:'To update your rating, click "Send Feedback" in the GPT Menu'})})]})}):e.jsx(er,{children:e.jsxs(tr,{className:"flex flex-col items-center gap-4 rounded-lg border border-token-border-heavy p-4",children:[e.jsxs("div",{className:"flex justify-between gap-2",children:[e.jsx(E,{id:"gizmo.inlineReview.prompt",defaultMessage:"How would you rate this GPT so far?"}),e.jsx(Fa,{onClick:d})]}),e.jsx(nu,{rating:void 0,onRating:l})]})})}const Ji=Oe.div`group flex h-10 items-center gap-2 rounded-lg px-2 hover:bg-token-main-surface-secondary text-sm text-token-text-primary`;function Cg(){const{data:t,isLoading:s}=iu({cutId:"recent",limit:8}),{data:o,isLoading:n}=lu();return{isLoading:s||n,recent:t,pinned:o}}function wg({query:t,onSelectGizmo:s,selectedIdx:o},n){const a=Sc(),r=i.useRef([]),{isLoading:l,recent:d,pinned:c}=Cg();i.useImperativeHandle(n,()=>({handleEnterOnIndex:u=>{if(!h[u])return u<p.length?p[u].resource:"create"},getResultsLength:()=>p.length+1,scrollToItem:u=>{const m=r.current[u];m&&m.scrollIntoView({behavior:"instant",block:"nearest"})}}));let p=[];if(l)return e.jsx("div",{className:"absolute right-4 top-0 flex h-full items-center justify-center",children:e.jsx(Po,{})});d&&p.push(...d.pages.flatMap(u=>u.list.items).map(u=>({resource:u.resource,from:"recent"}))),c&&p.push(...c.items.map(u=>({resource:u,from:"pinned"}))),p=ou(p,u=>u.resource.gizmo.id);const h=p.map(u=>u.resource.gizmo.tags?.includes(Rs.WorkspaceDisabled));return t&&t!==""&&(p=p.filter(u=>(u.resource.gizmo.display.name.toLowerCase()+u.resource.gizmo.display.description?.toLowerCase()+u.resource.gizmo.author.display_name?.toLowerCase()).includes(t?.toLowerCase()))),e.jsxs("div",{className:"max-h-40 overflow-y-auto",children:[p.map((u,m)=>e.jsx("div",{ref:g=>{r.current[m]=g},tabIndex:m,onClick:()=>{h[m]||s(u.resource)},children:e.jsx(Ag,{gizmoResource:u.resource,from:u.from,showDescription:a,isSelected:o===m,grayedOut:h[m]})},u.resource.gizmo.id)),e.jsx("div",{ref:u=>{r.current[p.length]=u},tabIndex:p.length,onClick:()=>{s("create")},children:e.jsx(kg,{isSelected:o===p.length})},"create")]})}const Mg=i.forwardRef(wg),kg=({isSelected:t})=>e.jsx(Ji,{className:t?"bg-token-main-surface-secondary":"",children:e.jsxs(xn,{to:"/gpts/editor",target:"_blank",className:"flex flex-row space-x-2 font-semibold",children:[e.jsx("span",{className:"self-center",children:e.jsx(Zo,{className:"icon-sm"})}),e.jsx("span",{children:e.jsx(E,{...Xi.dropdownCreateLabel})})]})}),Tg=({onClick:t,onClose:s})=>{const[o,n]=i.useState(null),a=i.useRef(null),r=i.useRef(null),[l,d]=i.useState(0),c=oe(),p=h=>{F.logEvent(B.mentionsClickGizmo,{gizmo_id:h==="create"?"create":h.gizmo.id}),h!=="create"&&t(h)};return e.jsxs(e.Fragment,{children:[e.jsx("input",{autoFocus:!0,placeholder:c.formatMessage(Xi.searchPlaceholder),ref:a,onKeyDown:h=>{if(h.nativeEvent.isComposing)return;const u=r.current?.getResultsLength()??0;if((h.key==="Escape"||h.key==="Backspace"&&!o)&&(h.preventDefault(),s()),h.key==="Enter"||h.key==="Tab"){h.preventDefault();const m=r.current?.handleEnterOnIndex(l);if(!m)return;m==="create"?(window.open("/gpts/editor","_blank"),s()):p(m)}if(h.key==="ArrowDown"&&l<u-1){h.preventDefault();const m=l+1;r.current?.scrollToItem(m),d(m)}if(h.key==="ArrowUp"&&l>0){h.preventDefault();const m=l-1;r.current?.scrollToItem(m),d(m)}},onChange:h=>{n(h.target.value),d(0)},className:"w-full border-0 bg-token-main-surface-primary p-2 text-sm focus:outline-none"}),e.jsx(Mg,{ref:r,query:o,selectedIdx:l,onSelectGizmo:p})]})},_g=({onClick:t,onClose:s})=>{const o=Pr(),n=!!o;return cu(()=>{F.logEvent(B.mentionsOpened,{gizmo_selector_disabled:n})}),n?e.jsx(ni,{clientThreadId:vo,rateLimitInfo:o}):e.jsx("div",{onBlur:a=>{a.currentTarget.contains(a.relatedTarget)||s()},className:"popover rounded-2xl border border-token-border-light bg-token-main-surface-primary p-2 shadow-lg",children:e.jsx(Tg,{onClick:t,onClose:s})})};function Ag({gizmoResource:t,from:s,showDescription:o,isSelected:n,grayedOut:a}){const r=!!t.gizmo.tags?.includes(Rs.FirstParty);return e.jsxs(Ji,{className:N(n?"bg-token-main-surface-secondary":"",a&&"opacity-50"),children:[e.jsx(la,{isFirstParty:r,src:t.gizmo.display.profile_picture_url,className:N("icon-xl h-7 w-7 flex-shrink-0",a&&"grayscale group-hover:grayscale-0")}),e.jsxs("div",{className:"flex h-fit grow flex-row justify-between space-x-2 overflow-hidden text-ellipsis whitespace-nowrap",children:[e.jsxs("div",{className:"flex flex-row space-x-2",children:[e.jsx("span",{className:"shrink-0 truncate font-semibold",children:t.gizmo.display.name}),o&&e.jsx("span",{className:"flex-grow truncate text-sm text-token-text-tertiary sm:max-w-xs lg:max-w-md",children:t.gizmo.display.description})]}),e.jsx("span",{className:"shrink-0 self-center",children:s==="recent"?e.jsx(au,{className:"icon-sm"}):e.jsx(ru,{className:"icon-sm"})})]})]})}const Xi=He({talkingTo:{id:"TaggingDropdown.talkingTo",defaultMessage:"Talking to"},dropdownCreateLabel:{id:"TaggingDropdown.dropdownCreateLabel",defaultMessage:"Create a GPT"},searchPlaceholder:{id:"TaggingDropdown.searchPlaceholder",defaultMessage:"Search recent and pinned GPTs"}}),Ng={p:t=>{const{node:s,children:o,...n}=t;return e.jsx("p",{...n,className:"text-start !text-sm !leading-6 text-white",children:o})},a:t=>{const{node:s,children:o,...n}=t;return e.jsx("a",{...n,className:"!text-sm !leading-6 !text-white !underline",children:o})}};function Eg(t){const s=ea(),o=ot(t);return!o.isLoading&&o.eligible&&!s}function Zi(t,s){const o=du(),n=uu(),a=Ui(s);return Eg(t)&&!o&&!a&&!n}function el(t,s){const o=ot(t.announcementKey);return e.jsx(_n,{announcementKey:t.announcementKey,side:"top",show:!0,theme:"bright",dismissOnOutsideClick:!0,badge:"new",title:t.nuxTitle,onDismiss:o.markAsViewed,sideOffset:0,className:"!max-w-2xs xs:!max-w-sm",description:e.jsx(oi,{componentOverrides:Ng,children:t.nuxDescription}),children:e.jsx("div",{children:s})})}function tl(t){const s=ra(),o=t.useState(a=>a.getSystemHints()[0]);return s.size?s.values().next().value:o}function sl(t,s){const{clearAllSystemHintModeTriggers:o,setThreadSystemHintMode:n}=In(),{value:a}=Fe("1325692000");return i.useCallback(({hint:r,enable:l})=>{o();const d=!!r.composerBarButtonInfo;l?d||a?(n(r.systemHint,!0,{clientThreadId:s}),t.removeSystemHints()):(t.addSystemHint(r.systemHint,r.name),setTimeout(()=>{t.focus()},0)):t.removeSystemHints()},[o,t,n,s,a])}const Rg={[J.Research]:bc.DEEP_RESEARCH};function Pg(t){return Rg[t]??null}function Ig(t,s){return new Date(t).toLocaleDateString(s,{month:"long",day:"numeric"})}const nl=new Map([[J.Think,{hover:[B.composerThinkButtonHovered,"composer_think_button_hovered"],enable:[B.composerThinkButtonEnabled,"composer_think_button_enabled"],disable:[B.composerThinkButtonDisabled,"composer_think_button_disabled"]}],[J.Research,{hover:[B.composerResearchButtonHovered,"composer_research_button_hovered"],enable:[B.composerResearchButtonEnabled,"composer_research_button_enabled"],disable:[B.composerResearchButtonDisabled,"composer_research_button_disabled"]}]]);function ol({systemHint:t,logo:s,isPinnedActive:o=!1,isDisabled:n=!1,composerController:a,analyticsMetadata:r,onClick:l,showLabel:d=!1}){const{name:c,systemHint:p}=t,h=p,{setThreadSystemHintMode:u,clearAllSystemHintModeTriggers:m}=In(),g=Ui(h),f=!!t.composerBarButtonInfo?.upsell,v=Mp.useStore(),[j,S]=i.useState(!1),{value:M}=Fe("2454940646"),C=fd(),T=n||o,k=Ps(),z=[J.Search,J.Think].includes(h);i.useEffect(()=>{n&&k.has(h)&&u(h,!1,r)},[n,h,r,u,k,z]);const P=!n&&g,w=e.jsxs("button",{className:N("flex h-9 min-w-8 items-center justify-center rounded-full border p-2 text-[13px] font-medium radix-state-open:bg-black/10",{"duration-75 motion-safe:transition-all":j,"text-token-text-secondary":!g&&!o,"border-transparent bg-[#DAEEFF] text-blue-1000 can-hover:hover:bg-[#BDDCF4] dark:bg-[#2A4A6D] dark:text-[#48AAFF] dark:can-hover:hover:bg-[#1A416A]":!!P||o,"border-token-border-light focus-visible:outline-black can-hover:hover:bg-token-main-surface-secondary dark:focus-visible:outline-white dark:can-hover:hover:bg-gray-700":!o&&!P,"opacity-30":n&&!o,"opacity-50":o}),"aria-pressed":g,"aria-label":c,disabled:T,onTransitionEnd:()=>S(!1),onClick:y=>{if(y.stopPropagation(),y.preventDefault(),f&&h!==J.Search)return;S(!0);let I=!0;M&&z&&(v.getState().persistedSystemHints.has(J.Search)||v.getState().persistedSystemHints.has(J.Think))&&(I=!1),I&&m(),u(h,!g,r),g||(a.removeSystemHints(),a.focus());const{enable:A,disable:O}=nl.get(h)??{},[_,x]=(g?O:A)??[];_&&x&&F.logEventWithStatsig(_,x,r),l?.(y)},children:[s,d&&e.jsx("div",{className:"whitespace-nowrap pl-1 pr-1 [display:--force-hide-label]",children:c}),e.jsx(nt,{children:!d&&g&&e.jsx(ee.span,{initial:{x:-10,width:0,opacity:0},animate:{x:0,width:"fit-content",opacity:1},exit:{x:-10,width:0,opacity:0},transition:{ease:"easeOut",duration:C?0:.15},children:e.jsx("div",{className:"whitespace-nowrap pl-1 pr-2 [display:--force-hide-label]",children:c})})})]});return f?e.jsx(wn,{children:e.jsx(_s,{triggerButton:w,sideOffset:0,alignOffset:0,children:e.jsx(An,{location:h,statsig_login_event:"chatgpt_composer_upsell_login_button_clicked",statsig_signup_event:"chatgpt_composer_upsell_signup_button_clicked"})})}):w}function Fg({composerController:t,systemHint:s,composerBarButtonInfo:o,isDisabled:n,clientThreadId:a,showLabel:r,isPinnedActive:l,currentModelName:d,disabledReason:c,rateLimitProgress:p}){const h={clientThreadId:a};return e.jsx(Bg,{composerBarButtonInfo:o,isDisabled:n,isPinnedActive:l,analyticsMetadata:h,systemHint:s.systemHint,currentModelName:d,disabledReason:c,rateLimitProgress:p,children:e.jsx(ol,{isDisabled:n,isPinnedActive:l,systemHint:s,logo:e.jsx(Rn,{svgString:s.logo,className:"h-[18px] w-[18px]"}),composerController:t,analyticsMetadata:h,showLabel:r})})}function Bg({children:t,isDisabled:s,isPinnedActive:o,systemHint:n,composerBarButtonInfo:a,analyticsMetadata:r,currentModelName:l,disabledReason:d,rateLimitProgress:c}){const p=Zi(a.announcementKey,n),h=el(a,t),u=oe();let m;return c&&c.remaining&&c.remaining<=5?m=e.jsx(Dg,{remaining:c.remaining,reset_date:c.reset_after,text:a.tooltipText}):m=e.jsx(al,{text:a.tooltipText}),p?h:e.jsx("div",{children:e.jsx(Ut,{sideOffset:0,label:s?d===ss.HasAttachedFiles?u.formatMessage({id:"z7E1Px",defaultMessage:"Reason disabled for attachments"}):d===ss.DeepResearchHighLoad?u.formatMessage({id:"UrDtrS",defaultMessage:"Deep research is temporarily unavailable"}):d===ss.RateLimitReached?a.rateLimitReachedText:a.disabledText:o?u.formatMessage({id:"gFCsls",defaultMessage:"You've selected a thinking model {modelName}"},{modelName:`(${l})`}):m,side:"bottom",onOpenChange:g=>{if(g){const{hover:f}=nl.get(n)??{},[v,j]=f??[];v&&j&&F.logEventWithStatsig(v,j,r)}},children:t})})}function sr({logo:t,onClick:s,showLabel:o,label:n,showRemoveIcon:a=!1}){return e.jsxs("button",{type:"button",className:"flex h-9 items-center gap-2 overflow-hidden rounded-full border border-transparent bg-[#DAEEFF] px-2 text-blue-1000 focus-visible:outline-black can-hover:hover:bg-[#BDDCF4] dark:bg-[#2A4A6D] dark:text-[#48AAFF] dark:focus-visible:outline-white dark:can-hover:hover:bg-[#1A416A]","aria-label":o?void 0:n,onClick:s,children:[e.jsxs("div",{className:"flex h-full items-center justify-center text-[13px] font-semibold",children:[t,o&&e.jsx("div",{className:"pl-1 [display:--force-hide-label]",children:n})]}),a&&e.jsx("div",{className:"flex h-full items-center justify-center",children:e.jsx(mu,{className:"h-[16px] w-[16px] text-blue-1000 dark:text-[#48AAFF]"})})]})}const al=({text:t})=>e.jsx("span",{children:t}),Dg=({remaining:t,reset_date:s,text:o})=>{const{locale:n}=oe(),a=Ig(s,n);return e.jsxs("div",{className:"text-left",children:[e.jsx("span",{className:"block text-xs font-semibold text-token-text-tertiary",children:e.jsx(E,{id:"PromptTextarea.systemHintTooltip.remaining",defaultMessage:"{remaining} available until {resetDate}",values:{remaining:t,resetDate:a}})}),e.jsx(al,{text:o})]})},rn={initial:{opacity:0,y:20,scale:.9},animate:{opacity:1,y:0,scale:1},transition:{delay:.1},exit:{opacity:0,scale:.5,transition:{duration:.2}}},Lg=({suggestions:t,onSelectingSuggestedReply:s})=>e.jsx("div",{className:"absolute bottom-full flex w-full max-w-[100vw] grow gap-2 overflow-auto px-1 pb-1 contain-inline-size sm:mb-0 sm:justify-start sm:px-2 sm:pb-0 md:static md:mb-2 md:max-w-none md:justify-center md:overflow-visible",children:t.slice(0,2).map((o,n)=>e.jsx(ee.div,{initial:rn.initial,animate:rn.animate,transition:{delay:(n-1)*rn.transition.delay},exit:rn.exit,children:e.jsx(ft,{as:"button",color:"secondary",size:"small",onClick:()=>{s(o,t,n)},className:"group whitespace-nowrap md:whitespace-normal",children:e.jsx(Og,{suggestion:o})},n)},n))});function Hg({suggestions:t,onSelectingSuggestedReply:s,clientThreadId:o}){const n=t?.length>0;i.useEffect(()=>{n&&ns(t,o)},[n,o]);const{isUnauthenticated:a}=ut();return n?t.every(ai)?e.jsxs(ee.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:"flex flex-col items-center",children:[a&&e.jsx(Mn,{className:"mb-6 h-12 w-12 sm:hidden"}),e.jsx(Ep,{starterPrompts:t,onSelectStarterPrompt:s})]}):t.every(ri)?e.jsx(Lg,{suggestions:t,onSelectingSuggestedReply:s}):null:null}function Og({suggestion:t}){return ri(t)?e.jsx(e.Fragment,{children:t.text}):ai(t)?e.jsxs("div",{className:"flex flex-col overflow-hidden",children:[t.title&&e.jsx("div",{className:"truncate font-semibold",children:t.title}),e.jsx("div",{className:N("truncate font-normal",t.title?"opacity-50":""),children:t.body})]}):null}function Ug(){const{store:t}=ze(),s=t.useSharedProps();return s?e.jsx(zg,{...s}):null}function zg({clientThreadId:t,suggestions:s}){const o=Bn();return s===void 0||s.length===0?null:e.jsx("div",{children:e.jsx(Gg,{children:e.jsx("div",{className:"grow",children:s!==void 0&&e.jsx(Hg,{suggestions:s,onSelectingSuggestedReply:o,clientThreadId:t})})})})}const Gg=Oe.div`h-full flex ml-1 md:w-full md:m-auto gap-0 md:gap-2 justify-center`,rl=({className:t,children:s})=>e.jsx(ee.div,{className:t,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0,transition:{duration:.1,delay:0}},transition:{type:"tween",duration:.3,delay:.2},children:s});function Wg({canContinue:t,onContinueGenerating:s}){const o=i.useCallback(()=>{s(),ko()},[s]);let n=null;return t&&(n=e.jsx(Vg,{onHandleContinueGenerating:o})),n&&e.jsx("div",{className:"flex h-full w-full items-center justify-end gap-0 py-4 md:gap-2",children:n})}function qg({className:t}){return e.jsx(ii,{className:N("-rotate-180",t)})}const Vg=({onHandleContinueGenerating:t})=>e.jsx(rl,{children:e.jsx(ft,{as:"button",color:"secondary",onClick:t,className:"whitespace-nowrap py-2",icon:qg,size:"small",children:e.jsx(E,{...Ee.continueGenerating})})}),$g=({clientThreadId:t})=>{const s=Ir(),o=ie(t,Z.getRequestId),n=Ot(o);i.useEffect(()=>{n&&Ba.dismissBanner()},[n]);const a=s?.is_dismissible?()=>Ba.dismissBanner():void 0;return e.jsx(nt,{children:s&&e.jsx(ee.div,{transition:{type:"tween",ease:"easeInOut",duration:.1},initial:{opacity:0,transform:"translateY(8px)"},animate:{opacity:1,transform:"translateY(0px)"},exit:{opacity:0,transform:"translateY(8px)"},children:e.jsx(ni,{clientThreadId:t,rateLimitInfo:s,onDismiss:a})})})};function Yg(t){const s=ie(t,Z.getRequestId),o=Ot(s),n=Ir();return!o&&n!=null}const Ao=window.sessionStorage,No=yc(jc(()=>({memoryFullBannerDismissed:!!Ao?.getItem(es.MemoryFullBannerDismissed)}))),il={dismissBanner(){No.setState(t=>{t.memoryFullBannerDismissed=!0}),Ao?.setItem(es.MemoryFullBannerDismissed,"true")},clearDismissedBanner(){No.setState(t=>{t.memoryFullBannerDismissed=!1}),Ao?.removeItem(es.MemoryFullBannerDismissed)}};function Kg(t){const s=dt(t),o=li(),{data:n}=ci(s,!1,o),a=n!=null,r=a&&n.memoryFullPct>=100,[l,d]=i.useState(!1);i.useEffect(()=>{!r&&a&&(d(!0),il.clearDismissedBanner())},[r,a]);const c=No(p=>p.memoryFullBannerDismissed);return r&&l&&!c}function Qg(){const t=oe(),{openSettings:s}=hu();return e.jsx(ee.div,{initial:{opacity:0},animate:{opacity:1},children:e.jsx(ta,{title:t.formatMessage(ln.memoryFullTitle),content:t.formatMessage(ln.memoryFullTooltip,ln.memoryFullTooltip.values),primaryCtaText:t.formatMessage(ln.memoryManageButton),onPrimaryCtaClick:()=>s(pu.Personalization),onDismiss:()=>il.dismissBanner()})})}const ln=He({memoryFullTitle:{id:"yRGU2/",defaultMessage:"Memory is full."},memoryManageButton:{id:"a5A88o",defaultMessage:"Manage"},memoryFullTooltip:{id:"neUc+N",defaultMessage:"New memories won’t be created until you make space. <a>Learn more</a>",values:{a:t=>e.jsx("a",{href:gu,target:"_blank",rel:"noopener noreferrer",className:"underline",children:t})}}}),ha=Xe.hasSeenMemoryInSearch;function Jg(){const t=Tn();i.useEffect(()=>{F.logEventWithStatsig(B.chatgptMemoryInSearchAnnouncementShown,"chatgpt_memory_in_search_announcement_shown")},[]);const{markAsViewed:s}=ot(ha),o=i.useCallback(()=>{F.logEventWithStatsig(B.chatgptMemoryInSearchAnnouncementClosed,"chatgpt_memory_in_search_announcement_closed"),s()},[s]),n=i.useCallback(()=>{F.logEventWithStatsig(B.chatgptMemoryInSearchAnnouncementCTAClicked,"chatgpt_memory_in_search_announcement_cta_clicked"),t("#settings/Personalization"),s()},[s,t]);return e.jsx(ta,{onPrimaryCtaClick:n,primaryCtaText:e.jsx(E,{id:"8MwdJw",defaultMessage:"Settings"}),onDismiss:o,content:e.jsxs("div",{className:"flex-grow",children:[e.jsx("div",{className:"mb-0.5 font-semibold",children:e.jsx(E,{id:"Sdp8JT",defaultMessage:"Search, now with memory"})}),e.jsx("span",{className:"text-token-text-secondary",children:e.jsx(E,{id:"a4czFu",defaultMessage:"ChatGPT can now use memories to shape searches it sends to search providers, to give you more relevant answers. You can turn this off at any time in settings. {learnMoreLink}",values:{learnMoreLink:e.jsx("a",{href:"https://help.openai.com/en/articles/9237897-chatgpt-search",target:"_blank",rel:"noopener noreferrer",className:"underline",children:e.jsx(E,{id:"JMsjZT",defaultMessage:"Learn more"})},"learn-more-link")}})})]})})}function ll(){const t=ot(ha),{userIsInSearchHoldoutWithWebDisabled:s}=zi();return t.eligible&&!t.isLoading&&!s}function Xg(){const{markAsViewed:t,eligible:s}=ot(ha);return s?t:void 0}const Zg=()=>{const{shouldShowSkipButton:t}=di();return t?e.jsx(rl,{className:"flex justify-center",children:e.jsx(ft,{as:"button",color:"secondary",onClick:()=>fu.skipParagen(),children:e.jsx(E,{...ef.skip})})}):null},ef=He({skip:{id:"dvcUbp",defaultMessage:"Skip"}}),tf=Ue(()=>Ve(()=>import("./g6h6w1mnkfslacmc.js"),__vite__mapDeps([44,2,4,1,3,5,45,46,47])).then(t=>t.JawboneNotificationsBanner)),cl=i.memo(function({className:s}){const{store:o}=ze(),n=o.useIsHeaderContentAreaPopulated();return e.jsx("div",{className:N(s??"absolute bottom-full left-0 right-0",hi.PromptTextareaHeader),children:e.jsx(xu,{shouldRender:n,contentArea:is.Header,children:e.jsxs("div",{className:"mb-2 flex flex-col gap-3.5 pt-2",children:[e.jsx(dl,{}),e.jsx(ul,{})]})})})});function dl(){const{store:t}=ze(),s=t.useSharedProps(r=>r?.clientThreadId),o=t.useContentAreaId(is.HeaderTop),n=ui();let a;switch(o){case V.ProjectConversationTaskNoFileAccess:a=e.jsx(af,{});break;case V.AdvancedVoiceOnMobileAnnouncement:a=e.jsx(ku,{clientThreadId:s});break;case V.S09KM1:a=null;break;case V.ParagenControls:a=e.jsx(Zg,{});break;case V.ItemActions:a=e.jsx(Ug,{});break;case V.BannerSignup:a=e.jsx(of,{});break;case V.BannerTermsDisclaimer:a=e.jsx(rf,{});break;case V.PromptTextareaAction:a=e.jsx(lf,{});break;case V.BannersRateLimit:a=e.jsx(cf,{});break;case V.BannerSidekickAnnouncement:a=e.jsx(Mu,{});break;case V.SearchBrowserExtensionAnnouncement:a=e.jsx(Hp,{});break;case V.MemoryInSearchAnnouncement:a=e.jsx(Jg,{});break;case V.MoonshineAnnouncement:a=e.jsx(wu,{});break;case V.CustomizeChatGPTAnnouncement:a=e.jsx(Cu,{});break;case V.SearchBrowserExtensionReactiveAnnouncement:a=e.jsx(Lp,{});break;case V.BannerMemoryFull:a=e.jsx(Qg,{});break;case V.Box:a=e.jsxs("div",{className:"flex h-20 w-full items-center justify-center gap-2 bg-red-500 p-2",children:["box",e.jsxs("div",{className:"flex h-full w-full items-center justify-center gap-2 bg-blue-500 p-2",children:["inner",e.jsx("div",{className:"flex h-full w-full items-center justify-center bg-yellow-400 text-center",children:"actual content"})]})]});break;case V.JawboneAnnouncement:n?a=e.jsx(tf,{}):a=null;break;case V.JawboneMaxActiveAnnouncement:n?a=e.jsx(ju,{}):a=null;break;case V.PromoRedemptionAnnouncement:a=e.jsx(yu,{});break;case V.OperatorAnnouncement:a=e.jsx(bu,{});break;case V.BannerPlusUpsell:a=e.jsx(Su,{});break;case V.ClassmatesPromotionAnnouncement:a=e.jsx(vu,{});break;default:a=null;break}return a}function ul(){const{store:t}=ze(),s=t.useContentAreaId(is.HeaderBottom);let o;switch(s){case mi.DallePromptControls:o=e.jsx(nf,{});break;default:o=null;break}return o}const sf=Ue(()=>Ve(()=>import("./kk7z3x85399sx5vr.js"),__vite__mapDeps([48,2,1,3,4,5,10,49])).then(t=>t.default));function nf(){const{store:t}=ze(),s=t.useSharedProps(o=>o?.composerController);return s?e.jsx(sf,{composerController:s}):null}function of(){const{store:t}=ze(),s=t.useSharedProps(a=>a?.clientThreadId),o=$r(),n=Tu();return s?o?e.jsx(_u,{threadId:s,showSignUp:n}):e.jsx(Au,{threadId:s,showLogin:n}):null}function af(){return i.useEffect(()=>()=>{co.getItem(es.TasksHasSeenProjectDisclaimerBanner)||co.setItem(es.TasksHasSeenProjectDisclaimerBanner,!0)},[]),e.jsx(ta,{icon:e.jsx(si,{}),title:e.jsx(E,{id:"ibX3g7",defaultMessage:"Tasks can’t access project files"}),content:e.jsx(E,{id:"fm94Tm",defaultMessage:"There’s a task in this conversation — just FYI, it won’t be able to access project files."}),onDismiss:()=>{co.setItem(es.TasksHasSeenProjectDisclaimerBanner,!0)}})}function rf(){const{store:t}=ze(),s=t.useSharedProps(o=>o?.clientThreadId);return s?e.jsx(Nu,{threadId:s}):null}function lf(){const{store:t}=ze(),s=t.useSharedProps();return s?e.jsx(Wg,{...s}):null}function cf(){const{store:t}=ze(),s=t.useSharedProps(o=>o?.clientThreadId);return s?e.jsx($g,{clientThreadId:s}):null}const df=5,uf=i.memo(function(s){return mf(s),hf(s),pf(),null});function mf(t){const{store:s}=ze(),o=s.useSetSharedProps();So(()=>{o(t)},[t,o])}function hf(t){const{clientThreadId:s,canContinue:o}=t,{store:n}=ze(),a=i.useRef({top:n.useContentAreaApi(is.HeaderTop),bottom:n.useContentAreaApi(is.HeaderBottom)}).current,r=xf(t),l=Eu(s),{shouldShowBannerSignup:d,shouldShowBannerTermsDisclaimer:c}=vf(s),p=Yg(s),h=Ru(t),u=Op(t),m=ll(),g=ea(),f=Pu(),v=Up(t),j=Kg(s),S=Iu(),M=Fu(t),C=Bu(s),T=Du(s),k=Lu(),{eligible:z}=ot(Wu),P=Hu(),w=Ou(),y=ie(s,A=>A?.modelId),I=Ns(s);So(()=>{y&&I?.kind===Le.GizmoInteraction&&I.gizmo&&qu(y,I.gizmo)?a.top.set(V.ProjectConversationTaskNoFileAccess):M.eligible?a.top.set(V.AdvancedVoiceOnMobileAnnouncement):S?a.top.set(V.ParagenControls):c?a.top.set(V.BannerTermsDisclaimer):p?a.top.set(V.BannersRateLimit):w?a.top.set(V.BannerPlusUpsell):C?a.top.set(V.JawboneAnnouncement):T?a.top.set(V.JawboneMaxActiveAnnouncement):h.eligible?a.top.set(V.BannerSidekickAnnouncement):m?a.top.set(V.MemoryInSearchAnnouncement):g?a.top.set(V.MoonshineAnnouncement):f?a.top.set(V.CustomizeChatGPTAnnouncement):u?a.top.set(V.SearchBrowserExtensionAnnouncement):v?a.top.set(V.SearchBrowserExtensionReactiveAnnouncement):k?a.top.set(V.PromoRedemptionAnnouncement):z?a.top.set(V.OperatorAnnouncement):P?a.top.set(V.ClassmatesPromotionAnnouncement):r?a.top.set(V.ItemActions):o?a.top.set(V.PromptTextareaAction):d?a.top.set(V.BannerSignup):j?a.top.set(V.BannerMemoryFull):a.top.set(null)},[a,r,o,c,d,p,h,j,S,M]),So(()=>{l&&a.bottom.set(mi.DallePromptControls)},[a,l])}function pf(){const{store:t}=ze();i.useEffect(()=>()=>{t.reset()},[t])}function gf(t){const s=pi(),o=Bo(t),n=Z.getTree(tt(t)).getLastValidNode(o)?.message?.id;return s?.messageId===n?s.suggestions:[]}function ff(t){return gf(t).length>0}function xf(t){const{value:s}=Re("1887864177"),o=Uu(t.clientThreadId),n=ff(t.clientThreadId);return t.isDisabled||s?!1:t.isNewThread||o||n}function vf(t){const{isUnauthenticated:s}=ut(),o=Bo(t),{layer:n}=gn("3637408529"),{layer:a}=as("3637408529"),r=a.get("no_auth_banner_signup_rate_limit",df),l=n.get("should_show_no_auth_signup_banner",!0),d=zu(f=>f.bannerDisclaimerClientThreadId),c=Gu(),p={shouldShowBannerTermsDisclaimer:!1,shouldShowBannerSignup:!1};if(!t)return p;const h=Z.getTree(tt(t)),u=h.countMessagesByAuthor(st.User),m=h.getNodeByIdOrMessageId(o),g=m?.message?.author.role===st.Assistant&&Cc(m.message);return p.shouldShowBannerTermsDisclaimer=g&&s&&u===1&&!c&&(d==null||d===t),p.shouldShowBannerSignup=l&&g&&s&&u>0&&u%r===0,p}function ml(){const{value:t}=Re("1166240779");return t}function hl(t){const s=ml(),n=Ps().has(J.Research),r=ie(t,d=>Z.getConversationTurns(d).at(-1)?.messages.at(-1))?.message.author.name===Do.CLARIFY_WITH_TEXT;return{lastMessageIsClarifyWithText:r,isBigBoxModeActive:s&&n&&!r}}const Sf=({disabled:t,clientThreadId:s})=>{Ze.markStart("ComposerModelSelectorButton",Ze.NS_COMPOSER);const o={clientThreadId:s},n=Jo(),a=da(s,n,!0),{isLoading:r,data:l}=Nt(),d=ie(s,g=>g?.modelId),c=Cs(l?.models,d);if(r||!c)return null;const h=l?.categories.find(g=>g.defaultModel===c.id)?.shortLabel??c.title;Ze.markRendered("ComposerModelSelectorButton",Ze.NS_COMPOSER);function u(){F.logEventWithStatsig(B.composerSystemHintButtonHovered,"composer_model_selector_button_hovered",o)}function m(){F.logEventWithStatsig(B.composerSystemHintButtonClicked,"composer_model_selector_button_clicked",o)}return e.jsx(bf,{disabled:t,modelLabel:h,onHover:u,onOpen:m,children:e.jsx(ua,{sections:a})})},bf=({disabled:t,children:s,modelLabel:o,onHover:n,onOpen:a})=>{const r=oe(),[l,d]=i.useState(!1);return e.jsxs(X.Root,{open:l,onOpenChange:c=>{d(c),c&&a?.()},children:[e.jsx(yf,{disabled:!!t,children:e.jsx(Lo,{className:N(gi.toolsButton,"flex h-8 min-w-8 items-center justify-center gap-1 rounded-lg p-1 px-2 text-sm font-semibold text-token-text-secondary hover:bg-black/10 focus-visible:outline-black disabled:opacity-30 radix-state-open:bg-black/10 dark:focus-visible:outline-white"),"aria-label":r.formatMessage({id:"njhg2P",defaultMessage:"Choose a model"}),disabled:t,onPointerOver:n,onClick:c=>{c.preventDefault()},onFocusCapture:c=>{c.stopPropagation()},children:o})}),e.jsx(X.Portal,{children:e.jsx(X.Content,{alignOffset:-16,onCloseAutoFocus:c=>{c.preventDefault()},className:"[--radix-popper-available-height:40dvh]",removeVerticalPadding:!0,addBottomGradient:!0,children:e.jsx("div",{className:"flex flex-col",children:s})})})]})},yf=({disabled:t,children:s})=>e.jsx(Ut,{side:"right",sideOffset:0,label:t?e.jsx(E,{id:"WU1XH1",defaultMessage:"Model selector unavailable"}):e.jsx(E,{id:"7bVJwH",defaultMessage:"Choose a model"}),children:s});function jf({composerController:t,isDisabled:s,disabledReason:o,isPinnedActive:n,clientThreadId:a,showLabel:r,currentModelName:l}){const d=Gi(),c=oe(),p=i.useMemo(()=>({clientThreadId:a}),[a]),h=i.useCallback(()=>{F.logEventWithStatsig(B.composerSearchButtonClicked,"composer_search_button_clicked",p),d&&t.trimLeadingText(/^search\b/i)},[p,t,d]),u=i.useMemo(()=>({systemHint:J.Search,description:c.formatMessage({id:"m/oaZE",defaultMessage:"Find on the web"}),logo:"",requiredFeatures:["search"],requiredModels:[],requiredConversationModes:[Le.PrimaryAssistant],name:c.formatMessage({id:"TbHx8d",defaultMessage:"Search"})}),[c]);return e.jsx(wf,{analyticsMetadata:p,isThreadUsingSearchMode:d,isDisabled:s||n,disabledReason:o,currentModelName:l,children:e.jsx(ol,{isDisabled:s||n,isPinnedActive:n,systemHint:u,logo:e.jsx(fi,{className:"h-[18px] w-[18px]"}),composerController:t,analyticsMetadata:p,onClick:h,showLabel:r})})}function Cf(){const t=ll(),s=ea(),o=ot(Xe.hasSeenComposerSearchButtonTooltip);return!o.isLoading&&o.eligible&&!t&&!s}function wf({children:t,analyticsMetadata:s,isThreadUsingSearchMode:o,isDisabled:n,disabledReason:a,currentModelName:r}){const l=Cf()&&!o,d=ot(Xe.hasSeenComposerSearchButtonTooltip);return l?e.jsx(_n,{announcementKey:Xe.hasSeenComposerSearchButtonTooltip,side:"right",show:!0,theme:"bright",dismissOnOutsideClick:!0,badge:"new",title:e.jsx(E,{id:"Yjduqi",defaultMessage:"Search the web"}),onDismiss:d.markAsViewed,sideOffset:0,className:"!max-w-2xs xs:!max-w-sm",description:e.jsx(E,{id:"W51Aei",defaultMessage:"Get fast answers with trusted sources. {learnMore}",values:{learnMore:e.jsx(Vu,{href:"https://openai.com/index/introducing-chatgpt-search",className:"underline",children:e.jsx(E,{id:"stA7F4",defaultMessage:"Learn more"})})}}),children:e.jsx("div",{children:t})}):e.jsx("div",{children:e.jsx(Ut,{sideOffset:0,label:n?a===bn.ModelNotSupported?e.jsx(E,{id:"GZemJe",defaultMessage:"Search disabled for {modelName}",values:{modelName:`${r}`}}):a===bn.HasAttachedFiles?e.jsx(E,{id:"Wd1fc2",defaultMessage:"Search disabled for attachments"}):e.jsx(E,{id:"GpDAWD",defaultMessage:"Search is unavailable"}):e.jsx(E,{id:"c+4o2s",defaultMessage:"Search the web"}),side:"bottom",onOpenChange:c=>{c&&F.logEventWithStatsig(B.composerSearchButtonHovered,"composer_search_button_hovered",s)},children:t})})}function Mf({composerController:t,clientThreadId:s}){const o=zt(s),n=ra(),{setThreadSystemHintMode:a,clearAllSystemHintModeTriggers:r}=In(),{value:l}=Re("1416952492"),{value:d}=Fe("1325692000"),c=Fn(s).filter(w=>w.systemHint!==J.Think&&(w.systemHint!==J.Research||!l)&&!w.composerBarButtonInfo?.upsell),[p,h]=i.useState([]),[u,m]=i.useState(void 0),[g,f]=i.useState(0);i.useEffect(()=>{h(u?c.filter(w=>w.name.toLocaleLowerCase().startsWith(u.text.toLocaleLowerCase())||w.systemHint.toLocaleLowerCase().startsWith(u.text.toLocaleLowerCase())):[])},[u]),i.useEffect(()=>{t.view.dispatch(zp(t.view.state.tr,{onHintMatch(w){m(y=>Fr(y,w)?y:w)}}))},[t]);const v=!c.length||!p.length||!u;i.useEffect(()=>{v&&f(0)},[v]);const j=p.length,S=i.useCallback(w=>{f(y=>(w(y)%j+j)%j)},[j]),M=p[g],C=({hintToSave:w=M,expectPerfectMatch:y})=>{if(!u||!M||y&&w.name.toLowerCase()!==u.text.toLowerCase())return!1;F.logEvent(B.systemHintSelected,{system_hint:w.systemHint,conversation_id:o??vo});const I=u.range.from===1?w.name:u.text+w.name.slice(u.text.length),A={clientThreadId:s};an(t.view),n.size>0&&r();const O=!!w.composerBarButtonInfo,_=w.systemHint===J.Search;return d||O||_?(a(w.systemHint,!0,A,_?Br.CONVERSATION_COMPOSER_SLASH_SEARCH:void 0),u.range&&t.delete(u.range.from,u.range.to),t.removeSystemHints(),!0):(t.addSystemHint(w.systemHint,I,u.range.from,u.range.to),!0)},T=i.useRef(C);T.current=C;const k=i.useRef(S);k.current=S;const z=i.useRef(u);z.current=u;const P=t.view;return i.useEffect(()=>(v||Gp(P,w=>{if(w==="up")k.current(y=>y-1);else if(w==="down")k.current(y=>y+1);else if(w==="cancel")an(P),Wp(P);else{if(w==="submit")return an(P),T.current({expectPerfectMatch:!1});if(w==="checkMatch")return T.current({expectPerfectMatch:!0})}}),()=>an(P)),[v,P]),i.useEffect(()=>{v||F.logEvent(B.systemHintListOpened,{conversation_id:o??vo})},[v]),v?null:e.jsx(wc,{className:"max-w-60",onMouseDown:w=>{w.preventDefault()},children:p.map((w,y)=>e.jsx("div",{onMouseOver:()=>f(y),onClick:()=>{C({hintToSave:w,expectPerfectMatch:!1}),t.focus()},children:e.jsx(Mc,{autoFocus:!1,className:"rounded-lg px-1 py-2",$spoofHovered:y===g,children:e.jsx(pl,{title:w.name,description:w.description,logo:w.logo})})},w.systemHint))})}function pl({title:t,description:s,logo:o,checked:n}){return e.jsxs("div",{className:"group inline-flex w-full items-center justify-start gap-2 pl-1.5 pr-3",children:[e.jsx("div",{className:"flex h-7 w-7 items-center justify-center gap-2.5",children:e.jsx(Rn,{svgString:o,className:"icon-lg text-token-text-secondary"})}),e.jsxs("div",{className:"shrink grow basis-0",children:[e.jsx("p",{className:"text-sm font-normal leading-tight text-token-text-primary",children:t}),!!s&&e.jsx("p",{className:"text-[13px] font-normal leading-[18px] text-token-text-secondary",children:s})]}),n&&e.jsx(kc,{className:N("icon-md text-token-text-primary",{"group-hover:hidden":!n})})]})}function kf({composerController:t,clientThreadId:s}){return t instanceof ia?e.jsx(Mf,{composerController:t,clientThreadId:s}):null}function Tf({children:t,className:s,showBackground:o}){return e.jsxs("div",{className:"relative",children:[t,o&&e.jsx(ee.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:260,damping:20},className:N("pointer-events-none absolute inset-0 rounded-full",s)})]})}function _f({clientThreadId:t,icon:s,setOpen:o,open:n,isDisabled:a=!1,highlightTooltip:r=!1,hideBorder:l=!1,isSmall:d=!1,disabledReason:c,currentModelName:p}){const h=Cn(),u=oe();return a=a||!!h,e.jsxs(e.Fragment,{children:[e.jsx(X.Trigger,{className:"m-0 h-0 w-0 border-none bg-transparent p-0"}),e.jsx(Vi,{clientThreadId:t,rateLimitPopup:h,highlightTooltip:r,disabled:a,disabledReason:c,currentModelName:p,children:e.jsx(Kr,{disabled:a,"aria-disabled":a,"aria-label":a?u.formatMessage({id:"NTwThg",defaultMessage:"Attach files is unavailable"}):u.formatMessage({id:"ixBxc3",defaultMessage:"Upload files and more"}),onClick:m=>{m.preventDefault(),o(!0)},$open:n,$hideBorder:l,$isSmall:d,children:s})})]})}function Af(){const{connectorConfig:t}=xi(),s=kn(),o=Si(),[n,a]=ks(vi([...t.values()],h=>!!h.access_token),h=>!!h.access_token),[r,l]=ks(a,h=>h.type===kt.O365_PERSONAL||h.type===kt.O365_BUSINESS),d=!s&&!o&&n.length>0,c=!s&&!o&&!d&&r.length>1;return{unconnectedConnectors:o?[]:c?l:a,showUnconnectedInSubmenu:d,showOneDriveInSubmenu:c}}function Nf({clientThreadId:t,icon:s,modelAcceptedMimeTypes:o,modelSupportedImageMimeTypes:n,attachmentsProductFeature:a,onOauthRedirect:r,uploadType:l,getInputProps:d,openFileDialog:c,isDisabled:p=!1,isNested:h=!1,highlightTooltip:u=!1,showLabel:m,isSmall:g=!1,hideBorder:f=!1,disabledReason:v,currentModelName:j}){const S=Tc().locale,M=oe(),C=As(),T=$o(),k=kn(),{connectorConfig:z,isLoading:P}=xi(),w=ot(Xe.ContextConnectors),{getGizmoId:y}=Nn(),[I,A]=i.useState();i.useEffect(()=>{y?y().then(H=>A(H)):A(void 0)},[y]);const O=i.useRef(null),[_,x]=i.useState(!1),K=i.useRef(!1),$=i.useCallback(()=>{const H=O.current?.files;Array.from(H??[]).forEach(he=>ys.uploadFile(T,he,n,M,C,a))},[T,n,M,C,a]),[D,R]=i.useState(null),q=i.useCallback(()=>R(null),[R]),G=i.useCallback((H,he)=>ys.uploadPickedFile(T,H,he,n,o,a,I,M,C),[T,n,o,a,I,M,C]),{openMenu:W,confirmMenuOpened:de}=$u();i.useEffect(()=>{W&&(x(!0),de())},[W,de,x]);const ue=i.useCallback(H=>{ys.doContextConnectorOauthRedirect(location.pathname+location.search+location.hash,H,r,Da.Picker),r()},[r]),ye=i.useCallback(H=>{ys.uploadPickedFile(T,H,kt.GDRIVE,n,o,a,I,M,C)},[T,n,o,a,I,M,C]),Me=i.useCallback(async H=>{const{access_token:he}=H;if(!he){ue(H);return}switch(ys.logAttemptIfAccessTokenIsExpired(H,Da.Picker),H.type){case kt.GDRIVE:Yu(S,H.type,he,Ge=>Ge.forEach(ye));break;case kt.O365_PERSONAL:case kt.O365_BUSINESS:R(H.type);break}},[ye,ue,R,S]),pe=()=>{F.logEvent(B.openFileViewer,{intent:l.toString()}),c()},te=H=>{if(!H&&K.current&&!P)pe();else if(H&&Be&&!P){pe();return}x(H),H&&(w.eligible&&w.markAsViewed(),F.logEvent(B.composerOpenContextConnectorPicker),K.current=!0,setTimeout(()=>{K.current=!1},250))},[me,_e]=ks(vi([...z.values()],H=>!!H.access_token),H=>!!H.access_token);Ef(me,Me);const[Ae]=ks(_e,H=>H.type===kt.O365_PERSONAL||H.type===kt.O365_BUSINESS),{unconnectedConnectors:ge,showUnconnectedInSubmenu:fe,showOneDriveInSubmenu:Pe}=Af(),{desktopConnectors:$e}=Ku(n),Be=!me.length&&!ge.length&&!$e.length,ae=e.jsxs(e.Fragment,{children:[fe&&ge.length>0&&e.jsx(Qu,{connectorEntries:ge,onOauthRedirect:H=>ue(H),isNested:h}),!fe&&ge.map(H=>e.jsx(Wa,{entry:H,onClick:()=>Me(H),isNested:h},H.id)),Pe&&e.jsx(Ju,{connectors:Ae,onOauthRedirect:ue,isNested:h}),P&&e.jsx(X.Item,{icon:e.jsx(Po,{className:"text-token-text-secondary"})}),(ge.length>0||P)&&!h&&e.jsx(X.Separator,{}),me.map(H=>e.jsx(Wa,{entry:H,onClick:()=>Me(H),isNested:h},H.id)),$e.map(H=>e.jsx(Xu,{entry:H,isNested:h},H.key)),e.jsx(X.Item,{className:N(h&&"mx-0 rounded-xl p-1.5 px-2 py-2.5"),onClick:pe,icon:Zu,children:e.jsx(E,{...k?nr.uploadFileMobile:nr.uploadFile})},"upload")]}),at=h?e.jsx("div",{className:"relative flex flex-col",children:ae}):e.jsxs("div",{className:"flex flex-col",children:[e.jsx(em,{type:D,onClose:q,uploadPickedFile:G}),e.jsx("input",{onChange:$,...d({className:"hidden"})}),e.jsxs(X.Root,{open:_,onOpenChange:te,children:[e.jsx(_f,{clientThreadId:t,icon:s,setOpen:te,open:_,isDisabled:p,highlightTooltip:u,showLabel:m,hideBorder:f,isSmall:g,disabledReason:v,currentModelName:j}),e.jsx(X.Portal,{children:e.jsx(X.Content,{alignOffset:-16,side:"top",children:ae})})]}),e.jsx(tm,{hasConnectors:!P&&!Be})]});return{dropdownItems:ae,mainComponent:at}}function Ef(t,s){const{connector:o,clearParam:n}=sm(),a=t.find(r=>r.type===o&&!!r.access_token);i.useEffect(()=>{a&&(s(a),n())},[a,s,n])}function Rf(t){const{mainComponent:s}=Nf(t);return s}const nr=He({attachFiles:{id:"ContextConnectorPicker.attachFiles",defaultMessage:"Upload files and more"},uploadFile:{id:"LocalFileDropdownItem.uploadFile",defaultMessage:"Upload from computer"},uploadFileMobile:{id:"LocalFileDropdownItem.uploadFileMobile",defaultMessage:"Upload file"}});function or({clientThreadId:t,uploadType:s,modelAcceptedMimeTypes:o,modelSupportedImageMimeTypes:n,attachmentsProductFeature:a,getInputProps:r,openFileDialog:l,onOauthRedirect:d,historyDisabled:c,isNested:p,isDisabled:h,highlightTooltip:u,disabledReason:m,currentModelName:g,showLabel:f,showUpsell:v,hideBorder:j,isSmall:S}){const M=Si(),{gdriveStatus:C,o365Status:T}=nm(),k="h-[18px] w-[18px]",z=c?"text-white":u?"text-brand-blue-800":"",P=v?e.jsx(bi,{"aria-label":"",className:N(k,z)}):e.jsx(Zo,{"aria-label":"",className:N(k,z)}),y=(C!=="false"||T!=="false"||M)&&!v?e.jsx(Rf,{hideBorder:j,isSmall:S,clientThreadId:t,icon:P,modelAcceptedMimeTypes:o,modelSupportedImageMimeTypes:n,attachmentsProductFeature:a,onOauthRedirect:d,uploadType:s,openFileDialog:l,isNested:p,getInputProps:r,isDisabled:h,highlightTooltip:u,disabledReason:m,currentModelName:g}):e.jsx(eg,{isSmall:S,hideBorder:j,clientThreadId:t,uploadType:s,openFileDialog:l,getInputProps:r,showLabel:f,showUpsell:v,icon:P,isDisabled:h,highlightTooltip:u,disabledReason:m,currentModelName:g});return p?y:e.jsx("div",{className:"relative",children:e.jsx(Tf,{showBackground:u,className:"bg-brand-blue-800/20",children:y})})}function Pf({suggestions:t,composerController:s,onSelect:o,onChange:n}){const a=Bn(),r=i.useCallback((m,g,f)=>{o?.(m,g,f),a(m,g,f)},[o,a]),[l,d]=i.useState(()=>t.length>0),[c,p]=i.useState(-1),[h,u]=i.useState(!1);return i.useEffect(()=>{const m=g=>{if(!g.isComposing)if(g.key==="ArrowDown"){const f=c===t.length-1?0:c+1;p(f),n?.(f,!0,t[f])}else if(g.key==="ArrowUp"){g.preventDefault();const f=c<=0?t.length-1:c-1;p(f),n?.(f,!0,t[f])}else g.key==="Enter"&&!g.shiftKey&&t[c]&&r(t[c],t,c)};return s.subscribe("keydown",m)},[t,c,n,r,s]),i.useEffect(()=>s.subscribe("blur",()=>{p(-1),d(!1),n?.(-1,!1)}),[s,n]),i.useEffect(()=>s.subscribe("focus",()=>d(!0)),[s]),i.useEffect(()=>{if(!h){const m=()=>{u(!0),window.removeEventListener("mousemove",m)};return window.addEventListener("mousemove",m),()=>{window.removeEventListener("mousemove",m)}}},[h]),i.useEffect(()=>{p(-1),n?.(-1,!1),u(!1)},[t,n]),e.jsx(ee.ul,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:N("w-full flex-col p-2.5 max-lg:flex-col-reverse",l?"flex":"hidden"),children:t.map((m,g)=>e.jsxs(ee.li,{initial:{opacity:0,translateY:4},animate:{opacity:1,translateY:0},transition:{delay:g*.03},exit:{opacity:0,translateY:4},className:"w-full",children:[g>0&&e.jsx("div",{className:N("h-[1px] opacity-60 max-lg:hidden",c===g||c===g-1?"mx-2 bg-token-main-surface-secondary":"bg-token-border-light")}),e.jsxs("button",{className:N("flex w-full cursor-pointer items-center justify-start whitespace-pre-wrap rounded-lg px-2.5 py-3 text-start",c===g?"bg-token-main-surface-secondary":"bg-token-main-surface-primary"),onClick:f=>{f.preventDefault(),r(m,t,g)},onMouseDown:f=>{f.preventDefault()},onMouseEnter:()=>{h&&(p(g),n?.(g,!1,m))},onMouseLeave:()=>{p(-1),n?.(-1,!1,m)},children:[m.icon?e.jsx("span",{className:"mr-4 h-6 w-6 text-token-text-secondary",children:m.icon}):null,e.jsx("span",{className:"whitespace-pre-wrap",children:m.autocompletionChunks&&m.autocompletionChunks.length>0?e.jsx(e.Fragment,{children:m.autocompletionChunks.map((f,v)=>e.jsx("span",{className:N(f.isMatched?"text-token-text-tertiary":"text-token-text-primary"),children:f.text},v))}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:N(m.type===_t.Starter||m.type===_t.Trending?"text-token-text-secondary":"text-token-text-tertiary"),children:m.title}),e.jsx("span",{className:"text-token-text-primary",children:m.body})]})})]}),g>0&&e.jsx("div",{className:N("h-[1px] opacity-60 lg:hidden",c===g||c===g-1?"mx-2 bg-token-main-surface-secondary":"bg-token-border-light")})]},m.id??g))})}function If(t,s){t=t.toLocaleLowerCase();const o=s;s=s.toLocaleLowerCase();const n=[];let a=0;for(let d=0;d<s.length&&(a<t.length&&t[a]===s[d]&&(n.push(d),a++),a!==t.length);d++);const r=[];let l=0;if(n.forEach(d=>{if(d>l){const c=o.slice(l,d);c&&r.push({text:c,isMatched:!1})}r.push({text:o[d],isMatched:!0}),l=d+1}),l<s.length){const d=o.slice(l);d&&r.push({text:d,isMatched:!1})}return Ff(r)}function Ff(t){if(t.length===0)return t;let s=[t[0]];for(let n=1;n<t.length;n++){const a=s[s.length-1],r=t[n];a.isMatched===r.isMatched?a.text+=r.text:s.push(r)}const o=s.filter(n=>n.isMatched).reduce((n,a)=>n+a.text.trim().length,0);return s.length<=4&&o>=2?s:[{text:s.map(n=>n.text).join(""),isMatched:!1}]}const Bf=350;function Df({suggestionData:t,composerController:s,shouldRender:o,state:n}){const a=oe(),l=Ps().has(J.Research),c=a.formatMessage(Ee.researchSuggestionInitial),p=a.formatMessage(Ee.deepResearchPlaceholderBullet1),h=a.formatMessage(Ee.deepResearchPlaceholderBullet2),u=a.formatMessage(Ee.deepResearchPlaceholderBullet3),{displayedText:m,isStreaming:g}=sn(c,{enableStreaming:l},[s.isEmpty()]),f=Bf,{displayedText:v,isStreaming:j}=sn(p,{startDelay:f,enableStreaming:l}),{displayedText:S,isStreaming:M}=sn(h,{enableStreaming:!j&&l}),{displayedText:C}=sn(u,{enableStreaming:!j&&!M&&l}),T=n!=="streaming";return o?e.jsx("div",{className:"mb-[8px] mt-[-8px] flex select-none items-start justify-between pl-1 text-token-text-tertiary",children:s.isEmpty()?e.jsx("ul",{className:"list-disc pl-5 text-token-text-tertiary marker:text-token-text-tertiary",children:T?e.jsxs(e.Fragment,{children:[v&&e.jsx("li",{children:v}),S&&e.jsx("li",{children:S}),C&&e.jsx("li",{children:C})]}):e.jsxs(e.Fragment,{children:[p&&e.jsx("li",{children:p}),h&&e.jsx("li",{children:h}),u&&e.jsx("li",{children:u})]})}):e.jsx("div",{className:"relative flex items-center gap-1",children:e.jsx(oi,{size:"small",className:N(g&&"result-streaming",t?.isLoading&&"pulse","text-token-text-tertiary"),children:m})})}):null}const Lf=i.forwardRef(function({type:s,placeholder:o,replyRegions:n,state:a,renderFiles:r,leftSideActions:l,topRightAction:d,onSubmit:c,setIsComposerOverflowing:p,inputState:h,composerController:u,clientThreadId:m,gizmoId:g,disableReason:f,controlsDisabled:v,setControlsDisabled:j,matchaData:S},M){const C=ct(),T=om();i.useState(void 0);let k=null;const{isLoading:z}=T;z||(k=T.modelId);const[P,w]=i.useState(300),y=am(D=>{D.contentRect&&w(D.contentRect.width)});i.useEffect(()=>{z||_c()||u.focus()},[k,u,z]);const{value:I}=Fe("3780975974"),{lastMessageIsClarifyWithText:A,isBigBoxModeActive:O}=hl(m),{getShowUpsellReason:_}=yi(),x=I||_(),K=D=>{Hf({target:D.target,rootId:"composer-background",additonalInteractiveIds:["reply-regions"]})||u.focus()},$=i.useCallback(()=>e.jsx(rm,{useStartButtonText:A||!1,inputState:h,state:a,onSubmit:c,composerController:u,clientThreadId:m,gizmoId:g,disableReason:f}),[h,a,c,u,m,g,f,S,A]);return e.jsxs("div",{id:"composer-background",ref:M,className:N("flex w-full cursor-text flex-col rounded-3xl border border-token-border-light px-3 py-1 duration-150 ease-in-out contain-inline-size motion-safe:transition-[color,background-color,border-color,text-decoration-color,fill,stroke,box-shadow] dark:border-none dark:shadow-none",s!=="temporary"&&"shadow-[0_9px_9px_0px_rgba(0,0,0,0.01),_0_2px_5px_0px_rgba(0,0,0,0.06)] has-[:focus]:shadow-[0_2px_12px_0px_rgba(0,0,0,0.04),_0_9px_9px_0px_rgba(0,0,0,0.01),_0_2px_5px_0px_rgba(0,0,0,0.06)]",C&&"backdrop-blur-2xl no-transparency:backdrop-blur-none",C&&s!=="temporary"&&"bg-token-composer-surface",!C&&s!=="temporary"&&"bg-token-main-surface-primary dark:bg-[#303030]",s==="temporary"&&"dark bg-[#303030]"),onClick:K,style:{viewTransitionName:"var(--vt-composer)"},children:[e.jsx(nt,{initial:!1,children:n.length>0&&e.jsx(ee.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0,transition:{duration:.06}},transition:{ease:"easeOut",duration:.1},id:"reply-regions",children:e.jsx("div",{className:"-mx-2",children:e.jsx(im,{replyRegions:n})})})}),e.jsxs(e.Fragment,{children:[r,e.jsx(nt,{initial:!1,children:e.jsxs(ee.div,{initial:{minHeight:0},animate:{minHeight:O?"142px":0},exit:{minHeight:0},transition:{type:"spring",stiffness:48.7,damping:13.54,mass:1},className:N("flex flex-col justify-start"),children:[e.jsxs("div",{className:"flex min-h-[44px] items-start pl-1",ref:y,children:[e.jsx("div",{className:"min-w-0 max-w-full flex-1",children:e.jsx(qp,{composerController:u,placeholder:o})}),e.jsx("div",{className:"w-[32px] pt-1",children:d})]}),e.jsx(Df,{suggestionData:S,composerController:u,shouldRender:O,state:a})]})}),e.jsxs("div",{className:"mb-2 mt-1 flex items-center justify-between sm:mt-5",ref:D=>{if(!x||!("ResizeObserver"in window))return;let R=new AbortController,q=window.innerWidth;const G=lm({axis:"width",debounce:!0,target:D,onChange:()=>{if(!D)return;D.scrollWidth>D.clientWidth?p?.(!0):Math.abs(q-window.innerWidth)>40&&(p?.(!1),q=window.innerWidth)}});return()=>{G?.(),R.abort()}},children:[e.jsx("div",{className:"flex gap-x-1.5 text-token-text-primary",children:l}),e.jsx("div",{className:"flex gap-x-1.5",children:$()})]})]})]})});function Hf({target:t,rootId:s,additonalInteractiveIds:o}){let n=t;for(;n&&n!=null;){if(n.tagName==="BUTTON"||n.tagName==="INPUT"||n.tagName==="TEXTAREA"||n.isContentEditable||o.includes(n.id))return!0;if(n.id===s)return!1;n=n.parentElement}return!1}const ar=({composerController:t,disabled:s,clientThreadId:o,isComposerV2Mode:n,uploadButtons:a,showLabel:r,showUpsell:l})=>{const{value:d}=Fe("1325692000"),c=Fn(o).filter(S=>S.systemHint===J.Research&&(n||d)?!0:!S.composerBarButtonInfo&&S.systemHint!==J.Search),p=tl(t),{value:h}=Fe("3780975974"),u=sl(t,o),[m,g]=i.useState(!1);if(i.useEffect(()=>{const S=Math.random(),M=setInterval(()=>{const C=new Date,T=C.getHours()+C.getMinutes()/60+C.getSeconds()/3600,k=Math.abs((6+T)%12-6)/6;g(Math.pow(k,15)>S)},1e3);return()=>clearInterval(M)},[]),!(t instanceof ia)||c.length===0&&!n)return null;const f={clientThreadId:o};function v(){F.logEventWithStatsig(B.composerSystemHintButtonHovered,"composer_system_hint_button_hovered",f)}function j(){F.logEventWithStatsig(B.composerSystemHintButtonClicked,"composer_system_hint_button_clicked",f)}return e.jsx(Of,{systemHints:c,selectedHint:p,showJack:h?!1:m,disabled:s,isComposerV2Mode:n,onHover:v,onOpen:j,onSelect:u,uploadButtons:a,showLabel:r,showUpsell:l})},Of=({systemHints:t,selectedHint:s,showJack:o,disabled:n,isComposerV2Mode:a,onHover:r,onOpen:l,onSelect:d,uploadButtons:c,showLabel:p,showUpsell:h})=>{const u=oe(),[m,g]=i.useState(!1),f=t.find(k=>k.systemHint==="contextual_answers")?.name,{value:v}=Fe("3780975974"),j=t.length>0,S=!1;if(!Ac())return null;const C=h?e.jsx(An,{location:"tools",statsig_login_event:"chatgpt_composer_upsell_login_button_clicked",statsig_signup_event:"chatgpt_composer_upsell_signup_button_clicked"}):e.jsxs(e.Fragment,{children:[j&&e.jsxs(e.Fragment,{children:[S,t.map(k=>e.jsx(X.Item,{className:N(!a&&"px-1 py-2",a&&"mx-0 rounded-xl p-1.5 px-2 py-2.5"),onClick:()=>d?.({hint:k,enable:k.systemHint!==s}),children:a?e.jsx(cm,{title:k.name,description:k.description,icon:k.logo,checked:k.systemHint===s}):e.jsx(pl,{title:k.name,description:k.description,logo:k.logo,checked:k.systemHint===s})},k.systemHint))]}),j&&c&&e.jsx(X.Separator,{className:"mx-2 my-1",noMargin:!0}),c]}),T=h&&p?e.jsx(bi,{"aria-label":"",className:"pointer-events-none h-[18px] w-[18px]"}):e.jsx(Zo,{"aria-label":"",className:"pointer-events-none h-5 w-5"});return e.jsxs(X.Root,{open:m,onOpenChange:k=>{g(k),k&&l?.()},children:[e.jsx(Uf,{disabled:!!n,contextualAnswersHintNameIfPresent:f,children:e.jsxs(Lo,{className:N(gi.toolsButton,"flex h-9 min-w-9 items-center justify-center rounded-full border border-token-border-light p-1 text-xs font-semibold text-token-text-secondary focus-visible:outline-black disabled:opacity-30 radix-state-open:bg-black/10 can-hover:hover:bg-token-main-surface-secondary dark:focus-visible:outline-white dark:can-hover:hover:bg-gray-700"),"data-opened":rr(m),"data-jack":rr(!!o),"aria-label":a?u.formatMessage({id:"9xVxsA",defaultMessage:"Upload files and more"}):u.formatMessage({id:"oDAnGy",defaultMessage:"Use a tool"}),disabled:n,onPointerOver:r,onClick:k=>{k.preventDefault()},onFocusCapture:k=>{k.stopPropagation()},children:[a?T:v?e.jsx(ji,{className:"pointer-events-none h-5 w-5"}):e.jsx(dm,{className:"pointer-events-none h-5 w-5"}),h&&p&&e.jsx("span",{className:"whitespace-nowrap pr-2 text-[13px] font-semibold [display:--force-hide-label]",children:u.formatMessage({id:"AlZBxR",defaultMessage:"Tools"})})]})}),e.jsx(X.Portal,{children:e.jsx(X.Content,{alignOffset:-16,className:N(a&&"flex flex-col justify-start gap-2",a&&!h&&"p-1.5"),onCloseAutoFocus:k=>{k.preventDefault()},removeVerticalPadding:a||h,children:C})})]})},Uf=({disabled:t,children:s,contextualAnswersHintNameIfPresent:o})=>{const n=ot(Xe.hasSeenComposerSystemHintButtonTooltip),a=ot(Xe.hasSeenCaSystemHint),r=!t&&!n.isLoading&&n.eligible,l=!t&&!n.isLoading&&o&&!a.isLoading&&a.eligible,d=r?{announcementKey:Xe.hasSeenComposerSystemHintButtonTooltip,title:e.jsx(E,{id:"tTydhk",defaultMessage:"All your tools, in one handy place"}),onDismiss:n.markAsViewed,description:e.jsx(E,{id:"S+BFNe",defaultMessage:"Create a canvas, generate a picture, and more."})}:l?{announcementKey:Xe.hasSeenCaSystemHint,title:e.jsx(E,{id:"uaC1JM",defaultMessage:"Not finding internal information?"}),onDismiss:a.markAsViewed,description:e.jsx(E,{id:"TL/S+W",defaultMessage:"If ChatGPT didn't search your files automatically, type {hintName} or select it from the menu.",values:{hintName:e.jsx("span",{className:"whitespace-nowrap font-bold",children:'"/'+o+'"'})}})}:void 0;return d?e.jsx(_n,{show:!0,side:"bottom",theme:"bright",dismissOnOutsideClick:!0,badge:"new",sideOffset:0,className:"!max-w-2xs xs:!max-w-sm",...d,children:s}):e.jsx(Ut,{side:"top",sideOffset:0,label:t?e.jsx(E,{id:"uw9x80",defaultMessage:"Tools unavailable"}):e.jsx(E,{id:"mrYNGk",defaultMessage:"View tools"}),children:s})};function rr(t){return t?"":null}const zf=1,Gf=3e3,ir="search-button",lr="active-hint-tag";function Wf({onAbortCompletion:t,onCreateNewCompletion:s,onContinueGenerating:o,currentModelId:n,clientThreadId:a,isNewThread:r,isCompletionInProgress:l,className:d,disabled:c=!1,disabledReason:p,canPause:h=!1,canContinue:u=!1,suggestions:m,isInteractableSharedThread:g,composerContainerRef:f,autocompletions:v,matchaData:j,requiresFileUpload:S,onComposerInput:M,onComposerChange:C,onAutocompleteSelect:T,headerClassName:k,hideHeader:z,setComposerBarElement:P,onTaggingDropdownOpen:w,onTaggingDropdownClose:y}){Ze.markStart("PromptTextarea"),Ze.markRendered("PromptTextarea");const I=i.useRef(null),A=Im(I,P),{data:O}=Io(),{data:_}=Nt(),x=Dn(),K=Pn(),$=Nc(O),D=$?.isFree(),{isUnauthenticated:R}=ut(),q=oe(),G=As(),W=$o(),[de,ue]=ie(a,b=>[Z.getCurrentLeafId(b),Z.getRequestId(b)]),[ye]=Wr(),{gizmoEditorData:Me,mode:pe,getGizmoId:te}=Nn(),me=Dr(),_e=Nr(),Ae=At(),ge=Ci(),fe=zt(a),Pe=!!Pr(),$e=!!Ec(),Be=!!Rc(),ae=Pc(),at=sa.useIsEnabled(a),H=!!Ho(),{setThreadSystemHintMode:he,clearSystemHintModeTrigger:Ge,getSystemHintModeTrigger:Wt}=In(),Ie=Ps(),Ye=Ie.has(J.Search),re=Ie.has(J.Think),Ne=Ie.has(J.Research),vt=ie(a,b=>Z.getConversationTurns(b).some(Q=>!!Q.messages.length)),U=Fn(a),Y=U.length>0,se=Ie.size===1&&Ie.values().next().value,je=se&&se!==J.Search&&se!==J.Think,Se=U.find(b=>b.systemHint===se),[xe,Ce]=i.useState(!1),[le,Ke]=i.useState(0),[mt,ht]=i.useState(!1),qt=ct(),St=i.useRef(!1),bt=null,be=Cs(_?.models,n);let ne=Ns(a),yt=ne&&"gizmo"in ne?ne.gizmo:void 0;const ke=Es(yt?.gizmo.id),Ln=Xg(),Hn=um(),Et=wi(),Is=Ko(yt?.gizmo.id),[De,Vt]=i.useState(null);De!==null&&(ne={gizmo:De,gizmo_id:De.gizmo.id,kind:Le.GizmoInteraction},yt=De);const Rt=vn(be,ne),Fs=Cn(),ds=!c&&Rt!==ts.None&&!R,jt=Jr(be,ne),us=Zr(be,ne);let Qe=Sn(b=>b.files);const[ms]=i.useState(()=>mm());pe==="magic"?Qe=Qe.filter(b=>b.gizmoId!=null):Qe=Qe.filter(b=>b.gizmoId==null);const Bs=hm(),pt=Qe.length>0||Bs,Pt=Sn(Fm.hasUploadInProgress),Ds=pm(a),hs=x.useState(b=>{const Q=kp(b);return typeof be?.maxTokens=="number"&&Q>be.maxTokens}),Ct=x.useState(b=>!b.isEmpty()),$t=!hs&&!Pt&&(Ct||pt),Yt=(Rt===ts.Multimodal?qo:Vo)-Qe.length,Ls=Yt<=0,rt=$t&&!c&&!H&&(!l||Et),[It,Hs]=i.useState(!1),{value:Os,isLoading:On}=Fe("3780975974"),{value:Un}=Fe("759329447"),{value:Us}=Fe("2223246572"),{value:We}=Fe("1325692000"),zs=n??Mi(_).id,Ft=Cs(_?.models,zs),Kt=qa(Ft,La.Search),{value:zn}=Re("2603280534"),{userIsInSearchHoldoutWithWebDisabled:Gn}=zi(),Wn=R&&!Kt,ps=!c&&(!yt||ke&&zn)&&me?.includes(un.SearchTool)&&!me.includes(un.SearchToolHoldout)&&!Gn&&(me.includes(un.BrowsingAvailable)||!$?.isEnterprisey())&&(!We||!je)&&!Wn,{value:qn}=Re("1416952492"),{value:Bt}=Re("4239853523"),Vn=ps&&Kt,{targetedContent:Gs,setTargetedContent:Dt}=ki(),qe=Gs?.isFocusedViewContent&&!ge?void 0:Gs,{rebaseSystemMessageContent:Ws}=na(),$n=ne?.kind===Le.PrimaryAssistant||ne?.kind===Le.GizmoInteraction&&ke,Yn=ne?.kind===Le.PrimaryAssistant||ne?.kind===Le.GizmoInteraction&&ke,Kn=U.find(b=>b.systemHint===J.Think),{getUpsellLabelType:qs,getUpsellShowsAttach:Qn,getShowUpsellReason:Vs}=yi(),Jn=Os&&Kn&&bt==null&&ne?.kind===Le.PrimaryAssistant&&(Un||We)&&(!We||!je),L=ne?.kind===Le.PrimaryAssistant&&!Ae&&!We&&!Bt,ce=Y&&$n,[it,Xn]=i.useState(!1),jl=!D&&ce&&!Us,[gs,Cl]=i.useState(!1);i.useEffect(()=>{if(!K?.id)return;const b=Ka.getAndReset(K.id,fe);b&&x.setText(b.inputText)},[K?.id,fe,x]),i.useEffect(()=>{const b=ye.get("prompt")??"";x.getCurrentText().length===0&&b.length>0&&x.setText(b)},[x,ye]),i.useEffect(()=>{It!==rt&&(Hs(rt),rt&&Ic(!0).then(b=>{gm.startEnforcement(b),Fc.startEnforcement(b)}))},[rt,It,ne?.kind,me]);const Zn=Qr(be,ne),{handleFileAccepted:wl}=Yi(q,vn(be,ne),jt,"mouse",te,Zn?.attachments),{getInputProps:Ml,open:kl}=ei({disabled:c||!ds||Ls,noClick:!0,onDropAccepted:wl,onDropRejected:b=>$i(b,q,G,Rt),multiple:!0,maxSize:ti,maxFiles:Yt,...Xr(us)}),ga=Bc(ms),{value:Tl}=Fe("1988730211"),_l=ml(),{isBigBoxModeActive:Al}=hl(a),fa=i.useCallback(()=>{x.eraseContent(),ga.clearMessages(),x.resize(zf),x.usedDictation=!1,fm();for(const b of Qe)mn.remove(W,b.tempId,"none");xm.markAllAsSent()},[x,ga,Qe,W]),$s=async(b,Q)=>{if(b?.preventDefault(),c||!$t&&!Q||!ne||tt(a)?.isLoading!==!1)return;if(Et&&vs==="streaming"){const Je=Z.getMessage(tt(a)),lo=Je?Oc(Je).length:0;F.logEventWithStatsig(B.conversationStreamInterrupted,"chatgpt_web_conversation_stream_interrupted",{client_thread_id:a,interrupted_message_length:lo})}const Te=Uc(ue);if(Et&&Te&&!Te.turnTracker.isStreamOpen)return;Ce(!0),Ln?.(),Hn();const ve=x.getContentToSend(),et=_p(ve.content),Jt=Bm({namespace:Dm.CompletionRequest,opts:{expectedTimingLogs:[{name:"prompt_submitted",expectedInMs:3e3}]}});Jt.reset();const{content:bs,attachments:Js}=Lm(W,et,be,ne),Aa=[],ao=[];Ws&&ao.push(zc(Ws));const ro={...ne};"gizmo"in ro&&delete ro.gizmo;let Xs=x.getSystemHints();Ie.size>0&&(Xs=Array.from(Ie));const Na=Wt(J.Search),lc=Ye?Na??Br.CONVERSATION_COMPOSER_WEB_ICON:void 0,Ea=Hm(),Ra=Om(),cc=x.usedDictation;let gt={content:bs,eventSource:b?"mouse":"keyboard",completionMetadata:{suggestions:m,conversationMode:ro,systemHints:Xs,searchSource:lc},messageMetadata:{...Js.length>0&&{attachments:Js},...De&&{gizmo_id:De.gizmo.id},...Xs.length>0&&{system_hints:Xs},...!!ve.metadata&&{serialization_metadata:ve.metadata},...Ea.length>0&&{canvas:{user_created_textdocs:Ea.map(Je=>({user_created_temp_textdoc_id:Je.tempTextdocId,type:Je.type,title:Je.title,content:Je.content,create_source:Je.create_source,remix_shared_textdoc_id:Je.remixSharedTextdocId}))}},...Object.keys(Ra).length>0&&{__internal:{search_settings:Ra}},dictation:cc},prependMessages:Aa.length>0?Aa:void 0,appendMessages:ao.length>0?ao:void 0,profiler:Jt};const io={};if(gt=Um(gt),Tl&&gt.completionMetadata.systemHints){let Je=!1;gt.completionMetadata.systemHints=gt.completionMetadata.systemHints.filter(lo=>lo===J.Search?(Je=!0,!1):!0),Je&&(io.forceUseSearch=!0)}at&&(io.enableMessageFollowups=!0),gt.extraStreamParams=io,qe?.createNewCompletionParams&&(gt=await qe.createNewCompletionParams(gt)),Jt.logTiming("request_params_ready"),s(gt),qe?.onCreateCompletion?.({serverThreadId:fe,currentLeafId:de}),qe?.shouldPersistAcrossMessages!==!0&&Dt(void 0),Ms.hideThreadHeader(),fa(),Ce(!1),m!==void 0&&(we.logEvent("chatgpt_prompt_ignore_suggestions"),F.logEvent(B.promptIgnoreSuggestions)),Ye&&Na&&Ge(J.Search);const dc=Z.getConversationTurns(tt(a)).at(-2)?.messages.at(-1);Ne&&dc?.message.author.name===Do.CLARIFY_WITH_TEXT&&Ge(J.Research)},Nl=i.useRef($s);i.useEffect(()=>{Nl.current=$s});const El=b=>{Dt(b.targetedReply),b.targetedReply&&(x.focus(),F.logEventWithStatsig(B.targetedReplyButtonClicked,"chatgpt_targeted_reply_button_clicked",{conversationId:fe,sourceMessageId:b.messageId}))},xa=i.useCallback(()=>{qe?.onCleared?.({serverThreadId:fe,currentLeafId:de}),Dt(void 0),x.focus()},[de,fe,qe,Dt,x]),va={Enter:{validator:b=>{const Q=b.isComposing||b.keyCode===229,Te=mt&&St.current;return Al?!Te&&!Q&&(b.metaKey||b.ctrlKey):!Te&&(b.metaKey||(_e||Gc)&&!b.shiftKey&&!Q)},handler:b=>{if(!rt){hs&&G.danger("The message you submitted was too long, please submit something shorter.",{hasCloseButton:!0});return}b.preventDefault(),$s()}},Escape:{validator:b=>!b.isComposing,handler:b=>{h&&l&&(t(ue),F.logEvent(B.pauseCompletion,{threadId:Tt(a),currentLeafId:Z.getMessageId(tt(a)),eventSource:"keyboard"})),b.target.value===""&&xa()}}},fs=i.useRef(va);fs.current=va;const Ys=vm(Ft?.tags,ne?.kind),[eo,Ks]=i.useState(!1),xs=Ys&&eo&&!ke,Sa=x.isReady();i.useEffect(()=>x.subscribe("keydown",b=>{x.acceptLegacyKeydown()&&fs.current[b.key].validator(b)&&fs.current[b.key].handler(b);const Te=x.getCurrentText();if(b.key==="@"){const ve=x.getSelectionStart(),et=Te.substring(0,ve);(!et||/\s$/.test(et)||ve===0)&&setTimeout(()=>Ks(!0),10)}else eo&&Ks(!1);b.key==="Escape"&&(Vt(null),ht(!1)),Ye&&b.key==="Escape"&&he(J.Search,!1,{clientThreadId:a})}),[x,Sa,eo,Vn,Ie,Ye,he,a]),i.useEffect(()=>{const b=Object.fromEntries(Object.keys(fs.current).map(Q=>[Q,ve=>{const et=fs.current[Q];if(!et||x.acceptLegacyKeydown())return!1;const{validator:Jt,handler:bs}=et;return Jt(ve)?(bs(ve),!0):!1}]));x.registerKeyHandlers(b)},[x,Sa]),i.useEffect(()=>x.subscribe("paste",b=>{Sm({filePickerStore:W,event:b,intl:q,toaster:G,clientThreadId:a,conversationMode:ne,currentModelConfig:be,getEditorGizmoId:te,modelSupportedImageMimeTypes:jt})}),[q,a,ne,be,te,jt,x,G,W]);const Rl=b=>{Pe||Vt(b),x.trimLeadingText("@"),ko(),Ks(!1)},Pl=bm(a,ms,jt,Zn?.attachments),Il=i.useCallback(b=>{b?.preventDefault(),t(ue),F.logEvent(B.pauseCompletion,{threadId:Tt(a),currentLeafId:Z.getMessageId(tt(a)),eventSource:"mouse"}),ko()},[t,a,ue]),ba=i.useCallback(()=>{Ka.set(K?.id,fe,x.getCurrentText())},[fe,K?.id,x]);i.useEffect(()=>{Me||!xe&&!Dc()&&x.focus()},[xe,x]),i.useEffect(()=>{if(jt.length>0)for(const Q of Qe)Tp(Q.fileSpec?.mimeType,us)||mn.remove(W,Q.tempId,"none");else mn.reset(W)},[n,W]),i.useEffect(()=>{(!Ys&&De||Pe)&&Vt(null)},[Ys,De,Pe]);const{layer:Fl}=as("4031588851"),{layer:ya}=as("3637408529"),Bl=ya.get("is_in_composer_text_exp",!1),Dl=ya.get("composer_text","MESSAGE_CHATGPT"),Ll=Fl.get("composer_text","MESSAGE_CHATGPT"),Hl=Bl?Dl:Ll,[Qs,Ol]=(()=>{switch(p){case"workspaceDisallowsGizmo":return[Ee.disallowedByWorkspacePlaceholder,!0];case"noModelsAvailable":return[Ee.noModelsAvailablePlaceholder,!0];case"requiresPluginsToBeInstalled":return[Ee.requiresPluginsToBeInstalled,!0];case"loadingPlugins":return[Ee.loading,!0];case"noTestGizmoId":return[Ee.noTestGizmoId,!0];default:{if(g)return[Ee.placeholderWithName,!1];if(qe?.placeholderTextOverride!=null)return[qe.placeholderTextOverride,!1];if(Ne&&_l)return vt?[Ee.researchSuggestionInitial,!1]:[Ee.deepResearchPlaceholder,!1];switch(Hl){case"BLANK":return[null,!1];case"ASK_ANYTHING":return[Ee.placeholderAskAnythingVariant,!1];case"ASK_CHATGPT_ANYTHING":return[Ee.placeholderAskNameAnythingVariant,!1];default:return[Ee.placeholderWithName,!1]}}}})(),Ul=ke?r?q.formatMessage(jo.newChatInProject):Qs?q.formatMessage(Qs,{name:"ChatGPT"}):"​":Qs?q.formatMessage(Qs,{name:Me!=null?pe==="magic"?ym:Me.name||"GPT":yt?.gizmo.display.name??"ChatGPT"}):"​";i.useEffect(()=>x.subscribe("input",()=>{Xo.getState().isThreadHeaderVisible&&Ms.hideThreadHeader(),ht(!0)}),[x]),i.useEffect(()=>x.subscribe("input",()=>{Ke(performance.now()),M?.()}),[x,M]),i.useEffect(()=>{if(C)return x.subscribe("change",()=>{C()})},[x,C]),i.useEffect(()=>x.subscribe("focus",()=>{ht(!0)}),[x]),i.useEffect(()=>{We&&se&&je&&!U.some(({systemHint:b})=>b===se)&&!R&&he(se,!1,{clientThreadId:a})},[a,he,se,je,U,R,We]);const ja=Os||On||Vs(),Ca={clientThreadId:a,uploadType:Rt,modelAcceptedMimeTypes:us,modelSupportedImageMimeTypes:jt,attachmentsProductFeature:Zn?.attachments,getInputProps:Ml,openFileDialog:kl,historyDisabled:Ae,onOauthRedirect:ba,highlightTooltip:S&&!pt},to=U.some(({systemHint:b,requiredModels:Q})=>b===J.Think&&Q.some(Te=>{const ve=Cs(_?.models,Te);return ve?ve.product_features.attachments:!1})),Lt=[],wa=!c&&!Ls&&(ds||Fs!=null)&&!Ye&&(!re||to),so=Qn(),Ma=so||!R,ka=Rt===ts.None?xt.ModelNotSupported:re?xt.ThinkModeInUse:Ye?xt.SearchModeInUse:void 0;!Bt&&Ma?Lt.push(e.jsx("div",{style:{viewTransitionName:"var(--vt-composer-attach-file-action)"},children:e.jsx(or,{...Ca,showLabel:qs()==="all",showUpsell:so,isDisabled:!wa||gs,disabledReason:ka,currentModelName:be?.title??""})},"file-upload-button")):Lt.push(e.jsx("div",{style:{viewTransitionName:"var(--vt-composer-system-hint-action)"},children:e.jsx(ar,{composerController:x,clientThreadId:a,disabled:!Ma,showLabel:qs()==="all",showUpsell:so,isComposerV2Mode:!0,uploadButtons:e.jsx(or,{...Ca,isDisabled:!wa,isNested:!0,disabledReason:ka,currentModelName:be?.title??""})})},"system-hint-button"));const wt=[];Se&&je&&We&&wt.push(e.jsx("div",{style:{viewTransitionName:`var(--vt-composer-${Se}-action)`},children:e.jsx(sr,{logo:e.jsx(Rn,{svgString:Se.logo,className:"h-[18px] w-[18px] text-blue-1000 dark:text-[#48AAFF]"}),label:Se.name,showRemoveIcon:!0,onClick:()=>{he(Se.systemHint,!1,{clientThreadId:a})},showLabel:ja})},lr)),ps&&wt.push(e.jsx("div",{style:{viewTransitionName:"var(--vt-composer-search-action)"},children:e.jsx(jf,{composerController:x,clientThreadId:a,isDisabled:!Vn||pt||gs,disabledReason:Kt?pt?bn.HasAttachedFiles:void 0:bn.ModelNotSupported,showLabel:!it,currentModelName:be?.title??""})},ir));const zl=i.useMemo(()=>ae.reduce((b,Q)=>(b[Q.feature_name]=Q,b),{}),[ae]);U.forEach(b=>{const Q=Pg(b.systemHint)??b.systemHint,Te=zl[Q]??null,ve=b.systemHint===J.Think,et=b.systemHint===J.Research;if(ve&&!Jn||b.systemHint===J.Search&&ps||et&&!L)return;const bs=ve&&($e||!to&&pt)||et&&(Be||qn);if(b.composerBarButtonInfo){const Js=be?.tags.includes("reasoning")||be?.id.includes("o1")||be?.id.includes("o3");wt.push(e.jsx("div",{style:{viewTransitionName:`var(--vt-composer-${b.systemHint}-action)`},children:e.jsx(Fg,{composerController:x,systemHint:b,rateLimitProgress:Te,composerBarButtonInfo:b.composerBarButtonInfo,clientThreadId:a,isDisabled:!ce||bs||gs,isPinnedActive:Js&&ve,showLabel:ja,currentModelName:be?.title??"",disabledReason:ve&&!to&&pt?ss.HasAttachedFiles:et?qn?ss.DeepResearchHighLoad:ss.RateLimitReached:void 0})},`system-hint-${b.systemHint}`))}}),Is&&wt.push(e.jsx("div",{style:{viewTransitionName:"var(--vt-composer-system-model-selector)"},children:e.jsx(Sf,{clientThreadId:a})},"model-selector-button")),jl&&!Vs()&&!Bt&&wt.push(e.jsx("div",{style:{viewTransitionName:"var(--vt-composer-system-hint-action)"},children:e.jsx(ar,{composerController:x,clientThreadId:a,disabled:!ce||gs})},"system-hint-button"));const Gl=jm(!1),no=_?.defaultModelSlug;if(!We||n===no||!Yn)Lt.push(...wt);else if(We&&be&&no&&_.categories){const b=_.categories.find(Q=>Q.defaultModel===be.id);if(b){Lt.push(e.jsx(sr,{showLabel:!0,logo:null,label:b.shortLabel,onClick:()=>Gl({location:"PromptTextArea",modelId:no}),showRemoveIcon:!0}));const Q=wt.find(ve=>ve.key===ir);Kt&&Q?Lt.push(Q):Ie.has(J.Search)&&he(J.Search,!1,{clientThreadId:a}),Ie.has(J.Think)&&he(J.Think,!1,{clientThreadId:a});const Te=wt.find(ve=>ve.key===lr);Lt.push(Te)}}const Wl=Ol?"disabled":"default",ql=l&&h,Vl=Lc(),$l=!rt||xe||Vl,Yl=Ap(Pt,Ct,hs,Ds),vs=ql?"streaming":$l?"disabled":"idle",Ss=i.useRef(null),Qt=i.useRef(null),{value:Kl}=Re("222560275"),Ql=Kl||n&&!n.startsWith("o1")&&!n.startsWith("o3");i.useEffect(()=>{const b=()=>{Ss.current!=null&&bo.addAction("composer_state_disabled",{threadId:Tt(a),disabledReason:Ss.current})};if($t&&vs==="disabled"){let Q="unknown";c?Q=p??"component_disabled_unknown":l?Q="completion_in_progress":H?Q="thread_hard_blocked":xe&&(Q="starting_new_completion_request"),Ss.current!==Q&&(Qt.current&&clearTimeout(Qt.current),Qt.current=setTimeout(b,Gf)),Ss.current=Q}else Ss.current=null;return()=>{Qt.current&&(clearTimeout(Qt.current),Qt.current=null)}},[a,$t,vs,c,p,l,H,xe]);const oo=[];if(qe?.label&&oo.push({type:qe.type,value:qe.label,onRemoveRegion:xa}),De!==null){const b=!!De.gizmo.tags?.includes(Rs.FirstParty);oo.push({type:"mention",value:De.gizmo.display.name,icon:e.jsx(la,{isFirstParty:b,src:De.gizmo.display.profile_picture_url,className:"icon-md"}),onRemoveRegion:()=>{Vt(null),x.focus()}})}i.useEffect(()=>{(!v||v.length===0||!mt)&&(St.current=!1)},[v,mt]);const Jl=(b,Q,Te)=>{St.current=b>=0,Q&&x.setText(Te?`${Te.title}${Te.body}`:"")},Ta=mt&&v&&v.length>0&&!xs&&!x.hasMultipleLines()&&x.canShowAutocompletion();i.useEffect(()=>{xs?w?.():y?.()},[xs,w,y]);const _a=b=>{if(le>0){const Q=performance.now()-le;zm.hist(Gm.DEFAULT,"final_user_input_to_submit_ms",[],Q)}vs==="streaming"&&(!Et||x.isEmpty())?Il(b):$s(b)},Xl=qa(Ft,La.Canvas),{value:Zl}=Fe("61299031"),ec=kn(),tc=Cm(),sc=Xl&&Zl&&!tc&&!Bs&&!ec;i.useEffect(()=>{},[bt,x]),Re("3993182790");const nc=e.jsx(uf,{canUseInlineTagging:Ys,isDisabled:c,clientThreadId:a,currentLeafId:de,currentRequestId:ue,canContinue:u,composerController:x,suggestions:m,isNewThread:r,onCreateNewCompletion:s,onContinueGenerating:o,onResetState:fa,conversationMode:ne,isShowingAutocomplete:!!Ta}),oc=ne!=null&&Ql&&wm.includes(ne.kind)&&e.jsx(Mm,{clientThreadId:a,onTargetedReply:El}),ac=Ta&&e.jsx("div",{className:"absolute left-0 z-[-1] box-border w-full bg-token-main-surface-primary pl-0 max-lg:bottom-full lg:top-full",children:e.jsx(Pf,{suggestions:v,composerController:x,onSelect:T,onChange:Jl})}),rc=e.jsx(Wm,{composerController:x,parsedDocumentHandler:Pl}),ic=!z&&!qt&&e.jsx(cl,{className:k});return e.jsxs(km.Provider,{value:ms,children:[e.jsx(Tm,{onOauthRedirect:ba,children:e.jsx("form",{className:d,onSubmit:_a,children:e.jsxs("div",{className:"relative z-[1] flex h-full max-w-full flex-1 flex-col",children:[ic,e.jsxs("div",{ref:f,className:"group relative z-[1] flex w-full items-center",style:{"--force-hide-label":it?"none":"block"},children:[e.jsxs(_m,{open:xs||ce||Is,children:[e.jsx(Am,{className:"w-full",children:e.jsx(Lf,{type:Ae?"temporary":"default",ref:A,replyRegions:oo,placeholder:Ul,inputState:Wl,setIsComposerOverflowing:Xn,composerController:x,matchaData:j,leftSideActions:Lt,topRightAction:sc&&e.jsx(Nm,{composerRef:I,composerController:x,clientThreadId:a}),state:vs,onSubmit:_a,renderFiles:pt&&e.jsxs(e.Fragment,{children:[pe==="magic"&&e.jsx("div",{className:"m-2 mb-0 rounded-lg bg-token-main-surface-secondary p-2 text-xs text-token-text-secondary",children:e.jsx(E,{...Ee.gizmoKnowledgeWarning})}),e.jsx(Em,{files:Qe,className:"-ml-1.5 flex flex-nowrap gap-2 overflow-x-auto p-1.5"})]}),clientThreadId:a,gizmoId:yt?.gizmo.id,disableReason:Yl,modelId:zs,controlsDisabled:gs,setControlsDisabled:Cl})}),e.jsx(Rm,{children:e.jsxs(Pm,{side:"bottom",align:"start",sideOffset:12,onOpenAutoFocus:b=>{Hc("2713687629")&&b.preventDefault()},children:[xs&&e.jsx(_g,{onClick:b=>Rl(b),onClose:()=>{Ks(!1),x.focus()}}),ce&&e.jsx(kf,{composerController:x,clientThreadId:a})]})})]}),ac]}),rc]})})}),nc,oc]})}function qf(t,s){const o=!s&&t.message.author.role===st.User&&t.message.status==="in_progress",n=t.metadata?.err!=null&&t.metadata.errCode!==Ha.ContentPolicy,a=t.metadata?.errCode===Ha.ModelIncompatibility;return t.metadata?.canRetry===!1||a?!1:o||n}function Vf(t){return e.jsx(Wi,{clientThreadId:t.clientThreadId,children:e.jsx($f,{...t})})}function $f({clientThreadId:t,isNewThread:s,currentModelId:o,showPromptStarters:n,noWrap:a,onRequestCompletion:r,composerContainerRef:l}){const c=Dn(),p=i.useContext(Uo),h=zo(p),u=Fo(),m=Go(),g=ie(t,j=>qf(Z.getCurrentNode(j),!1));_i(c);const{value:f}=Re("3779321121");if(!f&&!m&&g)return e.jsx(Yf,{clientThreadId:t});const v=e.jsx(e.Fragment,{children:e.jsx(gl,{composerContainerRef:l,clientThreadId:t,currentModelId:o,isNewThread:s,showPromptStarters:n,onRequestCompletion:r})});return a?v:e.jsxs(e.Fragment,{children:[e.jsx(yg,{clientThreadId:t}),e.jsx(oa,{clientThreadId:t,isStaticSharedThread:u,verticalPadding:h?"last-standard":"none",horizontalPadding:"standard",children:e.jsx(yn,{children:v})})]})}function Yf({clientThreadId:t}){const s=qi({clientThreadId:t}),o=ie(t,r=>Z.getCurrentNode(r).metadata?.errCode===Kc.ModelCapExceeded),n=Xm(r=>r.isoDate),a=Bo(t);return o&&n!=null&&n!==""?null:e.jsxs("div",{children:[e.jsx("div",{className:"mb-3 text-center text-xs","data-has-thread-error":!0,children:e.jsx(E,{...cr.errorGeneratingResponse})}),e.jsx("div",{className:"flex items-center md:mb-4",children:e.jsx(ft,{as:"button",color:"primary",onClick:()=>{we.logEvent("chatgpt_regenerate_due_to_error_button_clicked",void 0,lt({clientThreadId:t})),s({nodeId:a})},className:"m-auto",icon:ii,"data-testid":"regenerate-thread-error-button",children:e.jsx(E,{...cr.regenerateResponse})})})]})}function gl({clientThreadId:t,currentModelId:s,isNewThread:o,onRequestCompletion:n,showPromptStarters:a,composerContainerRef:r,autocompletions:l,matchaData:d,requiresFileUpload:c,onComposerInput:p,onComposerChange:h,onAutocompleteSelect:u,headerClassName:m,hideHeader:g,onTaggingDropdownClose:f,onTaggingDropdownOpen:v}){const{data:j}=Nt(),[S,M,C,T,k,z,P,w]=ie(t,re=>{const Ne=Z.getCurrentLeafId(re);return[Z.getRequestId(re),re?.isLoading,re?.async_status===Hr.STREAMING,Z.isMessageTurnEnded(re),re?.tree.getHasErrorFromNode(Ne)??!1,re?.tree.isMessageIncomplete(Ne)??!1,re?.mode,re?.continuingFromSharedConversationId!=null]}),y=ls(),{isUnauthenticated:I}=ut(),A=Ot(S),O=Wc({clientThreadId:t}),_=!I,x=qc(),{isOpen:K,onClose:$}=qm({type:"just-hit-rate-limit"}),{value:D}=Fe("1988730211"),R=ra(),q=i.useCallback(()=>{F.logEvent(B.continueCompletion);const re=Array.from(R),{systemHints:Ne,extraStreamParams:vt}=D?Vm(re):{systemHints:re,extraStreamParams:{}};n({completionType:Vc.Continue,extraStreamParams:vt,completionMetadata:{conversationMode:tt(t)?.mode,systemHints:Ne}})},[R,D,n,t]),G=qr(),W=i.useCallback(re=>{$m({clientThreadId:t,currentRequestId:re,isHistoryAndTrainingDisabled:x,queryClient:G})},[t,x,G]),ue=i.useCallback(({content:re,eventSource:Ne,extraStreamParams:vt,completionMetadata:U,messageMetadata:Y,prependMessages:se,appendMessages:je,profiler:Se,requestedModelId:xe})=>{let Ce;js(t,le=>{Lr.appendMessage(le,$c(re,Y,Ce))}),Ym(t),n({eventSource:Ne,completionMetadata:U,extraStreamParams:vt,prependMessages:se,appendMessages:je,profiler:Se,conduitToken:Me.current,...xe?{requestedModelId:xe}:{}}),Me.current=null,pe.current=!1},[t,n,null,y?.normalizedAccountUserId]),ye=Km(),Me=i.useRef(null),pe=i.useRef(!1),te=i.useCallback(()=>{h?.()},[t,s,ye,h]),me=!T&&(A||C),_e=i.useMemo(()=>me?!1:!k&&z,[k,z,me]),Ae=me,ge=dt(t),fe=Gt(ge).data,{promptStarters:Pe,isSuccess:$e}=Ti(o&&!M,t,4),Be=pi(),ae=ie(t,Z.getLastValidNode),at=(()=>{if(Be?.messageId===ae.message.id)return Be.suggestions;if(a&&!M&&$e&&!_)return Pe})(),H=Yc(),he=fe?.gizmo.tags?.includes(Rs.WorkspaceDisabled)&&!H?"workspaceDisallowsGizmo":j?.models.size===0?"noModelsAvailable":P?.kind===Le.GizmoTest&&P.gizmo_id==null?"noTestGizmoId":null,Ge=xd(),Wt=Oo(),Ie=Ge.action==="moderate",{value:Ye}=Re("1860647109");return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex justify-center empty:hidden",children:Wt&&Ie&&Ye?e.jsx(Qm,{}):null}),K?e.jsx(Jm,{onClose:$}):null,e.jsx(Wf,{composerContainerRef:r,clientThreadId:t,onCreateNewCompletion:ue,onAbortCompletion:W,onContinueGenerating:q,currentModelId:s,isNewThread:o,isCompletionInProgress:O,className:"w-full",canContinue:_e,suggestions:at??[],disabled:!!he,disabledReason:he??void 0,canPause:Ae,isInteractableSharedThread:w,autocompletions:l,matchaData:d,requiresFileUpload:c,onComposerInput:p,onComposerChange:te,onAutocompleteSelect:u,headerClassName:m,hideHeader:g,onTaggingDropdownClose:f,onTaggingDropdownOpen:v},t)]})}const cr=He({errorGeneratingResponse:{id:"PromptTextarea.errorGeneratingResponse",defaultMessage:"There was an error generating a response"},regenerateResponse:{id:"PromptTextarea.regenerateResponse",defaultMessage:"Regenerate"}}),fl=i.memo(function(){return e.jsxs("div",{className:`mb-2 flex flex-col gap-2 empty:hidden ${hi.PromptTextareaHeader}`,children:[e.jsx(dl,{}),e.jsx(ul,{})]})}),mv=Object.freeze(Object.defineProperty({__proto__:null,ChatScreenComposerAlerts:fl},Symbol.toStringTag,{value:"Module"}));function Kf({label:t,description:s,icon:o,badge:n,onClick:a,disabled:r=!1}){return e.jsxs("button",{type:"button",disabled:r,onClick:a,className:N("group relative flex min-w-[162px] flex-col items-start gap-2 rounded-[20px] border border-token-border-light py-3 pl-3 pr-4 text-start text-[13px] leading-[18px] transition enabled:hover:bg-token-main-surface-secondary disabled:cursor-not-allowed"),children:[e.jsxs("div",{className:"flex w-full items-center justify-between",children:[o&&e.jsx("div",{className:"mr-2",children:o}),n&&e.jsx("span",{className:"rounded bg-blue-400 px-1 text-[10px] font-semibold text-white",children:n})]}),e.jsxs("span",{className:"block max-w-full select-none font-medium text-token-text-secondary",children:[t,s&&e.jsx("p",{className:"font-normal text-gray-500",children:s})]})]})}function Qf({composerBarButtonInfo:t,systemHintType:s,mobileLayout:o,children:n}){const a=Zi(t.announcementKey,s),r=!o&&a,l=el(t,n);return r?l:n}function Jf(t){const{value:s,isLoading:o}=Fe("2223246572"),n=Fn(t),a=i.useMemo(()=>n.filter(r=>r.suggestedPrompt).sort((r,l)=>(r.suggestedPrompt?.sortOrder??0)-(l.suggestedPrompt?.sortOrder??0)).map(r=>({id:r.systemHint,label:r.suggestedPrompt?.title??"",description:r.suggestedPrompt?.subtitle??"",icon:e.jsx(Rn,{svgString:r.logo,className:"h-[22px] w-[22px]",color:r.suggestedPrompt?.theme??""}),badge:r.suggestedPrompt?.badge,systemHint:r})),[n]);return{replaceStarterPromptsWithToolChips:s,isLoading:o,toolChips:a}}const dr=Ue(()=>Ve(()=>import("./lonirizi613v4ikr.js"),__vite__mapDeps([50,2,4,1,3,5,37,9,10,46,51,52,19,20,17,16,21,22,23,24,25,26])).then(t=>t.SnorlaxSplashScreen)),ho=4;function Xf(){const{layer:t}=gn("4031588851"),s=t.get("autocomplete_qualified_start_date","2099-09-13T00:00:00Z"),o=Pn();return!!o&&o.created*1e3>=new Date(s).getTime()}const po=t=>`${t.title}${t.body}`.toLocaleLowerCase();function Zf(t){const s=dt(t.clientThreadId),o=Es(s);return e.jsx(Wi,{clientThreadId:t.clientThreadId,children:o&&s&&dr?e.jsx(dr,{clientThreadId:t.clientThreadId,gizmoId:s,currentModelId:t.currentModelId,onRequestCompletion:t.onRequestCompletion}):e.jsx(nx,{...t})})}function ex({children:t}){const{store:s}=ze(),[o,n]=i.useState(!1),a=Dn();i.useEffect(()=>a.subscribe("focus",()=>{n(!0)}),[a]),i.useEffect(()=>a.subscribe("blur",()=>{n(!1)}),[a]);const r=s.useSharedProps(),l=!!(r!=null&&r.isShowingAutocomplete);return t(l&&o)}function tx({isSendBlocked:t,clientThreadId:s,headlineOption:o,shouldShowStarterPrompts:n,promptChips:a,onSelectStarterPrompt:r,starterPromptExpanded:l,setStarterPromptExpanded:d,replaceStarterPromptsWithToolChips:c,toolChips:p,onSelectToolChip:h,selectedHint:u,isToolChipsLoading:m}){const g=Or();return e.jsx(ex,{children:f=>e.jsx(ee.div,{initial:{opacity:0},animate:{opacity:f?0:1},exit:{opacity:0},transition:{duration:.1},className:N("h-full flex-col text-token-text-primary [display:var(--display-hidden-until-loaded,flex)]",{"mt-[var(--screen-optical-compact-offset-amount)] flex-shrink items-center justify-center overflow-hidden":!c},f?"pointer-events-none":"",g?"@lg/thread:hidden":"lg:hidden"),children:c?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"h-full"}),e.jsx("div",{className:"mx-[-12px]",children:e.jsx(Sl,{toolChips:p,onSelectToolChip:h,disabled:t,mobileLayout:!0,selectedHint:u})})]}):e.jsxs(e.Fragment,{children:[m?null:o==="CHATGPT_LOGO"?e.jsx(Mn,{className:"inline-block h-12 w-12"}):e.jsx(xl,{headlineOption:o}),e.jsx(ee.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:N(!l&&!c&&"h-[116px]"),children:n&&e.jsx(vl,{starterPrompts:a,onSelectStarterPrompt:r,disabled:t,clientThreadId:s,onExpand:()=>d(!0),mobileLayout:!0})})]})})})}function sx(t){const s=Re("1468311859").value,o=Re("3664702598").value,{layer:n}=as("4031588851"),a=Xf(),r=s,l=o&&a;let d="HARDCODED";if(t){const c=n.get("search_autocomplete_mode","");r&&c&&(d=c)}else l&&(d=n.get("autocomplete_mode","HARDCODED"));return d}function nx({clientThreadId:t,currentModelId:s,isModelLoaded:o,onRequestCompletion:n,chatgptHomepageDisclaimer:a}){const r=Dn(),l=Zt(t),d=Ho(),[c,p]=i.useState([]);i.useState([]),i.useRef(0);const[h,u]=i.useState(),m=i.useCallback(U=>{p(Y=>{const se=typeof U=="function"?U(Y):U;return Fr(se,Y)?Y:se})},[]),{trendingSuggestions:g,fetchTrendingSuggestions:f}=ix(ho),v=i.useRef(!1),{isUnauthenticated:j}=ut(),S=Qc(),[M,C]=i.useState(!1),T=Gi(),k=ct();_i(r);const z=Re("589604007").value,{layer:P}=gn("4031588851"),{layer:w}=gn("3533083032"),{replaceStarterPromptsWithToolChips:y,isLoading:I,toolChips:A}=Jf(t),O=sl(r,t),_=tl(r),{prospectiveModelId:x}=Zm(t),K=o?s:x??"auto",{promptStarters:$,isSuccess:D}=Ti(l,t,8,z,!0,K),R=S&&!!c.find(U=>!!U.requires_file_upload),q=i.useCallback(U=>{const Y=r.getCurrentText();return Y&&po(U).startsWith(Y.toLocaleLowerCase())},[r]),G=i.useCallback(U=>{const Y=r.getCurrentText(),se=U.title+U.body;return q(U)?{...U,title:Y,body:se.slice(Y.length)}:{...U,title:se,body:""}},[r,q]),W=i.useCallback((U=!1)=>{m(Y=>!Y.some(q)&&Y.length>0?[]:U?Y:Y.map(G))},[q,G,m]),de=(U,Y,se)=>{const je=U.title;m([]),r.focus(),r.setText(je),requestAnimationFrame(()=>{const Se=($?.filter(xe=>xe.theme===U.theme)??[]).map(xe=>{const Ce=Xt(xe.oneliner),le=Ce.startsWith(xe.title);return{...xe,title:le?`${xe.title} `:"",body:le?xe.body:Ce,autocompletionChunks:If(je,Ce),type:_t.Autocomplete}});m(Se),Se.length>0&&ns(Se,t),sh(U,se,t)})};i.useEffect(()=>{const U=c.some(Y=>Y.theme===wo.Search);T&&r.getCurrentText()===""?g.length>0?m(g):f():U&&!T&&m(Y=>Y.filter(se=>se.theme!==wo.Search))},[c,T,g,f,r,m]),i.useEffect(()=>{T&&r.getCurrentText()===""&&g.length>0&&ns(g,t)},[T,r,g,t]);const ue=$?.reduce((U,Y)=>(Y.theme&&!U[Y.theme]&&(U[Y.theme]=Y),U),{}),ye=[];if(ue)for(const U in ue)U!=="For you"&&ye.push(ue[U]);const Me=ye&&ye.length>0,pe=!!(D&&Me&&o&&!y);Ze.markStart("StarterPromptChips",Ze.NS_COMPOSER),pe&&Ze.markRendered("StarterPromptChips",Ze.NS_COMPOSER);const te=ho-c.filter(q).length,me=sx(T),_e=j?w.get("headline_option","HELP_WITH"):P.get("headline_option","HELP_WITH"),Ae=P.get("autocomplete_min_char",4),ge=P.get("autocomplete_fetch_interval",200),fe=i.useRef(null),Pe=i.useCallback(Ai(async U=>{const Y=r.getCurrentText();if(!Y||Y.length<Ae||Y.length>80||r.hasMultipleLines()){m([]);return}if(!v.current&&!(fe.current&&fe.current.length>Ae&&Y.startsWith(fe.current)))try{const se=j?await rs.generateAutocompletionsAnon(Y,U,T):await rs.generateAutocompletions(Y,U,T);if(se.completions.length===0){fe.current=Y;return}const je=se.completions.map(Se=>({id:vd(),type:_t.Autocomplete,title:Se.slice(0,Y.length),body:Se.slice(Y.length),oneliner:Se,prompt:Se,source:me})).filter(q).map(G);m(Se=>{const xe=Se.filter(q),Ce=je.filter(le=>{const Ke=po(le);return!xe.some(mt=>{const ht=po(mt);if(Ke===ht)return!0;const qt=/[\p{P}\p{S}]$/u,St=Ke.replace(qt,""),bt=ht.replace(qt,"");return St===ht||Ke===bt||St===bt})}).slice(0,ho-xe.length);return[...xe,...Ce]}),je.length>0&&ns(je,t)}catch{}},me==="BING"?150:ge),[r,me,G,ge]);Sn(U=>U.files);const Be=Ps().has(J.Research),at=Be&&!1,H=i.useCallback(()=>{W(),te>0&&Pe(te)},[Pe,W,te]);i.useEffect(()=>{v.current&&m([])},[v,m]);const he=i.useMemo(()=>me==="HARDCODED"?W:H,[me,H,W]),Ge=!1,Wt=i.useCallback(()=>{he()},[he,Ge,at,m]),Ie=i.useCallback(()=>{r instanceof ia&&W(!0),r.getCurrentText().indexOf(`
`)>0&&(m([]),u(void 0))},[r,m,W,Ge,at]),Ye=i.useCallback((U,Y,se)=>{Y.forEach(je=>{je.id===U.id&&(je.userInput=r.getCurrentText())}),m([Y[se]])},[r,m]),re=cs(),Ne=Or();return e.jsx(e.Fragment,{children:e.jsx(nt,{children:e.jsxs("div",{className:N("h-full w-full",Ne?"@lg/thread:py-[18px]":"lg:py-[18px]",!1),children:[e.jsx(oa,{isStaticSharedThread:!1,verticalPadding:"none",horizontalPadding:"standard",clientThreadId:t,fullHeight:!0,children:e.jsxs(Va,{className:"relative",children:[e.jsx("div",{className:N("hidden text-center",re&&"mb-5",!re&&"mb-7",Ne?"@lg/thread:block":"lg:block"),children:_e==="CHATGPT_LOGO"?e.jsx(Mn,{className:"inline-block h-12 w-12"}):e.jsx(xl,{headlineOption:_e,overrideMessage:Be?os.deepResearchPlaceholder:void 0})}),e.jsx(tx,{headlineOption:_e,shouldShowStarterPrompts:pe,promptChips:ye,onSelectStarterPrompt:de,starterPromptExpanded:M,setStarterPromptExpanded:C,isSendBlocked:d,clientThreadId:t,replaceStarterPromptsWithToolChips:y,toolChips:A,onSelectToolChip:O,selectedHint:_,isToolChipsLoading:I}),e.jsx("div",{className:N(Ne?"@lg/thread:absolute @lg/thread:bottom-8 @lg/thread:left-0 @lg/thread:w-full":"[display:var(--display-hidden-until-loaded,block)] lg:absolute lg:bottom-8 lg:left-0 lg:w-full"),children:e.jsx(Va,{className:"relative @lg/thread:pb-0",children:k?e.jsx(fl,{}):e.jsx(cl,{className:"block"})})}),e.jsx("div",{className:"w-full",children:e.jsx(gl,{clientThreadId:t,isNewThread:l,currentModelId:s,onRequestCompletion:n,showPromptStarters:!1,autocompletions:c,matchaData:h,requiresFileUpload:R,onComposerInput:Wt,onComposerChange:Ie,onAutocompleteSelect:Ye,onTaggingDropdownClose:()=>{v.current=!1},onTaggingDropdownOpen:()=>{v.current=!0},hideHeader:!0})}),e.jsxs(ee.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:N("hidden",Ne?"@lg/thread:block":"lg:block",a&&j&&M?"":!y&&"h-[70px]",!y&&re&&"mt-5 min-h-[108px]"),children:[pe&&e.jsx(vl,{starterPrompts:ye,onSelectStarterPrompt:de,disabled:d,clientThreadId:t,onExpand:()=>C(!0)}),y&&e.jsx(Sl,{toolChips:A,onSelectToolChip:O,disabled:d,selectedHint:_})]}),a&&e.jsx("div",{className:N("w-full translate-y-4 px-2 py-2 text-center text-xs text-token-text-secondary empty:hidden xs:translate-y-8 md:px-[60px]",Ne?"@lg/thread:absolute @lg/thread:bottom-0 @lg/thread:left-0":"lg:absolute lg:bottom-0 lg:left-0"),children:e.jsx("div",{className:N("min-h-4"),children:a})})]})}),!1]})})})}function xl({headlineOption:t,overrideMessage:s}){const n=oe().formatMessage(s??(lx[t]||os.whatCanIHelpWith)),a=At(),r=cs(),l=e.jsxs("div",{className:"grid min-h-[74px] grid-cols-1 items-center justify-end",children:[e.jsx("h1",{className:N("flex h-full items-end justify-center [grid-area:1/1] motion-safe:[transition:0.3s_transform_var(--spring-standard),0.5s_opacity_var(--spring-standard),0.5s_visibility_var(--spring-standard)]",r&&"text-[28px] font-semibold leading-[34px] tracking-[0.38px]",a?"invisible -translate-y-full opacity-0":"translate-y-0 opacity-100"),"aria-hidden":a,children:n}),e.jsx("div",{className:N("flex h-full flex-col items-center justify-end [grid-area:1/1] motion-safe:[transition:0.3s_transform_var(--spring-standard),0.5s_opacity_var(--spring-standard),0.5s_visibility_var(--spring-standard)]",a?"translate-y-0 opacity-100":"invisible translate-y-full opacity-0"),"aria-hidden":!a,children:e.jsx(Ni,{})})]});return e.jsxs("div",{className:"relative inline-flex justify-center text-center text-2xl font-semibold leading-9",children:[r&&e.jsx("div",{style:{viewTransitionName:"var(--vt-splash-screen-headline)"},children:l}),!r&&e.jsx("h1",{style:{viewTransitionName:"var(--vt-splash-screen-headline)"},children:n})]})}function ox({starterPrompt:t,starterPrompts:s,index:o,disabled:n,onSelectStarterPrompt:a}){const r=t.theme??t.title,l=Bn(),{mutate:d}=nh(),c=t.category==="onboarding"?()=>{d({key:Xe.hasUsedConversationalOnboardingStarterPrompt}),l(t,s,o)}:()=>a(t,s,o);return e.jsx(Ei,{disabled:n,onClick:c,icon:e.jsx(oh,{category:t.category,useV2Colors:!0}),label:r})}function ur({clientThreadId:t,onClick:s}){i.useEffect(()=>{ah(t)},[t]);const o=oe();return e.jsx(ee.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3,ease:"easeOut"},className:"inline-block",children:e.jsx(Ei,{onClick:()=>{rh(t),s()},label:o.formatMessage(os.moreStarterPrompts)})})}const ax=5,rx=3;function vl({starterPrompts:t,onSelectStarterPrompt:s,disabled:o,clientThreadId:n,onExpand:a,mobileLayout:r=!1}){const l=r?rx:ax,[d,c]=i.useState(l),[p,h]=i.useState(!1),u=i.useRef(null),m=t.length<=d;i.useEffect(()=>{ns(t.slice(0,l),n)},[n]),i.useEffect(()=>{if(!p&&!m&&u.current){const f=u.current,v=f.getBoundingClientRect(),j=v.width,S=Array.from(f.children);let M=0;for(let C=0;C<S.length&&S[C].getBoundingClientRect().right-v.left<=j;C++)M++;c(M),h(!0)}},[t,m,p]);const g=()=>{const f=t.slice(d,t.length).map(v=>({...v,isAdditional:!0}));f.length>0&&ns(f,n),c(t.length),a()};return e.jsxs("div",{className:N("mt-5 flex items-center justify-center gap-x-2 transition-opacity xl:gap-x-2.5",p&&t.length>0?"opacity-100":"opacity-[0.01]",r?"flex-wrap":"flex-nowrap"),children:[e.jsxs("ul",{className:N("relative flex items-stretch gap-x-2 gap-y-4 overflow-hidden py-2 sm:gap-y-2 xl:gap-x-2.5 xl:gap-y-2.5",m||r?"flex-wrap justify-center":"flex-nowrap justify-start"),ref:u,children:[t.slice(0,d).map((f,v)=>e.jsx(ee.li,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3,ease:"easeOut"},children:e.jsx(ox,{starterPrompt:f,starterPrompts:t,index:v,disabled:o,onSelectStarterPrompt:s})},f.id??v)),r&&t.length>d&&e.jsx(ur,{clientThreadId:n,onClick:g})]}),!r&&t.length>d&&e.jsx(ur,{clientThreadId:n,onClick:g})]})}function Sl({toolChips:t,onSelectToolChip:s,disabled:o,mobileLayout:n=!1,selectedHint:a}){const r=Jc(),l=cs(),d=!r&&l;return e.jsx("div",{className:N("mt-5 min-h-[108px] gap-x-2 transition-opacity xl:gap-x-2.5",t.length>0?"opacity-100":"opacity-[0.01]",{"flex flex-wrap justify-center":!n}),children:e.jsx("ul",{className:N("relative flex gap-3 sm:gap-y-2",!l&&"py-2",{"w-full snap-x snap-proximity flex-nowrap overflow-x-auto scroll-smooth whitespace-nowrap px-3":n},{"flex-wrap justify-start":!n}),children:t.map(({id:c,label:p,description:h,icon:u,systemHint:m,badge:g},f)=>{const v=e.jsx(Kf,{label:p,description:h,icon:u,badge:g,onClick:()=>{m&&s({hint:m,enable:m.systemHint!==a})},disabled:o,mobileLayout:n});return e.jsx(ee.li,{initial:{opacity:d?0:1},animate:d?{opacity:1}:!1,exit:{opacity:0},transition:{type:"spring",stiffness:175,damping:26},className:N({"shrink-0":n}),children:m.composerBarButtonInfo?e.jsx(Qf,{composerBarButtonInfo:m.composerBarButtonInfo,systemHintType:m.systemHint,mobileLayout:n,children:v}):v},c??f)})})})}const ix=t=>{const[s,o]=i.useState([]),n=i.useCallback(async()=>{const r=(await rs.generateTrendingSuggestions(t)).suggestions.map((l,d)=>({type:_t.Trending,title:mr(l),body:"",icon:e.jsx(eh,{}),prompt:mr(l),id:`search-trending-${d}`,theme:wo.Search}));o(r)},[t]);return{trendingSuggestions:s,fetchTrendingSuggestions:n}};function mr(t){return t.split(" ").map(th).join(" ")}const os=He({whatCanIHelpWith:{id:"SplashScreenV2.whatCanIHelpWith",defaultMessage:"What can I help with?"},whereShouldWeStart:{id:"SplashScreenV2.whereShouldWeStart",defaultMessage:"Where should we start?"},askChatgptAnything:{id:"SplashScreenV2.askChatgptAnything",defaultMessage:"Ask ChatGPT anything"},moreStarterPrompts:{id:"SplashScreenV2.moreStarterPrompts",defaultMessage:"More"},deepResearchPlaceholder:{id:"G1v9do",defaultMessage:"What are you researching?"}}),lx={HELP_WITH:os.whatCanIHelpWith,WHERE_TO_START:os.whereShouldWeStart,ASK_CHATGPT:os.askChatgptAnything};function cx({clientThreadId:t,currentModelId:s,isModelLoaded:o,onRequestCompletion:n,showChatgptHomepage:a,chatgptHomepageDisclaimer:r}){const l=At(),d=cs();let c=e.jsx(Pp,{}),p;return l&&!d?(p=e.jsx(Ni,{}),c=e.jsx(Mn,{className:"mb-6 h-12 w-12 brand:hidden"})):t!=null?(p=a?e.jsx(Zf,{clientThreadId:t,currentModelId:s,isModelLoaded:o,onRequestCompletion:n,chatgptHomepageDisclaimer:r}):e.jsx(Ip,{clientThreadId:t}),c=null):p=e.jsx(dx,{}),e.jsxs("div",{className:"flex h-full flex-col items-center justify-center text-token-text-primary",children:[c,p]})}function dx(){return e.jsx("div",{className:"mb-5 text-2xl font-semibold",children:e.jsx(E,{...mx.howCanIHelpYouToday})})}function ux({clientThreadId:t,currentModelId:s,isModelLoaded:o,onRequestCompletion:n,showChatgptHomepage:a,chatgptHomepageDisclaimer:r}){const l=dt(t),d=Ur(),c=Ho(),{data:p}=Gt(l),h=ih(),u=Xc(()=>navigator.windowControlsOverlay);return(d!=null||l!=null)&&p==null?null:e.jsxs("div",{className:"relative h-full",children:[e.jsx("div",{className:u?.visible?N("absolute right-[calc(100dvw-env(titlebar-area-width,100dvw)-env(titlebar-area-x,0))]",h?"left-[env(titlebar-area-x,0)]":"left-0"):"absolute left-0 right-0",children:e.jsx(Qi,{clientThreadId:t})}),p!=null?e.jsx(Rp,{gizmo:p,showStarterPrompts:!0,disableStarterPrompts:c}):e.jsx(cx,{clientThreadId:t,currentModelId:s,isModelLoaded:o,onRequestCompletion:n,showChatgptHomepage:a,chatgptHomepageDisclaimer:r})]})}const mx=He({temporaryChat:{id:"GizmoLanding.temporaryChat",defaultMessage:"Temporary Chat"},temporaryChatBizMemoryAvailable:{id:"g1opBW",defaultMessage:"This chat won't appear in your history and won't use or create memories."},temporaryChatBizMemoryUnavailable:{id:"fQmbtG",defaultMessage:"This chat won't appear your conversation history."},temporaryChatDescriptionMemoryAvailable:{id:"GizmoLanding.temporaryChatDescriptionMemoryAvailable",defaultMessage:"This chat won't appear in history, use or create memories, or be used to train our models. For safety purposes, we may keep a copy for up to 30 days."},temporaryChatDescriptionMemoryUnavailable:{id:"GizmoLanding.temporaryChatDescriptionMemoryUnavailable",defaultMessage:"This chat won't appear in history or be used to train our models. For safety purposes, we may keep a copy of this chat for up to 30 days."},temporaryChatDescriptionGptActions:{id:"GizmoLanding.temporaryChatDescriptionGptActions",defaultMessage:"Any data shared with a third party through GPT actions are subject to the third party's privacy policy. <link>Learn more</link>"},howCanIHelpYouToday:{id:"GizmoLanding.howCanIHelpYouToday",defaultMessage:"How can I help you today?"}}),hx="bg-token-main-surface-primary text-token-text-primary",px="openai",hr=["bg-blue-300 text-white"];function gx(t){return hr[(t?.charCodeAt(0)??0)%hr.length]}const cn=({children:t})=>e.jsx("div",{className:"pt-0",children:e.jsx("div",{className:N(i.isValidElement(t)&&t.type===Mo?"gizmo-bot-avatar":"gizmo-shadow-stroke","flex h-8 w-8 items-center justify-center overflow-hidden rounded-full"),children:t})});function Eo(t){const{messages:s,isUserTurn:o,avatarClassName:n,gizmo:a}=t,r="medium",d=s[0]?.message.metadata?.shared_conversation_id,c=d!=null,p=Pn(),{gizmoEditorData:h,mode:u}=Nn();let m=e.jsx(cn,{children:e.jsx(Mo,{className:n??hx,iconName:px,size:r})});return a?m=e.jsx(cn,{children:e.jsx(Vp,{gizmoId:a.gizmo.id,className:"h-full w-full"})}):h!=null&&u==="test"&&(m=e.jsx(la,{isFirstParty:!1,src:h.profilePictureUrl,className:"h-8 w-8 first:pt-[3px]"})),e.jsx("div",{className:void 0,children:o?c?e.jsx(cn,{children:e.jsx(Mo,{className:gx(d),iconName:"user",size:r})}):e.jsx(cn,{children:e.jsx(lh,{user:p,size:r})}):m})}function fx({modelSlug:t,animateModelLabelOnRender:s,isDropdownOpen:o,isRegenerateEnabled:n,isHovered:a,animateShortLabel:r}){const{data:l}=Nt(),[d,c]=i.useState("initial");i.useEffect(()=>{if(s){const m=setTimeout(()=>c("show"),500),g=setTimeout(()=>c("initial"),2e3);return()=>{clearTimeout(m),clearTimeout(g)}}c("initial")},[s]);const{shorterLabel:p}=l?.categories.find(({defaultModel:m})=>m===t)??{},h={initial:{opacity:0,paddingLeft:0,width:"0"},show:{opacity:1,paddingLeft:2,width:"100%"},visible:{opacity:1,paddingLeft:2,width:"100%",transition:{delay:0,duration:0}}},u=o?"visible":a?"show":d;return e.jsxs(ee.div,{initial:"initial",animate:u,className:"flex items-center pb-0",children:[e.jsx(Ri,{className:"icon-md"}),(n||r)&&e.jsx(ee.span,{className:"overflow-hidden text-clip whitespace-nowrap text-sm",variants:h,transition:{type:"tween",duration:.18},children:p}),n&&e.jsx(Qo,{className:"icon-sm"})]})}function Ro(t,s){const{modelSwitcherDeny:o,subscriptionLevel:n}=t;return!!o&&o.reason===Zc.RATE_LIMIT&&n===ed.PLUS&&!s}const dn="rounded-lg radix-disabled:pointer-events-auto radix-disabled:cursor-not-allowed";function xx({className:t,clientThreadId:s,message:o,onModelSelect:n,onDropdownChange:a,canRegenerateResponse:r}){const[l,d]=i.useState(null),[c,p]=i.useState(!1),[h,u]=i.useState(!1),m=dt(s),g=ch({clientThreadId:s,message:o}),f=o.message.metadata?.model_slug,v=o.message.id,{modelOptions:j,modelSlug:S,animateModelLabelOnRender:M,messageModelEnabledTools:C}=g,T=dh(o.message),k=C.includes(J.Search),z=i.useMemo(()=>j.find(_=>_.value===f),[j,f]),P=i.useRef(null),{data:w=null}=Io(),y=w&&Er(w),I=_=>{_||setTimeout(()=>{P.current&&P.current.blur()},10)};if(i.useEffect(()=>{I(c)},[c]),ie(s,mh))return null;const O=r&&j.some(_=>Ro(_,y));return m?null:e.jsxs(X.Root,{onOpenChange:_=>{r&&(p(_),a(_),I(_)),_&&F.logEvent(B.conversationOpenMessageModelSelector,{has_get_plus_button:O,is_new_regen_dropdown:!0})},children:[r?e.jsx(Sx,{label:e.jsx(E,{id:"wDs5sz",defaultMessage:"Switch model"}),children:e.jsx(Lo,{ref:P,className:N("cursor-pointer",t),onMouseEnter:()=>u(!0),onMouseLeave:()=>u(!1),children:e.jsx(fx,{modelSlug:S,animateModelLabelOnRender:M,isDropdownOpen:c,isRegenerateEnabled:r,isHovered:h})})}):null,r&&e.jsx(X.Portal,{children:e.jsxs(X.Content,{className:"z-30 min-w-fit origin-top-right text-token-text-primary",side:"bottom",align:"start",children:[e.jsx(X.Item,{disabled:!0,className:"pb-0 pt-2",children:e.jsx("span",{className:"text-token-text-secondary",children:e.jsx(E,{id:"bFLh5u",defaultMessage:"Switch model"})})}),e.jsx(vx,{clientThreadId:s,messageId:v,onModelSelect:n,messageModelSlug:f,modelOptions:j,setHoveredOption:d,hoveredOption:l,retryOption:z,lastResponseUsedSearch:T,modelSupportsSearch:k,doesUserHaveAnyAccountsWithPlusFeatures:y})]})})]})}function vx({clientThreadId:t,messageId:s,modelOptions:o,messageModelSlug:n,onModelSelect:a,setHoveredOption:r,hoveredOption:l,retryOption:d,lastResponseUsedSearch:c,modelSupportsSearch:p,doesUserHaveAnyAccountsWithPlusFeatures:h}){const u=oe(),[m,g]=i.useMemo(()=>ks(o,S=>S.subcategory),[o]),f=i.useMemo(()=>{const S=new Map;return m.forEach(M=>{const C=M.subcategory;C&&(S.has(C)||S.set(C,[]),S.get(C)?.push(M))}),S},[m]),v=N("icon-sm","order-10 ml-auto text-token-text-tertiary icon-md"),j=[{key:"use-search",extraStreamParams:{forceUseSearch:!0},label:u.formatMessage(go.search),icon:e.jsx(fi,{className:v}),condition:p&&!c,eventName:"chatgpt_regenerate_with_search_button_clicked"},{key:"use-no-search",extraStreamParams:{forceUseSearch:!1},label:u.formatMessage(go.nosearch),icon:e.jsx(uh,{className:v}),condition:p&&c,eventName:"chatgpt_regenerate_without_search_button_clicked"}];return e.jsxs(e.Fragment,{children:[g.map(S=>{const{value:M,...C}=S;return e.jsx(nn,{value:M,onSelect:()=>{we.logEvent("chatgpt_regenerate_switch_model_button_clicked",M,{requestedModelId:M,...lt({clientThreadId:t,messageId:s})}),a({requestedModelId:M})},includeRegenerate:!1,onMouseEnter:()=>r(M),onMouseLeave:()=>r(null),isHovered:l===M,messageModelSlug:n,includeCheck:!1,shouldShowUpsell:Ro(S,h),className:dn,...C,icon:e.jsx("span",{className:v})},M)}),[...f.entries()].map(([S,M])=>e.jsxs(X.Sub,{children:[e.jsx(X.SubMenuTrigger,{children:e.jsx("div",{className:"flex grow justify-between gap-2 overflow-hidden",children:S})}),e.jsx(X.Portal,{children:e.jsx(X.SubContent,{className:"min-w-fit",children:M.map(C=>{const{value:T,...k}=C;return e.jsx(nn,{value:T,onSelect:()=>{we.logEvent("chatgpt_regenerate_switch_model_button_clicked",T,{requestedModelId:T,...lt({clientThreadId:t,messageId:s})}),a({requestedModelId:T})},includeRegenerate:!1,onMouseEnter:()=>r(T),onMouseLeave:()=>r(null),isHovered:l===T,messageModelSlug:n,includeCheck:!1,className:dn,...k,icon:null,shouldShowUpsell:Ro(C,h)},S+"-"+T)})})})]},S)),!!d&&e.jsxs(e.Fragment,{children:[e.jsx(X.Separator,{}),e.jsx(nn,{onSelect:()=>{we.logEvent("chatgpt_regenerate_try_again_button_clicked",d.value,{requestedModelId:d.value,...lt({clientThreadId:t,messageId:s})}),a({requestedModelId:d.value})},includeRegenerate:!0,onMouseEnter:()=>r(d.value),onMouseLeave:()=>r(null),messageModelSlug:n,includeCheck:!1,className:dn,...d,label:u.formatMessage(go.tryAgain),subtitle:d.label,icon:e.jsx(Ri,{className:v})},d.value),j.filter(S=>S.condition).map(S=>e.jsx(nn,{onSelect:()=>{we.logEvent(S.eventName,d.value,{requestedModelId:d.value,...lt({clientThreadId:t,messageId:s})}),a({requestedModelId:d.value,extraStreamParams:S.extraStreamParams})},includeRegenerate:!1,onMouseEnter:()=>r(S.key),onMouseLeave:()=>r(null),isHovered:l===S.key,messageModelSlug:n,includeCheck:!1,className:dn,...d,label:S.label,subtitle:"",icon:S.icon},S.key))]})]})}function Sx({children:t,label:s}){return e.jsx(Ut,{label:s,sideOffset:0,children:t})}const go=He({tryAgain:{id:"VbsBGW",defaultMessage:"Try again"},search:{id:"eTV6j1",defaultMessage:"Search the web"},nosearch:{id:"IvLzUk",defaultMessage:"Without web search"}}),bx=i.memo(xx),pr=Ue(()=>Ve(()=>import("./fc2hzad6rtrm7s5f.js").then(t=>t.tk),__vite__mapDeps([4,1,2,3,5])).then(t=>t.MemoryActionResult));function gr(t,s,o){zr.updateTree(t,n=>{n.updateNodeMetadata(s,{inlineComparisonRating:o})})}const fr=({messages:t})=>{for(const{message:{metadata:s}}of t){const{augmented_paragen_prompt_label:o}=s??{};if(o)return o}};function yx(t){const s=i.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null}),o=i.useRef({left:null,right:null});return t.stubSideBySideFeedback?e.jsx(bl,{setPreferredFeedback:()=>{},leftVariantId:"left-placeholder",rightVariantId:"right-placeholder",leftTurn:null,rightTurn:null,originalTurn:null,hasActiveRequest:!0,visibilityStateRef:s,firstVisibleTokenTimestampsRef:o,...t}):e.jsx(jx,{...t,visibilityStateRef:s,firstVisibleTokenTimestampsRef:o})}function jx(t){const{clientThreadId:s,variantIds:o,turnIndex:n,firstVisibleTokenTimestampsRef:a}=t;if(o.length!==2)throw new Error("ConversationTurnSideBySideFeedback requires exactly two variant IDs");const r=pa(),l=Go(),d=td(),[c,p]=i.useMemo(()=>Pi(o.join(""))()<.5?[0,1]:[1,0],[o[0],o[1]]),h=c<p?"left":"right",u=h==="left"?"right":"left",m=o[c],g=o[p],[f,v]=ie(s,P=>[Xt(P).tree.getLeafFromNode(m).id,Xt(P).tree.getLeafFromNode(g).id]),j=Xt(yo(s,n,f)),S=Xt(yo(s,n,v)),M=h==="left"?j:S,C=h==="left"?S:j,T=r?"skippable_parallel_2_in_stream:a:2.0":"skippable_parallel_2_in_stream:a:1.5";i.useEffect(()=>($a.setState({displayingSideBySideFeedback:!0}),()=>{$a.setState({displayingSideBySideFeedback:!1})}),[]),hh();const k=i.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null});i.useEffect(()=>sd(nd,{requestCompletion:()=>{const P=Tt(s),y=Z.getTree(tt(s)).getParentPromptNode(f),I=[j,S].map((_,x)=>({messageId:_.messages[_.messages.length-1].message.id,loadFirstTokenTime:x===0?a.current.left:a.current.right,loadEndTime:ws(_.messages)?.completionSampleFinishTime})),A={},O=y.metadata?.variantsInStreamInfo==null&&y.message.metadata?.paragen_variants_info!=null;for(const _ of I)A[_.messageId]=O?{load_first_token_time:t.conversationTurnMountTime,load_end_time:t.conversationTurnMountTime}:{load_first_token_time:_.loadFirstTokenTime,load_end_time:_.loadEndTime};jr({params:{conversation_id:P,displayed_message_ids:I.map(_=>_.messageId),message_metadatas:A,rating:"skipped",selected_message_id:null,source_timestamp:Date.now(),ui_variant:r?2:1,user_prompt_message_id:y.message.id}})}}),[j,S,f,s,t.conversationTurnMountTime,T,u,M?.messages,C?.messages,d,r,a]);const z=P=>{const w=Z.getTree(tt(s)),y=w.getLeafFromNode(P);zr.setThreadCurrentLeafId(s,y.id);const I=P===m,A=I===(h==="left");M.messages.length>0&&gr(s,M.messages[M.messages.length-1].nodeId,A?"original":"new"),C.messages.length>0&&gr(s,C.messages[C.messages.length-1].nodeId,A?"original":"new");const O=Tt(s),_=[j,S].map((R,q)=>({messageId:R.messages[R.messages.length-1].message.id,loadFirstTokenTime:q===0?a.current.left:a.current.right,loadEndTime:ws(R.messages)?.completionSampleFinishTime})),x=I?_[0].messageId:_[1].messageId,K=w.getParentPromptNode(f),$={},D=K.metadata?.variantsInStreamInfo==null&&K.message.metadata?.paragen_variants_info!=null;for(const R of _)$[R.messageId]=D?{load_first_token_time:t.conversationTurnMountTime,load_end_time:t.conversationTurnMountTime}:{load_first_token_time:R.loadFirstTokenTime,load_end_time:R.loadEndTime};jr({params:{conversation_id:O,displayed_message_ids:_.map(R=>R.messageId),message_metadatas:$,rating:"selected",selected_message_id:x,source_timestamp:Date.now(),ui_variant:r?2:1,user_prompt_message_id:K.message.id}})};return e.jsx(bl,{...t,setPreferredFeedback:z,leftVariantId:m,rightVariantId:g,leftTurn:j,rightTurn:S,hasActiveRequest:l,originalTurn:M,visibilityStateRef:k})}function bl({setPreferredFeedback:t,leftVariantId:s,rightVariantId:o,leftTurn:n,rightTurn:a,hasActiveRequest:r,originalTurn:l,visibilityStateRef:d,...c}){const{defaultParagenLabel:p,shouldShowParagenLabels:h=!1}=di(),u=n&&fr(n)||p,m=a&&fr(a)||p,g=i.useMemo(()=>n?.messages??[],[n?.messages]),f=i.useMemo(()=>a?.messages??[],[a?.messages]),{avatarClassName:v,firstVisibleTokenTimestampsRef:j}=c,S=i.useMemo(()=>jn(g),[g]),M=i.useMemo(()=>jn(f),[f]),C=li(),T=Ot(n?fn.getRequestIdFromConversationTurn(n):""),k=Ot(a?fn.getRequestIdFromConversationTurn(a):""),z=n?.role===st.User,P=a?.role===st.User,w=i.useRef(null),y=i.useRef(null),I=i.useRef(null),A=!!c.stubSideBySideFeedback,O=!!c.stubSideBySideFeedback;!A&&j.current.left==null&&(j.current.left=Date.now()),!O&&j.current.right==null&&(j.current.right=Date.now()),i.useEffect(()=>{if(w.current&&y.current&&I.current){const D=Array(11).fill(0).map((q,G)=>G/10),R=new IntersectionObserver(q=>q.forEach(G=>{G.target===y.current?(d.current.left_visibility_initial==null&&(d.current.left_visibility_initial=G.intersectionRatio),d.current.left_visibility_max=Math.max(d.current.left_visibility_max??0,G.intersectionRatio)):G.target===I.current&&(d.current.right_visibility_initial==null&&(d.current.right_visibility_initial=G.intersectionRatio),d.current.right_visibility_max=Math.max(d.current.right_visibility_max??0,G.intersectionRatio))}),{root:w.current,threshold:D});return R.observe(y.current),R.observe(I.current),()=>R.disconnect()}},[d]);const{data:_}=ci(void 0,!1,C),x=pa(),K=e.jsx("div",{className:"text-pretty px-6 pb-5 pt-1 text-center text-sm text-token-text-secondary",children:e.jsx(E,{id:"TK934w",defaultMessage:"Which response do you prefer? Responses may take a moment to load."})}),$=ct();return e.jsxs("div",{className:"relative flex flex-col",children:[e.jsxs("div",{className:N("sticky z-[1] text-pretty bg-token-main-surface-primary px-6 text-center text-lg",$&&"top-[var(--thread-leading-height)] pt-3",!$&&"top-[-1px]",x&&!$?"md:top-header-height":$?"":"md:static"),"data-testid":"paragen-feedback-title",children:[e.jsx(E,{id:"JgCHDY",defaultMessage:"You’re giving feedback on a new version of ChatGPT."}),x?K:null]}),x?null:K,e.jsx("div",{className:"relative -mb-2 snap-x snap-mandatory overflow-x-auto px-3 pb-4 md:px-5 lg:px-10",ref:w,children:e.jsx("div",{className:N(!$&&"min-w-fit"),children:e.jsxs("div",{className:N("mx-auto flex max-w-6xl items-start",x&&!$&&"divide-x divide-token-border-medium dark:divide-token-border-heavy",!x&&!$&&"gap-4 sm:gap-6",x&&$&&"divide-x divide-token-border-medium dark:divide-token-border-heavy",$&&!x&&"gap-4 sm:gap-6"),children:[e.jsxs(xr,{horizontalScrollContainerRef:w,rootElementRef:y,onClick:()=>{t(s)},hasActiveRequest:r,isWaitingOnFirstUserVisibleToken:A,children:[e.jsxs(br,{children:[e.jsx(Eo,{messages:g,isUserTurn:z,avatarClassName:v}),e.jsx(Sr,{children:h?e.jsx("span",{className:"font-bold text-token-text-primary",children:u}):e.jsx(E,{...Cr.responseNumber,values:{responseIndex:1}})})]}),x&&A?e.jsx(vr,{}):e.jsxs(e.Fragment,{children:[_!=null&&!z&&e.jsx(pr,{clientThreadId:c.clientThreadId,messages:g,isParagen:!0}),e.jsx(To,{...c,allMessages:g,groupedMessagesToRender:S,allGroupedMessages:S,isEditing:!1,isUserTurn:z,isCompletionRequestInProgress:T,hasActiveRequest:r,handleEnterEdit:Zs,handleExitEdit:Zs,shouldGrowContainer:!1,showEditButton:!1,showCopyButton:!1}),e.jsx(yr,{clientThreadId:c.clientThreadId,conversationTurnMountTime:c.conversationTurnMountTime,turn:n,originalTurn:l})]})]}),e.jsxs(xr,{horizontalScrollContainerRef:w,rootElementRef:I,onClick:()=>{t(o)},hasActiveRequest:r,isWaitingOnFirstUserVisibleToken:O,children:[e.jsxs(br,{children:[e.jsx(Eo,{messages:f,isUserTurn:P,avatarClassName:v}),e.jsx(Sr,{children:h?e.jsx("span",{className:"font-bold text-token-text-primary",children:m}):e.jsx(E,{...Cr.responseNumber,values:{responseIndex:2}})})]}),x&&O?e.jsx(vr,{}):e.jsxs(e.Fragment,{children:[_!=null&&!P&&e.jsx(pr,{clientThreadId:c.clientThreadId,messages:f,isParagen:!0}),e.jsx(To,{...c,allMessages:f,groupedMessagesToRender:M,allGroupedMessages:M,isEditing:!1,isUserTurn:P,isCompletionRequestInProgress:k,hasActiveRequest:r,handleEnterEdit:Zs,handleExitEdit:Zs,shouldGrowContainer:!1,showEditButton:!1,showCopyButton:!1}),e.jsx(yr,{clientThreadId:c.clientThreadId,conversationTurnMountTime:c.conversationTurnMountTime,turn:a,originalTurn:l})]})]})]})})})]})}function xr({horizontalScrollContainerRef:t,rootElementRef:s,onClick:o,children:n,hasActiveRequest:a,isWaitingOnFirstUserVisibleToken:r}){const l=pa(),d=ct(),{scrollX:c}=Sd({layoutEffect:!1,container:t,target:s}),p=ph(),h=gh(),u=i.useRef(null),m=i.useRef(null),g=i.useRef(null),[f,v]=i.useState(!1),[j,S]=i.useState(!1),[M,C]=i.useState(!1),[T,k]=i.useState(0);i.useEffect(()=>{if(!l)return;const O=new IntersectionObserver(_=>{for(const x of _)x.target===u.current?v(x.isIntersecting):x.target===g.current?C(x.isIntersecting):x.target===m.current&&S(x.isIntersecting)},{root:p?.current,rootMargin:d?`0px 0px -${T}px 0px`:void 0});return u.current&&m.current&&g.current&&(O.observe(u.current),O.observe(m.current),O.observe(g.current)),()=>{O.disconnect()}},[T,l,d,p]);const z=!M&&(j||f),P=bd(c,O=>z?-1*O:0),w=Oa(0);i.useEffect(()=>{if(!l)return;const O=new ResizeObserver(_=>{on(_.length===1,"entryList.length === 1");const x=_[0];on(x.contentBoxSize.length===1,"item.contentBoxSize.length === 1"),w.set(x.contentBoxSize[0].inlineSize)});return s.current&&O.observe(s.current),()=>{O.disconnect()}},[l,w,s]);const y=Oa(0);i.useEffect(()=>{if(!l)return;const O=new ResizeObserver(_=>{on(_.length===1,"entryList.length === 1");const x=_[0];on(x.contentBoxSize.length===1,"item.contentBoxSize.length === 1"),y.set(x.contentBoxSize[0].blockSize+16),k(x.contentBoxSize[0].blockSize)});return h.current&&O.observe(h.current),()=>{O.disconnect()}},[l,y,h]);const I=e.jsx(ft,{className:l?"px-5":"mt-4 self-start",onClick:o,"data-testid":"paragen-prefer-response-button",children:e.jsx(E,{id:"U2EAH6",defaultMessage:"I prefer this response"})}),A=r;return e.jsxs("div",{"data-paragen-root":!0,className:N("relative flex w-full min-w-[min(450px,80vw)] snap-center flex-col gap-1 text-left",d&&l&&"pl-3 pr-5 sm:w-[calc(100cqw-62px)] sm:pl-3 sm:pr-5 md:px-10",!d&&l&&"px-10",l?"min-h-60 py-4":"rounded-2xl border border-token-main-surface-tertiary bg-white p-5 dark:bg-gray-700"),ref:s,children:[e.jsx("div",{className:N("absolute left-0 right-0 top-48 h-px","invisible"),ref:u}),e.jsx("div",{className:N("absolute bottom-0 left-0 right-0 top-48","invisible"),ref:m}),e.jsx("div",{className:N("absolute bottom-0 left-0 right-0 h-px","invisible"),ref:g}),n,l?e.jsx("div",{className:"flex-1"}):null,l?e.jsx("div",{className:"mt-4 min-h-10",children:A?null:e.jsx(ee.div,{style:{translateX:P,width:w,bottom:y},animate:{opacity:100},initial:{opacity:0},transition:{ease:"easeOut",duration:.2,delay:.5},className:N({fixed:z,"z-20 flex w-full justify-center":!0}),children:I})}):a?null:I]})}function vr(){return e.jsxs("div",{className:"flex w-full flex-col gap-4 pb-5 pt-3",children:[e.jsx(Ht,{className:"h-4 w-[75%]"}),e.jsx(Ht,{className:"h-4 w-[50%]"}),e.jsx(Ht,{className:"h-4 w-[80%]"}),e.jsx(Ht,{className:"h-4 w-[55%]"}),e.jsx(Ht,{className:"h-4 w-[66%]"}),e.jsx(Ht,{className:"h-4 w-[64%]"}),e.jsx(Ht,{className:"h-4 w-[48%]"})]})}function pa(){const{layer:t}=as("3119715334");return t.get("should-enable-hojicha",!1)}const Sr=Oe.div`text-sm text-token-text-secondary font-semibold`,br=Oe.div`flex gap-4 items-center mb-1`,Ht=Oe.div`animate-pulse rounded-[4px] bg-token-main-surface-tertiary`;function yr({clientThreadId:t,conversationTurnMountTime:s,turn:o,originalTurn:n}){const a=na();if(!a.showParagenMetadata||!a.showDebugConversationTurns&&!a.forceParagen||o==null)return null;let r=o===n?"ORIGINAL":"NEW";const l=o.messages[o.messages.length-1],d=l?.message?.metadata?.__internal;if(d){const{model_id:u,model_definition_slug:m,model_definition_virtual_model_id:g,alternative_model_selection_rule:f,augmented_paragen_prompt_group_id:v,augmented_paragen_prompt_id:j,augmented_paragen_prompt:S}=d;u&&(r+=`
Model ID: ${u}`),m&&(r+=`
Model Slug: ${m}`),g&&(r+=`
Virtual Model ID: ${g}`),f&&(r+=`
Alternative Model Rule: ${f}`),v&&(r+=`
Prompt Group ID: ${v}`),j&&(r+=`
Prompt ID: ${j}`),S&&(r+=`
Prompt: ${S}`)}r+=`
Message ID: ${l.message.id}`;const p=Z.getTree(tt(t)).getParentPromptNode(o.variantIds[0]),h=p.metadata?.variantsInStreamInfo==null&&p.message.metadata?.paragen_variants_info!=null;return r+=`
User prompt message ID: ${p.message.id}`,r+=`
Is Persisted Paragen? ${h}`,r+=`
Completion Sample Finish Time: ${h?`${s} (persisted)`:ws(o.messages)?.completionSampleFinishTime}`,e.jsx("div",{className:"whitespace-pre-wrap text-sm text-red-500",children:r})}async function jr({params:t}){await rs.submitParagenSelectionV2(t)}const Cr=He({responseNumber:{id:"ConversationTurnTwoUpFeedback.responseNumber",defaultMessage:"Response {responseIndex, number}"}});function Cx({handleShowRetrievalResults:t,clientThreadId:s,turnIndex:o,responseComplete:n=!1}){const[a,r]=ie(s,h=>[Z.getTurnContentReferences(h,o),Gr(h?.conversationTurns[o]?.messages??[])]),l=i.useMemo(()=>({turnIndex:o,clientThreadId:s,responseComplete:n}),[s,n,o]),d=i.useRef(!1);i.useEffect(()=>{d.current||(d.current=!0,F.logEvent(B.fileSourcesFooterShown,l))},[l]);const c=i.useCallback(()=>{F.logEvent(B.fileSourcesFooterClicked,l),t()},[t,l]),p=i.useMemo(()=>{const h=new Set,u=[];function m(f){!f||h.has(f)||(h.add(f),u.push(f))}if(a.forEach(f=>{f.type==="file"?m(f.cloud_doc_url??f.extra?.cloud_doc_url):f.type==="file_navlist"&&f.items.forEach(v=>{m(v.cloud_doc_url)})}),n){for(const f of r)if(fh(f.message)){const v=xh(f.message.content.result),j=f.message.metadata?.cloud_doc_urls??[],S=v.chunks;for(let M=0;M<S.length;M++){const C=S[M];if(!C.documentId)continue;if(M<j.length){m(j[M]);continue}const T=C.documentId.endsWith("--google")?C.documentId.split("--")[1]:void 0,k=C.metadata.cloud_doc_url??(T?`https://drive.google.com/file/d/${T}`:void 0);m(k?.toString())}break}}const g=[];for(let f=0;f<u.length;f++){const v=u[f],j=vh(v);if(j&&g.push(j.Icon),g.length>=3)break}return g},[r,a,n]);return e.jsxs(e.Fragment,{children:[e.jsx(ee.div,{className:"absolute h-[60px]",initial:{opacity:0},animate:{opacity:1},children:e.jsxs("button",{className:N("not-prose group/footnote mb-2 mt-3 flex w-fit items-center gap-1.5 rounded-xl border border-token-border-light bg-token-main-surface-primary py-2 hover:bg-token-main-surface-secondary","pl-3 pr-2.5"),onClick:c,children:[e.jsx("div",{className:"flex items-center gap-0.5 text-sm font-medium",children:e.jsx(E,{id:"/48IOP",defaultMessage:"Sources"})}),p.length>0&&e.jsx("div",{className:"flex flex-row-reverse gap-1",children:p.reverse().map((h,u)=>e.jsx(ee.div,{className:N("flex items-center overflow-hidden rounded-full border-token-main-surface-primary bg-token-main-surface-primary","group-hover/footnote:border-token-main-surface-secondary","relative"),initial:{opacity:0},animate:{opacity:1},children:e.jsx(h,{className:"icon-md"})},u))})]})}),e.jsx("div",{className:"h-[60px]"})]})}function wx({clientThreadId:t,followups:s,analyticsMetadata:o}){const[n,a]=i.useState(null),r=sa.useIsEnabled(t);return e.jsxs(e.Fragment,{children:[e.jsx(_x,{visible:n==="conversation"}),e.jsx(Ax,{visible:n==="global"}),r&&s.length>0&&e.jsx(Mx,{clientThreadId:t,followups:s,analyticsMetadata:o,setDisableMessage:a})]})}function Mx({clientThreadId:t,followups:s,setDisableMessage:o,analyticsMetadata:n}){const a=Bn(),r=i.useRef(!1);return i.useEffect(()=>{r.current||(r.current=!0,s.forEach(l=>{F.logEventWithStatsig(B.messageFollowupAction,"chatgpt_message_followup_action",{...lt(n),action:"shown",followupText:pn(l)})}))},[s,n]),e.jsxs("div",{className:"group",children:[e.jsxs("div",{className:"mb-1 flex items-center text-sm font-semibold",children:[e.jsx(E,{id:"3UFIQc",defaultMessage:"Follow up"}),e.jsx(Tx,{clientThreadId:t,setDisableMessage:o,analyticsMetadata:n})]}),e.jsx("div",{children:s.slice(0,4).map((l,d)=>e.jsx(ee.div,{initial:{opacity:0,translateY:4},animate:{opacity:1,translateY:0},transition:{delay:d*.03},exit:{opacity:0,translateY:4},children:e.jsx(kx,{followUp:l,onSelectingSuggestedReply:a,isLastItem:d===s.length-1,analyticsMetadata:n})},d))})]})}function kx({followUp:t,onSelectingSuggestedReply:s,isLastItem:o,analyticsMetadata:n}){return e.jsxs(ee.button,{whileHover:"hover",className:"flex w-full items-start gap-2",onClick:()=>{s(t,[],0),F.logEventWithStatsig(B.messageFollowupAction,"chatgpt_message_followup_action",{...lt(n),action:"clicked",followupText:pn(t)})},onMouseEnter:()=>{F.logEventWithStatsig(B.messageFollowupAction,"chatgpt_message_followup_action",{...lt(n),action:"hovered",followupText:pn(t)})},children:[e.jsx(ee.div,{className:"flex w-6 items-center justify-center pt-3.5 opacity-70",variants:{hover:{x:4}},initial:{x:0},transition:{duration:.1},children:e.jsx(Sh,{className:"h-4 w-4 text-token-text-secondary"})}),e.jsx("div",{className:N("flex-1 gap-0.5 border-b border-token-border-xlight py-2.5 pr-2 text-left",o&&"border-b-0"),children:pn(t)})]})}function Tx({clientThreadId:t,setDisableMessage:s,analyticsMetadata:o}){const n=sa.useStore(),[a,r]=i.useState(!1);return e.jsxs(_s,{size:"small",onOpenChange:l=>r(l),contentClassName:"min-w-[200px]",triggerButton:e.jsx("button",{className:"ml-2 flex h-6 w-6 items-center justify-center rounded-md text-token-text-tertiary hover:bg-token-main-surface-tertiary focus:outline-none focus:ring-0",children:e.jsx(ji,{className:N("h-4 w-4 opacity-0 group-hover:opacity-100",a&&"opacity-100")})}),children:[e.jsx(X.Item,{onClick:()=>{n.setDisabledConversation(t,!0),s("conversation"),setTimeout(()=>s(null),3e3),F.logEventWithStatsig(B.messageFollowupAction,"chatgpt_message_followup_action",{...lt(o),action:"disable_conversation"})},className:"text-token-text-primary",children:e.jsx(E,{id:"GZYofd",defaultMessage:"Hide for this chat"})}),e.jsx(X.Item,{onClick:()=>{n.setDisabledGlobally(!0),s("global"),setTimeout(()=>s(null),5e3),F.logEventWithStatsig(B.messageFollowupAction,"chatgpt_message_followup_action",{...lt(o),action:"disable_globally"})},className:"text-token-text-primary",children:e.jsx(E,{id:"dtAOq4",defaultMessage:"Hide everywhere"})})]})}const yl={initial:{opacity:1},animate:{opacity:1},exit:{opacity:0,transition:{duration:.2}}};function _x({visible:t}){return e.jsx(nt,{children:t&&e.jsx(ee.div,{...yl,className:"flex justify-center py-6 text-sm text-token-text-tertiary",children:e.jsx(E,{id:"ckTD9g",defaultMessage:"Follow ups are turned off for this conversation"})})})}function Ax({visible:t}){return e.jsx(nt,{children:t&&e.jsxs(ee.div,{id:"disableForAllConvos",...yl,className:"flex flex-col items-center py-3 text-sm",children:[e.jsx("div",{children:e.jsx(E,{id:"5GDIBQ",defaultMessage:"Follow up have been turned off"})}),e.jsx("div",{className:"pt-1 text-token-text-tertiary",children:e.jsx(E,{id:"LYaBNe",defaultMessage:"You can re-enable them in settings"})})]})})}const wr=[1,2,3,4,10,20,30],Nx=.5;function Ex({clientThreadId:t}){const s=Ii(Fi.isBusinessWorkspace),o=i.useRef(!1),n=zt(t),a=ie(t,y=>y?.mode),{isUnauthenticated:r}=ut(),l=i.useMemo(()=>{if(!n)return-1;const y=Pi(n);return y()>Nx?-1:wr[Math.floor(y()*wr.length)]},[n]),d=od(t),c=d[d.length-1],p=i.useMemo(()=>fn.getRequestIdFromConversationTurn(c),[c]),h=Ot(p),[u,m]=i.useState(null),[g,f]=i.useState(!1),[v,j]=i.useState(!1),[S,M]=i.useState(!1),C=y=>{const I=ws(d)?.messages[0]?.message.id;m(y),z(I,y)},T=d.filter(y=>y.role===st.Assistant).length,k=c?.role===st.Assistant,z=i.useMemo(()=>Ai((y,I)=>{n&&y&&rs.submitConversationRating({conversation_id:n,message_id:y,rating:I,shown_at_assistant_turn:l}),F.logEvent(B.conversationRatingSubmitted,{rating:I,showAtAssistantTurn:l,conversationId:n}),f(!0),setTimeout(()=>{j(!0)},1500)},2e3),[n,l]),P=T!==l||h||!k||!!s||a?.kind!==Le.PrimaryAssistant||S||r;i.useEffect(()=>{!P&&!o.current&&(F.logEvent(B.conversationRatingShown,{showAtAssistantTurn:l,conversationId:n}),o.current=!0)},[P]);const w=bh();return S||!w.forceShowConvoRating&&P?null:e.jsxs("div",{className:"mx-auto",children:[e.jsx(nt,{children:g&&!v&&e.jsx(ee.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:e.jsx(Mr,{$padded:!0,children:e.jsx("span",{className:"text-sm text-token-text-tertiary",children:e.jsx(E,{id:"rating.thanks",defaultMessage:"Thanks for your feedback!"})})})},"submitted")}),!g&&e.jsx(ee.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.1},children:e.jsxs(Mr,{$padded:!1,children:[e.jsxs("div",{className:"flex items-center justify-center gap-4 px-4 py-3 text-sm text-token-text-secondary",children:[e.jsx(E,{id:"rating.instructions",defaultMessage:"Is this conversation helpful so far?"}),e.jsxs("div",{className:"flex items-center gap-5",children:[e.jsx(fo,{$selected:u==="thumbsUp",onClick:()=>C("thumbsUp"),children:e.jsx(Bi,{className:"icon-md"})}),e.jsx(fo,{$selected:u==="thumbsDown",onClick:()=>C("thumbsDown"),children:e.jsx(Di,{className:"icon-md"})})]})]}),e.jsx("div",{className:"w-px flex-1 self-stretch bg-token-main-surface-tertiary"}),e.jsx(fo,{className:"p-3",$selected:!1,onClick:()=>M(!0),children:e.jsx(ad,{className:"icon-md text-token-text-secondary hover:text-token-text-primary"})})]})},"rating")]})}const fo=Oe.button`
  ${t=>t.$selected?"text-token-text-primary":"text-token-text-secondary"}
  hover:text-token-text-primary
`,Mr=Oe.div`inline-flex rounded-xl border border-gray-100 dark:border-gray-700
${t=>t.$padded&&"py-3 px-4"}
`,Rx=Ue(()=>Ve(()=>import("./niehzmi6s4ycdcrr.js"),__vite__mapDeps([53,2,1,3,4,5,54])));function Px({clientThreadId:t,canShowInlineMessageFeedback:s,messageForRating:o,allGroupedMessages:n,currentModelId:a}){let r=null;const l=ie(t,u=>{const m=Z.getConversationTurns(u);let g=0;for(let f=m.length-1;f>=0;f--){const v=m[f];if(v.messages.some(j=>j.message.metadata?.is_indepth_feedback))return!0;if(v.messages.some(j=>j.message.author.role===st.Assistant)&&g++,g>=3)break}return!1}),d=zt(t),c=Xo(u=>u.voiceFeedbackThread),p=d===c,{voiceName:h}=yh();return l?null:(p&&d?(rd.feedbackShown.success({voice:h}),r=e.jsx("div",{className:"text-center",children:e.jsx(jh,{serverThreadId:d})})):o.rating&&s?r=e.jsx(Rx,{clientThreadId:t,conversationMessage:o,allGroupedMessages:n,currentModelId:a}):r=e.jsx("div",{className:"text-center",children:e.jsx(Ex,{clientThreadId:t})}),e.jsx("div",{className:"mt-3 w-full empty:hidden",children:r}))}const Ix=Ue(()=>Ve(()=>import("./7nzpgz11uruugbbu.js"),__vite__mapDeps([55,2,1,3,56,57,4,5,58,59,60])).then(t=>t.VoicePlayButton)),Fx=Ue(()=>Ve(()=>import("./gr2fdg6s9o78t8hz.js"),__vite__mapDeps([61,2,4,1,3,5,62,63])).then(t=>t.AutomationSourceHeader)),Bx=Ue(async()=>Promise.resolve(()=>null)),kr=80,Dx=16,Tr={minHeight:`calc(100dvh - ${Li}px - ${Vh}px - 120px)`};function Lx(t){const{turnIndex:s,isFinalTurn:o,clientThreadId:n,onChangeRating:a,currentModelId:r,avatarClassName:l,showAvatar:d,scrollToMessageId:c,dateHeaderType:p}=t,h=oe(),u=Pn();ls()?.normalizedAccountUserId;const m=!!u&&id(u),g=Fo(),f=Ii(Fi.isBusinessWorkspace),v=As(),j=aa(),{value:S}=Re("1760640904"),{value:M}=Re("1456513860"),C=d??!M,k=null!=null,{value:z}=Re("1887864177"),P=Cp(),w=Tt(n),y=Xt(yo(n,s)),{messages:I,variantIds:A,variantsInStreamInfo:O}=y,_=jn(I),x=Ch(),K=ws(I);let $=K;for(const L of _){const ce=Yp(L);if(ce.some(it=>x.has(it.message.id))){$=ce[ce.length-1];break}}const D=K!==$,R=I.slice(0,$?I.indexOf($)+1:0),q=i.useMemo(()=>({clientThreadId:n,turnIndex:s,messageId:K?.message.id}),[n,s,K?.message.id]),G=!1,W=kn(),[de,ue]=i.useState(!1),[ye,Me]=i.useState(!1),pe=A.findIndex(L=>R.some(ce=>ce.nodeId===L)),te=y.role===st.User,me=At(),_e=dt(n),Ae=Gt(y.gizmoId??_e).data,ge=Yo(r),fe=wh(r),Pe=ct(),$e=i.useContext(Uo),Be=zo($e),[ae,at,H,he,Ge,Wt]=ie(n,L=>{const ce=L?.tree!=null&&A.some(it=>{const Xn=L.tree.getLeafFromNode(it);return L.tree.getHasErrorFromNode(Xn.id)});return[L?.async_status===Hr.STREAMING,Z.isMessageTurnEnded(L),ce,$h(Gr(L?.mode),Ae?.gizmo.id),L?.continuingFromSharedConversationId!=null,null]});let Ie="default";const Ye=R.some(L=>L.message.content.content_type===ld.MultimodalText),{layer:re}=as("1547743984"),Ne=w&&W&&re.get("show_share_button_inline",!1),vt=null,{isUnauthenticated:U}=ut(),[Y,se]=i.useState(!1),[je,Se]=i.useState(!1),xe=y.messages.map(L=>L.message.id),Ce=i.useRef(null),le=I[I.length-1],Ke=le.rating,mt=(c?.length??0)>2&&c!=="finalAgentTurn"&&o&&j,ht=()=>{R.length===1&&(F.logEvent(B.editPrompt,{id:R[0].message.id,threadId:Tt(n)}),we.logEvent("chatgpt_edit_prompt"),ue(!0))},qt=i.useCallback(()=>{ue(!1)},[]),St=i.useCallback(L=>{Mh(n,s,v,L)},[n,s,v]),bt=L=>{a({nodeId:le.nodeId,messageId:le.message.id,rating:L}),F.logEvent(L==="thumbsDown"?B.messageFeedbackThumbsDownClicked:B.messageFeedbackThumbsUpClicked,{id:le.message.id,threadId:Tt(n),model:r,rating:L}),Me(!0)},[be]=i.useState(()=>Date.now()),ne=kh(n),yt=i.useMemo(()=>fn.getRequestIdFromConversationTurn(y),[y]),ke=Ot(yt)&&!at,Ln=Go(),Hn=jn(R),Et=i.useRef(!1),Is=Th(n,K);i.useEffect(()=>{if(Et.current||c===void 0||!j||!Ce.current){c==="finalAgentTurn"&&o&&js(n,L=>{L.scrollToMessageId=void 0});return}(xe.includes(c)||c==="finalAgentTurn"&&o)&&(Et.current=!0,requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(Ce.current)if(c==="finalAgentTurn"&&o)Ce.current.scrollIntoView({behavior:"instant",block:"end"}),js(n,L=>{L.scrollToMessageId=void 0});else{const L=Ce.current.offsetHeight;let ce;L>kr?ce=kr-L:ce=0,Ce.current.style.scrollMarginTop=`${ce+Dx+Li}px`,Ce.current.scrollIntoView({behavior:"smooth"})}})}))},[c,Ce.current]);const{showDebugConversationTurns:De}=na(),Vt=wi(),Rt=_h(n,K),Fs=qi({clientThreadId:n,conversationMode:he}),ds=i.useCallback(({requestedModelId:L,systemMessage:ce,extraStreamParams:it})=>{Fs({nodeId:le.nodeId,requestedModelId:L,systemMessage:ce,extraStreamParams:it})},[le,Fs]),jt=!g&&!Ge&&!me&&!te,us=Ah(),Qe=$?.message.author.role===st.Assistant?$.message:null,ms=$?.message.metadata?.system_hints?.includes(J.Research);Nh({isCompletionRequestInProgress:ke,isUserTurn:te,message:Qe});const{isOpen:Bs}=wp(),pt=ui(),Pt=Eh(he),Ds=!us&&!Pt&&jt&&o&&O?.num_variants_in_stream===2&&!le.inlineComparisonRating&&!H,hs=Rh(y),Ct=Ds,$t=Ds&&!hs,Yt=!D&&!te&&!g&&!Ge&&!Pt&&!ae&&!ke&&!Bs&&!k&&!ne,Ls=o&&!ke&&!Ge&&!g&&(z||P),rt=Yt&&(!f||fe||m)&&!Pt&&!U&&!me&&!K?.message.metadata?.b1de6e2_s,It=!g&&!((ke||ae)&&o)&&A.length>1&&!de&&!Ct&&!k,Hs=te&&R.length===1&&Ph(R[0])?.shouldHideContent,Os=te&&!Pt&&!g&&!Ye&&R.length===1&&!Hs&&!de&&!U&&!k&&!ms,On=i.useCallback(L=>{js(n,ce=>{const it=Z.getTree(ce).getLeafFromNode(A[L]);Lr.setCurrentLeafId(ce,it.id)}),F.logEvent(B.changeNode,{intent:"toggle_between"})},[n,A]),Un=Ih(y,R,De),{toggleThreadSidebar:Us}=cd(),We=i.useMemo(()=>y.messages.length?y.messages[y.messages.length-1].nodeId:void 0,[y.messages]),zs=i.useCallback(()=>{We&&Us({type:"retrievalResults",clientThreadId:n,turnIndex:s,messageId:We})},[We,Us,n,s]),{value:Ft}=Re("2912660649"),Kt=i.useMemo(()=>Ft&&Fh(y,ge,!!_e),[Ft,ge,_e,y]);if(!Un&&!Ct)return mt?e.jsx("div",{style:Tr}):null;const zn=$?.message.metadata?.followup_prompts?$.message.metadata.followup_prompts.map(L=>({text:L,type:_t.Reply})):[],Gn=R.some(({message:L})=>dd.getAudioAssetPointers(L).length>0),Wn=R.some(({message:L})=>{const[ce]=L.author.name?.split(".")??[];return ce===Do.T2UAY3K}),ps=!ke&&R.some(({message:L})=>L.author.role===st.Assistant&&L.metadata?.onboarding?.main_usages),Bt=R.find(({message:L})=>!!L.metadata?.onboarding?.examples)?.message.metadata?.onboarding?.examples,Gs=Gn?null:Wn?e.jsx(Bx,{message:le,onModelSelect:ds}):e.jsx(bx,{className:"h-[30px] rounded-md px-1 text-token-text-secondary hover:bg-token-main-surface-secondary",clientThreadId:n,message:le,onModelSelect:ds,onDropdownChange:se,canRegenerateResponse:Rt}),Dt=!Hs&&(!te||!de)&&(!o||!ke),qe=S&&Dt,Ws=Dt?e.jsx(Yh,{onClick:St}):null,$n=!te&&(!o||!ke)&&(le.disclaimers??[]).length===0&&le.nodeId?e.jsx(Ix,{conversationId:n,message:le,iconClassName:"icon-md",className:"gap-1.5 rounded-md p-1 text-xs text-token-text-tertiary hover:text-token-text-primary"}):null,Yn=Is&&e.jsx(Kh,{turn:y}),Kn=rt&&!ke?e.jsxs("div",{className:"flex",children:[Ke!=="thumbsDown"&&e.jsx(mo,{onClick:()=>bt("thumbsUp"),disabled:Ke==="thumbsUp",icon:Ke==="thumbsUp"?Bh:Bi,label:h.formatMessage({id:"ConversationTurn.goodResponseTooltip",defaultMessage:"Good response"}),testId:"good-response-turn-action-button"},`thumbsUp:${le.nodeId}`),Ke!=="thumbsUp"&&e.jsx(mo,{onClick:()=>bt("thumbsDown"),disabled:Ke==="thumbsDown",icon:Ke==="thumbsDown"?Dh:Di,label:h.formatMessage({id:"ConversationTurn.badResponseTooltip",defaultMessage:"Bad response"}),testId:"bad-response-turn-action-button"},`thumbsDown:${le.nodeId}`)]}):null,qs=Ne&&e.jsx(mo,{onClick:()=>{Ms.openSharingModal(w)},label:h.formatMessage({id:"ConversationTurn.shareButtonTooltip",defaultMessage:"Share conversation"}),className:"sm:hidden",icon:Lh});function Qn(L){return Pe?L:e.jsx(oa,{clientThreadId:n,isStaticSharedThread:g,verticalPadding:Ie,horizontalPadding:Ct?"none":Be||C?"standard":"expanded",children:L})}const Vs=!Ct;function Jn(L){return Pe?L:e.jsx(yn,{shouldRemoveGap:k,children:L})}return Vt&&!k&&!o&&y.messages.every(({message:L})=>!ud(L))?null:e.jsxs(e.Fragment,{children:[e.jsx(Hh,{dateHeaderType:p,turn:y}),e.jsxs("article",{className:N("w-full text-token-text-primary focus-visible:outline-2 focus-visible:outline-offset-[-4px]",c==="finalAgentTurn"&&j?"opacity-0":""),style:mt?Tr:void 0,ref:Ce,dir:"auto","data-testid":`conversation-turn-${s}`,"data-scroll-anchor":o,onMouseEnter:()=>Se(!0),onMouseLeave:()=>Se(!1),children:[e.jsx(Oh,{role:y.role}),Qn(e.jsx(e.Fragment,{children:Ct?e.jsx(yx,{isFeedbackEnabled:rt,variantIds:A,conversationTurnMountTime:be,stubSideBySideFeedback:$t,...t}):Jn(e.jsxs(e.Fragment,{children:[G,!te&&!G&&C&&e.jsx(Ox,{children:e.jsx(Eo,{messages:R,isUserTurn:te,avatarClassName:l,gizmo:Ae})}),e.jsx("div",{className:N("group/conversation-turn relative flex w-full min-w-0 flex-col",!te&&Uh,Vs&&"@xs/thread:px-0 @sm/thread:px-1.5 @md/thread:px-4"),children:e.jsx("div",{className:"flex-col gap-1 md:gap-3",children:e.jsxs(e.Fragment,{children:[null,!te&&!g&&e.jsx(zh,{messages:R,clientThreadId:n,gizmoId:Ae?.gizmo.id}),pt&&!te&&e.jsx(Fx,{clientThreadId:n,messages:R}),e.jsx(To,{allMessages:I,groupedMessagesToRender:Hn,allGroupedMessages:_,...t,isEditing:de,isUserTurn:te,isCompletionRequestInProgress:ke,isFeedbackEnabled:rt,isFinalTurn:o,hasActiveRequest:Ln,showEditButton:Os,showCopyButton:qe,handleEnterEdit:ht,handleExitEdit:qt}),ge&&!Ft&&e.jsx("div",{className:"mb-4",children:e.jsx(Gh,{messages:R})}),Kt&&e.jsx(Cx,{handleShowRetrievalResults:zs,clientThreadId:n,turnIndex:s,responseComplete:!(ke||ae)}),ps&&e.jsx(Qp,{clientThreadId:n}),Bt&&Bt.length>0&&!ke&&e.jsx(Jp,{clientThreadId:n,examples:Bt}),(Yt||It)&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:N("mb-2 flex gap-3 empty:hidden",te?"mr-1 flex-row-reverse":"-ml-2"),children:e.jsx(Wh,{alwaysShow:o,showInline:o||It,isHovered:je||Y,pagination:It&&e.jsx(qh,{showInline:o||It,currentPage:pe,onChangeIndex:On,length:A.length,className:N("self-center",A.length>1?"visible":"!invisible")}),actions:Yt&&e.jsxs(e.Fragment,{children:[Ws,Kn,$n,Yn,qs,vt,Gs]})})}),o&&!ke&&e.jsx(Px,{canShowInlineMessageFeedback:ye,clientThreadId:n,messageForRating:le,allGroupedMessages:_,currentModelId:r})]}),Ls&&e.jsx(wx,{followups:zn,clientThreadId:n,analyticsMetadata:q})]})})})]}))}))]})]})}const Hx=Wo.memo(Lx),Ox=Oe.div`flex-shrink-0 flex flex-col relative items-end`;function Ux({onChangeRating:t,onRequestCompletion:s,clientThreadId:o,hideHeader:n,scrollContainerRef:a}){const[r,l,d,c,p]=ie(o,W=>[W?.mode,Z.getConversationTurns(W).length,Z.getThreadData(W).isArchived,W?.conversationOrigin===md.APPLE,W?.scrollToMessageId]),h=ze(),u=Oo(),m=aa(),g=Qh(),[f]=Jh(),v=Xh(),[j]=Zh(),S=ls(),M=En(o),C=h.store.useContentAreaDimensions(is.Header,W=>W?.height?W.height:void 0),T=h.store.useIsHeaderContentAreaPopulated(),k=ep(M.id),z=r?.kind===Le.GizmoMagicCreate?"bg-token-main-surface-primary text-token-text-primary":k,P=tp(),[w,y]=i.useState(0),[I,A]=i.useState(!1);i.useEffect(()=>{u&&(w===0?y(l):!I&&l>w&&(A(!0),we.logEvent("chatgpt_continue_conversation_first_message_sent"),F.logEvent(B.continueConversationFirstMessageSent)))},[l,w,I,u]),i.useEffect(()=>{u&&(we.logEvent("chatgpt_continue_conversation_page_loaded"),F.logEvent(B.continueConversationPageLoaded),we.logEvent("chatgpt_conversation_share_page_loaded"),F.logEvent(B.sharedConversationPageLoaded))},[u]);const O=i.useCallback(()=>{g({behavior:"smooth"})},[g]),[_,x]=i.useState(!1),K=m&&_||!m&&!f,$=sp(o),D=P&&!d,R=i.useRef(null),q=np(o),G=(W,de,ue,ye)=>[...new Array(de-W).keys()].map(Me=>{const pe=Me+W;return e.jsx(Hx,{isFinalTurn:ue(pe),turnIndex:pe,clientThreadId:o,onChangeRating:t,onRequestCompletion:s,currentModelId:M.id,avatarClassName:z,scrollToBottom:O,scrollToMessageId:ye,dateHeaderType:q(pe),showAvatar:void 0},pe)});return e.jsxs("div",{onCopy:$,className:N("flex flex-col text-sm",D&&"pb-[120px]",C||D?null:"md:pb-9"),style:{paddingBottom:D?void 0:C},children:[!n&&S?.data&&e.jsx(Qi,{clientThreadId:o}),u&&e.jsxs(e.Fragment,{children:[e.jsx(yn,{children:e.jsx("p",{className:"text-xs text-gray-500",children:e.jsx(E,{id:"threadLayout.sharedConversationCopyDisclaimer",defaultMessage:"This is a copy of a conversation between ChatGPT & Anonymous."})})}),l-w===0&&e.jsx("div",{className:"text-center text-xs font-semibold text-token-text-primary",children:e.jsx("button",{onClick:()=>{Ms.openModal(op.ReportConversation),we.logEvent("chatgpt_conversation_share_report_content_clicked",null,{location:"Static Shared Thread Page"}),F.logEvent(B.sharedConversationReportContentClicked,{location:"Dynamic Shared Thread Page"})},children:e.jsx(E,{id:"thread.reportSharedConversation",defaultMessage:"Report content"})})}),G(0,w,W=>W===w-1,p),e.jsx(yn,{children:e.jsxs("p",{className:"flex items-center text-xs text-gray-500",children:[e.jsx(ap,{className:"icon-xs mr-2"}),e.jsx(E,{id:"threadLayout.sharedConversationPrivateDisclaimer",defaultMessage:"Messages beyond this point are only visible to you"})]})}),G(w,l,W=>W===l-1,p)]}),!u&&G(0,l,W=>W===l-1,p),m&&a?.current&&e.jsx(Rr,{setIsScrolledToEdge:x,options:{root:a?.current,threshold:0,rootMargin:"0%"}},"threadBottomEdgeScrollObserver"),e.jsx("div",{ref:R}),c&&f&&!j&&e.jsx(_r,{className:N("translate-y-[10px] md:translate-y-[30px]"),onClick:()=>{we.logEvent("chatgpt_thread_scroll_to_top"),v({behavior:"smooth"})},children:e.jsx(rp,{className:"icon-md text-token-text-primary"})}),e.jsx(nt,{children:K&&e.jsx(ee.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.15,ease:"easeInOut"},children:e.jsx(_r,{className:N(C?null:"bottom-5",D?T?"translate-y-[-50px]":"translate-y-[-10px]":""),style:{bottom:P?"calc(var(--composer-bar_footer-current-height) + var(--composer-bar_current-height))":C},onClick:()=>{we.logEvent("chatgpt_thread_scroll_to_bottom"),m?R.current?.scrollIntoView({behavior:"smooth",block:"end"}):g({behavior:"smooth"})},children:e.jsx(ip,{className:"icon-md text-token-text-primary"})})})})]})}const _r=Oe.button`cursor-pointer absolute z-10 rounded-full bg-clip-padding border text-token-text-secondary border-token-border-light right-1/2 translate-x-1/2 bg-token-main-surface-primary w-8 h-8 flex items-center justify-center`,zx=60,Gx=({children:t,scrollViewClassName:s,scrollAnchorTopOffset:o=0})=>{const n=i.useRef(null);return e.jsx("div",{className:"h-full",ref:n,children:e.jsx(wn,{children:e.jsx($p,{className:"h-full",followButtonClassName:"hidden",initialScrollBehavior:"auto",scrollViewClassName:s,scroller:()=>Wx(n,o)?0:1/0,children:t})})})},Wx=(t,s)=>{const o=qx(t.current);if(o==null)return!1;const n=o>s,a=o<s-zx;return!n&&!a};function qx(t){if(!t)return null;const s=t.querySelector('[data-scroll-anchor="true"]');if(!s)return null;const o=s.getBoundingClientRect().top,n=t.getBoundingClientRect().top;return o-n}const Vx=Ue(()=>Ve(()=>import("./l95tqa88v5i9hn0n.js"),__vite__mapDeps([64,1,2,3,4,5,14,65,66,67,68,58,69])).then(t=>t.OpenDebugSidebarButton)),$x=Ue(()=>Ve(()=>import("./k6wx8lqy041mdibl.js"),__vite__mapDeps([70,2,4,1,3,5]))),Yx=Ue(()=>Ve(()=>import("./f3zuoxagz3pyagk9.js"),__vite__mapDeps([71,2,1,3,4,5])).then(t=>t.default)),Ar=He({doNotShareSensitive:{id:"thread.modal.onboarding.title",defaultMessage:"Do not share sensitive materials with this application"},somethingWentWrong:{id:"thread.modal.unrecoverableError.title",defaultMessage:"Something went wrong"},tryAgainLater:{id:"thread.modal.unrecoverableError.description",defaultMessage:"We're sorry, but something went wrong. Please try again later."},resetThread:{id:"thread.modal.unrecoverableError.resetThread",defaultMessage:"Reset thread"},sharedConversationReportConversation:{id:"thread.sharedConversation.report",defaultMessage:"Report conversation"},latencyButton:{id:"thread.latencyButton",defaultMessage:"Latency"},archivedConversationDescription:{id:"thread.archivedConversationDescription",defaultMessage:"This conversation is archived. To continue, please unarchive it first."},unarchiveButton:{id:"thread.unarchiveButton",defaultMessage:"Unarchive"}});function Kx({clientThreadId:t}){const s=qr(),o=zt(t),n=ie(t,Z.getGizmoId),a=async()=>{o&&(await rs.patchConversation(o,{is_archived:!1}),s.invalidateQueries({queryKey:["conversation",t]}),js(o,r=>{r.initialThreadData.isArchived=!1}),jp(s,n))};return e.jsxs("div",{className:"my-6 flex flex-col items-center justify-center gap-4",children:[e.jsx("div",{className:"px-3 text-center text-sm text-token-text-secondary",children:e.jsx(E,{...Ar.archivedConversationDescription})}),e.jsx("div",{children:e.jsx(ft,{disabled:!o,onClick:a,icon:Sp,children:e.jsx(E,{...Ar.unarchiveButton})})})]})}const Qx=function({clientThreadId:t,preRequestCompletion:s,hideHeader:o,hideFooter:n,hideToolsOverlay:a,messagesVerticalAlign:r="top",prependThreadChildren:l,renderEmptyState:d,prefetchSearch:c}){const p=Dr(),{data:h}=Nt(),u=Ns(t),m=Ur(),[g,f,v,j,S,M,C]=ie(t,ae=>[ae?.isLoading,Z.getCurrentLeafId(ae),Z.hasUserMessage(ae),ae?.conversationTurns.length??0,Z.getThreadData(ae).isArchived,ae?.modelId,ae?Z.getGizmoId(ae):m]);hd(t),i.useEffect(()=>{g||(Zt(t)?bo.addTiming("chatgpt.web.chatPage.renderNewConversation"):bo.addTiming("chatgpt.web.chatPage.renderExistingConversation"))},[t,g]);const{setTargetedContent:T}=ki(),k=p?.includes(pd),z=aa(),P=lp(),w=null,y=j>=2,I=Zt(t)&&!y&&hn(u),A=Zt(t)&&!v&&(hn(u)||u?.kind===Le.GizmoTest),_=Mi(h).id,x=M??_,K=!!M,$=Yo(x),D=Cs(h?.models,x),R=cp(t,u),q=Ci();dp(j,t),i.useEffect(()=>{q||T(void 0)},[t,T,q,f]);const G=yd({clientThreadId:t,preRequestCompletion:s}),{caModal:W,onChangeRating:de}=up({clientThreadId:t,currentModelId:x}),ue=mp({clientThreadId:t,handleRequestCompletion:G,prefetchSearchPromise:c}),ye=i.useRef(null),Me=ae=>z?e.jsx(wn,{children:e.jsxs(i.Suspense,{fallback:null,children:[e.jsx(bp,{}),e.jsx("div",{className:"relative h-full",children:e.jsx("div",{className:"flex h-full flex-col overflow-y-auto [scrollbar-gutter:stable]",ref:ye,children:ae})})]})}):e.jsx(Gx,{scrollAnchorTopOffset:o?0:yp,children:r==="bottom"?e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsx("div",{className:"flex-1"}),ae]}):ae});i.useEffect(()=>{document.title=R??"ChatGPT"},[R,w]);const pe=At(),te=cs(),me=i.useContext(Uo),_e=zo(me),Ae=_e,ge=A&&!d&&!C&&!$&&(!pe||te),fe=Oo(),Pe=i.useRef(null),$e=i.useRef(null),Be=i.useMemo(()=>({threadContentScrollContainerElementRef:Pe,footerRootContainerElementRef:$e}),[]);return e.jsxs(Np,{clientThreadId:t,children:[k&&e.jsx($x,{}),e.jsx(hp,{children:R!=null&&e.jsx("title",{children:R})}),e.jsx(gd.Provider,{value:G,children:e.jsxs(pp,{children:[e.jsxs(ng,{noKeyboard:!0,clientThreadId:t,currentModelConfig:D,className:N("composer-parent flex flex-col focus-visible:outline-0",ge?"h-[calc(100%-2rem)]":"h-full"),children:[e.jsx(gp,{value:Be,children:e.jsx(Jx,{ref:Pe,className:_e?"pb-[0.75rem]":"pb-[1.5rem]",children:!g&&!ue?A?d??e.jsx(ux,{clientThreadId:t,currentModelId:x,isModelLoaded:K,onRequestCompletion:G,showChatgptHomepage:ge,chatgptHomepageDisclaimer:Ae?null:ge&&e.jsx(Ya,{clientThreadId:t})}):y?Me(e.jsxs(e.Fragment,{children:[l,e.jsx(Ux,{onChangeRating:de,onRequestCompletion:G,clientThreadId:t,hideHeader:o,scrollContainerRef:ye},t)]})):null:null})}),e.jsx(Xx,{ref:$e,children:S?e.jsx(Kx,{clientThreadId:t}):e.jsxs("div",{children:[!ge&&e.jsx(Vf,{clientThreadId:t,isNewThread:I,showPromptStarters:I||!v,currentModelId:x,onRequestCompletion:G}),!n&&!Ae&&e.jsx("div",{className:"relative w-full px-2 py-2 text-center text-xs text-token-text-secondary empty:hidden md:px-[60px]",children:hn(u)&&!ge&&e.jsx("div",{className:"min-h-4",children:e.jsx(Ya,{clientThreadId:t})})})]})})]}),!a&&!_e&&e.jsxs("div",{className:"group absolute bottom-2 end-2 z-20 flex flex-col gap-1 md:flex lg:bottom-3 lg:end-3",children:[P?e.jsxs(e.Fragment,{children:[e.jsx(Vx,{}),!1]}):null,e.jsx(Yx,{})]}),W,e.jsx(fp,{clientThreadId:t,isStaticSharedThread:!1,isDynamicSharedThread:fe}),e.jsx(xp,{}),e.jsx(vp,{conversationId:t})]})})]})},hv=Wo.memo(Qx),Jx=Oe.div`grow flex-1 overflow-hidden @container/thread translate-y-[2rem] -mt-[2rem]`,Xx=Oe.div`md:pt-0 dark:border-white/20 md:border-transparent md:dark:border-transparent w-full isolate has-[[data-has-thread-error]]:[box-shadow:var(--sharp-edge-bottom-shadow)] has-[[data-has-thread-error]]:pt-2`;export{Hx as C,og as D,ux as E,ng as F,hv as M,gl as P,Zf as S,xg as T,Gx as W,Qi as a,Vf as b,Sg as c,mv as d,sg as g,$i as h,Ki as u};
//# sourceMappingURL=ntdjjw6s1dl31tgb.js.map
