const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/j492ff3c1rtrw6ax.js","assets/hggowi1ggrzb09yc.js","assets/izh0i1dfnf8ev7x1.js","assets/root-ko7rpr3h.css","assets/fc2hzad6rtrm7s5f.js","assets/conversation-small-lgvqkxxm.css","assets/ddzilicy6qtleo90.js","assets/8nxoaz0vb9p890un.js","assets/ozluxx1s2jsn9j26.js","assets/c9ymhpumxb2611xi.js","assets/gq56vmyv6ftpm8ay.js","assets/ki2fnq5gqslif1ka.js","assets/hy4byupilmyf57n0.js","assets/j7xrr4x8o3ssozmz.js","assets/jr1b41w4nuv00isi.js","assets/nn6gjrst5lwozesx.js"])))=>i.map(i=>d[i]);
import{bv as pe,bw as ve,v as Se,fB as Ce,E as Ee,fC as $,Q as E,S as O,P as y,a as b,cc as ye,aK as be,e3 as xe,ar as F,V as Te,s as Ne,X as Re,F as c,I as w,dt as _e,d as D,a0 as Ae,aS as we,U as De}from"./hggowi1ggrzb09yc.js";import{c as Z,r as o,a as W,d as Ie,j as t,L as K}from"./izh0i1dfnf8ev7x1.js";import{q as je,r as ke,aa as M,a8 as X,ab as Oe,ac as Me,ad as ze,ae as ee,af as Pe,ag as Le,ah as Ge,ai as Ue,aj as B,ak as qe,al as He,am as Ve,an as Q,ao as Fe,ap as Ke,aq as Xe,ar as Be,as as Y,at as Qe,au as Ye,av as Je,aw as $e}from"./fc2hzad6rtrm7s5f.js";import{G as te}from"./ddzilicy6qtleo90.js";const Ze=pe(()=>ve(()=>import("./j492ff3c1rtrw6ax.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15])).then(e=>e.GizmoConversationOptionsDropdown)),We=new Date(2024,9,11,0);function J(e){O.checkGate("3922476776")||we.abortAllRequests(),y.logEvent(b.loadThread,{threadId:e})}function et({conversation:e,conversationTitle:d,onOpenChange:m,testId:a,inMainScreen:n=!1}){const r=Z(),{isUnauthenticated:h}=Se(),{eligible:p,markAsViewed:x}=je(ke.ArchiveConversationOnboarding),u=Ce(e.id),[v,T]=o.useState(!1),l=W(),g=Ie(),S=Ee();if(o.useEffect(()=>$(te,{deleteChat:({serverThreadId:i})=>{i===e.id&&T(!0)},archiveChat:async({serverThreadId:i})=>{i===e.id&&(await E.patchConversation(e.id,{is_archived:!0}),M(l,e.gizmo_id),O.logEvent("chatgpt_conversation_archived"),y.logEvent(b.conversationArchived),p&&(S.info(r.formatMessage({defaultMessage:"You can view archived chats in Settings",id:"HistoryGizmoItem.archiveChatOnboarding"}),{duration:10,hasCloseButton:!0}),x()),u&&X(g))}}),[g,S,l,p,e.id,e.gizmo_id,r,u,x]),h)return null;const N=t.jsx(Ze,{conversation:e,onOpenChange:m,inMainScreen:n,children:t.jsx("button",{className:"flex items-center justify-center text-token-text-secondary transition hover:text-token-text-primary radix-state-open:text-token-text-secondary","data-testid":a,"aria-label":r.formatMessage({id:"idEcXk",defaultMessage:"Open conversation options"}),children:t.jsx(Oe,{className:"icon-md"})})});return t.jsxs(t.Fragment,{children:[t.jsx(ye,{label:r.formatMessage({id:"tJPHEQ",defaultMessage:"Options"}),sideOffset:4,side:"top",children:N}),v&&t.jsx(Me,{title:d,handleDelete:()=>{E.patchConversation(e.id,{is_visible:!1}).then(()=>{M(l,e.gizmo_id),O.logEvent("chatgpt_conversation_deleted"),y.logEvent(b.conversationDeleted),be.publish({kind:"deleteConversation",serverThreadId:e.id})}),u&&X(g)},onClose:()=>{T(!1)}})]})}const se=5,tt=3e3;function st({threadId:e}){const d=W(),m=o.useRef(!1),a=o.useRef(null);return o.useEffect(()=>{async function n(){m.current=!0;const r=await $e(e);if(r.async_status===c.UNREAD){M(d,r.gizmo_id),De.initThreadFromServerData(e,r,!0,void 0,!0);return}if(r.async_status!==c.STREAMING)return;const h=r.update_time??0;ee(new Date,new Date(h*1e3))<se?a.current=window.setTimeout(n,tt):E.setConversationStatus(e)}return m.current||(y.logEvent(b.conversationPollingStarted),n()),()=>{a.current&&window.clearTimeout(a.current)}},[d,e]),null}function it({conversation:e,className:d,hideOverflowMenu:m=!1,isActiveInMainWindow:a,isActive:n,elementRef:r,testId:h}){const p=Z(),[x,u]=o.useState(!1),[v,T]=o.useState(!1),[l,g]=o.useState(!1),S=xe(),{value:N}=F("3922476776"),{value:i}=F("232791851"),ae=ze(e.id),{value:f=null,source:R=null}=ae??{},oe=Te(e.id,Ne.getRequestId),C=Re(oe),z=ee(new Date,new Date(e.update_time??0))<se,P=Pe(e.id),ne=e.update_time&&Le(new Date(e.update_time),We),L=f===c.STREAMING&&z,re=i&&!n&&!C&&ne&&!l&&f===c.UNREAD,G=i&&(C||L)&&!l,ie=i&&!a&&P.length>0&&!l,le=i&&!a&&(C||L),ce=i&&f===c.STREAMING&&R===w.SERVER&&!C&&z,I=o.useRef(!1);o.useEffect(()=>{I.current||N&&(async()=>(I.current=!0,n&&f===c.UNREAD&&(R===w.SERVER&&await E.setConversationStatus(e.id),Y(e.id,null)),!n&&R===w.CLIENT&&f===c.UNREAD&&(await E.setConversationStatus(e.id,f),Y(e.id,{value:c.UNREAD,source:w.SERVER})),I.current=!1))()},[N,n,e.id,f,R,C]),o.useEffect(()=>$(te,{editTitle:({serverThreadId:s})=>{(s?s===e.id:a)&&u(!0)}}),[e.id,a]);const j=p.formatMessage({id:"mpXAeu",defaultMessage:"New chat"}),{resolvedTitle:_,isTypingEffect:de}=Ge(e.id,e.title,n),ue=_e(),fe=de&&n&&ue,{data:me}=Ue(),U=e.conversation_template_id!=null?me?.gizmos.find(s=>s.resource.gizmo.id===e.conversation_template_id)?.resource:void 0,q=o.useRef(null),ge=t.jsx("div",{className:D("absolute bottom-0 top-0 inline-flex items-center gap-1.5 pr-2 ltr:right-0 rtl:left-0",a||v?"flex":"invisible can-hover:group-hover:visible"),ref:q,children:t.jsx(et,{conversation:e,conversationTitle:_??e.title,onOpenChange:s=>{T(s),s&&y.logEvent(b.conversationHistoryItemOpenMenu,{conversationId:e.id})},testId:`${h}-options`})}),H=S?Qe:Ye,he=(a||v)&&Je,V=o.useRef(null);return t.jsxs("div",{draggable:B(e.gizmo_id),onDragStart:s=>{if(!B(e.gizmo_id))return;const k=Ae(V.current),A=q.current;A&&(A.style.display="none"),s.dataTransfer.setDragImage(k,k.clientWidth/3,k.clientHeight/2),A&&requestAnimationFrame(()=>{A.style.display=""}),s.dataTransfer.effectAllowed="move",qe({kind:"conversation",conversation:e,gizmoId:e.gizmo_id})},onDragEnd:()=>{He()},ref:V,style:{"--item-background-color":Ve(l,n,v)},className:D(H,"relative screen-arch:bg-transparent",d),onMouseEnter:()=>{g(!0)},onMouseLeave:()=>{g(!1)},children:[S&&t.jsx("div",{className:D(H,he,"pointer-events-none absolute inset-0 group-hover:bg-transparent motion-safe:group-active:scale-[98%] motion-safe:group-active:transition-transform motion-safe:group-active:duration-100")}),ce&&t.jsx(st,{threadId:e.id}),t.jsx(K,{to:Q(e.id,U),onClick:s=>{s.metaKey||s.ctrlKey||a||J(e.id)},onDoubleClick:()=>{u(!0)},ref:r,className:"flex items-center gap-2 p-2 screen-arch:motion-safe:group-active:scale-[98%] screen-arch:motion-safe:group-active:transition-transform screen-arch:motion-safe:group-active:duration-100",style:{maskImage:"var(--sidebar-mask)"},children:t.jsx("div",{className:D("relative grow overflow-hidden whitespace-nowrap",le&&!G&&"loading-shimmer"),dir:"auto",title:_??j,children:fe?t.jsx(Fe,{text:_||j}):_||j})}),x?t.jsx("div",{className:"absolute bottom-0 left-[7px] right-2 top-0 flex items-center bg-token-sidebar-surface-secondary",children:t.jsx(Ke,{conversation:e,onClose:()=>{u(!1)}})}):re?t.jsx(K,{to:Q(e.id,U),onClick:s=>{s.metaKey||s.ctrlKey||a||J(e.id)},children:t.jsx("div",{className:"absolute bottom-0 top-0 flex items-center gap-1.5 pr-2 ltr:right-0 rtl:left-0",children:t.jsx("div",{className:"h-2 w-2 rounded-full bg-blue-selection"})})}):ie?t.jsx("div",{className:"absolute bottom-0 top-0 flex items-center gap-1.5 pr-2 ltr:right-0 rtl:left-0",children:t.jsx(Xe,{task:P[0]})}):G?t.jsx("div",{className:"absolute bottom-0 top-0 flex items-center gap-1.5 pr-2 ltr:right-0 rtl:left-0",children:t.jsx(Be,{size:16,className:"text-token-text-primary"})}):!m&&ge]})}export{et as G,it as H};
//# sourceMappingURL=paq1bye12yp7s2hg.js.map
