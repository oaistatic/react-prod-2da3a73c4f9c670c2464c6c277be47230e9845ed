import{r as h,a_ as Y,h as K,c as $,j as i,av as f,ax as J}from"./izh0i1dfnf8ev7x1.js";import{h$ as Q,i0 as Z,i1 as ee,C as g,i2 as te,hv as se,i3 as ae,dl as oe,i4 as ie,i5 as ne,i6 as re,i7 as ce,du as de,cz as N,i8 as le,i9 as ue,ia as he,ib as M,ic as L,ds as me,v as D,id as pe,ie as fe,ig as ge,u as xe,ih as W,U as F,ii as j}from"./fc2hzad6rtrm7s5f.js";import{gB as E,a3 as O,V as ve,s as k,X as Ce,ew as we,q as Se,gC as be,eG as Te,e3 as U,fX as ye,d as Ie,gD as Ee}from"./hggowi1ggrzb09yc.js";import{L as Ae}from"./hg9mdduuem2pvwuj.js";import{u as _e}from"./bqaw7aag2c6iw58l.js";import{T as Re}from"./ohyflymiror10qd4.js";import{g as Ne}from"./btagl6w1gub4aw61.js";import"./l4ce2zdnnawhaijx.js";import"./bluopupp3hty4d7q.js";import"./iemgi2z64e5uqrv4.js";import"./oyoqdz9lwzk3lgxh.js";import"./knizt02844mv3db5.js";import"./gy64pge8qevmvg7e.js";import"./dxpde14qu5zfq5m7.js";import"./iejjcjl0eek5zfni.js";import"./lb1py1igp6jzrtce.js";import"./8nxoaz0vb9p890un.js";import"./gq56vmyv6ftpm8ay.js";import"./edwitfgce1i7kzg0.js";import"./ab6tyx2xygyb56l3.js";import"./hz86nu26alptyjds.js";import"./fzrn137102spawew.js";import"./d7bvxndom3b3tpj8.js";import"./ca7lq2gyndiywe6g.js";import"./h28ootcilxet47c8.js";import"./c9avu4yfkjav9bdb.js";import"./in3ze5ugryldzaj2.js";import"./lx9hhkuca66lgvof.js";import"./bk8slwxjkdlmxjxm.js";import"./nn6gjrst5lwozesx.js";import"./d60wxt0885pttnzn.js";import"./mesuhiy66f679pn3.js";const P="oai/apps/canmoreSidebarWidth",Me=.25,De=400,V=400;function z(e){return e-De}function y(e,t){return Y(V,z(e),t??Me*e)}function We(){const e=E.useState(E.selectWindowWidth),t=y(e,Q(O.DANGER_SECRET_FOLDERS_ONLY_getItem(P))),a=H(),[s,c]=h.useState(t);h.useEffect(()=>{(s<V||s>z(e))&&c(y(e,s))},[e]);function o(l){c(x=>y(e,x+=l.delta.x))}function d(l){c(l),O.DANGER_SECRET_FOLDERS_ONLY_setItem(P,l)}function n(){const l=y(e,void 0);d(l)}const r=`calc(100vw - ${s}px)`;return a?{chatWidth:s,canvasWidth:e-s,canvasWidthCalc:r,viewportWidth:e,handleDrag:o,handleDoubleClick:n,persist:d}:{chatWidth:0,canvasWidth:e,canvasWidthCalc:"100vw",viewportWidth:e,handleDrag:()=>{},handleDoubleClick:()=>{},persist:()=>{}}}function H(e){const t=E.useState(E.selectWindowWidth);return(e??t)>1e3}const _="sharedCanvas";function Fe(){const[e,t]=K(),a=e.get(_),s=$();h.useEffect(()=>{const c=a&&Z.createRemixTempTextdoc(a,s);if(!c)return;requestAnimationFrame(()=>{ee(c)});const o=new URLSearchParams(e);o.delete(_),t(o);const d=new URL(window.location.href);d.searchParams.delete(_),history.replaceState(null,"",d)},[a,e,t,s])}function je(e,t){let a;return t?.type===g.Textdoc&&(t.textdocId.startsWith(te)||(a={type:"canvas_textdoc",id:t.textdocId})),{...e,messageMetadata:{...e.messageMetadata,open_in_canvas_view:a}}}const G=({isFullScreen:e=!1,clientThreadId:t,focusedObject:a,onClose:s,isAnimating:c=!1,width:o})=>{const{setTargetedContent:d}=se(),n=h.useRef(!1);if(h.useEffect(()=>(n.current&&d(void 0),n.current=!0,()=>{n.current=!1}),[a]),a==null)return null;switch(a.type){case g.Textdoc:return i.jsx(Re,{isFullScreen:e,onClose:s,clientThreadId:t,focusedTextdoc:a,isAnimating:c,width:o});case g.ADAVisualization:return null;case g.Sonic:return!1}},Oe=300,ke=e=>{switch(e?.type){case g.Textdoc:return e.textdocId;case g.Sonic:return e.messageId;default:return null}};function Pe(e,t){const[a,s]=ve(e,p=>[k.getRequestId(p),k.isMessageTurnEnded(p)]),c=Ce(a),o=we(e),d=ae(),n=oe(),[r,l]=h.useMemo(()=>{if(o&&ie(o))return[void 0,null];if(t===!0)return[void 0,null];let p;return!s&&o&&(p=Se(ne(o.messages))),Le({clientThreadId:e,groupedMessage:p,isRequestActive:c,isCanvasOpen:n,latestTextdocId:d})},[s,o,t,e,c,n,d]),x=l!=null,b=ke(l),v=re("canvas");h.useEffect(()=>{if(l&&r&&!be()&&(v(),ce(l,r),l.type===g.Textdoc)){const{textdocId:p}=l,C=Ne(p);de(document.getElementById(C))}},[x,b])}function Le({clientThreadId:e,groupedMessage:t,isRequestActive:a,isCanvasOpen:s,latestTextdocId:c}){switch(t?.type){case N.Canmore:{const[o,d]=t.messages;if(!le(o?.message))break;const n=ue(a,o.message,d?.message??null),r=n.textdocId??c;if(r&&(n.function===he.CreateTextdoc?(n.content??"").length>Oe||n.status===M.WAITING:n.status===M.STREAMING))return[n.messageId,{type:g.Textdoc,textdocId:r}];break}case N.SonicCanvas:break}return[void 0,null]}const Ue=260,I={type:"spring",bounce:.12,duration:.64},Ve={type:"spring",bounce:0,duration:.58},ze=({clientThreadId:e,focusedObject:t,onClose:a})=>{const{chatWidth:s,canvasWidthCalc:c,handleDrag:o,handleDoubleClick:d,persist:n}=We(),r=U(),[l,x]=h.useState(!0),[b,v]=h.useState(!1),p=D(u=>u.activeSidebar),C=pe(({rect:u})=>u),{windowHeight:w,windowWidth:S}=ye(u=>u,{windowWidth:0,windowHeight:0});let m=C??{top:0,left:s,width:S-s,height:w},R=!1;if(C&&(m.top<0||m.top+m.height>w)){R=!0;const u={width:(S-s)*.75,height:w*.75};m={top:w/2-u.height/2,left:(S-s-u.width)/2+s,width:u.width,height:u.height}}if(r){const u=S-m.width-m.left;m={...m,left:-u}}const T=C?.borderRadius,A=fe(),B=A?.history!=null||A?.showChangesAtVersion!=null,q=D(u=>u.isDesktopNavCollapsed);return i.jsxs(i.Fragment,{children:[B&&i.jsx(Ae,{onClick:()=>ge(A.textdocId),zIndexKey:"chatOverlay"}),i.jsxs(f.div,{initial:!r&&{marginRight:q?0:-Ue},animate:!r&&{marginRight:0},transition:Ve,children:[i.jsx(f.div,{initial:{opacity:1},animate:{opacity:0},exit:{opacity:[1,0]},transition:{...I,delay:.22},className:"pointer-events-none absolute left-0 top-0 z-20 h-full w-full bg-token-main-surface-primary"}),!r&&i.jsx(f.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"pointer-events-none absolute left-0 top-0 z-10 h-full w-full bg-black/[0.025] dark:bg-transparent"}),i.jsx(f.div,{className:"relative z-20 h-full",style:{width:c},exit:{width:0},transition:{type:"spring",bounce:0,duration:.1}})]}),i.jsx(f.div,{className:Ie("absolute z-20 h-full transition-shadow",r&&"right-0 max-h-[100cqh] max-w-[var(--available-details-width)] overflow-y-auto overflow-x-clip",!r&&"overflow-hidden",!r&&(p==="debug"?"md:left-[-250px] lg:left-[-300px] xl:left-[-350px] 2xl:left-[-400px]":"left-0")),initial:{borderRadius:T,boxShadow:"0px 12px 32px 0px rgba(0, 0, 0, 0.064)",opacity:R?0:1,x:m.left,y:m.top,height:m.height,width:m.width},animate:{opacity:1,x:r?0:s,y:0,width:c,height:w,borderRadius:0,boxShadow:"0px 0px 18px rgba(0,0,0,0.075)"},exit:{scale:.64,opacity:0,filter:"blur(12px)",transition:{opacity:{duration:.14,bounce:.1}},borderRadius:T,boxShadow:"0px 12px 32px 0px rgba(0, 0, 0, 0.064)"},transition:b?{duration:0}:I,onAnimationComplete:()=>x(!1),children:i.jsx(f.div,{className:"h-full overflow-hidden border-l border-gray-100 dark:border-token-border-medium",initial:{borderRadius:T},animate:{borderRadius:0},exit:{borderRadius:T},transition:I,children:i.jsxs("div",{className:"h-full",children:[i.jsx(f.div,{drag:"x",className:"absolute left-[-2px] z-10 h-full w-[4px] cursor-ew-resize bg-token-text-quaternary opacity-0",whileHover:{opacity:.5},whileDrag:{opacity:.75,width:"8px",left:"-4px"},transition:{type:"tween",duration:.1},style:{x:0,y:0,transform:"translateX(0px)"},dragMomentum:!1,dragSnapToOrigin:!1,dragElastic:!1,dragConstraints:{left:0,right:0,top:0,bottom:0},onPointerDown:()=>v(!0),onPointerUp:()=>v(!1),onDrag:(u,X)=>o(X),onDragEnd:()=>{v(!1),n(s)},onDoubleClick:()=>d()}),b&&i.jsx("div",{className:"absolute inset-0 z-10"}),i.jsx(G,{onClose:a,clientThreadId:e,isAnimating:l,focusedObject:t,width:S-s})]})})})]})},He=h.memo(ze),Ge=({clientThreadId:e,focusedObject:t,onClose:a})=>i.jsx(Ee,{children:i.jsx(f.div,{className:"fixed inset-0 z-40 overflow-hidden shadow-xl md:border-gray-100 md:dark:border-gray-700",initial:{scale:.98},animate:{scale:1},transition:I,children:i.jsx(G,{isFullScreen:!0,clientThreadId:e,focusedObject:t,onClose:a})})}),Be=({clientThreadId:e,overrideWidth:t,isAutoFocusDisabled:a=!1})=>{const s=H(t),c=_e(e);Pe(e,a),Fe();const o=xe();h.useEffect(()=>{L()},[e]);const d=o&&(s?i.jsx(He,{clientThreadId:e,onClose:j,focusedObject:o},"canvas-sidebar"):i.jsx(Ge,{clientThreadId:e,onClose:j,focusedObject:o},"canvas-modal"));h.useEffect(()=>{if(o)return W(x=>je(x,o)),()=>W(null)},[o]);const n=U(),r=d!=null;return h.useEffect(()=>{if(!n)return F.setActiveStageSidebar(r),()=>{r&&F.setActiveStageSidebar(!1)}},[r,n]),c!==e?null:i.jsx(J,{children:d})},yt=e=>{const t=h.useRef(null);return i.jsx(Te,{ref:t,onError:(a,s)=>{L(),setTimeout(()=>{t.current?.resetErrorBoundary()}),me.logError("Error boundary hit",a,{componentStack:s})},name:"canmore-focused-view",children:i.jsx(Be,{...e})})};export{yt as CanvasFocusedViewManager};
//# sourceMappingURL=keshfl7thq1dh5vg.js.map
