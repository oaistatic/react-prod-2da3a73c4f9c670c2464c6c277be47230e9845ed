const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/l95tqa88v5i9hn0n.js","assets/hggowi1ggrzb09yc.js","assets/izh0i1dfnf8ev7x1.js","assets/root-ko7rpr3h.css","assets/fc2hzad6rtrm7s5f.js","assets/conversation-small-lgvqkxxm.css","assets/ki2fnq5gqslif1ka.js","assets/kaeuu7lrrhyntd9q.js","assets/fzrn137102spawew.js","assets/e9lafxuzyeh4418f.js","assets/d7bvxndom3b3tpj8.js","assets/ei7ej0cmjdt2qsbq.js","assets/dxpde14qu5zfq5m7.js","assets/b62offkhvw883hku.js","assets/ilf9q9cb2tzq42nz.js","assets/mzkxlhrlmxhntkvn.js","assets/fpc3fdcd67mn2gbu.js","assets/icqoll2azzmwe614.js","assets/nn6gjrst5lwozesx.js","assets/kkwehadcshvfaf0g.js","assets/in3ze5ugryldzaj2.js","assets/8nxoaz0vb9p890un.js","assets/lb1py1igp6jzrtce.js","assets/ab6tyx2xygyb56l3.js","assets/j7xrr4x8o3ssozmz.js","assets/occ17b3goczs014q.js","assets/m89x2zftpo6hrypr.js","assets/ddzilicy6qtleo90.js","assets/ntdjjw6s1dl31tgb.js","assets/c0dr65ykcqmn5jn4.js","assets/jr1b41w4nuv00isi.js","assets/h28ootcilxet47c8.js","assets/bluopupp3hty4d7q.js","assets/ca7lq2gyndiywe6g.js","assets/c9avu4yfkjav9bdb.js","assets/nf7qs4jioxsy0qcq.js","assets/modzmagtrlhmunl0.js","assets/myyiiqb6up4h3fac.js","assets/g6y5j997csop55q0.js","assets/ohyflymiror10qd4.js","assets/knizt02844mv3db5.js","assets/oyoqdz9lwzk3lgxh.js","assets/l4ce2zdnnawhaijx.js","assets/gy64pge8qevmvg7e.js","assets/iejjcjl0eek5zfni.js","assets/hg9mdduuem2pvwuj.js","assets/iemgi2z64e5uqrv4.js","assets/gq56vmyv6ftpm8ay.js","assets/edwitfgce1i7kzg0.js","assets/hz86nu26alptyjds.js","assets/lx9hhkuca66lgvof.js","assets/bk8slwxjkdlmxjxm.js","assets/d60wxt0885pttnzn.js","assets/mesuhiy66f679pn3.js","assets/bqaw7aag2c6iw58l.js","assets/njf3cz24xrjtlnt8.js","assets/kd4im2meh43m0la7.js","assets/i8jfxk8w8iv43ztc.js","assets/hjbk0a4n40hheieo.js","assets/keshfl7thq1dh5vg.js","assets/btagl6w1gub4aw61.js"])))=>i.map(i=>d[i]);
import{dv as He,ej as ce,n as Z,U as W,s as ue,r as me,Q as We,bz as $e,D as Ue,em as st,aj as ie,b_ as tt,aL as we,d2 as hs,gZ as at,bv as qe,bw as Ve,bT as Ke,e3 as xs,E as ne,di as H,al as Qe,ar as Pe,bh as Ye,bY as xe,co as vs,h as oe,cm as it,bX as nt,br as Xe,d as re,gY as rt,gw as ot,ae as Se,dw as js,bW as V,cj as Ze,bB as ys,bx as Ne,P as bs,a as Ms,c5 as ve,b$ as lt,cc as ws,b as ct,e4 as Ps,fw as dt,dl as je,H as ut,fC as Ss,eo as mt,au as gt,gK as ft,ak as pt,aK as ht,a3 as is,a4 as ns,gB as xt,l as vt,G as jt,f4 as yt,fp as bt,fV as Mt,gi as wt,gj as Pt}from"./hggowi1ggrzb09yc.js";import{v as Te,R as Ts,r as u,j as e,c as $,a as ks,M as g,d as ge,ax as St,av as Cs,w as Tt,h as kt}from"./izh0i1dfnf8ev7x1.js";import{bI as Ct,lo as It,jd as Is,lp as _s,v as Ns,lq as Gs,U as de,iH as O,b as As,bD as Me,cU as Ls,gg as Je,f2 as _t,eS as Nt,d6 as Gt,df as Fe,bC as A,eT as ke,eU as te,f5 as ye,e$ as be,eW as es,iA as Rs,lr as At,iB as zs,jr as Lt,ls as Rt,hP as ae,eV as zt,lt as Oe,ab as Et,lh as Ut,eM as Ft,f9 as Ot,f8 as Bt,gk as Dt,iD as Es,cf as Ht,iE as Us,iF as Fs,iI as Wt,lu as $t,is as qt,eO as Vt,iJ as Kt,ce as Be,iK as Qt,j7 as Yt,lv as rs,jb as Ge,jc as Xt,dh as os,lw as Zt,d7 as Os,lx as Jt,ly as ea,j9 as sa,lz as ta,d8 as aa,fu as ia,lA as ls,bE as na,T as ra,gP as oa,lB as la,fr as ca,lC as da,c7 as ua,ge as ma,j6 as cs,m as ga,lD as fa,lE as pa,d as ha,lF as xa,lG as ds,lH as us,lI as va,g7 as ja,eo as ms,cZ as ya}from"./fc2hzad6rtrm7s5f.js";import{i as ba,M as Bs,A as le,G as Ma,a as wa,b as gs,s as Pa,S as Sa,c as Ta,g as ka,d as Ca}from"./icqoll2azzmwe614.js";import{f as Ia}from"./m89x2zftpo6hrypr.js";import{u as _a}from"./ddzilicy6qtleo90.js";import{M as Ds,h as Na}from"./ntdjjw6s1dl31tgb.js";import{a as Hs}from"./in3ze5ugryldzaj2.js";import{C as Ws}from"./nf7qs4jioxsy0qcq.js";import{u as $s}from"./lb1py1igp6jzrtce.js";import{i as De}from"./g6y5j997csop55q0.js";import{d as Ga}from"./ohyflymiror10qd4.js";import{S as qs}from"./nn6gjrst5lwozesx.js";import{S as Aa}from"./ki2fnq5gqslif1ka.js";import{G as Vs}from"./j7xrr4x8o3ssozmz.js";import{G as La}from"./njf3cz24xrjtlnt8.js";import{S as Ra}from"./kd4im2meh43m0la7.js";import{F as Y,a as X,b as Ae,c as za,G as Ea}from"./fpc3fdcd67mn2gbu.js";import{G as Ua}from"./i8jfxk8w8iv43ztc.js";import{S as Fa}from"./hjbk0a4n40hheieo.js";import{CanvasFocusedViewManager as Oa}from"./keshfl7thq1dh5vg.js";import{G as Ba}from"./jr1b41w4nuv00isi.js";function Da(s,t){const a=W.getThreadCurrentLeafId(s),i=ue.getTree(me(s)),r=[];let n=i.getNodeByIdOrMessageId(a);for(;n!=null&&(t==null||n.id!==t);)r.unshift(n.message),n=n.parentId!==""?i.getNodeByIdOrMessageId(n.parentId):void 0;return r}function Ha(s){return s.filter(i=>i.recipient==="gizmo_editor.update_behavior").flatMap(i=>i.content.content_type==="text"?i.content.parts:i.content.content_type==="code"?[i.content.text]:[]).map(i=>JSON.parse(i)).reduce((i,r)=>({...i,...r}),{})}async function Wa(s){let t;for(const a of s)if(a.author.name==="gizmo_editor.generate_profile_pic"){const i=tt.getImageAssetPointers(a);i.length>0&&(t=i.at(-1))}if(t!=null){const a=Ct(t.asset_pointer),i=await We.getFileDownloadLink(a);if(i.status===$e.Success)return{id:a,permalink:i.download_url}}}async function $a(s,t,a,i){const r=Da(t,i),n=Ha(r);let o=await Wa(r);if(De(n)&&o==null)return;const{name:c,context:f,description:l,profile_pic_file_id:M,prompt_starters:w}=n;if(M!=null)try{const m=await We.getFileDownloadLink(M,s.id);m.status===$e.Success&&(o={id:M,permalink:m.download_url})}catch(m){Ue.addError(new Error("Error while retrieving profile pic in update",{cause:m})),a.warning("Something went wrong updating your GPT's profile picture.",{duration:3})}const d={name:typeof c=="string"?c:void 0,description:typeof l=="string"?l:void 0,instructions:typeof f=="string"?f:void 0,promptStarters:Array.isArray(w)?w:void 0,profilePictureId:o?.id,profilePictureUrl:o?.permalink};return st(d,m=>m!=null)}function qa(s){const t=new Set;for(const f of s.tools)t.add(f.type);const a=s.name??"",i=s.description??"",r=s.instructions??"",n=Array.from(t).join(","),o=a===""&&i===""&&r==="",c=s.profilePictureUrl!=null;return o?`The GPT you are about to has the following abilities: ${n}.`:`This is the GPT's current set of fields:

name: ${a}

description: ${i}

context: ${r}

abilities: ${n}

${c?"The GPT has a profile picture.":"This GPT does not have a profile picture. You must generate a profile picture when you next update your behavior."}
`}const Va=10;function Ks(s,t,a,i){const r=a.current,n=i.current;if(He(r,n))return;const o={};r.name!==n?.name&&(o.name=r.name),(r.description??"")!==(n?.description??"")&&(o.description=r.description??""),r.instructions!==(n?.instructions??"")&&(o.context=r.instructions??"");const c=new Set(n?.files?.map(d=>d.file_id)??[]),f=new Set(r.files?.map(d=>d.file_id)??[]),l=(r.files??[]).filter(d=>!c.has(d.file_id)),M=(n?.files??[]).filter(d=>!f.has(d.file_id));if(De(o)&&l.length===0&&M.length===0)return;const w=[];if(!De(o)){const d=`Explicitly update the GPT's behavior to the following exact fields:

    ${JSON.stringify(o,null,2)}

    "Do not call update_behavior yet. Instead, use these updated fields as the GPT's current behavior, and in the next call to update_behavior, incorporate these changes."
    `;w.push(ce.getTextAsMessage(d,Z.System))}if(M.length>0&&w.push(ce.getTextAsMessage(`The user has removed the following files from the GPT. You can no longer reference these files: ${M.map(d=>d.file_id).join(", ")}`,Z.System)),l.length>0){const d=l.slice(0,Va);w.push(ce.getTextAsMessage(`The user is adding these files to the GPT. The GPT may reference these files. The file IDs are: ${d.map(m=>m.file_id).join(", ")}`,Z.System,{attachments:d.map(m=>({id:m.file_id,name:m.name,size:m.size}))}))}w.length>0&&W.updateTree(s,d=>{let m=d.getNodeByIdOrMessageId(t).parentId;for(const x of w){const h=Te();d.insertNodeBefore(t,{id:h,children:[],parentId:m,message:x,metadata:{isClientCreatedSystemMessage:!0}}),m=h}})}function Ka(s,t,a){if(a.length===0)return;const i=Te(),r=`The user is uploading files in their next message. If you need to reference these in calls to update_behavior, you will use the following File ID(s), in order: ${a.map(n=>`"${n.fileId}"`).join(", ")}`;W.updateTree(s,n=>{const o=n.getNodeByIdOrMessageId(t).parentId;n.insertNodeBefore(t,{id:i,children:[],parentId:o,message:ce.getTextAsMessage(r,Z.System),metadata:{isClientCreatedSystemMessage:!0}})})}function Qa(s,t){const a="Remember, you should be calling either update_behavior or generate_profile_pic after most messages from the user. Your personality should be neutral and separate from the GPT you are creating.",i=W.getThreadCurrentLeafId(s),r=ue.getTree(me(s));let n=r.getNodeByIdOrMessageId(i);for(;n!=null&&n.message.author.role!==Z.User;){if(n.message.content.content_type==="text"&&n.message.content.parts[0]===a)return;n=n.parentId!==""?r.getNodeByIdOrMessageId(n.parentId):void 0}W.updateTree(s,o=>{const c=o.getNodeByIdOrMessageId(t).parentId;o.insertNodeBefore(t,{id:Te(),children:[],parentId:c,message:ce.getTextAsMessage(a,Z.System,{exclude_after_next_user_message:!0}),metadata:{isClientCreatedSystemMessage:!0}})})}function Ya(s,t){W.initThread(s,{kind:ie.GizmoMagicCreate,gizmo_id:void 0,behavior_overrides:t});const a=$s({clientThreadId:s});return async(r,n,o)=>{if(o.length===0)return;we(s,f=>{hs.updateTree(f,(l,M)=>{for(const w of o)M=l.addMessageNode(M,at(w),{isClientCreatedSystemMessage:!0}).id;return M})}),Ks(s,ue.getCurrentLeafId(me(s)),r,n);const c={conversationMode:{kind:ie.GizmoMagicCreate,gizmo_id:r.current.id,behavior_overrides:t}};a({completionMetadata:c})}}const Xa="Generate a new profile picture for this GPT using gizmo_editor generate_profile_pic. Do not prompt the user for any clarification. Do not send extra text outside of the tool function call. DO NOT CALL update_behavior or otherwise update GPT behavior in your response.",Za=qe(()=>Ve(()=>import("./l95tqa88v5i9hn0n.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12])).then(s=>s.DebugConversationSidebar));function Ja(s,t){u.useEffect(()=>{const a=ue.getTree(me(s));if(a.findNode(o=>o.message.author.role===Z.User||o.metadata?.isClientCreatedSystemMessage===!0)||(we(s,o=>{hs.deleteNodesByFilter(o,c=>c.metadata?.isPlaceholderTemplateAssistantWelcomeMessage===!0)}),t==null||t.length===0))return;const r=W.getThreadCurrentLeafId(s);if(!a.hasNodeOrMessageId(r))return;const n=Te();W.updateTree(s,o=>{o.addNode(n,t,r,Z.Assistant,{isPlaceholderTemplateAssistantWelcomeMessage:!0})}),W.setThreadCurrentLeafId(s,n)},[s,t])}function ei(s,t,a){As(s,{kind:ie.GizmoMagicCreate,gizmo_id:t.id,behavior_overrides:a}),u.useEffect(()=>{we(s,r=>{r.mode={kind:ie.GizmoMagicCreate,gizmo_id:t.id,behavior_overrides:a}})},[s,t.id,a]);const[i]=u.useState(()=>{const r=t.id==null,n=t.id!=null&&t.name!==""&&t.description!=null&&t.instructions!==""&&t.profilePictureUrl!=null;return r?`Hi! I'll help you build a new GPT. You can say something like, "make a creative who helps generate visuals for new products" or "make a software engineer who helps format my code."

What would you like to make?`:n?`Welcome back! Is there anything ${t.name} should be doing better? Anything you'd like to change?`:"You're back! Let's continue where we left off..."});Ja(s,i)}function si({gizmoEditorData:s,updateGizmo:t,clientThreadId:a,gizmoEditorDataRef:i,magicMakerBehaviorOverrides:r,magicMakerConversationGizmoEditorDataRef:n,requireGizmoId:o}){const c=u.useMemo(()=>({gizmoEditorData:s,gizmoId:s.id,mode:"magic",behaviorOverrides:r,getGizmoId:o}),[o,s,r]),f=It(d=>d.files.filter(m=>m.status===O.Ready&&m.gizmoId!=null)),l=u.useCallback(()=>{const d=ue.getCurrentLeafId(me(a));Ka(a,d,f),Ks(a,d,i,n),Qa(a,d),t(m=>({...m,files:[...m.files??[],...Ke(f.map(x=>x.fileId!=null&&{file_id:x.fileId,name:x.file.name,size:x.file.size,type:Is(x.file),last_modified:x.file.lastModified,file_size_tokens:x.fileSpec?.fileTokenSize}))]})),n.current=_s(i.current)},[a,f,i,n,t]),M=Ns(d=>d.activeSidebar),w=xs();return e.jsx(Gs.Provider,{value:c,children:e.jsxs("div",{className:"relative flex h-full grow overflow-auto",children:[e.jsx("div",{className:"grow",children:w?e.jsx("div",{className:"contents [--screen-height-override:100%]",children:e.jsx(Hs,{clientThreadId:a,preRequestCompletion:l,children:e.jsx(Ws,{hideHeader:!0,embedded:!0})})}):e.jsx(Ds,{clientThreadId:a,preRequestCompletion:l,hideHeader:!0,prependThreadChildren:e.jsx("div",{className:"h-8"})})}),M==="debug"&&e.jsx(Za,{clientThreadId:a,slideOver:!1,onClose:()=>de.toggleActiveSidebar("debug"),isOpen:!0})]})})}const ti=Ts.memo(si);function ai({gizmo:s,updateGizmo:t,publishedGizmo:a,promoteGizmo:i,appealGizmo:r,setAppealState:n,showActionsModal:o,shareOnly:c,onClose:f}){const[l,M]=u.useState({type:"privacy"});return l.type==="privacy"?e.jsx(ni,{gizmo:s,updateGizmo:t,publishedGizmo:a,promoteGizmo:i,appealGizmo:r,setAppealState:n,setStep:M,showActionsModal:o,shareOnly:c,onClose:f}):e.jsx(ri,{publishedGizmo:l.publishedGizmo,onClose:f})}function ii(s){return s?A.Workspace:A.Link}function ni({gizmo:s,publishedGizmo:t,updateGizmo:a,promoteGizmo:i,appealGizmo:r,setAppealState:n,setStep:o,showActionsModal:c,shareOnly:f,onClose:l}){const[M,w]=u.useState(!1),d=Me(Ls.isBusinessWorkspace),m=$(),x=ne(),[h,S]=u.useState(Je(s)?ii(!!d):s.sharingRecipient),C=ks(),k=ba(h,s.sharingTargets),{data:b,isLoading:L}=_t(),v=Nt(),[p,T]=u.useState(t!=null&&t.gizmo.display.categories.length>0?v.data?.categories.find(y=>y.id===t.gizmo.display.categories[0])?.id:void 0);u.useEffect(()=>{T(t?.gizmo.display.categories[0])},[t?.gizmo.display.categories]);const[I,E]=u.useState(void 0),G=u.useRef(Gt((y,_)=>Fe.generateCategory(y,_),1e3)),U=b?.is_verified?void 0:m.formatMessage({id:"qUMu4e",defaultMessage:"To publish your GPTs to the Explore GPTs page, set up your builder profile in the user settings page."});h===A.Marketplace&&U!=null&&!L&&S(A.Link);const B=d&&!s.sharingTargets?.some(y=>y.recipient===A.Link),R=ke(s,h,p),F=R.includes(te.MissingPublicActionPrivacyPolicyURL),K=s.tools.find(y=>y.type===H.JIT_PLUGIN&&!y.metadata.privacy_policy_url),q=Me(y=>y.currentWorkspace),Q=Qe();u.useEffect(()=>{let y=!0;return(async()=>{try{if(p!=null)return;const _=await G.current(s.name,s.instructions);y&&p==null&&(_?T(_.id):E(!0))}catch{y&&p==null&&E(!0)}})(),()=>{y=!1}},[s.instructions,s.name,Q,p]);const{value:fe}=Pe("4226692983");return e.jsx(Ye,{type:"success",isOpen:!0,onClose:l,title:e.jsx(g,{id:"9viumf",defaultMessage:"Share GPT"}),showCloseButton:!0,primaryButton:k?e.jsx(xe,{color:"primary",disabled:R.length>0,loading:M,onClick:async()=>{try{if(w(!0),f){if(!t?.gizmo.id){x.danger(m.formatMessage({id:"QYVEx8",defaultMessage:"Error sharing GPT"}));return}const y=await Fe.shareGizmo(t.gizmo.id,p?{sharing:ye(h,[],be),categories:[p]}:{sharing:ye(h,[],be)});y.error?(x.warning(m.formatMessage({id:"tmIKmp",defaultMessage:"Unable to share GPT"})),a({sharingTargets:y.sharing_targets}),n({gizmoId:t.gizmo.id,sharingRecipient:h,categories:t.gizmo.display.categories,moderationType:Bs.PublishBlocked,sharingTargets:y.sharing_targets,showModal:le.AppealAvailable})):(C.setQueryData(["gizmo",{gizmoId:t.gizmo.id},{draft:!1}],_=>y.resource),a(_=>({..._,sharingRecipient:h})),x.success(m.formatMessage({id:"SWSzcY",defaultMessage:"Sharing settings updated"})),l())}else{const y=await i({recipient:h,subjects:ye(h,[],be)},p);y?(o({type:"published",publishedGizmo:y}),a(_=>({..._,id:y.gizmo.id,sharingRecipient:h})),y.gizmo.live_version!=null&&a({liveVersion:y.gizmo.live_version}),x.success(m.formatMessage({id:"R5zko1",defaultMessage:"GPT published"}),{testId:"gpt-published-toast"})):(x.warning(m.formatMessage({id:"uf7WYw",defaultMessage:"Unable to publish GPT"})),l())}}finally{w(!1)}},"data-testid":"save-gizmo-button",children:e.jsx(g,{id:"SW4DG4",defaultMessage:"Save"})}):fe?e.jsx(e.Fragment,{children:e.jsx(xe,{color:"primary",onClick:async()=>{await r(h,p)},children:e.jsx(g,{id:"bBmLUr",defaultMessage:"Appeal"})})}):null,secondaryButton:t?e.jsx(xe,{color:"secondary",onClick:y=>es(t,x,y,m.formatMessage({id:"KdDqMm",defaultMessage:"Copied link to clipboard"})),children:e.jsx(g,{id:"wvL15a",defaultMessage:"Copy link"})}):null,children:e.jsxs("div",{className:"mx-[-16px] flex flex-col gap-3 text-sm",children:[e.jsx("div",{className:"space-y-1.5",children:e.jsxs(Rs,{value:h,onValueChange:y=>S(y),children:[s.sharingTargets&&s.sharingTargets.map((y,_)=>e.jsx(Le,{value:y.recipient,disabled:y.recipient===A.Marketplace&&U!=null,tooltipText:y.recipient===A.Marketplace?U??m.formatMessage({id:"0Rcb4e",defaultMessage:"Your GPT will appear in the Explore GPTs page"}):void 0,shareLevel:y.recipient},_)),B&&e.jsxs(e.Fragment,{children:[e.jsx(Le,{value:A.Link,disabled:!0,tooltipText:m.formatMessage(fs.workspaceDisabledHint),shareLevel:A.Link,workspaceName:q?.name}),e.jsx(Le,{value:A.Link,disabled:!0,tooltipText:m.formatMessage(fs.workspaceDisabledHint),shareLevel:A.Marketplace,workspaceName:q?.name})]})]})}),F&&e.jsx("div",{className:"text-xs text-red-500",children:e.jsx(g,{id:"/iw1Iv",defaultMessage:"Public actions require valid privacy policy URLs. Click <fixlink>here</fixlink> to update.",values:{fixlink:y=>e.jsx("button",{onClick:()=>{c(K?.metadata.action_id)},className:"underline",children:y})}})}),h!==A.Private&&e.jsx(Ma,{gizmo:s,category:p,categories:h===A.Marketplace?v.data?.categories??[]:void 0,onCategoryChange:h===A.Marketplace?y=>T(y.id):void 0}),h===A.Marketplace&&(I?e.jsx("div",{className:"text-xs text-red-500",children:e.jsx(g,{id:"tpC3ui",defaultMessage:"There was an error updating the list of categories"})}):null),!k&&fe&&e.jsx("div",{className:"flex items-center justify-between text-sm text-token-text-secondary",children:e.jsx(g,{id:"jLCMMV",defaultMessage:"Because this GPT previously may have violated our policies, you will have to submit an appeal to make it available at this level."})})]})})}function ri({publishedGizmo:s,onClose:t}){const a=At(s),i=$(),r=ne();return e.jsx(Ye,{type:"success",isOpen:!0,onClose:t,title:e.jsx(g,{id:"rCRRmx",defaultMessage:"Settings Saved"}),showCloseButton:!0,primaryButton:e.jsx(xe,{color:"primary",as:"link",to:a,children:e.jsx(g,{id:"lyZz44",defaultMessage:"View GPT"})}),children:e.jsx("div",{className:"flex flex-col gap-2",children:e.jsxs("div",{className:"flex gap-1 rounded bg-token-main-surface-secondary px-2 py-1",children:[e.jsx("div",{className:"line-clamp-1 text-ellipsis break-all",children:a}),e.jsx("button",{onClick:n=>{es(s,r,n,i.formatMessage({id:"KdDqMm",defaultMessage:"Copied link to clipboard"}))},className:"text-token-text-secondary transition hover:text-token-text-primary","data-testid":"copy-saved-gpt-url-button",children:e.jsx(vs,{className:"icon-sm"})})]})})})}const fs=oe({workspaceDisabledHint:{id:"gizmo.workspaceDisabledHint",defaultMessage:"Your workspace administrator has disabled this setting"}});function Le({shareLevel:s,workspaceName:t,value:a,disabled:i=!1,tooltipText:r}){const n=u.useId();return e.jsx(it,{disabled:r==null,label:r,side:"top",children:e.jsxs(zs,{id:n,value:a,disabled:i,className:"flex h-14 w-full cursor-pointer flex-row items-center justify-between gap-2 rounded-md px-3 py-4 font-semibold hover:bg-token-main-surface-secondary",children:[e.jsx("label",{htmlFor:n,className:"flex cursor-pointer items-center gap-1",children:e.jsx(wa,{shareLevel:s,workspaceName:t??"",hasInviteSharing:!1})}),e.jsx(Lt,{children:e.jsx(nt,{className:"icon-lg mr-1"})})]})})}function Qs(s){window.history.length>1?s(-1):s(Rt())}function oi({gizmo:s,publishedGizmo:t,isUpsertLoading:a,isPromoteLoading:i,isUploadingProfilePic:r,isGeneratingProfilePic:n,updateGizmo:o,promoteGizmo:c,appealGizmo:f,setAppealState:l,showActionsModal:M}){const w=Se(),d=s!=null?ke(s):[];(s==null||i||a)&&d.push(te.Loading),r&&d.push(te.UploadingProfilePic),n&&d.push(te.GeneratingProfilePic);const m=Je(s),[x,h]=u.useState(!1),[S,C]=u.useState(!1),k=s.sharingRecipient?gs[s.sharingRecipient]:gs.private,b=i||a;return e.jsxs(e.Fragment,{children:[m?e.jsx(ae,{color:"primary",onClick:()=>h("promote"),loading:a,disabled:b||s.id===void 0||d.length>0,tooltip:d.length>0?d.map(Oe).join(`
`):void 0,testId:"gizmo-editor-create-gpt-button",children:e.jsx(g,{id:"svUGIb",defaultMessage:"Create"})}):e.jsxs(e.Fragment,{children:[e.jsx(ae,{color:"secondary",loading:i||!t,disabled:b,icon:k,onClick:()=>h("share"),children:e.jsx(g,{id:"aXKW4G",defaultMessage:"Share"})}),e.jsx(ae,{color:"primary",onClick:async()=>{let L=s.sharing.subjects.map(Pa);const v=zt(s.sharing.subjects);L=ye(s.sharing.recipient,L,v?.capabilities??be),await c({recipient:s.sharing.recipient,subjects:L},t?.gizmo.display.categories[0])&&C(!0)},loading:a||!t,disabled:b||d.length>0,tooltip:d.length>0?d.map(Oe).join(`
`):void 0,children:e.jsx(g,{id:"84QVoj",defaultMessage:"Update"})})]}),x&&(w?.getWorkspaceId()==null?e.jsx(ai,{gizmo:s,publishedGizmo:t,promoteGizmo:c,appealGizmo:f,setAppealState:l,showActionsModal:M,updateGizmo:o,shareOnly:x==="share",onClose:()=>h(!1)}):e.jsx(Sa,{gizmo:s,publishedGizmo:t,promoteGizmo:c,appealGizmo:f,setAppealState:l,showActionsModal:M,updateGizmo:o,onClose:()=>h(!1),shareOnly:x==="share"})),S&&e.jsx(Ta,{publishedGizmo:t,sharing:t.gizmo.sharing,onClose:()=>C(!1),workspaceName:w?.data.name??""})]})}function li({gizmoEditorData:s,publishedGizmo:t,revertDraft:a}){const i=$(),r=ne(),n=ge(),[o,c]=u.useState(!1),f=Qe(),{value:l}=Pe("3645668434");return!f?.includes("debug")&&s?.id==null?null:e.jsxs(e.Fragment,{children:[e.jsxs(js,{side:"top",contentAlign:"end",sideOffset:8,triggerButton:e.jsx(ae,{color:"ghost",icon:Et}),children:[t!=null&&e.jsxs(V.Item,{onClick:M=>{es(t,r,M)},children:[e.jsx(qs,{className:"icon-sm"}),e.jsx(g,{...J.copyLink})]}),a!=null&&e.jsxs(V.Item,{onClick:()=>{window.confirm(i.formatMessage(J.revertConfirm))&&a()},children:[e.jsx(Ut,{className:"icon-sm"}),e.jsx(g,{id:"W2blnV",defaultMessage:"Revert..."})]}),s?.id!=null&&l&&s.liveVersion>0&&e.jsxs(e.Fragment,{children:[e.jsxs(V.Item,{onClick:()=>{n(`/g/${s.id}/view`)},children:[e.jsx(Ga,{className:"icon-sm"}),e.jsx(g,{id:"gizmo.versionHistory",defaultMessage:"Version History"})]}),e.jsxs(V.Item,{onClick:async()=>{const M=await Fe.copyGizmo({gizmoId:s.id});M.gizmo.id&&n(`/gpts/editor/${M.gizmo.id}`)},children:[e.jsx(vs,{className:"icon-sm"}),e.jsx(g,{id:"GizmoInformation.copyGizmoLabel",defaultMessage:"Duplicate GPT"})]})]}),s?.id!=null&&e.jsxs(V.Item,{color:"danger",onClick:()=>{c(!0)},children:[e.jsx(Ft,{className:"icon-sm"}),e.jsx(g,{id:"tNrOLG",defaultMessage:"Delete GPT"})]}),f?.includes("debug")&&e.jsxs(e.Fragment,{children:[e.jsx(V.Separator,{}),e.jsxs(V.Item,{onClick:()=>{de.toggleActiveSidebar("debug")},children:[e.jsx(Aa,{className:"icon-sm"}),"Debug (Internal only)"]})]})]}),o&&e.jsx(La,{gizmoId:s.id,onSuccess:()=>Qs(n),onClose:()=>{c(!1)}})]})}const he=Xe.div`flex items-center gap-1`;function ci({gizmoEditorData:s}){const t=Me(a=>a.currentWorkspace?.name);switch(s.sharingRecipient){case A.Private:return e.jsxs(he,{children:[e.jsx(Dt,{className:"icon-xs"}),e.jsx(g,{...J.onlyMe})]});case A.Link:return e.jsxs(he,{children:[e.jsx(qs,{className:"icon-xs"}),e.jsx(g,{...J.anyoneWithLink})]});case A.Workspace:return e.jsxs(he,{children:[e.jsx(Bt,{className:"icon-xs"}),t]});case A.Marketplace:return e.jsxs(he,{children:[e.jsx(Ot,{className:"icon-xs"}),e.jsx(g,{...J.public})]});default:return e.jsx("div",{})}}function di({gizmoEditorData:s}){return e.jsxs("div",{className:"flex items-center gap-2",children:[s.profilePictureUrl!=null?e.jsx(Vs,{isFirstParty:!1,src:s.profilePictureUrl,className:"h-8 w-8"}):e.jsx("div",{className:"h-8 w-8 rounded-full border-2 border-dashed border-token-border-medium"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold",children:s.name||e.jsx(g,{...J.newGPT})}),e.jsx("div",{className:"text-xs text-token-text-secondary",children:Je(s)?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"h-1.5 w-1.5 rounded-full bg-token-text-tertiary"}),e.jsx(g,{...J.draft})]}):e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"h-1.5 w-1.5 rounded-full bg-brand-green"}),s.sharingRecipient===A.Marketplace?e.jsx(g,{...J.published}):e.jsx(g,{id:"gizmoEditorHeader.live",defaultMessage:"Live"})," · ",e.jsx(ci,{gizmoEditorData:s})]})})]})]})}const ui=Xe.div`cursor-pointer border-b pb-[1px] pt-[2px] text-sm text-token-text-secondary hover:border-token-border-xheavy hover:text-token-text-primary mx-2`;function mi({gizmoEditorData:s,isUpsertLoading:t,isPromoteLoading:a,isUploadingProfilePic:i,isGeneratingProfilePic:r,publishedGizmo:n,updateGizmo:o,promoteGizmo:c,appealGizmo:f,setAppealState:l,revertDraft:M,draftMessage:w,className:d,hasUnpublishedChanges:m,showActionsModal:x}){const h=ge();return e.jsxs("div",{className:re("relative flex h-14 w-full items-center justify-between gap-2 border-b border-token-border-medium px-3",d),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("a",{className:"cursor-pointer text-token-text-primary",onClick:()=>Qs(h),children:e.jsx(rt,{className:"icon-lg"})}),e.jsx(di,{gizmoEditorData:s})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[n&&(n?.gizmo.live_version??0)>1&&e.jsx(ui,{onClick:()=>h(`/g/${s.id}/view`),children:e.jsx(g,{id:"P0Ri/k",defaultMessage:"Last edited {date}",values:{date:e.jsx(ot,{value:n.gizmo.updated_at,day:"numeric",month:"short",year:new Date(n.gizmo.updated_at).getFullYear()===new Date().getFullYear()?void 0:"numeric"})}})}),w,e.jsx(li,{gizmoEditorData:s,publishedGizmo:n,revertDraft:M}),e.jsx(oi,{gizmo:s,publishedGizmo:n,isUpsertLoading:t,isPromoteLoading:a,isUploadingProfilePic:i,isGeneratingProfilePic:r,updateGizmo:o,promoteGizmo:c,appealGizmo:f,setAppealState:l,hasUnpublishedChanges:m,showActionsModal:x})]})]})}const J=oe({onlyMe:{id:"gizmo.onlyMe",defaultMessage:"Only me"},anyoneWithLink:{id:"gizmo.anyoneWithLink",defaultMessage:"Anyone with a link"},public:{id:"gizmo.public",defaultMessage:"Everyone"},newGPT:{id:"gizmo.newGPT",defaultMessage:"New GPT"},draft:{id:"gizmo.draft",defaultMessage:"Draft"},published:{id:"gizmo.published",defaultMessage:"Published"},revertConfirm:{id:"gizmo.revertConfirm",defaultMessage:"Are you sure you want to revert to the last saved version?"},copyLink:{id:"gizmo.copyLink",defaultMessage:"Copy link"}}),gi=512;function fi(){return e.jsx("div",{className:"relative flex h-full w-full items-center justify-center rounded-full border-2 border-dashed border-token-border-medium",children:e.jsx(Ze,{className:"h-1/4 w-1/4"})})}function pi({gizmoEditorData:s,onFileChange:t,generateProfilePic:a,isGeneratingProfilePic:i,setIsGeneratingProfilePic:r}){const n=$(),o=ne(),[c,f]=u.useState(void 0),l=u.useRef(t);u.useEffect(()=>{l.current=t});async function M(m){if(m.length>0){r(!1);const x=await Kt(m[0],gi),h=Be(x);f({tempId:h,file:x,status:O.Uploading,progress:1,fileId:null,cdnUrl:null}),l.current("uploading"),Qt(h,x,n,o,ys.ProfilePicture,{onFileCreated(S,C,k){f(b=>b!=="initial"&&b?.tempId===S&&b.status===O.Uploading?{...b,progress:10,fileId:C,cdnUrl:k}:b)},onFileUploadProgress(S,C){f(k=>k!=="initial"&&k?.tempId===S&&k.status===O.Uploading?{...k,progress:C}:k)},onFileUploaded(S,C,k){f(b=>b!=="initial"&&b?.tempId===S?(l.current(b),{...b,status:O.Ready,progress:100,fileSpec:{name:b.file.name,id:b.fileId,size:b.file.size,...k??{}}}):b)},onError(S){f(C=>{if(C!=="initial"&&C?.tempId===S){l.current(void 0);return}return C})}})}}const{open:w,getInputProps:d}=Es({disabled:!1,noClick:!0,onDropAccepted:M,onDropRejected:m=>Na(m,n,o,Ht.ProfilePicture),multiple:!0,maxSize:Us,...Fs(Wt)});return e.jsxs("div",{className:"flex w-full items-center justify-center gap-4",children:[e.jsxs(js,{sideOffset:8,triggerButton:e.jsx("button",{className:"h-20 w-20",children:i?e.jsx(fi,{}):c!=null&&c!="initial"&&c.status!=O.Ready?e.jsxs("div",{className:"relative h-full w-full overflow-hidden rounded-full",children:[e.jsx($t,{file:c.file}),c.status===O.Uploading&&c.progress<90?e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/5 text-white",children:e.jsx(qt,{percentage:c.progress,className:"h-6 w-6"})}):null]}):s?.profilePictureUrl!=null&&s?.profilePictureUrl!==""?e.jsx(Vs,{isFirstParty:!1,src:s.profilePictureUrl}):e.jsx("div",{className:"flex h-full w-full items-center justify-center rounded-full border-2 border-dashed border-token-border-medium",children:e.jsx(Vt,{className:"text-4xl"})})}),children:[e.jsx(V.Item,{onClick:w,children:e.jsx(g,{id:"ERQwXg",defaultMessage:"Upload Photo"})}),e.jsx(V.Item,{onClick:a,children:e.jsx(g,{id:"NXAog/",defaultMessage:"Use DALL·E"})})]}),e.jsx("input",{...d()})]})}function hi({gizmoEditorData:s,requireGizmoId:t,currentModelConfig:a,updateGizmo:i}){const r=$(),n=ne(),[o,c]=u.useState(0),f=u.useRef(new Map),l=Yt(a,void 0),M=async p=>{bs.logEvent(Ms.uploadFile,{client:"web",eventSource:"mouse",intent:"gizmo"});const T=await t();p.length>0&&await Promise.all(p.map(I=>{const E=Be(I);f.current.set(E,{tempId:E,gizmoId:T,file:I,status:O.Uploading,progress:1,fileId:null,cdnUrl:null}),Xt(Be(I),I,r,n,{kind:ys.Gizmo,gizmoId:T},{onFileUploaded:(G,U,B,R)=>{const F=f.current.get(G);F==null||F.fileId==null||(i(K=>({...K,files:[...K.files??[],{file_id:F.fileId,name:F.file.name,size:F.file.size,type:R?.mimeType??Is(I),last_modified:F.file.lastModified,file_size_tokens:R?.fileTokenSize}]})),f.current.delete(G),c(K=>K+1))},onFileCreated:(G,U,B)=>{f.current.set(G,{tempId:G,gizmoId:T,file:I,status:O.Uploading,progress:1,...f.current.get(G),fileId:U,cdnUrl:B}),c(R=>R+1)},onFileUploadProgress:(G,U)=>{const B=f.current.get(G);B?.status===O.Uploading&&f.current.set(G,{...B,progress:U}),c(R=>R+1)},onError:G=>{f.current.delete(G)}},{usesRetrievalIndex:a!=null&&Ge(a,I.type,I.name)===Ne.Retrieval})}))},{getInputProps:w,open:d}=Es({disabled:!1,noClick:!0,onDropAccepted:M,multiple:!0,maxSize:Us,maxFiles:10,...Fs(l)}),m=s?.files??[];function x(p){return e.jsx(os,{onRemoveFileClick:()=>{f.current.delete(p.tempId),c(T=>T+1)},file:p.file,loadingPercentage:p.status===O.Uploading?p.progress:void 0},p.tempId)}function h(p){return e.jsx(os,{file:p.name,fileId:p.file_id,onRemoveFileClick:()=>i(T=>({...T,files:T?.files?.filter(I=>I.file_id!==p.file_id)})),gizmoId:s?.id},p.file_id)}const S=Array.from(f.current.values()).filter(p=>m.every(T=>T.file_id!==p.fileId)),[C,k]=rs(S,p=>a!=null&&Ge(a,p.file.type,p.file.name)===Ne.CodeInterpreter),[b,L]=rs(m,p=>a!=null&&p.type!=null&&Ge(a,p.type,p.name)===Ne.CodeInterpreter),v=u.useRef(b.length);return u.useEffect(()=>{b.length>v.current&&i(p=>p.tools?.some(T=>T.type===H.PYTHON)?p:{...p,tools:[...p.tools??[],{type:H.PYTHON}]}),v.current=b.length},[b.length]),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"rounded-lg text-token-text-tertiary",children:e.jsx(g,{...xi.knowledgeWarning})}),k.length>0||L.length>0?e.jsxs("div",{className:"flex flex-wrap gap-2",children:[k.map(x),L.map(h)]}):null,C.length>0||b.length>0?e.jsxs("div",{children:[e.jsx("div",{className:"mb-2 text-xs text-token-text-tertiary",children:e.jsx(g,{id:"i/QurZ",defaultMessage:"The following files are only available for Code Interpreter:"})}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[C.map(x),b.map(h)]})]}):null,e.jsx("div",{children:e.jsxs(ae,{onClick:d,children:[e.jsx("input",{...w()}),e.jsx(g,{id:"sr8Qp/",defaultMessage:"Upload files"})]})})]})}const xi=oe({knowledgeWarning:{id:"gizmo.knowledgeWarning",defaultMessage:"If you upload files under Knowledge, conversations with your GPT may include file contents. Files can be downloaded when Code Interpreter is enabled"}});function vi({placeholder:s,text:t,onChange:a,onClose:i}){return e.jsx(Ye,{className:"!max-h-[100vh] !max-w-[80vw]",type:"success",isOpen:!0,onClose:i,primaryButton:e.jsx(ae,{onClick:i,children:e.jsx(g,{id:"FeFVdS",defaultMessage:"Close"})}),children:e.jsx("textarea",{className:"h-[70vh] w-full resize-none rounded-lg bg-token-main-surface-primary dark:border-gray-700",value:t,onChange:r=>{a(r.target.value)},placeholder:s})})}const Re=Xe.div`text-sm text-red-500`;function ji({children:s,collapsed:t,initial:a}){return e.jsx(St,{initial:a,children:!t&&e.jsx(Cs.div,{initial:"collapsed",animate:"open",exit:"collapsed",variants:{open:{opacity:1,height:"auto"},collapsed:{opacity:0,height:0}},children:s})})}function yi({gizmo:s,onShowActionsEditor:t,isDisabled:a}){const i=$(),r=ne(),n=e.jsxs("div",{className:"space-y-1",children:[s?.tools?.map((o,c)=>o.type!==H.JIT_PLUGIN?null:e.jsxs("div",{children:[e.jsx(Ea,{isDisabled:a,actionTool:o,onShowActionsEditor:()=>t(o.metadata.domain)}),o.metadata.auth?.type==="oauth"&&e.jsx(ia,{label:i.formatMessage(z.callbackUrlLabel),value:`https://chat.openai.com/aip/${o.metadata.action_id}/oauth/callback`,onCopied:()=>{r.success("Copied to clipboard",{duration:3})}})]},c)),(s?.tools?.filter(o=>o.type===H.JIT_PLUGIN)??[]).length>=ls?e.jsx("div",{children:i.formatMessage(z.maxActionsReached,{number:ls})}):e.jsx(ae,{disabled:a,onClick:()=>{t("Unknown domain")},className:"mt-2",children:e.jsx(g,{...z.createActionLabel})})]});return a?e.jsx(ws,{side:"top",label:i.formatMessage(z.disabledCustomActionsTooltip),children:n}):n}function bi(s){return(s.files?.length??0)>0||s?.tools?.some(t=>t.type===H.JIT_PLUGIN)}function Mi({gizmoEditorData:s,updateGizmo:t,currentModelConfig:a,generateProfilePic:i,setIsUploadingProfilePic:r,isGeneratingProfilePic:n,setIsGeneratingProfilePic:o,requireGizmoId:c,onShowActionsEditor:f}){const l=s?.tools??[],[M,w]=u.useState(!1),[d,m]=u.useState(!0),x=s?.promptStarters??[],h=[...x,...x.length<Zt?[""]:[]],S=ke(s),k=Se()?.isWorkspaceAccount(),b=Os(ve.WorkspaceGPTCustomActions),L=$();return e.jsxs("div",{className:"flex h-full grow flex-col overflow-y-auto px-2 pt-6 text-sm",children:[e.jsxs("div",{className:"grow",children:[e.jsxs(Y,{children:[e.jsx(pi,{gizmoEditorData:s,generateProfilePic:i,isGeneratingProfilePic:n,setIsGeneratingProfilePic:o,onFileChange:async v=>{if(v!=null&&v!=="uploading"&&v.fileId!=null){const p=await We.getFileDownloadLink(v.fileId);p.status===$e.Success&&t({profilePictureId:v.fileId!=null?v.fileId:void 0,profilePictureUrl:p.download_url})}else t({profilePictureId:void 0,profilePictureUrl:void 0});r(v==="uploading")}}),e.jsx(X,{label:e.jsx(g,{id:"M4dZms",defaultMessage:"Name"}),description:e.jsx(g,{id:"+Gkni2",defaultMessage:"The name of your GPT"})}),e.jsx(Ae,{type:"text",placeholder:L.formatMessage(z.gptNamePlaceholder),value:s?.name??"",onChange:v=>{t({name:v.target.value})},onBlurCapture:()=>t(v=>({...v,name:v.name.trim()})),"data-testid":"gizmo-name-input"}),S.includes(te.GizmoNameTooLong)?e.jsx(Re,{className:"mt-1",children:e.jsx(g,{...z.nameTooLong,values:{length:Jt}})}):null]}),e.jsxs(Y,{className:"mt-4",children:[e.jsx(X,{label:e.jsx(g,{id:"YDzNvf",defaultMessage:"Description"}),description:e.jsx(g,{id:"dpxCw8",defaultMessage:"Short description of what this GPT does"})}),e.jsx(Ae,{type:"text",placeholder:L.formatMessage(z.descriptionPlaceholder),value:s?.description??"",onChange:v=>t({description:v.target.value}),onBlurCapture:()=>t(v=>({...v,description:v.description?.trim()??""})),"data-testid":"gizmo-description-input"}),S.includes(te.GizmoDescriptionTooLong)?e.jsx(Re,{className:"mt-1",children:e.jsx(g,{...z.descriptionTooLong,values:{length:ea}})}):null]}),e.jsxs(Y,{children:[e.jsx(X,{label:e.jsx(g,{id:"2SO0RJ",defaultMessage:"Instructions"}),description:L.formatMessage(z.instructionsSubtitle)}),e.jsxs("div",{className:"relative",children:[e.jsx(za,{className:"resize-none",rows:8,value:s?.instructions,onChange:v=>t({instructions:v.target.value}),onBlurCapture:()=>t(v=>({...v,instructions:v.instructions.trim()})),placeholder:L.formatMessage(z.instructionsSubtitle),"data-testid":"gizmo-instructions-input"}),e.jsx("button",{className:"absolute bottom-3 right-2 text-token-text-tertiary",onClick:()=>w(!0),children:e.jsx(Ra,{className:"icon-sm"})})]}),S.includes(te.GizmoInstructionsTooLong)?e.jsx(Re,{className:"mt-1",children:e.jsx(g,{...z.instructionsTooLong,values:{length:sa}})}):null]}),e.jsxs(Y,{children:[e.jsx(X,{label:e.jsx(g,{id:"6rfYOX",defaultMessage:"Conversation starters"}),description:e.jsx(g,{id:"OSOIpd",defaultMessage:"Examples for the user to start the conversation"})}),e.jsx("div",{className:"flex flex-col gap-1",children:h.map((v,p)=>e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ae,{className:"rounded-r-none",value:v,type:"text",maxLength:ta,onChange:T=>{const I=T.target.value;t(E=>({...E,promptStarters:Ke(p>=(x.length??0)?[...x??[],I]:x.map((G,U)=>U===p?I===""?void 0:I:G))}))}}),e.jsx("button",{className:"flex h-9 w-9 items-center justify-center rounded-lg rounded-l-none border border-l-0 border-token-border-medium",onClick:()=>t(T=>({...T,promptStarters:x.filter((I,E)=>E!==p)})),children:e.jsx(lt,{className:"icon-sm"})})]},p))})]}),e.jsxs(Y,{children:[e.jsx(X,{label:e.jsx(g,{id:"bwXSkU",defaultMessage:"Knowledge"}),description:L.formatMessage(z.knowledgeExplanation)}),e.jsx(hi,{gizmoEditorData:s,requireGizmoId:c,currentModelConfig:a,updateGizmo:t})]}),e.jsxs(Y,{children:[e.jsx(X,{label:e.jsx(g,{id:"mcAwDU",defaultMessage:"Capabilities"}),description:e.jsx(g,{id:"2exQT6",defaultMessage:"Functionality this GPT can use"})}),e.jsx(Ua,{enabledTools:l,onEnabledToolsChange:v=>t({tools:v})})]}),e.jsxs(Y,{children:[e.jsx(X,{label:e.jsx(g,{id:"7r7v+u",defaultMessage:"Actions"}),description:e.jsx(g,{id:"fBln7I",defaultMessage:"APIs this GPT can use"})}),e.jsx(yi,{isDisabled:!!(k&&!b),gizmo:s,onShowActionsEditor:f})]}),!k&&bi(s)&&e.jsxs(Y,{children:[e.jsx(X,{label:e.jsx(g,{id:"R3KeU7",defaultMessage:"Additional Settings"}),collapsed:!!d,onClick:()=>{m(v=>!v)}}),e.jsx(ji,{collapsed:d,initial:!1,children:e.jsx(aa,{className:"mx-3 my-1",labelClassName:"w-full cursor-pointer",label:e.jsx(g,{id:"tZgwFW",defaultMessage:"Use conversation data in your GPT to improve our models"}),id:"improve-chatgpt",checked:!s.trainingDisabled,onChange:()=>{t({trainingDisabled:!s.trainingDisabled})}})})]})]}),M&&e.jsx(vi,{text:s.instructions??"",onChange:v=>{t({instructions:v})},onClose:()=>w(!1),placeholder:L.formatMessage(z.instructionsSubtitle)})]})}const z=oe({nameTooLong:{id:"gizmo.nameTooLong",defaultMessage:"GPT names cannot be longer than {length} characters."},knowledgeExplanation:{id:"gizmo.knowledgeExplanation",defaultMessage:"Additional files for this GPT to reference."},descriptionTooLong:{id:"gizmo.descriptionTooLong",defaultMessage:"GPT descriptions cannot be longer than {length} characters."},instructionsTooLong:{id:"gizmo.instructionsTooLong",defaultMessage:"GPT instructions cannot be longer than {length} characters."},disabledCustomActionsTooltip:{id:"gizmo.disabledCustomActionsTooltip",defaultMessage:"Custom actions are disabled for your workspace. Contact your admin to enable them."},createActionLabel:{id:"gizmo.createActionLabel",defaultMessage:"Create new action"},maxActionsReached:{id:"gizmo.maxActionsReached",defaultMessage:"GPTs can have a maximum of {number} actions"},descriptionPlaceholder:{id:"gizmo.descriptionPlaceholder",defaultMessage:"Add a short description about what this GPT does"},instructionsSubtitle:{id:"gizmo.instructionsSubtitle",defaultMessage:"What does this GPT do? How does it behave? What should it avoid doing?"},gptNamePlaceholder:{id:"gizmo.gptNamePlaceholder",defaultMessage:"Name your GPT"},callbackUrlLabel:{id:"gizmo.callbackUrlLabel",defaultMessage:"Callback URL"}});function wi(s,t){const a=Ps(s);if(!Array.isArray(s.detail))return a;const i=Ke(s.detail.map(r=>{if(r.type==="value_error.any_str.max_length")switch(r.loc[1]){case"display":{switch(r.loc[2]){case"name":return t.formatMessage(z.nameTooLong,{length:r.ctx.limit_value});case"description":return t.formatMessage(z.descriptionTooLong,{length:r.ctx.limit_value})}break}case"instructions":return t.formatMessage(z.instructionsTooLong,{length:r.ctx.limit_value})}if(typeof r.msg=="string")return r.msg}));return i.length>0?i.join(`
`):a}function Pi({upsertDraftError:s}){const t=$(),a=wi(s,t);return e.jsxs("div",{className:"flex items-center gap-2 text-red-500",children:[e.jsx("div",{children:e.jsx(g,{...Ys.errorSavingDraft})}),a!=null&&e.jsx(ws,{label:a,children:e.jsx(na,{className:"icon-sm"})})]})}function Si({isPublished:s,isSavingDraft:t,hasUnpublishedChanges:a,upsertDraftError:i,className:r}){return i instanceof ct?e.jsx(Pi,{upsertDraftError:i}):a?e.jsxs("div",{className:re("flex items-center gap-2",r),children:[e.jsx("span",{className:"text-token-text-secondary",children:s?e.jsx(g,{id:"gizmoEditor.draftUnpublished",defaultMessage:"Unpublished changes"}):e.jsx(g,{id:"gizmoEditor.draftPending",defaultMessage:"Updates pending"})}),e.jsx("div",{className:"w-4 text-token-text-tertiary",children:t&&e.jsx(Ze,{})})]}):null}const Ys=oe({errorSavingDraft:{id:"gizmo.errorSavingDraft",defaultMessage:"Error saving draft"}}),Ti=qe(()=>Ve(()=>import("./l95tqa88v5i9hn0n.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12])).then(s=>s.DebugConversationSidebar));var ki=(s=>(s.TestGizmoAction="test_gizmo_action",s))(ki||{});const Ci=new dt;function Ii({gizmoEditorData:s,isSavingDraft:t,showTitle:a=!0}){const[i,r]=u.useState(()=>je());As(i,{kind:ie.GizmoTest,gizmo_id:s.id}),u.useEffect(()=>{we(i,h=>{h.mode={kind:ie.GizmoTest,gizmo_id:s.id}})},[i,s.id]);const n=s.files?.map(h=>h.file_id).join();u.useEffect(()=>{ut(i)!=null&&r(je())},[s.id,s.instructions,s.tools,n,i]);const o=Ns(h=>h.activeSidebar),c=u.useMemo(()=>({gizmoEditorData:s,mode:"test"}),[s]),[f,l]=u.useState(0),M=()=>{l(h=>h-360)},w=s.id,d=_i(i);u.useEffect(()=>Ss(Ci,{test_gizmo_action:({rootDomain:h,operationName:S})=>{w&&d(w,h,S)}}),[d,w]);const m=xs(),x=u.useCallback(()=>e.jsx("div",{className:"h-full w-full",children:e.jsx(Ba,{gizmo:s,hideOwner:!0,showStarterPrompts:!0})}),[s]);return e.jsx(Gs.Provider,{value:c,children:e.jsx(ra,{clientThreadId:i,children:e.jsxs("div",{className:re("flex h-full w-full",t&&"cursor-wait opacity-80 transition"),children:[e.jsxs("div",{className:"flex grow flex-col",children:[e.jsx("div",{className:"relative mb-2 flex-shrink-0",children:e.jsx("div",{className:"flex justify-center py-1",children:a&&e.jsxs("div",{className:"group flex items-center gap-2 text-lg font-semibold",children:[e.jsx("div",{className:"icon-md"}),e.jsxs("button",{onClick:()=>{M(),r(je())},className:"flex items-center gap-2",children:[e.jsx(g,{id:"2u/6Ja",defaultMessage:"Preview"}),e.jsx(Cs.div,{className:"text-token-text-primary",animate:{rotate:f},transition:{duration:.3},children:e.jsx(oa,{className:"icon-md invisible group-hover:visible"})})]})]})})}),e.jsxs("div",{className:re("relative grow overflow-auto px-2",t&&"pointer-events-none"),children:[m?e.jsx("div",{className:"contents",style:{"--screen-height-override":"100%","--chat-screen-thread-parent-background":"var(--main-surface-secondary)"},children:e.jsx(Hs,{clientThreadId:i,children:e.jsx(Ws,{hideHeader:!0,embedded:!0,renderEmptyState:x})})}):e.jsx(Ds,{clientThreadId:i,hideHeader:!0,renderEmptyState:x()}),e.jsx(Fa.Sidebars,{children:e.jsx(Oa,{clientThreadId:i,overrideWidth:0,isAutoFocusDisabled:!0})})]})]}),o==="debug"&&e.jsx(Ti,{clientThreadId:i,slideOver:!1,onClose:()=>de.toggleActiveSidebar("debug"),isOpen:!0})]})})})}const ps=Ts.memo(Ii);function _i(s){const t=$s({clientThreadId:s});return u.useCallback((i,r,n)=>{t({promptMessage:mt(`Call the ${r} API with the ${n} operation`,{jit_plugin_data:{from_client:{type:"test",operation:n,tool_name:la(r)}}}),completionMetadata:{conversationMode:{kind:ie.GizmoTest,gizmo_id:i}}})},[t])}const Ni=qe(()=>Ve(()=>import("./b62offkhvw883hku.js"),__vite__mapDeps([13,2,1,3,14,4,5,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,12,44,45,46,47,48,49,8,10,50,51,52,53,54,6,55,56,57,58,59,60])).then(s=>s.GizmoActionsEditor));var Xs=(s=>(s.MAGIC_MAKER="magic",s.ADVANCED="advanced",s.PREVIEW="preview",s))(Xs||{});function ze({value:s,label:t,testId:a}){return e.jsx(zs,{value:s,className:"text-md w-1/3 flex-grow rounded-lg border-token-border-light p-1.5 font-semibold text-token-text-tertiary transition hover:text-token-text-primary radix-state-checked:border radix-state-checked:bg-token-main-surface-primary radix-state-checked:text-token-text-primary radix-state-checked:shadow-[0_0_2px_rgba(0,0,0,.03)] md:w-1/2","data-testid":a,children:t})}function Gi({className:s,editorTab:t,setEditorTab:a}){const i=$(),{value:r}=Pe("1393076427");return e.jsxs(Rs,{className:re("flex w-full overflow-hidden rounded-xl bg-token-main-surface-secondary p-1.5 md:w-1/2",s),value:t,onValueChange:n=>{a(n)},children:[r&&e.jsx(ze,{value:"magic",label:i.formatMessage(Ee.magicMakerLabel)}),e.jsx(ze,{value:"advanced",label:i.formatMessage(Ee.configureLabel),testId:"gizmo-editor-configure-button"}),e.jsx("div",{className:"flex w-1/3 md:hidden",children:e.jsx(ze,{value:"preview",label:i.formatMessage(Ee.previewLabel)})})]})}function Ai(s,t){return s.length!==t.length?!1:s.every(a=>t.some(i=>i.type===a.type))}function Li(s,t){return s.name===t.gizmo.display.name&&s.description===t.gizmo.display.description&&s.instructions===t.gizmo.instructions&&Ai(s.tools,t.tools)&&He(s.files?.map(a=>a.file_id)??[],t.files?.map(a=>a.file_id)??[])&&s.profilePictureUrl==t.gizmo.display.profile_picture_url&&s.profilePictureId==t.gizmo.display.profile_pic_id}const Zs=({gizmo:s,onNewGizmoId:t})=>{const a=ks(),i=Qe(),r=Os(ve.BrowsingAvailable),n=i?.includes(ve.GizmoCanvasToggle)&&i?.includes(ve.Canvas),o=$(),c=ne(),f=()=>{const j=[];return r&&j.push({type:H.BROWSER}),n&&j.push({type:H.CANVAS}),{...us,tools:[...us.tools,...j]}},l=u.useRef(s!=null?cs(s):f()),M=u.useRef(s),w=u.useRef(l.current),[d,m]=u.useState(()=>l.current),[x,h]=u.useState(()=>je()),[S]=u.useState(()=>({context_message:qa(l.current),model_slug:"unused",enabled_tools:[{tool_id:s!=null?"gizmo_editor":"gizmo_creator"}]}));ei(x,w.current,S);const{data:C}=gt(),k=C?.models.get(ft)??(C&&Ia(C.models.values(),j=>j.tags.includes(pt.GPT_4o))),{data:b}=ga(l.current.id),L=fa(),{isPending:v,error:p}=L,T=pa(),I=u.useMemo(()=>b!=null&&!Li(d,b),[d,b]),E=async()=>{const j=l.current;try{const P=await L.mutateAsync({editorData:j,gizmoId:j.id});if(M.current=P,l.current.id==null){const N=P.gizmo.id;l.current={...l.current,id:N,sharingTargets:P.gizmo.sharing_targets},m(l.current),t?.(N)}for(const N of P.tools.filter(D=>D.type===H.JIT_PLUGIN)){const D=l.current.tools.find(ee=>ee.type===H.JIT_PLUGIN&&ee.metadata.domain===N.metadata.domain);D&&D.metadata.action_id!==N.metadata.action_id&&(D.metadata={...D.metadata,action_id:N.metadata.action_id},m(l.current))}return P}catch(P){const N=Ps(P)??o.formatMessage(Ys.errorSavingDraft);throw c.warning(N,{duration:2}),P}},G=u.useRef(void 0),U=async()=>l.current.id!=null?l.current.id:(G.current==null&&(G.current=E().then(j=>j.gizmo.id).catch(j=>{throw G.current=void 0,j})),G.current),[B]=u.useState(()=>ha(()=>E(),2e3,{trailing:!0})),R=u.useCallback((j,P=!0)=>{const N=typeof j=="function"?j(l.current):xa(l.current,j);He(N,l.current)||(l.current=N,m(l.current),P&&B())},[B]),F=u.useRef(void 0);u.useEffect(()=>Ss(ht,{completionFinished:async j=>{const P=j.serverThreadId;if(P==null){pe(!1);return}try{const N=await $a(l.current,P,c,F.current);N!=null&&(R(N),w.current=_s(l.current))}catch(N){Ue.addError(N),c.warning("Something went wrong generating your GPT",{duration:3})}finally{F.current=W.getThreadCurrentLeafId(P),pe(!1)}}}),[c,R]);const K=Ya(x,S),[q,Q]=u.useState(void 0);u.useEffect(()=>{Q(ka(s))},[s?.gizmo.id]);const fe=async(j,P)=>{const N=ke(l.current,j.recipient,P);if(N.length>0){c.warning(`Could not save GPT:

${N.map(se=>`- ${Oe(se)}`).join(`
`)}`,{duration:3});return}const D=await E(),ee=D.gizmo.id;try{return bs.logEvent(Ms.promoteGizmo,{gizmo_id:D.gizmo.id,sharing_recipient:j.recipient,editor_tab:_}),await T.mutateAsync({gizmoId:D.gizmo.id,data:{sharingSubjects:j.subjects,sharingRecipient:j.recipient,categories:P==null?void 0:[P]}},{onSuccess(_e){a.setQueryData(ds(a,ee).queryKey,_e),a.invalidateQueries({queryKey:["gizmos"]}),a.invalidateQueries({queryKey:["gizmo",{gizmoId:ee}]}),a.invalidateQueries({queryKey:["gizmo","userActionSettings",{gizmoId:ee}]})}})}catch(se){if(se instanceof va)Q({gizmoId:ee,sharingRecipient:j.recipient,moderationType:Bs.PublishBlocked,sharingTargets:se.response?.sharing_targets,showModal:le.AppealAvailable});else{Ue.addError(se);const _e=se.detail??"An unknown error occurred";c.warning("Error saving GPT - "+_e,{duration:6})}}},{value:y}=Pe("1393076427"),[_,ss]=u.useState(()=>{if(!y)return"advanced";const j=is.getItem(ns.GizmoEditorTab);return Object.values(Xs).includes(j)?j:"magic"}),Ce=xt.useState(({windowWidth:j})=>j);u.useEffect(()=>{Ce!=null&&Ce>=768&&_==="preview"&&ss("magic")},[Ce,_]);const[Js,et]=u.useState(!1),[ts,pe]=u.useState(!1),[as,Ie]=u.useState(void 0);return e.jsxs("div",{className:"flex h-screen w-full flex-col items-center",children:[e.jsx(mi,{gizmoEditorData:d,isUpsertLoading:L.isPending,isPromoteLoading:T.isPending,hasUnpublishedChanges:I,isUploadingProfilePic:Js,isGeneratingProfilePic:ts,publishedGizmo:b,updateGizmo:R,promoteGizmo:async(j,P)=>{const N=await fe(j,P);return l.current={...l.current,sharingRecipient:j.recipient},m(l.current),is.setItem(ns.GizmoEditorTab,_),N},appealGizmo:async(j,P)=>{q!=null&&Q({...q,sharingRecipient:j,categories:P==null?void 0:[P],showModal:le.AppealAvailable})},setAppealState:Q,revertDraft:b!=null&&I?()=>{const j=a.getQueryData(ds(a,l.current.id).queryKey);if(j!=null){const P=cs(j);l.current=P,m(P),E()}}:void 0,draftMessage:e.jsx(Si,{isPublished:b!=null&&(b.gizmo.share_recipient==="marketplace"||b.gizmo.share_recipient==="workspace"),hasUnpublishedChanges:I,isSavingDraft:v,upsertDraftError:p,className:"text-sm"}),showActionsModal:j=>{Ie(j)},className:"flex-shrink-0"}),q&&e.jsx(Ca,{appealState:q,onAppealClose:()=>Q({...q,showModal:le.None}),onAppealSubmitted:()=>Q({...q,showModal:le.AppealSent})}),e.jsxs("div",{className:"relative flex w-full grow overflow-hidden",children:[e.jsx("div",{className:"flex w-full justify-center md:w-1/2",children:e.jsx("div",{className:"h-full grow overflow-hidden",children:as!==void 0?e.jsx(Ni,{currentlyEditingActionDomain:as,gizmoEditorData:d,updateGizmo:R,onClose:()=>{Ie(void 0)}}):e.jsxs("div",{className:"flex h-full flex-col px-2 pt-2",children:[e.jsx("div",{className:"flex w-full flex-row justify-center",children:e.jsx(Gi,{editorTab:_,setEditorTab:ss,className:"mb-2 flex-shrink-0 self-center"})}),e.jsx("div",{className:"grow overflow-hidden",children:_==="magic"?e.jsx("div",{className:"h-full w-full pb-5",children:e.jsx(ti,{gizmoEditorData:d,updateGizmo:R,clientThreadId:x,gizmoEditorDataRef:l,magicMakerBehaviorOverrides:S,magicMakerConversationGizmoEditorDataRef:w,requireGizmoId:U},x)}):_==="advanced"?e.jsx(Mi,{gizmoEditorData:d,updateGizmo:R,currentModelConfig:k,generateProfilePic:()=>{pe(!0),K(l,w,[Xa])},setIsUploadingProfilePic:et,isGeneratingProfilePic:ts,setIsGeneratingProfilePic:pe,requireGizmoId:U,onShowActionsEditor:j=>{Ie(j)}}):e.jsx(ps,{gizmoEditorData:d,isSavingDraft:v,showTitle:!1})})]})})}),e.jsx("div",{className:re("hidden w-1/2 justify-center border-l border-token-border-medium bg-token-main-surface-secondary pt-4",_!=="preview"&&"md:flex"),children:e.jsx("div",{className:"flex-grow pb-5 screen-arch:pb-0 screen-arch:[--embedded-screen-padding-bottom:20px]",children:e.jsx("div",{className:"h-full",children:e.jsx(ps,{gizmoEditorData:d,isSavingDraft:v})})})})]})]})};function Ri({gizmoId:s,version:t}){const{data:a}=da({gizmoId:s,draft:!0,version:t}),i=Me(Ls.accountUserId),n=ua()?.id,o=a!=null&&i!=null&&n!=null&&ma(a);return a==null||!o?null:e.jsx(Zs,{gizmo:a})}function zi({onNewGizmoId:s}){return e.jsx(Zs,{onNewGizmoId:s})}const Ei=({gizmoId:s,remixSourceId:t,version:a})=>{const i=ge(),r=Se(),n=u.useRef(void 0);u.useEffect(()=>(de.enterGizmoEditor(),()=>{de.exitGizmoEditor()}),[]);let o=s;return s!=null&&n.current===s&&(o=void 0),_a({resetThreadAction:()=>{i("/")}}),r?.data?o!==void 0?e.jsx(Ri,{gizmoId:o,version:a},o):e.jsx(zi,{remixSourceId:t,onNewGizmoId:c=>{n.current=c,window.history.replaceState(window.history.state,"",ca(c))}}):e.jsx("div",{className:"flex min-h-screen items-center justify-center",children:e.jsx(Ze,{})})},Ee=oe({magicMakerLabel:{id:"gizmo.magicMakerLabel",defaultMessage:"Create"},configureLabel:{id:"gizmo.advancedLabel",defaultMessage:"Configure"},previewLabel:{id:"gizmo.previewLabel",defaultMessage:"Preview"}});function Ui(s){const t=ge();u.useEffect(()=>{s||t(vt(jt.NO_ACCESS))},[s,t])}const ln=()=>(bt(),null),cn=yt(function(){const t=Se();Ui(t==null||t.canCreateGPTs());const a=Tt(),[i]=kt(),r=ge(),n=a.slug,o=i.get("version"),c=n?Mt(n):void 0,f=i.get("remixFrom");return u.useEffect(()=>{wt(!0).then(l=>{ja.initializeAndGatherData(l),Pt.initializeAndGatherData(l)})},[]),u.useEffect(()=>{t!=null&&!t.canCreateGPTs()&&r("/")},[t,r]),u.useEffect(()=>{c&&ms(c)&&r(`/g/${n}/project`)},[c,r,n]),!t?.canCreateGPTs()||c&&ms(c)?null:e.jsx(ya,{children:e.jsx(Ei,{gizmoId:c,remixSourceId:f??void 0,version:o!=null?Number(o):void 0})})});export{Ci as G,ki as a,ln as c,cn as g};
//# sourceMappingURL=neq4crs76ff9btm7.js.map
